<div id="wrapperApplication" class="container-fluid"></div>
<!-- template section starts -->
<script type="text/x-kendo-template" id="layout">
	<div id="menu"></div>			
	<div id="content" class="row-fluid container"></div>
</script>
<script type="text/x-kendo-template" id="blank-tmpl">
</script>
<script type="text/x-kendo-template" id="menu-tmpl">
	<div class="menu-hidden sidebar-hidden-phone menu-left hidden-print">
		<div class="navbar main navbar-fixed-top" id="main-menu">
			<ul class="topnav">
				<li><a href="#" data-bind="click: checkRole"><img src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/banhji-logo.png" style="height: 40px;"></a></li>
			</ul>
			<form class="navbar-form pull-left">
				<div class="btn-group">
				  	<a class="btn btn-inverse dropdown-toggle" data-toggle="dropdown" href="#">
				    	<i class="icon-th"></i>
				    	<span class="caret"></span>
				  	</a>
				  	<ul class="dropdown-menu">
				    	<li data-bind="click: searchContact"><a href="#"><i class="icon-user"></i> Contact</a></li>
				    	<li data-bind="click: searchTransaction"><a href="#"><i class="icon-random"></i> Transaction</a></li>
				    	<li data-bind="click: searchItem"><a href="#"><i class="icon-th-list"></i> Item</a></li>
				  	</ul>
				</div>
			  	<input type="text" class="span2 search-query" placeholder="Search Contact" id="search-placeholder" 
			  			data-bind="value: searchText" 
			  			style="background-color: #555555; color: #ffffff; border-color: #333333; height: 22px;">
			  	<button type="submit" class="btn btn-inverse" data-bind="click: search"><i class="icon-search"></i></button>
			</form>
			<ul class="topnav" id="secondary-menu">
			</ul> 
			<ul class="topnav pull-right">
				<li role="presentation" class="dropdown">
			  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"> <i class="icon-th-list"></i> <span class="caret"></span></a>
		  			<ul class="dropdown-menu ul-multiTaskList" data-template="multiTaskList-row-template" data-bind="source: multiTaskList">  				  				
		  			</ul>
			  	</li>
				<li role="presentation" class="dropdown">
			  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">[<span data-bind="text: getUsername"></span>] <span class="caret"></span></a>
		  			<ul class="dropdown-menu">  				  				
		  				<li><a href="#" data-bind="click: lang.changeToKh">ភាសាខ្មែរ</a></li>
    					<li><a href="#" data-bind="click: lang.changeToEn">English</a></li>
						<li class="divider"></li>	
						<li><a href="#/manage" data-bind="click: logout"><i class="icon-power-off"></i> Logout</a></li> 				
		  			</ul>
			  	</li>				
			</ul>
		</div>
	</div>
</script>
<script id="multiTaskList-row-template" type="text/x-kendo-template">	
    <li>
    	<a href="\#/#=url#">
    		#=name#
    		<span title="Remove" class="multiTaskList glyphicons remove_2 pull-right" data-bind="click: removeLink">
    			<i></i>
    		</span>
    	</a>

    </li>	
</script>
<script type="text/x-kendo-template" id="index">
	<div class="row-fluid">
		<div class="span6">
			<div class="row">
				<div class="span12" style="padding-left: 0; margin-left: 0; margin-top: 0;">
					<ul id="module-image">
						<li style="text-align:center;">
							<a href="#/customers ">
								<img title="Customers Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/customers.jpg" alt="Customer">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.customers" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/vendors">
								<img title="Supplier Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/supplier.jpg" alt="Vendor">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.suppliers" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/inventories">
								<img title="Products/Sercies Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/inventory.jpg" alt="Inventory">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.products_services" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/documents">
								<img title="Attached Documents" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/attach_file.jpg" alt="Attachment">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.documents" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
					</ul>
					<ul id="module-image">						
						<li style="text-align:center;">
							<a href="#/accounting">
								<img title="Accounting Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/accounting.jpg" alt="Customer">							
								<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.accounting" style="margin-top: 8px; display: inline-block;" style="margin-top: 5px; display: inline-block;"></span></span>
							</a>
						</li>
						<li style="text-align:center;">
							<a href="#/reports">
								<img title="Reports Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/report.jpg" alt="Reports">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.reports" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/sale_tax">
								<img title="Tax Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/tax.jpg" alt="Tax">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.tax" style="margin-top: 5px; display: inline-block;" style="margin-top: 5px; display: inline-block;"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="<?php echo base_url(); ?>admin">
								<img title="Admin Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/setting.jpg" alt="Admin">
								<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.settings" style="margin-top: 5px; display: inline-block;" style="margin-top: 5px; display: inline-block;"></span></span>
							</a>
						</li>											
					</ul>
				</div>
			</div>
			<div class="row" style="margin-top: 5px;">
				<div class="span12" style="width: 100%; padding: 0 5px;">
					<div class="home-chart" style="width: 95%; padding: 0 15px;">
						
						<div data-role="chart"
							 data-auto-bind="false"
			                 data-legend="{ position: 'top' }"
			                 data-series-defaults="{ type: 'column' }"
			                 data-tooltip='{
			                    visible: true,
			                    format: "{0}%",
			                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
			                 }'                 
			                 data-series="[
			                                 { field: 'cash_in', name: 'Cash In', categoryField:'month', color: '#236DA4' },
			                                 { field: 'cash_out', name: 'Cash Out', categoryField:'month', color: '#A6C9E3' }
			                             ]"	                             
			                 data-bind="source: graphDS"
			                 style="height: 240px;" ></div>
			           
					</div>
				</div>
			</div>
			<br>
			<br>
		</div>		
		
		<div class="span6">
			<div class="row">
				<div class="span12" style="background: #fff;">
					<!-- Add New Board -->
					<div class="board-add" style="padding: 15px 0;">
						<div class="span4" style="padding-right: 0;">
							<h2 style="color: #6399D5; font-size: 20px;" data-bind="text: lang.lang.welcome"></h2>
							<p style="font-size: 12px;">
								<span data-bind="text: lang.lang.to_get_you_started_with_banhji"></span> <a target="_blank" href="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/guide/welcome_guide.pdf">[Welcome Guide]</a>.
							</p>
						</div>
						<div class="span8" style="padding-right: 0; padding-left: 0;">
							<div class="span12" style="padding-right: 0; padding-left: 0;">
								<div class="span3">
									<a href="#/customer" class="center">
										<img  title="Add Customer" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/customers.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/vendor" class="center">
										<img  title="Add Supplier" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/suppliers.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/item" class="center">
										<img  title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/item_service" class="center">
										<img  title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
									</a>
								</div>
							</div>
						</div>
					</div><!--End Add New Board -->

				</div>
				
				<div class="board-chart">
					<div class="span12">
						<h4 data-bind="text: companyName"></h4>
						<h2 style="color: #113051; margin-bottom: 11px; display: inline-block; width: 100%;" data-bind="text: lang.lang.financial_snapshot"></h2>
						<span style="color: #000000;"><span data-bind="text: lang.lang.as_of"></span>:&nbsp;<span id="today-date" data-bind="text: today"></span></span><br/>
					</div>
				</div>

				<div class="board-chart">
					<div class="span12">
						<div class="span6">
							<p><span data-bind="text: lang.lang.performance"></span></p>
							<a href="#/statement_profit_loss">
								<table class="performance">
									<tr>
										<td><span data-bind="text: lang.lang.income"></span></td>
										<td></td>
										<td align="right"><span data-bind="text: income"></span></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.expense"></span></td>
										<td></td>
										<td align="right"><span data-bind="text: expense"></span></td>
									</tr>
									<tr>
										<td><b><span data-bind="text: lang.lang.net_income"></span></b></td>
										<td></td>
										<td align="right"><b data-bind="text: net_income"></b></td>
									</tr>
								</table>
							</a>     
						</div>
						<div class="span6">
							<p><span data-bind="text: lang.lang.position"></span></p>
							<a href="#/statement_financial_position">
								<table class="position" style="width: 100%;">
									<tr>
										<td><span data-bind="text: lang.lang.asset"></span></td>
										<td></td>
										<td align="right"><span data-bind="text: asset"></span></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.liabilities"></span></td>
										<td></td>
										<td align="right"><span data-bind="text: liability"></span></td>
									</tr>
									<tr>
										<td><b><span data-bind="text: lang.lang.equity"></span></b></td>
										<td></td>
										<td align="right"><b data-bind="text: equity"></b></td>
									</tr>
								</table>
							</a>
						</div>
					</div>
					
					<div class="span12">
						<div class="span6">
							<a href="#/customer_balance_summary">
								<div class="widget-body alert-info welcome-nopadding" >
									<p><span data-bind="text: lang.lang.receivable"></span></p>
							
									<div align="center" class="text-large strong" data-bind="text: ar"></div>
								
									<table width="100%" >
										<tr align="center">
											<td>										
												<span data-bind="text: ar_open"></span>
												<br>
												<span><span data-bind="text: lang.lang.open"></span></span>
											</td>
											<td>
												<span data-bind="text: ar_customer"></span>
												<br>
												<span><span data-bind="text: lang.lang.customers"></span></span>
											</td>
											<td>
												<span data-bind="text: ar_overdue"></span>
												<br>
												<span><span data-bind="text: lang.lang.overdue"></span></span>
											</td>
										</tr>
									</table>
								</div>
							</a>
						</div>
						<div class="span6">
							
							<a href="#/suppliers_balance_summary">
								<div class="widget-body  alert-info welcome-nopadding" style="width: 100%;">
									<p><span data-bind="text: lang.lang.payables"></span></p>
							
									<div align="center" class="text-large strong" data-bind="text: ap"></div>
								
									<table width="100%">
										<tr align="center">
											<td>										
												<span data-bind="text: ap_open"></span>
												<br>
												<span><span data-bind="text: lang.lang.open"></span></span>
											</td>
											<td>
												<span data-bind="text: ap_vendor"></span>
												<br>
												<span><span data-bind="text: lang.lang.suppliers"></span></span>
											</td>
											<td>
												<span data-bind="text: ap_overdue"></span>
												<br>
												<span><span data-bind="text: lang.lang.overdue"></span></span>
											</td>
										</tr>
									</table>
								</div>
							</div>
						</a>
					</div>					
				</div>	

			</div>
		</div>
	</div>

	<div class="row-fluid">
		<div style="margin-top: 10px; margin-left: 0;" align="center">
			<p><span data-bind="text: lang.lang.all_rights_reserved"></span></p>
		</div>	
	</div>		
</script>

<!-- <script type="text/x-kendo-template" id="index">
	<div class="row-fluid">
		<div class="span6">
			<div class="row">
				<div class="span12" style="padding-left: 0; margin-left: 0; margin-top: 0;">
					<ul id="module-image">
						<li style="text-align:center;">
							<a href="#/customers ">
								<img title="Customers Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/customers.jpg" alt="Customer">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span ></span>Customers</span>
						</li>
						<li style="text-align:center;">
							<a href="#/vendors">
								<img title="Supplier Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/supplier.jpg" alt="Vendor">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span ></span>Suppliers</span>
						</li>
						<li style="text-align:center;">
							<a href="#/inventories">
								<img title="Inventories Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/inventory.jpg" alt="Inventory">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span ></span>Products/Services</span>
						</li>
						<li style="text-align:center;">
							<a href="#/documents">
								<img title="Attached Documents" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/attach_file.png" alt="Attachment">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span ></span>Documents</span>
						</li>
					</ul>
					<ul id="module-image">
						<li style="text-align:center;">
							<a href="#/cashs">
								<img title="Cash Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/1.png" alt="Cash Management">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000">Cash MGT.</span>
						</li>
						<li style="text-align:center;">
							<a href="#/accounting">
								<img title="Accounting Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/accounting.jpg" alt="Customer">							
								<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.accounting"></span></span>
							</a>
						</li>
						<li style="text-align:center;">
							<a href="#/reports">
								<img title="Reports Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/report.jpg" alt="Reports">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span ></span>Reports</span>
						</li>
						<li style="text-align:center;">
							<a href="<?php echo base_url(); ?>admin">
								<img title="Setting Module" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/setting.jpg" alt="Admin">
								<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.settings"></span></span>
							</a>
						</li>
					</ul>
				</div>
				
				<div class="span12" style="padding-left: 0; margin-left: 0; margin-top: 30px;">
					<h4 style="margin-left: 35px; width: 450px;"><span data-bind="text: lang.lang.subcribed_industry_modules"></span></h4>
					<ul id="module-image">
						<li style="text-align:center;">
							<a href="#">
								<img src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/web_store.jpg" alt="Customer">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.web_store"></span></span>
						</li>
						<li style="text-align:center;">
							<a href="#/sale_tax">
								<img src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/tax.jpg" alt="Tax">
							</a>
							<span style="margin-top: 5px; font-size: 14px; font-weight: bold; color: #000000"><span data-bind="text: lang.lang.tax"></span></span>
						</li>
					</ul>	
				</div>
			</div>	
		</div>
		
		
		<div class="span6">
			<div class="row">
				<div class="span12">					

					
					<div class="board-add">
						<div class="span6">
							<h2>Welcome on board!</h2>
							<p>
								To get you started with BanhJi, please have a look at this <a target="_blank" href="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/guide/welcome_guide.pdf">[Welcome Guide]</a>.
							</p>
						</div>
						<div class="span6">
							<div class="span12">
								<div class="span3">
									<a href="#/customer" class="center">
										<img title="Add Customer" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/customers.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/vendor" class="center">
										<img title="Add Supplier" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/suppliers.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/item" class="center">
										<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
									</a>
								</div>
								<div class="span3">
									<a href="#/item_service" class="center">
										<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
									</a>
								</div>
							</div>
						</div>
					</div>

				
					<div class="board-financial">
						<div class="span12">
							<h4 data-bind="text: companyName"></h4>
							<h2 style="color: #113051;">Financial Snapshot</h2>
							<span style="color: #000000;">As of:&nbsp;<span id="today-date" data-bind="text: today"></span></span><br/>
						</div>
					</div>

					
					<div class="board-chart">
						<div class="span12">
							<div class="span6">
								<p>Performance</p>
								<table class="performance">
									<tr>
										<td>Income</td>
										<td></td>
										<td>0</td>
									</tr>
									<tr>
										<td>Expense</td>
										<td></td>
										<td>0</td>
									</tr>
									<tr>
										<td><b>Net Income</b></td>
										<td></td>
										<td><b>0</b></td>
									</tr>
								</table>
							</div>
							<div class="span6">
								<p>Position</p>
								<table class="position" style="width: 100%;">
									<tr>
										<td>Assets</td>
										<td></td>
										<td>0</td>
									</tr>
									<tr>
										<td>Liabilities</td>
										<td></td>
										<td>0</td>
									</tr>
									<tr>
										<td><b>Equity</b></td>
										<td></td>
										<td><b>0</b></td>
									</tr>
								</table>
							</div>
						</div>
						
						<div class="span12">
							<div class="span6">
								<a href="#/customer_balance">
									<div class="widget-body alert-info welcome-nopadding" >
										<p>RECEIVABLES</p>
								
										<div align="center" class="text-large strong" data-bind="text: ar"></div>
									
										<table width="100%" >
											<tr align="center">
												<td>										
													<span data-bind="text: ar_open"></span>
													<br>
													<span>Open</span>
												</td>
												<td>
													<span data-bind="text: ar_customer"></span>
													<br>
													<span>Customer</span>
												</td>
												<td>
													<span data-bind="text: ar_overdue"></span>
													<br>
													<span>Overdue</span>
												</td>
											</tr>
										</table>
									</div>
								</a>
							</div>
							<div class="span6">
								

								<div class="widget-body  alert-info welcome-nopadding" style="width: 100%;">
									<p>PAYABLES</p>
							
									<div align="center" class="text-large strong" data-bind="text: ap"></div>
								
									<table width="100%">
										<tr align="center">
											<td>										
												<span data-bind="text: ap_open"></span>
												<br>
												<span>Open</span>
											</td>
											<td>
												<span data-bind="text: ap_vendor"></span>
												<br>
												<span>Supplier</span>
											</td>
											<td>
												<span data-bind="text: ap_overdue"></span>
												<br>
												<span>Overdue</span>
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>

						<div class="span12">
							<div class="home-chart">
								
								<div data-role="chart"
									 data-auto-bind="false"
					                 data-legend="{ position: 'top' }"
					                 data-series-defaults="{ type: 'column' }"
					                 data-tooltip='{
					                    visible: true,
					                    format: "{0}%",
					                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
					                 }'                 
					                 data-series="[
					                                 { field: 'cash_in', name: 'Cash In', categoryField:'month', color: '#236DA4' },
					                                 { field: 'cash_out', name: 'Cash Out', categoryField:'month', color: '#A6C9E3' }
					                             ]"	                             
					                 data-bind="source: graphDS"
					                 style="height: 250px;" ></div>
					            
							</div>
						</div>
					</div>
					
				</div>
			</div>
		</div>
	</div>

	<div class="row-fluid">
		<div style="margin-top: 10px; margin-left: 0;" align="center">
			<p>© 2016 BanhJi PTE. Ltd. All rights reserved.</p>
		</div>	
	</div>		
</script> -->

<script id="searchAdvanced" type="text/x-kendo-template">
    <div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" onclick="javascript:window.history.back()"><i></i></span>						
					</div>
			        
			        <h2>SEARCH</h2>
				    
				    <br>	
				    
				    <!-- Result -->
				    <span class="results"><span data-format="n0" data-bind="text: found"></span> result found <i class="icon-circle-arrow-down"></i></span>
					
					<div data-role="listview"
						 data-auto-bind="false"
						 data-selectable="true"				                 
		                 data-template="searchAdvanced-contact-template"
		                 data-bind="source: contactDS"></div>
		            <div data-role="listview"
						 data-auto-bind="false"
						 data-selectable="true"				                 
		                 data-template="searchAdvanced-transaction-template"
		                 data-bind="source: transactionDS"></div>
		            <div data-role="listview"
						 data-auto-bind="false"
						 data-selectable="true"				                 
		                 data-template="searchAdvanced-item-template"
		                 data-bind="source: itemDS"></div>
		            <div data-role="listview"
						 data-auto-bind="false"
						 data-selectable="true"				                 
		                 data-template="searchAdvanced-account-template"
		                 data-bind="source: accountDS"></div>					
					<!-- End Result -->

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="searchAdvanced-contact-template" type="text/x-kendo-template">
	<dl data-bind="click: selectedContact">			
		<dt>
			<div class="widget widget-heading-simple widget-body-multiple widget-offers">
				<div class="widget-body">
					
					<!-- Media item -->
					<div class="media">
						<img class="media-object pull-left thumb hidden-tablet hidden-phone" 
							src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/contact.ico" 
							style="width: 100px; height: 100px;">
						<div class="media-body">
							<h5>#=surname# #=name#</h5>							
							<span>#=abbr# #=number#</span>							
							<br>
							<span>#=company#</span>
							<br>
							<span>#=contact_type#</span>
														
						</div>
					</div>
					<!-- // Media item END -->
						
				</div>
			</div>
		</dt>											
	</dl>	
</script>
<script id="searchAdvanced-transaction-template" type="text/x-kendo-template">
	<dl data-bind="click: selectedTransaction">			
		<dt>
			<div class="widget widget-heading-simple widget-body-multiple widget-offers">
				<div class="widget-body">
					
					<!-- Media item -->
					<div class="media">
						<img class="media-object pull-left thumb hidden-tablet hidden-phone" 
							src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/transaction.ico" 
							style="width: 100px; height: 100px;">
						<div class="media-body">
							<h5>#=number#</h5>
							<span>#=amount#</span>
							<br>
							<span>#=issued_date#</span>					
						</div>
					</div>
					<!-- // Media item END -->
						
				</div>
			</div>
		</dt>											
	</dl>	
</script>
<script id="searchAdvanced-item-template" type="text/x-kendo-template">
	<dl data-bind="click: selectedItem">			
		<dt>
			<div class="widget widget-heading-simple widget-body-multiple widget-offers">
				<div class="widget-body">
					
					<!-- Media item -->
					<div class="media">
						<img class="media-object pull-left thumb hidden-tablet hidden-phone" 
							src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/item.ico" 
							style="width: 100px; height: 100px;">
						<div class="media-body">
							<h5>#=name#</h5>
							<span>#=number#</span>
							<br>
							<span>#=on_hand#</span>					
						</div>
					</div>
					<!-- // Media item END -->
						
				</div>
			</div>
		</dt>											
	</dl>	
</script>
<script id="searchAdvanced-account-template" type="text/x-kendo-template">
	<dl data-bind="click: selectedAccount">			
		<dt>
			<div class="widget widget-heading-simple widget-body-multiple widget-offers">
				<div class="widget-body">
					
					<!-- Media item -->
					<div class="media">
						<img class="media-object pull-left thumb hidden-tablet hidden-phone" 
							src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/journal.ico" 
							style="width: 100px; height: 100px;">
						<div class="media-body">
							<h5>#=name#</h5>
							<span>#=number#</span>				
						</div>
					</div>
					<!-- // Media item END -->
						
				</div>
			</div>
		</dt>											
	</dl>	
</script>





<!-- ***************************
*	Accounting Section        *
**************************** -->
<script id="accountingDashboard" type="text/x-kendo-template" >
	<div class="row-fluid">
		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<h2 data-bind="text: lang.lang.accounting"></h2>
			        	<p>
			        		<span data-bind="text: lang.lang.acc_in_this_module"></span>
			        	</p>
			        	<div class="supplier-icon">
						    <div class="span4">
						       	<a href="#/txn_item" class="center">
						       		<img title="Add Txn Item"  src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/add_txn_item.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/account" class="center">
						       		<img title="Add New Account" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/journal.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/segment" class="center">
						       		<img title="Add New Segment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/segment.ico" />
						       	</a>
						    </div>
						</div>
			        </td>
			 	</tr>
			</table>
			<table class="table table-borderless table-condensed table-vertical-center ">
				<tr>	
					<td class="center">
						<a href="#/journal">
							<img title="Add Account" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/journal.png" width="110" height="200" />
							<span data-bind="text: lang.lang.journal" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>					
					<td class="center">
						<a href="#/cash_transaction">
							<img title="Add Cash Transaction" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_transaction.png" width="110" height="200" />
							<span data-bind="text: lang.lang.cash_transaction" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">
						<a href="#/cash_advance">
							<img title="Add Cash Advance" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_advance.png" width="110" height="200" />
							<span data-bind="text: lang.lang.cash_advance" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>		
				</tr>
				<tr>
					<td class="center">						
						<a href="#/expense">
							<img title="Add Expense" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/expense.png" width="110" height="200" />
							<span data-bind="text: lang.lang.expense" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">						
						<a href="#/currency_rate">
							<img title="Add Exchange Rate Record" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/currency_record.png" width="110" height="200" />
							<span data-bind="text: lang.lang.ex_rate_record" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">
						<a href="#/segment">
							<img title="Add Segment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/segment.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;" data-bind="text: lang.lang.segment"></span>
						</a>
					</td>			
				</tr>								
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8 dash-accounting">
			<div class="row">
				<div class="span6 accounting-right">
					<div class="financial-report" style="padding-bottom: 0;">
						<p><span data-bind="text: lang.lang.financial_report_standard"></span> <b>Cambodia International Financial Reporting Standards for SMEs (CIFRS for SMEs)</b>
						</p>
						<a style="margin: 0 0 15px;" class="btn-download" href="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/guide/IFRS+for+SME_Khmer.pdf" target="_blank"><span data-bind="text: lang.lang.take_this_standard"></span></a>
						<a style="margin: 0px 0 15px; float: right;" class="btn-download" href="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/guide/IFRS+for+SMEs_Standard_2015.pdf" target="_blank">Download Standards</a>
						<p><span data-bind="text: lang.lang.reporting_currency"></span> <b data-bind="text: reportCurrency"></b></p>
						<p><span data-bind="text: lang.lang.fiscal_year"></span> <b data-bind="text: fiscalDate"></b></p>
					</div>
					<div class="account-stement">
						<a href="#/statement_profit_loss">
							<table class="performance">
								<tr>									
									<td style="padding-left: 0;"><span data-bind="text: lang.lang.income"></span></td>
									<td></td>
									<td align="right"><span data-bind="text: income"></span></td>
								</tr>
								<tr> 									
									<td style="padding-left: 0;"><span data-bind="text: lang.lang.expense"></span></td>
									<td></td>
									<td align="right"><span data-bind="text: expense"></span></td>
								</tr>
								<tr>
									<td style="padding-left: 0;"><b><span data-bind="text: lang.lang.net_income"></span></b></td>
									<td></td>
									<td align="right"><b data-bind="text: net_income"></b></td>
								</tr>
							</table>
						</a> 
							
						<a href="#/statement_financial_position">
							<table class="position">
								<tr>

									<td style="padding-left: 0;"><span data-bind="text: lang.lang.asset"></span></td>
									<td></td>
									<td align="right"><span data-bind="text: asset"></span></td>
								</tr>
								<tr>
									<td style="padding-left: 0;"><span data-bind="text: lang.lang.liabilities"></span></td>
									<td></td>
									<td align="right"><span data-bind="text: liability"></span></td>
								</tr>
								<tr>
									<td style="padding-left: 0;"><b><span data-bind="text: lang.lang.equity"></span></b></td>
									<td></td>
									<td align="right"><b data-bind="text: equity"></b></td>
								</tr>
							</table>
						</a>
					</div>
				</div>
				<div class="span6 accounting-management">

					<div class="span12 capital-box" style="width: 100%;">
						<span data-bind="text: txnRecorded"></span>
						<p class="month" style="width: 70%; text-align: center; margin: 0 auto;" data-bind="text: lang.lang.transactions_recorded"></p>
					</div>
					<!-- <div class="span6 capital-box">
						<span>10</span>
						<p class="month">Unsettled accrual transactions</p>
					</div> -->
					<div class="span12" style="padding: 0;">
						<div class="span6 capital-box" >
							<span data-bind="text: currentRatio"></span> <span>x</span>
							<p class="month" data-bind="text: lang.lang.current_ratio"></p>
						</div>
						<div class="span6 capital-box">
							<span data-bind="text: quickRatio"></span> <span>x</span>
							<p class="month" data-bind="text: lang.lang.quick_ratio"></p>
						</div>
					</div>
					<table width="100%">
						<tr>
							<td>
								<span data-bind="text: lang.lang.return_on_capital_employed"></span>
							</td>
							<td align="right">
								<span data-bind="text: roce"></span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.gross_profit_margin"></span>
							</td>
							<td align="right">
								<span data-bind="text: grossProfitMargin"></span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.profit_margin"></span>
							</td>
							<td align="right">
								<span data-bind="text: profitMargin"></span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.return_on_asset"></span>
							</td>
							<td align="right">
								<span data-bind="text: returnOnAsset"></span> <span>x</span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.account_receivable_collection_period"></span>
							</td>
							<td align="right">
								<span data-bind="text: arCollectionPeriod"></span> <span>days</span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.payable_payment_period"></span>
							</td>
							<td align="right">
								<span data-bind="text: apPaymentPeriod"></span> <span>days</span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.inventory_turnover"></span>
							</td>
							<td align="right">
								<span data-bind="text: inventoryTurnOver"></span> <span>days</span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.cash_conversion_cycle"></span>
							</td>
							<td align="right">
								<span data-bind="text: ccc"></span> <span>days</span>
							</td>
						</tr>
						<tr>
							<td>
								<span data-bind="text: lang.lang.working_capital_to_sale_ratio"></span>
							</td>
							<td align="right">
								<span data-bind="text: wcSale"></span>
							</td>
						</tr>							
					</table>

					
				</div>
			</div>

		

		</div>		

	</div>
</script>

<script id="accountingCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">

							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Account ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>

							<div class="select2-container" style="width: 100%; margin-bottom: 10px;">								
								<input data-role="dropdownlist"
					                   data-option-label="Account Type..."
					                   data-template="account-type-list-tmpl"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: account_type_id,
					                              source: accountTypeDS"
					                   style="width: 100%" />									
							</div>

						</form>					
					</div>
					
					<span class="results"><span data-bind="text: dataSource.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: dataSource"						 
						 data-row-template="accountingCenter-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="accounCetner-textedit">
							<table width="100%">
								<tr>
									<td width="40%"><span data-bind="text: lang.lang.account_number"></span>:</td>
									<td width="60%">
										<span class="strong" data-bind="text: obj.number"></span>
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.account_title"></span>:</td>
									<td>
										<span class="strong" data-bind="text: obj.name"></span>
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.sub_account"></span>:</td>
									<td>
										<span data-bind="text: subName"></span>
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.account_type"></span>:</td>
									<td>
										<span data-bind="text: typeName"></span>
									</td>
								</tr>								
								<tr>
									<td><span data-bind="text: lang.lang.description"></span>:</td>
									<td>
										<span data-bind="text: obj.description"></span>
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.taxable"></span>:</td>
									<td>										
										<input type="checkbox" id="chbTaxable" class="k-checkbox" data-bind="checked: obj.is_taxable">
          								<label class="k-checkbox-label" for="chbTaxable"></label>
									</td>
								</tr>
							</table>

							<span class="btn btn-primary btn-icon glyphicons edit pull-right" data-bind="click: goEdit"><i></i><span data-bind="text: lang.lang.edit"></span></span>

							</div>
						</div>

						<div class="span6 account-center" style="margin-bottom: 10px;">
							<div class="row-fluid" >
								<div class="span12" style="margin-bottom: 10px;">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadTransaction" style=" width: 425px; height:114px; background:#424242; margin-left:0;">
										<span class="glyphicons coins"><i></i></span>										
										<span class="txt">
											<span data-bind="text: lang.lang.balance_as_of_today"></span>
											<span data-bind="text: balance"></span>
										</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5">
										<span class="glyphicons adjust_alt"><i></i></span>
										<span class="txt">
											<span data-bind="text: nature"></span>
											<span data-bind="text: lang.lang.nature_balance"></span>
										</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadTransaction">
										<span class="glyphicons random"><i></i></span>										
										<span class="txt">
											<span data-bind="text: totalTxn"></span>
											<span data-bind="text: lang.lang.transaction"></span>
										</span>										
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >

					  	<button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th data-bind="text: lang.lang.date"></th>
								<th data-bind="text: lang.lang.type"></th>							
								<th data-bind="text: lang.lang.reference_no"></th>
								<th data-bind="text: lang.lang.description"></th>
								<th data-bind="text: lang.lang.dr"></th>
								<th data-bind="text: lang.lang.cr"></th>
								<th></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="accountingCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="accountingCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(dr==0 && cr==0){#
        		#=number#
        	#}else{#
	        	#if(type=="Direct_Expense" || type=="Reimbursement" || type=="Advance_Settlement" ){#
	        		<a href="\#/expense/#=transaction_id#"><i></i> #=number#</a>
	        	#}else if(type=="Deposit" || type=="Witdraw" || type=="Transfer" ){#
	        		<a href="\#/cash_transaction/#=transaction_id#"><i></i> #=number#</a>
	        	#}else if(type=="Cash_Purchase" || type=="Credit_Purchase" ){#
	        		<a href="\#/purchase/#=transaction_id#"><i></i> #=number#</a>
	        	#}else{#
					<a href="\#/#=type.toLowerCase()#/#=transaction_id#"><i></i> #=number#</a>
				#}#
			#}#
        </td>
        <td>#=description#</td>
    	<td class="right">    		
    		#=kendo.toString(dr, locale=="km-KH"?"c0":"c", locale)#    		
    	</td>
    	<td class="right">
    		#=kendo.toString(cr, locale=="km-KH"?"c0":"c", locale)#
    	</td>    	
    	<td align="center">
			#if(type==="Invoice"){#
				<a href="\#/invoice/#=id#"><i></i> Pay</a>				   	
        	#}#
		</td>     	
    </tr>
</script>
<script id="accountingCenter-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				#if(sub_of_id>0){#
					&nbsp;&nbsp;
					<span>
						#=number#				
					</span>
					-
					<span>
						#if(name.length>25){#
							#=name.substring(0, 25)#...
						#}else{#
							#=name#
						#}#
					</span>
				#}else{#
					<span class="strong">
						#=number#				
					</span>
					-
					<span class="strong">
						#if(name.length>25){#
							#=name.substring(0, 25)#...
						#}else{#
							#=name#
						#}#
					</span>
				#}#				
			</div>
		</td>
	</tr>
</script>

<script id="account" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">					
				<div id="example" class="k-content">

			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

				    <h2 data-bind="text: lang.lang.account"></h2>				    		   

				    <br>

				    <div class="row">
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="ddlType"><span data-bind="text: lang.lang.account_type"></span><span style="color:red">*</span></label>
								<input id="ddlType" name="ddlType" 
									   data-role="dropdownlist"					                   
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.account_type_id,
					                              source: accountTypeDS,
					                              events:{change:typeChanges}"
					                   data-option-label="Select Type..."
					                   required data-required-msg="required" style="width: 100%;" />
							</div>
							<!-- // Group END -->
						</div>
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtNumber"><span data-bind="text: lang.lang.account_code"></span><span style="color:red">*</span></label>
								<input id="txtNumber" name="txtNumber" 
										class="k-textbox"
										data-bind="value: obj.number,
													events:{change: checkExistingNumber}"										
										required data-required-msg="required" style="width: 100%;">
								<br>
								<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>								
							</div>
							<!-- // Group END -->
						</div>
				    </div>

				    <div class="row">
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtName"><span data-bind="text: lang.lang.account_name"></span><span style="color:red">*</span></label>
								<input id="txtName" name="txtName" 
										class="k-textbox"
										data-bind="value: obj.name"										
										required data-required-msg="required" style="width: 100%;">
							</div>
							<!-- // Group END -->
						</div>
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtNonLocalName"><span data-bind="text: lang.lang.non_local_name"></span></label>
								<input id="txtNonLocalName" name="txtNonLocalName" 
										class="k-textbox"
										data-bind="value: obj.name_2"
										style="width: 100%;">
							</div>
							<!-- // Group END -->
						</div>
				    </div>

				    <div class="row">
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="ddlSubOf"><span data-bind="text: lang.lang.sub_account"></span></label>
								<input id="ddlSubOf" name="ddlSubOf" 
									   data-role="dropdownlist"
									   data-template="account-list-tmpl"					                   
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.sub_of_id,
					                              source: subAccountDS"
					                   data-option-label="Select Sub Account..."
					                   style="width: 100%;" />
							</div>
							<!-- // Group END -->
						</div>
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span><span style="color:red">*</span></label>
								<input id="ddlStatus" name="ddlStatus" 
									   data-role="dropdownlist"									   				                   
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.status,
					                              source: statusList"
					                   data-option-label="Select Status..."
					                   required data-required-msg="required" style="width: 100%;" />
							</div>
							<!-- // Group END -->
						</div>
				    </div>

				    <div class="row">
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label><input type="checkbox" data-bind="checked: obj.is_taxable" /> <span data-bind="text: lang.lang.taxable"></span></label>			
							</div>
							<!-- // Group END -->
						</div>
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtDescription"><span data-bind="text: lang.lang.description"></span></label>
								<input id="txtDescription" name="txtDescription" 
										class="k-textbox"
										data-bind="value: obj.description" 
										style="height: 50px; width: 100%;">
							</div>
							<!-- // Group END -->
						</div>				    	
				    </div>

				    <br>

				    <div class="row well" data-bind="visible: showBank">
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtBankName"><span data-bind="text: lang.lang.bank_name"></span></label>
								<input id="txtBankName" name="txtBankName" 
										class="k-textbox"
										data-bind="value: obj.bank_name"
										style="width: 100%;">
							</div>
							<!-- // Group END -->
						</div>
				    	<div class="span6">														
							<!-- Group -->
							<div class="control-group">										
								<label for="txtBankAccountNumber"><span data-bind="text: lang.lang.bank_account_no"></span></label>
								<input id="txtBankAccountNumber" name="txtBankAccountNumber" 
										class="k-textbox"
										data-bind="value: obj.bank_account_number"
										style="width: 100%;">
							</div>
							<!-- // Group END -->
						</div>
						
				    </div>

				    <br>

				    <!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> Save New</span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> Delete</span>
							</div>
						</div>
					</div>
					<!-- // Form actions END -->						
			    	
				</div>							
			</div>
		</div>
	</div>
</script>
<script id="journal" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">				
						
				    <span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

				    <h2 span data-bind="text: lang.lang.journal_entry"></h2>				        				        				        	
				   
				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 150px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.type"></span></td>
										<td>
											<input id="ddlType" name="ddlType"
												   data-role="dropdownlist"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.journal_type,
								                              source: types"							                   
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" 
								                   style="width: 100%;" />
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.currency"></span></td>
										<td>
											<input id="cbbCurrency" name="cbbCurrency"
												   data-role="combobox"				                
								                   data-value-primitive="true"
								                   data-template="currency-list-tmpl"				   
								                   data-text-field="code"
								                   data-value-field="locale"
								                   data-bind="value: obj.locale, 
								                   			source: currencyDS, 
								                   			events: {change : setRate}"
								                   placeholder="Select currency..." 
								                   required data-required-msg="required" style="width: 100%" />										
										</td>
									</tr>									
								</table>
							</div>
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							            <li class="span1 glyphicons pencil active"><a href="#tab1-3" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab2-3" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons history"><a href="#tab3-3" data-toggle="tab"><i></i></a>
							            </li>								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							        <!-- Memo Tab content -->
							        <div class="tab-pane active" id="tab1-3">
							        	<textarea id="memo2" cols="0" rows="4" class="k-textbox" 
							        		data-bind="value: obj.memo2" style="width:100%;" 
							        		placeholder="Please enter transaction purpose here ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab2-3">
							         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th data-bind="text: lang.lang.file_name"></th>
									                <th data-bind="text: lang.lang.description"></th>
									                <th data-bind="text: lang.lang.date"></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab3-3">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>
				                <th style="width: 30%;"><span data-bind="text: lang.lang.account"></span></th>
				                <th data-bind="text: lang.lang.description"></th>
				                <th data-bind="visible: showRef" style="width: 7%;"><span data-bind="text: lang.lang.reference"></span></th>
				                <th data-bind="visible: showName" style="width: 15%;"><span data-bind="text: lang.lang.name"></span></th>
				                <th data-bind="visible: showJob" style="width: 7%;"><span data-bind="text: lang.lang.job"></span></th>
				                <th data-bind="visible: showSegment" style="width: 15%;"><span data-bind="text: lang.lang.segment"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.dr_"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.cr_"></span></th>			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview"
				        		data-template="journal-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span6 hidden-print">
							
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0; ">
									<li>
										<input type="checkbox" data-bind="checked: showRef" /> <span data-bind="text: lang.lang.reference"></span>
									</li>
									<li>
										<input type="checkbox" data-bind="checked: showName" /> <span data-bind="text: lang.lang.name"></span>
									</li>
									<li>
										<input type="checkbox" data-bind="checked: showJob" /> <span data-bind="text: lang.lang.job"></span>
									</li>
									<li>
										<input type="checkbox" data-bind="checked: showSegment" /> <span data-bind="text: lang.lang.segment"></span>
									</li>								
								</ul>
							</div>

							<a href="#/account" class="btn btn-default"><span data-bind="text: lang.lang.add_account"></span></a>						
							
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span6">
							<div class="box-generic">						
								<div class="row-fluid row-merge">
									<div class="span6">
										<div class="center">
											<h5 class="strong muted text-uppercase"><span data-bind="text: lang.lang.total_dr"></span></h5>
											<span class="text-large strong text-primary" data-bind="text: dr"></span>
										</div>
									</div>
									<div class="span6">
										<div class="center muted">
											<h5 class="strong muted text-uppercase"><span data-bind="text: lang.lang.total_cr"></span></h5>
											<span class="text-large strong" data-bind="text: cr"></span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- // Column END -->
						
					</div>
		           
		            <br>
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="journal-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: remove }"></i>
			#:banhji.journal.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="cbbAccounts" name="cbbAccounts" 
				   data-role="combobox"                   
                   data-value-primitive="true"
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-header-template="account-header-tmpl"
                   data-bind="value: account_id,
                              source: accountDS"
                   data-placeholder="Add Account.."                                     
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td data-bind="visible: showRef">
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>					
		<td data-bind="visible: showName">
			<input data-role="combobox" id="ddlName"                  
                   data-value-primitive="true"
                   data-template="contact-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: contact_id,
                              source: contactDS"
                   data-placeholder="Add Name.."                    
                   style="width: 100%" />
		</td>
		<td data-bind="visible: showJob">
			<input id="ddlJob" name="ddlJob"
				   data-option-label="Add Job..." 
				   data-role="dropdownlist"                   
                   data-value-primitive="true"                   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: job_id,
                              source: jobDS"
                   data-placeholder="Add Job.."
                   style="width: 80px;" />	
		</td>		
		<td data-bind="visible: showSegment">
			<select data-role="multiselect" id="ddlSegment"
				   data-value-primitive="true"				   
				   data-item-template="segment-list-tmpl"				    
				   data-value-field="id" 
				   data-text-field="code"
				   data-bind="value: segments, 
				   			source: segmentItemDS,
				   			events:{ change: segmentChanges }"
				   data-placeholder="Add Segment.."				   
				   style="width: 100%" /></select>					
		</td>
		<td class="right">
			<input id="ntbDr" name="ntbDr" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n0" 
					data-bind="value: dr, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>
		<td class="right">
			<input id="ntbCr" name="ntbCr" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n0" 
					data-bind="value: cr, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />										
		</td>		
    </tr>   
</script>
<script id="currencyRate" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">
					<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

					<h2 span data-bind="text: lang.lang.exchange_rate"></h2>			    		   

				    <br>

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-body">

					    	<div class="row-fluid">
						    	<div class="span6 alert alert-primary"><span data-bind="text: lang.lang.company_currency"></span> <span data-bind="text: baseCode"></span> </div>
						    	<div class="span6 alert alert-primary"><span data-bind="text: lang.lang.reporting_currency"></span> <span data-bind="text: reportCode"></span> </div>
					    	</div>

							<br>					
							
							<button class="btn btn-inverse hidden-print" data-bind="click: openWindow"><i class="icon-plus icon-white"></i> <span data-bind="text: lang.lang.add_new_rate"></span></button>
							
							<!-- Item List -->
							<table style="margin-top: 15px;" class="table table-bordered table-primary table-striped table-vertical-center">
						        <thead>
						            <tr>
						                <th style="width: 15%;"><span data-bind="text: lang.lang.date"></span></th>
						                <th style="width: 6%;"><span data-bind="text: lang.lang.code"></span></th>
						                <th style="width: 25%"><span data-bind="text: lang.lang.country"></span></th>
						                <th style="width: 15%;"><span data-bind="text: lang.lang.rate"></span></th>
						                <th style="width: 15%;"><span data-bind="text: lang.lang.source"></span></th>
						                <th style="width: 15%;"><span data-bind="text: lang.lang.method"></span></th>
						                <th style="width: 10%;"></th>			                
						            </tr> 
						        </thead>
						        <tbody data-role="listview"
						        		data-template="currencyRate-template"
						        		data-bind="source: dataSource"></tbody>			        
						    </table>
							
				            <div data-role="pager"
					            data-bind="source: dataSource"></div>
						   

						    <!-- Window -->
						    <div data-role="window"
					                 data-title="Exchange Rate"		                 
					                 data-width="350"
					                 data-height="250"
					                 data-actions="{}"
					                 data-position="{top: '30%', left: '37%'}"
					                 data-bind="visible: windowVisible">
						    	
						    	<table class="table table-borderless table-condensed cart_total" >
									<tr>
										<td>										
									    	<input data-role="dropdownlist"
								                   data-option-label="Select Currency"
								                   data-value-primitive="true"
								                   data-text-field="code"
								                   data-value-field="id"
								                   data-template="currency-list-tmpl"
								                   data-bind="value: obj.currency_id,
								                              source: currencyDS"
								                   style="width: 100%" />
							            </td>
					            	</tr>
					            	<tr>
										<td>
							                <input id="date" name="date" 
							            		data-role="datepicker"			            		
					        					data-bind="value: obj.date" CASH ADVANCE
					        					data-format="dd-MM-yyyy"
					        					data-parse-formats="yyyy-MM-dd" 
					        					placeholder="dd-MM-yyyy" 
					        					required data-required-msg="required"
					        					style="width: 100%" />
					        			</td>
					            	</tr>
					            	<tr>
										<td>
					        				<input type="textbox" class="k-textbox" 		                   
							                   data-bind="value: obj.rate"
							                   placeholder="Rate(per 1 unit of base currency) ..."
							                   style="width: 100%" />
							            </td>
					            	</tr>
				                </table>

				                <p>
				                	<span data-bind="text: lang.lang.note_the_exchange_rate_here"></span>
				                </p>			               
					            
					            <div align="center">
									<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i><span data-bind="text: lang.lang.save"></span></span>
									<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i><span data-bind="text: lang.lang.close"></span></span>
								</div>

							</div>
						  					

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="currencyRate-template" type="text/x-kendo-tmpl">		
	<tr>			
		<td>#=kendo.toString(new Date(date), "dd-MM-yyyy")#</td>		
		<td>#=currency.length>0?currency[0].code:""#</td>
		<td>#=currency.length>0?currency[0].country:""#</td>
		<td align="right">#=rate#</td>					
		<td>#=source#</td>
		<td>#=method#</td>				
		<td>			
			<span data-bind="click: edit"><i class="icon-edit"></i> <span data-bind="text: lang.lang.edit"></span></span>	
		</td>		
    </tr>   
</script>
<script id="saleTax" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960" style="overflow: hidden;">					
			<div id="example" class="k-content">
				
		    	<span class="glyphicons no-js remove_2 pull-right" 
						onclick="javascript: window.history.back()"><i></i></span>

		        <h2 span data-bind="text: lang.lang.tax"></h2>

			    <div class="row">
			        <div class="span6">
			        	<p>
				        	<span data-bind="text: lang.lang.these_are_the_tax_items_required_by_your_countries"></span>
				        </p>
			        </div>
			        <div class="span6">
			         	<button class="btn btn-inverse" data-bind="click: openWindow"><i class="icon-plus icon-white"></i>&nbsp&nbsp <span data-bind="text: lang.lang.add_tax_type"></span></button>
						
			        </div>		        				        				        	
			    </div>			   

			    <br>

			    <!-- Tax Type Window -->
			    <div data-role="window"
		                 data-title="Tax Type"		                 
		                 data-width="350"
		                 data-height="290"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '35%'}"
		                 data-bind="visible: windowVisible">
		    		<table>
						<tr style="border-bottom: 8px #fff solid;">
							<td width="50%"><span data-bind="text: lang.lang.tax_system"></span></td>
							<td width="50%">
								<input data-role="dropdownlist"				            			               			   		                   
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.tax_system,
				                              source: typeList"
				                   style="width: 100%;" />
							</td>
						</tr>
						<tr style="border-bottom: 8px #fff solid;">
							<td><span data-bind="text: lang.lang.tax_registration_no"></span></td>
							<td>
								<input class="k-textbox" placeholder="type number ..." data-bind="value: obj.number" style="width: 100%;">
							</td>
						</tr>
						<tr style="border-bottom: 8px #fff solid;">
							<td><span data-bind="text: lang.lang.agency"></span></td>
							<td>
								<input class="k-textbox" placeholder="type agency ..." data-bind="value: obj.agency" style="width: 100%;">
							</td>
						</tr>
						<tr style="border-bottom: 8px #fff solid;">
							<td><span data-bind="text: lang.lang.name"></span></td>
							<td>
								<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
							</td>
						</tr >
						<tr style="border-bottom: 8px #fff solid;">
							<td><span data-bind="text: lang.lang.last_end_date"></span></td>
							<td>
								<input data-role="datepicker"
									data-format="dd-MM-yyyy"
									data-parse-formats="yyyy-MM-dd" 
									data-bind="value: obj.end_date"
									style="width: 100%;" />
							</td>
						</tr>
						<tr>
							<td><span data-bind="text: lang.lang.last_submission_date"></span></td>
							<td>
								<input data-role="datepicker"
									data-format="dd-MM-yyyy"
									data-parse-formats="yyyy-MM-dd" 
									data-bind="value: obj.submission_date"
									style="width: 100%;" />
						</td>
						</tr>
					</table>

					<br>
					<div style="text-align: center;">
						<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i>Save</span>
						<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i><span data-bind="text: lang.lang.close"></span></span> 
					</div> 
				</div>
						
                <div class="row">
	                <div class="span12 table-tax">	                					
		            	<table class="table table-condensed">
		            		<thead style="background-color: #1E4E78; color: #fff; font-weight: bold">
		            			<tr>
		            				<th style="padding-left: 8px !important;"><span data-bind="text: lang.lang.no_"></span></th>
		            				<th data-bind="text: lang.lang.name"></th>
		            				<th data-bind="text: lang.lang.system"></th>
		            				<th data-bind="text: lang.lang.agency"></th>
		            				<th style="text-align: center;"><span data-bind="text: lang.lang.end_date"></span></th>
		            				<th style="text-align: center;"><span data-bind="text: lang.lang.submission_date"></span></th>
		            				<th></th>
		            			</tr>
		            		</thead>
		            		<tbody data-role="listview"			            			
					                data-template="saleTax-type-template"
					                data-bind="source: dataSource"></tbody>
		            	</table>
	            	</div>

	            <!-- Item Window -->
	            <div data-role="window"
		                 data-title="Tax Item"		                 
		                 data-width="285"
		                 data-height="220"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '37%'}"
		                 data-bind="visible: windowItemVisible">
            		<table>
						<tr style="border-bottom: 8px solid #fff;">
							<td width="34%"><span data-bind="text: lang.lang.item_name"></span></td>
							<td>
								<input class="k-textbox" placeholder="type name ..." data-bind="value: item.name" style="width: 100%;">
							</td>
						</tr>
						<tr style="border-bottom: 8px solid #fff;">
							<td width="34%"><span data-bind="text: lang.lang.description"></span></td>
							<td>
								<input class="k-textbox" placeholder="type description ..." data-bind="value: item.description" style="width: 100%;">
							</td>
						</tr>
						<tr style="border-bottom: 8px solid #fff;">
							<td><span data-bind="text: lang.lang.item_rate"></span></td>
							<td>
								<input data-role="numerictextbox"
				                   data-format="p"
				                   data-min="0"
				                   data-max="0.99"
				                   data-step="0.1"                   
				                   data-bind="value: item.rate"
				                   style="width: 100%;">
							</td>
						</tr>
						<tr>
							<td><span data-bind="text: lang.lang.account"></span></td>
							<td>
								<input data-role="dropdownlist" id="ddlAccount"
					                   data-option-label="Select Account..."
					                   data-header-template="account-header-tmpl"
					                   data-template="account-list-tmpl"
					                   data-value-primitive="true"					                   
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: item.account_id,
					                              source: accountDS"
					                   style="width: 100%" />
							</td>
						</tr>
						
					</table>

					<br>
					<div style="text-align: center;">
						<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: saveItem"><i></i><span data-bind="text: lang.lang.save"></span></span>
						<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindowItem"><i></i><span data-bind="text: lang.lang.close"></span></span>
					</div>  
				</div>

				<h3 data-bind="text: taxName" style="margin-left: 20px;"></h3>

				<div class="row">
	            	<div class="span12" style="padding-left: 30px;">		                	
					    <table class="table table-bordered table-white" style="width: 98%;">
		            		<thead>
		            			<tr>
		            				<th style="width:15%"><span data-bind="text: lang.lang.name"></span></th>
		            				<th style="width: 45%;"><span data-bind="text: lang.lang.description"></span></th>
		            				<th data-bind="text: lang.lang.rate"></th>
		            				<th data-bind="text: lang.lang.account"></th>		            					            		
		            				<th></th>
		            			</tr>
		            		</thead>
		            		<tbody data-role="listview"			            				
					                data-template="saleTax-item-template"
					                data-auto-bind="false"
					                data-bind="source: itemDS"></tbody>
		            	</table>
	            	</div>
            	</div>
			</div>							
			</div>
		</div>
	</div>
</script>
<script id="saleTax-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=number#</td>
    	<td>#=name#</td>
    	<td>#=tax_system#</td>
    	<td>#=agency#</td>
    	<td>#=kendo.toString(new Date(end_date), "dd-MM-yyyy")#</td>
    	<td align="center">#=kendo.toString(new Date(submission_date), "dd-MM-yyyy")#</td>
    	<td align="center">
    		<span data-bind="click: edit"><i class="icon-edit"></i> <span data-bind="text: lang.lang.edit"></span></span>
    		|
    		<span data-bind="click: view"><i class="icon-view"></i> <span data-bind="text: lang.lang.view_item"></span></span>
    		|
    		<span data-bind="click: addItem"><i class="icon-plus icon-white"></i> <span data-bind="text: lang.lang.add_tax_item"></span>
    	</td>
   	</tr>
</script>
<script id="saleTax-item-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>#=rate#</td>
    	<td>#=account[0].name#</td>     	 		
   		<td>
    		<span data-bind="click: editItem"><i class="icon-edit"></i> <span data-bind="text: lang.lang.edit"></span></span>
    	</td>
   	</tr>
</script>
<!-- <script id="accountRecurring" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">				
					
			    <div class="hidden-print">
			    	<div class="pull-right">
			    		<span class="glyphicons no-js remove_2" onclick="javascript:window.history.back();"><i></i></span>						
					</div>

			        <h2>ACCOUNTING RECURRING TRANSACTION LISTS</h2>				        				        				        	
			    </div>

			    <br>			   
			   
				
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th style="width: 1%;">No.</th>
			                <th>TEMPLATE NAME</th>
			                <th>NAME</th>
			                <th class="center" style="width: 10%">TYPE</th>
			                <th class="center">START DATE</th>
			                <th class="center">FREQUENCY</th>
			                <th></th>			                			                
			            </tr> 
			        </thead>
			        <tbody data-template="recurring-template"
			        		data-auto-bind="false"			        		
			        		data-bind="source: dataSource"></tbody>			        
			    </table>											

			</div>							
			</div>
		</div>
	</div>
</script> -->
<!-- <script id="recurring-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">			
			#:banhji.recurring.dataSource.indexOf(data)+1#			
		</td>		
		<td>#=recurring_name#</td>
		<td>#=contact.length>0?contact[0].name:""#</td>
		<td class="center">#=type#</td>		
		<td class="center">#=kendo.toString(start_date, "dd-MMMM-yyyy")#</td>
		<td class="center">#=frequency#</td>
		<td class="right">
			<span class="btn btn-success btn-icon glyphicons edit" data-bind="click: goToTemplate" style="width: 80px;"><i></i> Edit</span>
			<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete" style="width: 80px;"><i></i> Delete</span>
		</td>
    </tr>   
</script> -->
<script id="accountRecurring" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<div class="hidden-print">
				    	<div class="pull-right">

				    		<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>						
						</div>

				        <h2 span data-bind="text: lang.lang.accounting_recurring"></h2>				        				    	
				    </div>			   

				    <br>

				    <div data-role="window"
		                 data-title="Job"		                 
		                 data-width="600"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '30%'}"
		                 data-height="300"
		                 data-bind="visible: isVisible">

						<table class="table table-bordered table-primary table-striped table-vertical-center">							
							<tr>
								<td><span data-bind="text: lang.lang.name"></span></td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td><span data-bind="text: lang.lang.description"></span></td>
								<td>
									<input class="k-textbox" placeholder="type description ..." data-bind="value: obj.description" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td><span data-bind="text: lang.lang.customer"></span></td>
								<td>
									<input data-role="combobox"
										   data-template="contact-list-tmpl"				            			               			   		                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.contact_id,
						                              source: contactDS"
						                   style="width: 100%;" />
								</td>
							</tr>							
						</table>

						<br>

						<div align="center">
							<span class="btn btn-icon btn-primary glyphicons ok_2" data-bind="click: save" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-icon btn-danger glyphicons remove_2" data-bind="click: closeWindow" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.close"></span></span>						
						</div>
					</div>
					
										                           					
	            	<table class="table table-bordered table-primary table-striped table-vertical-center">
	            		<thead style="background-color: blue; color: #fff; font-weight: bold">
	            			<th style="width: 1%;">No.</th>
			                <th data-bind="text: lang.lang.template_name"></th>
			                <th data-bind="text: lang.lang.name"></th>
			                <th class="center" style="width: 10%"><span data-bind="text: lang.lang.type"></span></th>
			                <th class="center"><span data-bind="text: lang.lang.start_date"></span></th>
			                <th class="center">FREQUENCY</th>
			                <th></th>
	            		</thead>
	            		<tbody ></tbody>
	            	</table>
	            </div>	            						
			</div>
		</div>
	</div>
</script>

<script id="accountingReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>PERIOD-END CLOSING REPORTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td width="50%">
								<h3><a href="#/journal_report">Journal Entry Report</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/general_ledger">General Ledger</a></h3>								
							</td>						
						</tr>
						<tr>
							<td width="50%">
								<p>
									Lists all accounting transactions within a period of time into debits and credits and displays them chronologically.

								</p>
								
							</td>
							<td width="50%">
								<p>
									Groups all accounting transactions by each account in your chart of accounts within a period of time into debits, credits, and balances. 

								</p>
							</td>
							
						</tr>
						<tr>
							<td width="50%">
								<h3><a href="#/trial_balance">Trial Balance</a></h3>
							</td>
							<!-- <td width="50%">
								<h3><a href="#/transaction_list_date">Transaction List by Date</a></h3>
							</td> -->
						</tr>
						<tr>
							<td width="50%">
								<p>
									Summarizes each account balance on your chart of accounts in the format of debit and credit within a period of time
								</p>
							</td>
							<!-- <td width="50%">
								<p>
									This is similar with journal entry; however, it does not include debit and credit. In addition, it includes not financial transactions, such as sale order or purchase order.

								</p>
							</td> -->
						</tr>

						<!-- <tr>
							<td width="50%">
								<h3><a href="#/recent_transactions_list">Recent Transactions List</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/">Period-End Closing Checklist</a></h3>
							</td>
						</tr>
						<tr>
							<td width="50%">
								<p>
									Lists all transaction recorded or edited within the last five days.
								</p>
							</td>
							<td width="50%">
								
							</td>
						</tr>

						<tr>
							<td width="50%">
							</td>
							<td width="50%">
								
							</td>
						</tr>
						<tr>
							<td width="50%">
							</td>
							<td>
								
							</td>
						</tr> -->

					</table>
				</div>
			</div>

			<div class="row-fluid recevable-report">
				<h2>FINANCIAL STATEMENTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td >
								<h3><a href="#/statement_profit_loss">Statement of Profit or Loss</a></h3>
							</td>
							<td >
								<h3><a href="#/statement_financial_position">Statement of Financial Position</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Provides the progress of your company’s financial performance, summarized in a record of income generated and expenses incurred over a given period.

								</p>
								
							</td>
							<td >
								<p>
									Provides the snapshot of your company’s financial position on value and ownership. It is the relationship of the company’s assets, liabilities and equities as of a specific date.

								</p>
							</td>
							
						</tr>
						<!-- <tr>
							<td >
								<h3><a href="#/statement_profit_loss_comparison">Statement of Profit or Loss Comparison</a></h3>
							</td>
							<td >
								<h3><a href="#/statement_financial_position_comparison">Statement of Financial Position Comparison</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Shows a year-over-year comparison of your financial performance.
								</p>
							</td>
							<td >
								<p>
									Shows a year-over-year comparison of your financial position.
								</p>
							</td>
						</tr>

						<tr>
							<td >
								<h3><a href="#/statement_cash_flow">Statement of Cash Flow</a></h3>
							</td>
							<td >
								<h3><a href="#/statement_changes_equity">Statement of Changes in Equity</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Shows cash generated by your company operating activities, cash spent on investing in your company assets long term asset, and cash in or out from your own share or financial institutions.

								</p>
							</td>
							<td >
								<p>
									Shows the movement of your paid-up capital, dividends, the effects of changes in accounting policies and corrections of errors recognized in the period, and the profit or loss for a reporting period

								</p>
							</td>
						</tr> -->

					</table>
				</div>
			</div>

			<!-- <div class="row-fluid sale-report">
				<h2>CASH POSITION</h2>
				<p>
					The following reports provide summary and detailed reports on employee related transactions.  
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/">Cash Position Report</a></h3>
							</td>
							<td >
								<h3><a href="#/">Cash Payment Report</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Summarizes each inventory balance by quantity on hand, on purchase order and sale order. In addition, it also includes average cost and price.  


								</p>
								
							</td>
							<td >
								<p>
									Lists of all transactions related to and grouped by each inventory with analysis of average gross profit margin.


								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/">Cash Receipt Report</a></h3>
							</td>
							<td >
								<h3><a href="#/">Reconciliation Report</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual inventory movement transactions by date for each inventory within a period of time.


								</p>
							</td>
							<td >
								<p>
									List of all cash related reconciliation reports.
								</p>
							</td>
						</tr>
					</table>					
				</div>
			</div> -->

			<div class="row-fluid recevable-report">
				<h2>OTHER REPORTS/ LISTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td style="width: 49%; padding-right: 8px !important;">
								<h3><a href="#/chart_of_account">Chart of Account </a></h3>
							</td>
							<!-- <td >
								<h3><a href="#/audit_trial_report">Audit Trial Report</a></h3>								
							</td>	 -->					
						</tr>
						<tr>
							<td style="width: 49%; padding-right: 8px !important;">
								<p>
									Lists of all accounts with name, type, and balance.

								</p>
								
							</td>
							<!-- <td >
								<h3><a href="#/recurring_journal_list">Recurring Journal List</a></h3>							
							</td> -->
							
						</tr>
						<!-- <tr>
							<td>
								<h3><a href="#/">Realized Exchange Gains & Losses</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/">Unrealized Exchange Gains & Losses</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									This detailed report lists foreign transactions that are closed (referred to as realized gains and losses) and totals the gains and losses due to changes in exchange rates.


								</p>
								
							</td>
							<td >
								<p>
									This summary report lists your foreign accounts and calculates the potential gain or loss for each account.


								</p>
							</td>							
						</tr> -->
						
					</table>
				</div>
			</div>

		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart" style="overflow: hidden;">
				<div class="statement">
					<div class="account-stement">
						<h2 style="color: #496cad; font-size: 20px;">Statement of Profit or Loss</h2>
						<table class="performance" style="width:100%; background: #fff; color: #000; padding: 0; margin-bottom: 20px;">
							<tr>
								<td style="padding-left: 0;">Income</td>
								<td></td>
								<td align="right"><span data-bind="text: income"></span></td>
							</tr>
							<tr>
								<td style="padding-left: 0;">Expense</td>
								<td></td>
								<td align="right"><span data-bind="text: expense"></span></td>
							</tr>
							<tr>
								<td style="padding-left: 0;"><b>Net Income</b></td>
								<td></td>
								<td align="right"><b data-bind="text: net_income"></b></td>
							</tr>
						</table>

						<h2 style="color: #496cad; font-size: 20px;">Statement of Financial Position</h2>
						<table class="position" style="width:100%; background: #fff; color: #000; padding: 0;">
							<tr>
								<td style="padding-left: 0;">Assets</td>
								<td></td>
								<td align="right"><span data-bind="text: asset"></span></td>
							</tr>
							<tr>
								<td style="padding-left: 0;">Liabilities</td>
								<td></td>
								<td align="right"><span data-bind="text: liability"></span></td>
							</tr>
							<tr>
								<td style="padding-left: 0;"><b>Equity</b></td>
								<td></td>
								<td align="right"><b data-bind="text: equity"></b></td>
							</tr>
						</table>
						
					</div>
				</div>
			</div>
			
		</div>
	</div>
</script>
<script id="journalReport" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">			
		    		<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>

					<!-- Search Taps -->
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">

											<input data-role="dropdownlist"
												   class="sorter"                  
										           data-value-primitive="true"
										           data-text-field="text"
										           data-value-field="value"
										           data-bind="value: sorter,
										                      source: sortList,                              
										                      events: { change: sorterChanges }" />

											<input data-role="datepicker"
												   class="sdate"
												   data-format="dd-MM-yyyy"
										           data-bind="value: sdate,
										           			  max: edate"
										           placeholder="From ..." >

										    <input data-role="datepicker"
										    	   class="edate"
										    	   data-format="dd-MM-yyyy"
										           data-bind="value: edate,
										                      min: sdate"
										           placeholder="To ..." >

										  	<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
																		
							        	</div>

							        	<!-- PRINT/EXPORT  -->
								        <!--div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div-->								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>JOURNAL ENTRY REPORTS</h2>
							<p data-bind="text: displayDate"></p>
						</div>

						<div class="row-fluid journal_block">
							<div class="span4">
								<p>Total no. of transactions</p>
								<span data-bind="text: totalTxn"></span>
							</div>
							<div class="span4">
								<p>Total Dr. Balance</p>
								<span data-bind="text: dr"></span>
							</div>
							<div class="span4">
								<p>Total Cr. Balance</p>
								<span data-bind="text: dr"></span>
							</div>
						</div>

						<table class="table table-borderless table-condensed">
				            <thead>
					            <tr>
					                <th>TYPE</th>
					                <th>DATE</th>
					                <th>TXN#</th>
					                <th>TXN DESCRIPTION</th>
					                <th>ACCOUNT</th>                		                
					                <th class="right">DEBITS (Dr)</th>
					                <th class="right">CREDITS (Cr)</th>
					                <th><i class="icon-paper-clip"></i></th>		                
					            </tr>
				            </thead> 
					        <tbody data-role="listview"
					        		data-auto-bind="false"
					        		data-template="journalReport-template"			        		
					        		data-bind="source: dataSource"></tbody>			        
					    </table>
					</div>
		            <div data-role="pager"
		            	data-auto-bind="false" 
		            	data-bind="source: dataSource"></div>					  

				</div>
			</div>						
		</div>
	</div>
</script>
<script id="journalReport-template" type="text/x-kendo-tmpl">
	#var sumDr =0, sumCr = 0;#
	#for(var i=0; i<line.length; i++){#
		#sumDr += line[i].dr / line[i].rate;#
		#sumCr += line[i].cr / line[i].rate;#
		<tr>
			<td style="color: black;">
				#if(i==0){#
					#=type#
				#}#
			</td>		
			<td style="color: black;">
				#if(i==0){#
					#=kendo.toString(new Date(issued_date), "dd-MMMM-yyyy")#
				#}#
			</td>
			<td style="color: black;">
				#if(i==0){#
					#if(type=="Cash_Purchase" || type=="Credit_Purchase"){#
						<a href="\#/purchase/#=id#"><i></i> #=number#</a>
					#}else if(type=="Deposit" || type=="Witdraw" || type=="Transfer"){#
						<a href="\#/cash_transaction/#=id#"><i></i> #=number#</a>				
					#}else{#
						<a href="\#/#=type.toLowerCase()#/#=id#"><i></i> #=number#</a>
					#}#
				#}#
			</td>		
			<td style="color: black;">
				#if(i==0){#
					#=memo#
				#}#
			</td>
			<td style="color: black;">
				#=line[i].account#
			</td>			
			<td class="right" style="color: black;">
				#if(line[i].dr>0){#
					#=kendo.toString(line[i].dr / line[i].rate, "c0", banhji.locale)#
				#}#
			</td>
			<td class="right" style="color: black;">
				#if(line[i].cr>0){#
					#=kendo.toString(line[i].cr / line[i].rate, "c0", banhji.locale)#
				#}#
			</td>
			<td></td>  			
	    </tr>    
    #}# 
    <tr>
    	<td style="color: black;">Total:</td>
    	<td></td>    	
    	<td></td>
    	<td></td>
    	<td></td>    	
    	<td class="right strong" style="border-top-color: black; color: black;">
    		#=kendo.toString(sumDr, "c0", banhji.locale)#
    	</td>
    	<td class="right strong" style="border-top-color: black; color: black;">
    		#=kendo.toString(sumCr, "c0", banhji.locale)#
    	</td>
    	<td class="right" style="padding-right: 8px !important;"><i class="icon-paper-clip"></i></td>  	
    </tr>  
</script>
<script id="generalLedger" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">			
		    		<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i><span data-bind="text: lang.lang.date"></span></a></li>										
										<li><a class="glyphicons print" data-bind="click: printGrid"><i></i><span data-bind="text: lang.lang.print_export"></span></a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">

										<!-- Date -->
								        <div class="tab-pane active" id="tab-1">									        	
											
											<input data-role="dropdownlist"
												   class="sorter"                  
										           data-value-primitive="true"
										           data-text-field="text"
										           data-value-field="value"
										           data-bind="value: sorter,
										                      source: sortList,                              
										                      events: { change: sorterChanges }" />

											<input data-role="datepicker"
												   class="sdate"
												   data-format="dd-MM-yyyy"
										           data-bind="value: sdate,
										           			  max: edate"
										           placeholder="From ..." >

										    <input data-role="datepicker"
										    	   class="edate"
										    	   data-format="dd-MM-yyyy"
										           data-bind="value: edate,
										                      min: sdate"
										           placeholder="To ..." >

										  	<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>

							        	<!-- PRINT / EXPORT	-->
								        <!--div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" onclick="javascript: window.print();" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.print"></span></span>
								        	< <span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		<span data-bind="text: lang.lang.print_as_pdf"></span>
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		<span data-bind="text: lang.lang.export_to_excel"></span>
								        	</span> >
							        	</div-->

								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
			    	<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2 span data-bind="text: lang.lang.general_ledger"></h2>
							<p data-bind="text: displayDate"></p>
						</div>

						<table class="table table-borderless table-condensed">
							<thead>
								<tr>
									<th><span data-bind="text: lang.lang.type"></span></th>
									<th style="width: 10%;"><span data-bind="text: lang.lang.date"></span></th>
									<th style="width: 15%;"><span data-bind="text: lang.lang.reference_no"></span></th>
									<th><span data-bind="text: lang.lang.description"></span></th>
									<th class="right"><span data-bind="text: lang.lang.amount"></span></th>
									<th class="right"><span data-bind="text: lang.lang.balance"></span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
					        		data-auto-bind="false"
					        		data-template="generalLedger-template"			        		
					        		data-bind="source: dataSource"></tbody>
					       	<tfoot>
					       		<tr style="font-weight: bold; font-size: large;">
					       			<td colspan="4">TOTAL</td>
					       			<td align="right" data-bind="text: totalAmount"></td>
					       			<td align="right" data-bind="text: totalBalance"></td>
					       		</tr>
					       	</tfoot>
						</table>				  
					</div>
				</div>
			</div>						
		</div>
	</div>
</script>
<script id="generalLedger-template" type="text/x-kendo-tmpl">
	<tr>
		<td style="font-weight: bold;">#: number # #: name #</td>
    	<td></td>
    	<td></td>
    	<td></td>
    	<td></td>
    	<td class="right strong" style="color: black;">
    		#=kendo.toString(balance_forward, "c", banhji.locale)#
    	</td>
	</tr>
	#var balance = balance_forward;#
	#for(var i=0; i<line.length; i++){#
	#balance += line[i].amount;#
	<tr>
		<td style="color: black;">
			&nbsp;&nbsp; #=line[i].type#
		</td>		
		<td style="color: black;">
			#=kendo.toString(new Date(line[i].issued_date), "dd-MM-yyyy")#
		</td>
		<td style="color: black;">
			#if(line[i].type=="Cash_Purchase" || line[i].type=="Credit_Purchase"){#
				<a href="\#/purchase/#=line[i].id#"><i></i> #=line[i].number#</a>
			#}else if(line[i].type=="Deposit" || line[i].type=="Witdraw" || line[i].type=="Transfer"){#
				<a href="\#/cash_transaction/#=line[i].id#"><i></i> #=line[i].number#</a>				
			#}else{#
				<a href="\#/#=line[i].type.toLowerCase()#/#=line[i].id#"><i></i> #=line[i].number#</a>
			#}#
		</td>		
		<td style="color: black;">
			#if(i==0){#
				#=line[i].memo#
			#}#
		</td>
		<td class="right" style="color: black;">
			#=line[i].amount#
		</td>
		<td class="right" style="color: black;">
			#=kendo.toString(balance, "c", banhji.locale)#
		</td> 			
    </tr>    
    #}# 
    <tr>
    	<td style="font-weight: bold; color: black;">Total #: number # #: name #</td>
    	<td></td>
    	<td></td>
    	<td></td>
    	<td></td>
    	<td class="right" style="font-weight: bold; border-top: 1px solid black !important; color: black;">
    		#=kendo.toString(balance, "c", banhji.locale)#
    	</td>
    </tr>
    <tr>
    	<td colspan="6">&nbsp;</td>
    </tr>  
</script>
<script id="transactionListDate" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">			
		    		<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i><span data-bind="text: lang.lang.date"></span></a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i><span data-bind="text: lang.lang.print_export"></span></a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		<span data-bind="text: lang.lang.print_as_pdf"></span>
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		<span data-bind="text: lang.lang.export_to_excel"></span>
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>TRANSACTION LIST BY DATE</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<table class="table table-borderless table-condensed ">
						<tr>
							<th>Type</th>
							<th>Date</th>
							<th>TXN #</th>
							<th>TXN Description</th>							
							<th>Name</th>
							<th><i class="icon-paper-clip"></i></th>
						</tr>
						<tr>
							<td>10100 Cash & Cash Equivalent</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>
						</tr>
						<tr>						
							<td>Invoice</td>
							<td>7/1/16</td>
							<td>IV-0001</td>
							<td>anmsjssd</td>
							<td>Account Receivable</td>
							<td><i class="icon-paper-clip"></i></td>				
						</tr>
						<tr>					
							<td>Cash Sale</td>
							<td></td>
							<td>SR-0003</td>
							<td>anmsjssd</td>
							<td>Cash on hand</td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>
							<td>Toni</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>
						</tr>
						<tr>						
							<td>Invoice</td>
							<td>7/1/16</td>
							<td>IV-0015</td>
							<td>asg</td>
							<td>Account Receivable</td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>												
							<td>Cash Receipt</td>
							<td></td>
							<td>CR-0122</td>
							<td>ss</td>
							<td>Cash on hand</td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>					
							<td>Deposit</td>
							<td></td>
							<td>DS-0123</td>
							<td>aa</td>
							<td>Cash on hand</td>
							<td><i class="icon-paper-clip"></i></td>						
						</tr>
						<tr>						
							<td>Sub-total</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>						
						</tr>
						
						<tr>
							<th colspan="3">Total</th>
							<th colspan="3">(600.00)</th>
						</tr>
					</table>
				</div>
			</div>						
		</div>
	</div>
</script>
<script id="recentTransactionsList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">			
		    		<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab" style="overflow: hidden;">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons filter" href="#tab-1" data-toggle="tab"><i></i>Filter</a></li>
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->
								
								<div class="widget-body">
									<div class="tab-content">
								    	<!-- //GENERAL INFO -->
								        <div class="tab-pane active" id="tab-1">									        	
											<div class="row-fluid">								        		
								            	<div class="span3" style="padding-bottom: 20px;">
													<label for="ddlAR"><span ></span>Filtered by</label>
													<input id="ddlAR" name="ddlAR"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.account_id,
										                              source: arDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />													
												</div>
												<div class="span3">
													<label for="ddlRA"><span ></span>Grouped By</label>
													<input id="ddlRA" name="ddlRA"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.ra_id,
										                              source: raDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />
										         										
												</div>
																																		
											</div>
							
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //ACCOUNTING -->
								        <div class="tab-pane" id="tab-2">
								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>
								        <!-- //ACCOUNTING END -->
								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->
						
					</div>
			    	
					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>RECENT TRANSACTION LIST</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<table class="table table-borderless table-condensed ">
						<tr>
							<th>Type</th>
							<th>Ordered By</th>
							<th>Last Recored Date</th>
							<th>Status</th>
							<th>TXN #</th>
							<th>TXN Description</th>							
							<th>Name</th>
							<th>Amount</th>
							<th><i class="icon-paper-clip"></i></th>
						</tr>
						<tr>
							<td>10100 Cash </td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>
						</tr>
						<tr>						
							<td>Invoice</td>
							<td>7/1/16</td>
							<td>IV-0001</td>
							<td>anmsjssd</td>
							<td>Account Receivable</td>
							<td>1,000.00</td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>						
						</tr>
						<tr>					
							<td>Cash Sale</td>
							<td></td>
							<td>SR-0003</td>
							<td>anmsjssd</td>
							<td>Cash on hand</td>
							<td>500.00</td> 
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>
							<td>Toni</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>
						</tr>
						<tr>						
							<td>Invoice</td>
							<td>7/1/16</td>
							<td>IV-0015</td>
							<td>asg</td>
							<td>Account Receivable</td>
							<td>1,200.00</td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>												
							<td>Cash Receipt</td>
							<td></td>
							<td>CR-0122</td>
							<td>ss</td>
							<td>Cash on hand</td>
							<td>(1,200.00)</td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>					
							<td>Deposit</td>
							<td></td>
							<td>DS-0123</td>
							<td>aa</td>
							<td>Cash on hand</td>
							<td>(2,100.00)</td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>					
						</tr>
						<tr>						
							<td>Sub-total</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td>(2,100.00)</td>
							<td></td>
							<td></td>
							<td><i class="icon-paper-clip"></i></td>				
						</tr>
						
						<tr>
							<th colspan="5">Total</th>
							<th colspan="4">(600.00)</th>
						</tr>
					</table>					  

				</div>
			</div>						
		</div>
	</div>
</script>
<script id="trialBalance" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryCustomer">

			    	<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					<div class="row-fluid">
						<!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">	
							    <!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>
										<li><a class="glyphicons print" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
							    <!-- // Tabs Heading END -->
								<div class="widget-body">
								    <div class="tab-content">

								    	<!-- //GENERAL INFO -->
								        <div class="tab-pane active" id="tab-1">									
									        As of:
									        <input data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: as_of" />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //ACCOUNTING -->
								        <!--div class="tab-pane" id="tab-2">
								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div-->
								        <!-- //ACCOUNTING END -->						       

								       
								    </div>
								</div>
							</div>
						</div>
					
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>TRIAL BALANCE</h2>
							<p data-bind="text: displayDate"></p>
						</div>

						<div class="row-fluid journal_block1">
							<div class="span2">
								<p>
									Account
								</p>
								<span data-bind="text: dataSource.total"></span>
							</div>
							<div class="span5">
								<p>
									Total Dr. Balance
								</p>
								<span data-bind="text: dr"></span>
							</div>
							<div class="span5">
								<p>
									Total Cr. Balance
								</p>
								<span data-bind="text: cr"></span>
							</div>
						</div>

						<table class="table table-borderless table-condensed">
							<thead>
					            <tr>
					                <th>CODE</th>
					                <th>NAME</th>
					                <th>TYPE</th>
					                <th class="right">DEBIT</th>
					                <th class="right">CREDIT</th>
					            </tr>
					        </thead>
					        <tbody data-template="trialBalance-template"
					        		data-auto-bind="false" 
					        		data-bind="source: dataSource"></tbody>
					        <tfoot data-template="trialBalance-footer-template" 
					        		data-bind="source: this"></tfoot>
						</table>
					</div>				  
		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="trialBalance-template" type="text/x-kendo-tmpl">	
	<tr>
		<td style="color: black;">
			#=number#
		</td>		
		<td style="color: black;">
			#=name#
		</td>
		<td style="color: black;">
			#=type#
		</td>						
		<td class="right" style="color: black;">
			#if(dr!==0){#
				#=kendo.toString(dr, "c", banhji.locale)#
			#}#
		</td>
		<td class="right" style="color: black;">
			#if(cr!==0){#
				#=kendo.toString(cr, "c", banhji.locale)#
			#}#
		</td>		
    </tr>    
</script>
<script id="trialBalance-footer-template" type="text/x-kendo-template">
    <tr class="bg-total">
        <td>TOTAL:</td>        
        <td></td>
        <td></td>        
        <td class="right">
            #: totalDr() #
        </td>
        <td class="right">
            #: totalCr() #
        </td>
    </tr>
</script>
<script id="chartOfAccount" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">						
				<div id="example" class="k-content saleSummaryCustomer">
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					<br>					

					<div class="block-title" style="overflow: initial;">
						<h2>Chart of Account</h2>
					</div>

					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center">NUMBER</th>
				                <th class="center">NAME</th>
				                <th class="center">TYPE</th>			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview"
				        		data-template="chartOfAccount-template"			        		
				        		data-bind="source: dataSource"></tbody> 
				    </table>
		            <div data-role="pager" data-bind="source: dataSource"></div>					  

				</div>
			</div>						
		</div>
	</div>
</script>
<script id="chartOfAccount-template" type="text/x-kendo-tmpl">	
	<tr>
		<td style="color: black;">
			#=number#
		</td>		
		<td style="color: black;">
			#=name#
		</td>
		<td style="color: black;">
			#=account_type_name#
		</td>				
    </tr>    
</script>
<script id="statementProfitLoss" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryCustomer">

					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i><span data-bind="text: lang.lang.date"></span></a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i><span data-bind="text: lang.lang.print_export"></span></a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">

										<!-- Date -->
								        <div class="tab-pane active" id="tab-1">									        	
											
											<input data-role="dropdownlist"
												   class="sorter"                  
										           data-value-primitive="true"
										           data-text-field="text"
										           data-value-field="value"
										           data-bind="value: sorter,
										                      source: sortList,                              
										                      events: { change: sorterChanges }" />

											<input data-role="datepicker"
												   class="sdate"
												   data-format="dd-MM-yyyy"
										           data-bind="value: sdate,
										           			  max: edate"
										           placeholder="From ..." >

										    <input data-role="datepicker"
										    	   class="edate"
										    	   data-format="dd-MM-yyyy"
										           data-bind="value: edate,
										                      min: sdate"
										           placeholder="To ..." >

										  	<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>

							        	<!-- PRINT / EXPORT -->
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" onclick="javascript: window.print();" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.print"></span></span>
								        	<!-- <span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		<span data-bind="text: lang.lang.print_as_pdf"></span>
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		<span data-bind="text: lang.lang.export_to_excel"></span>
								        	</span> -->
							        	</div>

								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3 data-bind="text: company.name"></h3>
						<h2>Statement of Profit or Loss</h2>
						<p data-bind="text: displayDate"></p>
					</div>
			    
					<table class="table table-borderless table-condensed" style="width: 70%; margin:0 auto;">
						<tbody data-role="listview"
				        		data-auto-bind="false"
				        		data-template="statementProfitLoss-template"			        		
				        		data-bind="source: dataSource"></tbody>
					</table>

					<br><br>

		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="statementProfitLoss-template" type="text/x-kendo-tmpl">
	#if(id>0){#
		<tr>
			<td colspan="3" style="font-weight: bold; color: black;">#: type #</td>
		</tr>
		#var total = 0;#
		#for(var i=0; i<line.length; i++){#
		#total += line[i].amount;#
		<tr>
			<td style="color: black;">
				&nbsp;&nbsp; #=line[i].number# - #=line[i].name#
			</td>
			<td class="right" style="color: black;">
				#=kendo.toString(line[i].amount, "c", banhji.locale)#
			</td>
			<td style="width:15%;" ></td> 			
	    </tr>    
	    #}# 
	    <tr>
	    	<td style="font-weight: bold; color: black;">Total #: type #</td>
	    	<td></td>	    	
	    	<td class="right" style="font-weight: bold; border-top: 1px solid black !important; color: black;">
	    		#=kendo.toString(total, "c", banhji.locale)#
	    	</td>
	    </tr>	    
	#}else{#
		<tr>
			<td colspan="2" style="font-weight: bold; color: black;">#: name #</td>
			<td class="right" style="font-weight: bold; color: black;">#: kendo.toString(amount, "c", banhji.locale) #</td>
		</tr>
	#}# 
</script>
<script id="statementFinancialPosition" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryCustomer">
					
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>

					<br>
					<br>
					<!-- <div>
						As of:
				        <input data-role="datepicker"
								data-format="dd-MM-yyyy"
								data-parse-formats="yyyy-MM-dd" 
								data-bind="value: as_of" />

			            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
					</div> -->


					<div class="row-fluid">
						<!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">	
							    <!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>
										<li><a class="glyphicons print" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
							    <!-- // Tabs Heading END -->
								<div class="widget-body">
								    <div class="tab-content">

								    	<!-- //GENERAL INFO -->
								        <div class="tab-pane active" id="tab-1">									
									        As of:
									        <input data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: as_of" />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //ACCOUNTING -->
								        <!--div class="tab-pane" id="tab-2">
								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div-->
								        <!-- //ACCOUNTING END -->						       

								       
								    </div>
								</div>
							</div>
						</div>
					
					</div>


					<div class="block-title">
						<h3 data-bind="text: company.name"></h3>
						<h2>Statement of Financial Position</h2>
						<p data-bind="text: displayDate"></p>
					</div>
			    	
			    	<!-- <div class="row-fluid journal_block1">
						<div class="span2">
							<p>&nbsp;</p>
							<span>&nbsp;</span>
						</div>
						<div class="span5">
							<p>Assets</p>
							<span data-bind="text: totalAsset"></span>
						</div>
						<div class="span5">
							<p>Liabilities + Equity</p>
							<span data-format="n" data-bind="text: totalLiabilityEquity"></span>
						</div>
					</div> -->
			    	
					<table class="table table-borderless table-condensed" style="width: 70%; margin: 0 auto;">
						<thead>
							<tr>
								<th>ASSETS</th>
								<th width="15%"></th>
								<th width="15%"></th>
							</tr>
						</thead>
						<tbody data-role="listview" 
							data-template="statementFinancialPosition-template"
							data-auto-bind="false"
							data-bind="source: dataSource"></tbody>
						<tfoot>
							<tr>
								<td style="font-weight: bold; font-size: large;">TOTAL ASSETS</td>
								<td width="15%"></td>
								<td width="15%" style="font-weight: bold; font-size: large;" align="right">
									<span data-bind="text: totalAsset"></span>
								</td>
							</tr>
						</tfoot>
					</table>

					<br>

					<table class="table table-borderless table-condensed" style="width: 70%; margin: 0 auto;">
						<thead>
							<tr>
								<th>LIABILITIES</th>
								<th width="15%"></th>
								<th width="15%"></th>
							</tr>
						</thead>
						<tbody data-role="listview"
							data-template="statementFinancialPosition-template"
							data-auto-bind="false"
							data-bind="source: liabilityDS"></tbody>
						<tfoot>
							<tr>
								<td style="font-weight: bold; font-size: large;">TOTAL LIABILITIES</td>
								<td width="15%"></td>
								<td width="15%" style="font-weight: bold; font-size: large;" align="right">
									<span data-bind="text: totalLiability"></span>
								</td>
							</tr>
						</tfoot>
					</table>

					<br>

					<table class="table table-borderless table-condensed" style="width: 70%; margin: 0 auto;">
						<thead>
							<tr>
								<th>EQUITY</th>
								<th width="15%"></th>
								<th width="15%"></th>
							</tr>
						</thead>
						<tbody data-role="listview"
							data-template="statementFinancialPosition-template"
							data-auto-bind="false"
							data-bind="source: equityDS"></tbody>
						<tfoot>
							<tr>
								<td style="font-weight: bold; font-size: large;">TOTAL EQUITY</td>
								<td width="15%"></td>
								<td width="15%" style="font-weight: bold; font-size: large;" align="right">
									<span data-bind="text: totalEquity"></span>
								</td>
							</tr>
						</tfoot>
					</table>

		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="statementFinancialPosition-template" type="text/x-kendo-template">
    <tr>
        <td style="font-weight: bold; font-style: italic;">
            #: name #
        </td> 
        <td></td>
        <td ></td>    
    </tr>
    #var total = 0;#
	#for(var i=0; i<typeLine.length; i++){#
	    <tr>
	        <td style="font-weight: bold;">
	            &nbsp;&nbsp; #:typeLine[i].type#
	        </td> 
	        <td></td>
	        <td ></td>    
	    </tr>    
	    #var totalType = 0;#
		#for(var j=0; j<typeLine[i].line.length; j++){#
			#total += typeLine[i].line[j].amount;#
			#totalType += typeLine[i].line[j].amount;#
		    <tr>
		        <td>
		        	&nbsp;&nbsp;&nbsp;&nbsp; #: typeLine[i].line[j].number # #: typeLine[i].line[j].name #
		        </td>
		        <td align="right">
		            &nbsp;&nbsp;&nbsp;&nbsp; #: kendo.toString(typeLine[i].line[j].amount, "c", banhji.locale) #
		        </td>
		        <td ></td>
		    </tr>
		#}#
		<tr>
	        <td style="font-weight: bold;">
	            &nbsp;&nbsp; Total #:typeLine[i].type#
	        </td>
	        <td style="font-weight: bold; border-top: 1px solid black !important;" align="right">
	            #=kendo.toString(totalType, "c", banhji.locale)#
	        </td>
	        <td ></td>
	    </tr>
	    <tr>
	    	<td colspan="3">&nbsp;</td>
	    </tr>
	#}#
	<tr>
        <td style="font-weight: bold; font-style: italic;">
            Total #: name #
        </td>
        <td></td>
        <td style="font-weight: bold; border-top: 1px solid black !important;" align="right">
            #=kendo.toString(total, "c", banhji.locale)#
        </td>
    </tr>
</script>
<script id="statementProfitLossComparison" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryStatement">
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<div class="block-title">
						<h3>Company is Name</h3>
						<h2>Statement of Profit or Loss Comparison</h2>
						<p>for the year ended 31 December 2016</p>
					</div>
			    
					<table width="100%">
						<tr>
							<th></th>
							<th>Note</th>
							<th class="right">2016</th>
							<th class="pull-right">2015</th>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td class="right">KHR</td>
							<td class="right">KHR</td>
						</tr>
						<tr>
							<td>Revenue</td>
							<td>10</td>
							<td class="right">680,000</td>
							<td class="right">525,000</td>
						</tr>
						<tr>
							<td>Cost</td>
							<td></td>
							<td class="right">(400,000)</td>
							<td class="right">(300,000)</td>
						</tr>
						<tr>
							<td class="bold">Gross Profit</td>
							<td></td>
							<td class="right bold-border">280,000</td>
							<td class="right bold-border">225,000</td>
						</tr>
						<tr>
							<td>Distribution costs</td>
							<td></td>
							<td class="right">(8,580)</td>
							<td class="right">(5,830)</td>
						</tr>
						<tr>
							<td>Administrative Expense</td>
							<td></td>
							<td class="right">(50,000)</td>
							<td class="right">(40,000)</td>
						</tr>
						<tr>
							<td>Finance Costs</td>
							<td><a href="">1</a></td>
							<td class="right">(22,300)</td>
							<td class="right">(19,700)</td>
						</tr>
						<tr>
							<td>Share of profit of associate</td>
							<td><a href="">1</a></td>
							<td class="right">42,100</td>
							<td class="right">38,560</td>
						</tr>
						<tr>
							<td class="bold">Profit before Tax</td>
							<td><a href="">1</a></td>
							<td class="right bold-border">241,220</td>
							<td class="right bold-border">198,030</td>
						</tr>
						<tr>
							<td>Income tax expense</td>
							<td><a href="">1</a></td>
							<td class="right">(60,305)</td>
							<td class="right">(47,508)</td>
						</tr>
						<tr>
							<td class="bold">Profit for the year from continuing operations</td>
							<td></td>
							<td class="right bold-border">180,915</td>
							<td class="right bold-border">150,522</td>
						</tr>
						<tr>
							<td>Loss for the year discoutinued operations</td>
							<td><a href="">1</a></td>
							<td class="right">(24,780)</td>
							<td class="right">(2,000)</td>
						</tr>
						<tr>
							<td class="bold">Profit for the year</td>
							<td></td>
							<td class="right bold-border border-bottom">156,135</td>
							<td class="right bold-border border-bottom">148,522</td>
						</tr>
					</table>

		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="statementFinancialPositionComparison" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryStatement">
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<div class="block-title">
						<h3>Company is Name</h3>
						<h2>Statement of Financial Position Comparison</h2>
						<p>for the year ended 31 December 2016</p>
					</div>
			    	
					<table width="100%">
						<tr>
							<th></th>
							<th>Note</th>
							<th class="right">2015</th>
							<th class="right">2016</th>
						</tr>
						<tr>
							<td class="bold">ASSET</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="bold">Non-Current Asset</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Properties, Plants, & Equipment</td>
							<td><a href="">1</a></td>
							<td class="right bold-border border-bottom">138,923,361</td>
							<td class="right bold-border border-bottom">138,923,361</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Freehold Land</td>
							<td><a href="">1</a></td>
							<td class="right">123,670,644</td>
							<td class="right">123,670,644</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Building & Structure</td>
							<td><a href="">1</a></td>
							<td class="right">9,848,345</td>
							<td class="right">9,848,345</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Electrical Systems, Machineries and Improvement</td>
							<td><a href="">1</a></td>
							<td class="right">838,559</td>
							<td class="right">838,559</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Automobiles & Vehicles</td>
							<td><a href="">1</a></td>
							<td class="right">123,670,644</td>
							<td class="right">123,670,644</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Furniture, Fixtures & Fittings</td>
							<td><a href="">1</a></td>
							<td class="right">663,429</td>
							<td class="right">663,429</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Computer and Related Equipment</td>
							<td><a href="">1</a></td>
							<td class="right">286,688</td>
							<td class="right">286,688</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Equipments, Electricles Device & Tools</td>
							<td><a href="">1</a></td>
							<td class="right">779,835</td>
							<td class="right">779,835</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Heavy Machinaries</td>
							<td><a href="">1</a></td>
							<td class="right">341505</td>
							<td class="right">341505</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Completed Investment Properties</td>
							<td><a href="">1</a></td>
							<td class="right">3,701,848</td>
							<td class="right">3,701,848</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">I​nvestment Properties under-construction</td>
							<td><a href="">1</a></td>
							<td class="right">10,087,257</td>
							<td class="right">10,087,257</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Investment in Subsidiaries</td>
							<td><a href="">1</a></td>
							<td class="right">-</td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20 bold"><i>Total Non-Current Asset</i></td>
							<td><a href="">1</a></td>
							<td class="right bold-border border-bottom">152,712,466</td>
							<td class="right bold-border border-bottom">152,712,466</td>
						</tr>
						<tr>
							<td class="bold">Current Assets</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Inventory</td>
							<td><a href="">1</a></td>
							<td class="right bold-border border-bottom">389,142,635</td>
							<td class="right bold-border border-bottom">389,142,635</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Raw Material</td>
							<td><a href="">1</a></td>
							<td class="right">175,561,951</td>
							<td class="right">175,561,951</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Working-in-progress</td>
							<td><a href="">1</a></td>
							<td class="right">80,575,454</td>
							<td class="right">80,575,454</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Finished goods</td>
							<td><a href="">1</a></td>
							<td class="right">205,523,139</td>
							<td class="right">205,523,139</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Operating Equipment</td>
							<td><a href="">1</a></td>
							<td class="right">142,635</td>
							<td class="right">142,635</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Trade Receivables</td>
							<td><a href="">1</a></td>
							<td class="right">142,635</td>
							<td class="right">142,635</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Properties Sale Receivable</td>
							<td><a href="">1</a></td>
							<td class="right">-</td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Installment Payment Scheme</td>
							<<td><a href="">1</a></td>
							<td class="right">205,523,139</td>
							<td class="right">205,523,139</td>
						</tr>
						<tr>
							<td class="paddingLeft40">Mortgage Payment Scheme</td>
							<td><a href="">1</a></td>
							<td class="right">9,003,967</td>
							<td class="right">9,003,967</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">AR from Related Parties</td>
							<td><a href="">1</a></td>
							<td class="right">-</td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Other receivables</td>
							<td><a href="">1</a></td>
							<td class="right">34,859</td>
							<td class="right">34,859</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Interest Receivable</td>
							<td><a href="">1</a></td>
							<td class="right">138,835</td>
							<td class="right">138,835</td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Prepayment & Deposit</td>
							<td><a href="">1</a></td>
							<td class="right">3,741,185</td>
							<td class="right">3,741,185</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20 ">Cash and Cash Equivalent</td>
							<td><a href="">1</a></td>
							<td class="right">7,359,195</td>
							<td class="right">7,359,195</td>
						</tr>
						<tr>
							<td class="paddingLeft20 bold"><i>Total Current Assets</i></td>
							<td><a href="">1</a></td>
							<td class="right bold-border border-bottom">419,215,778</td>
							<td class="right bold-border border-bottom">419,215,778</td>
						</tr>
						<tr>
							<td class="bold">TOTAL ASSETS</td>
							<td></td>
							<td class="right bold under-bottom">571,928,244</td>
							<td class="right bold under-bottom">571,928,244</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="bold">EQUITY & LIABILITIES</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>Shareholders Equity</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Share Capital</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Retained Earning</td>
							<td></td>
							<td ></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20 bold"><i>Total Shareholders Equity</i></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>Non-Current Liabilities</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Interest Bearing Loans and Borrowing</td>
							<td><a href="">10</a></td>
							<td class="right">36,445,536</td>
							<td class="right">36,445,536</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Long term Loan based on Customer Portfolio</td>
							<td><a href="">10</a></td>
							<td class="right">60,334,222</td>
							<td class="right">60,334,222</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Long term loan from Related Parties</td>
							<td><a href="">11</a></td>
							<td class="right">9,429,028</td>
							<td class="right">9,429,028</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Land Purchase Payable</td>
							<td><a href="">12</a></td>
							<td class="right">150,595,772</td>
							<td class="right">150,595,772</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Deposit for Sale of Properties inventory</td>
							<td><a href="">13</a></td>
							<td class="right">-</td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Installment Payment Scheme</td>
							<td><a href=""></a></td>
							<td class="right">95,979,147</td>
							<td class="right">95,979,147</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Mortgage Payment Scheme</td>
							<td><a href=""></a></td>
							<td class="right">76,736,253</td>
							<td class="right">76,736,253</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Other Deposit</td>
							<td><a href=""></a></td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20 bold"><i>Total Non-Current Liabilities</i></td>
							<td><a href=""></a></td>
							<td class="right bold">429,519,958</td>
							<td class="right bold">429,519,958</td>
						</tr>
						<tr>
							<td>Current Liabilities</td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Trade Payable</td>
							<td><a href="">14</a></td>
							<td class="right">5,720,691</td>
							<td class="right">5,720,691</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Short term Bank Borrowing (OD)</td>
							<td><a href="">9</a></td>
							<td class="right">7,645,991</td>
							<td class="right">7,645,991</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Current Customer Deposit & Prepayment</td>
							<td><a href="">13</a></td>
							<td class="right">11,837,636</td>
							<td class="right">11,837,636</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Accrued Expenses (including bonus)</td>
							<td><a href="">15</a></td>
							<td class="right">280,607</td>
							<td class="right">280,607</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Salary Payable</td>
							<td><a href="">16</a></td>
							<td class="right">1,074,153</td>
							<td class="right">1,074,153</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Interest Payable</td>
							<td><a href=""></a></td>
							<td class="right">-</td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">General Provision</td>
							<td><a href=""></a></td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Current Tax Payable</td>
							<td><a href=""></a></td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20 bold"><i>Total Current Liabilities</i></td>
							<td><a href=""></a></td>
							<td class="right bold-border border-bottom">126,558,805</td>
							<td class="right bold-border border-bottom">126,558,805</td>
						</tr>
						<tr>
							<td class="bold">Total Liabilities</td>
							<td><a href=""></a></td>
							<td class="right bold border-bottom">556,078,762</td>
							<td class="right bold border-bottom">556,078,762</td>
						</tr>
						<tr>
							<td class="bold fontBig">Total Liabilities</td>
							<td><a href=""></a></td>
							<td class="right bold under-bottom">556,078,762</td>
							<td class="right bold under-bottom">556,078,762</td>
						</tr>
					</table>
		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="statementCashFlow" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryStatement">
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<div class="block-title">
						<h3>Company is Name</h3>
						<h2>Statement of Cash Flow</h2>
						<p>for the year ended 31 December 2016</p>
					</div>
			    
					<table width="100%">
						<tr>
							<th></th>
							<th>Note</th>
							<th class="right">12/31/2016</th>
						</tr>
						<tr>
							<td class="bold fontBig">OPERATING ACTIVITIES</td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td>Profit before tax</td>
							<td class="right"></td>
							<td class="right">46,471</td>
						</tr>
						<tr>
							<td class="bold">Adjustment to reconcile profit before tax to net cash flows</td>
							<td></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Depreciation of property, plant, and equipment</td>
							<td></td>
							<td class="right">36,049</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Amortization and impairment of intangible assets</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Allowance/ (Reversal of allowance)</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Gain from bargain purchase</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Gain on disposal of property, plant and equipment</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Gain on disposal of investment properties</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Finance Costs</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Interest income</td>
							<td></td>
							<td class="right">-</td>
						</tr>
						<tr>
							<td class="bold">Operating profit before working capital changes</td>
							<td></td>
							<td class="right bold-border border-bottom">82,520</td>
						</tr>
						<tr>
							<td class="bold">Changes in working capital</td>
							<td></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Decrease/ (Increase) in receivables</td>
							<td></td>
							<td class="center">(17,573)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Decrease/ (Increase) in prepayment and accrued income</td>
							<td></td>
							<td class="center">(7,095)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Decrease/ (increase) in development properties for sale</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Decrease/ (Increase) in inventory</td>
							<td></td>
							<td class="right">(16,176)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">(Decrease)/ Increase in trade, other payables and accruals</td>
							<td></td>
							<td class="center">186,183</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Movement in customer deposits</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="bold">Cash generated from/ (used in) operations</td>
							<td></td>
							<td class="right bold">145,338</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Income tax paid</td>
							<td></td>
							<td class="right bold">1,370</td>
						</tr>
						<tr>
							<td class="bold bold-border border-bottom">Net cash generated from/ (used in) operating activities</td>
							<td class="bold-border border-bottom"></td>
							<td class="right bold-border border-bottom">226,488</td>
						</tr>
						<tr>
							<td class="bold fontBig">INVESTING ACTIVITIES</td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Capital injection</td>
							<td></td>
							<td class="center">472,472</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Purchase of property, plant and equipment</td>
							<td></td>
							<td class="center">(217,210)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Proceeds from disposal of investment property</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Proceeds from disposal of property, plant, and equipment</td>
							<td></td>
							<td class="center">18,777</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Investment in Property_Land</td>
							<td></td>
							<td class="center">(55,000)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Investment in Property_Building</td>
							<td></td>
							<td class="center">(2,000)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Investment in subsidiaries</td>
							<td></td>
							<td class="center">(203,000)</td>
						</tr>
						<tr>
							<td class="bold bold-border border-bottom">Net cash generated from/ (used in) operating activities</td>
							<td class="bold-border border-bottom"></td>
							<td class="right bold-border border-bottom">14,038</td>
						</tr>
						<tr>
							<td class="bold fontBig">FINANCING ACTIVITIES</td>
							<td class="right"></td>
							<td class="right"></td>
						</tr>
						<tr>
							<td class="paddingLeft20">Proceeds from borrowing</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Repayment of borrowing</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Proceeds from issue of share capital</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Dividends paid to share holders</td>
							<td></td>
							<td class="center">(331,061)</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Interest received</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="paddingLeft20">Interest paid</td>
							<td></td>
							<td class="center">-</td>
						</tr>
						<tr>
							<td class="bold-border">Net cash generated from/ (used in)financing activities</td>
							<td class="right bold-border"></td>
							<td class="right bold-border">(331,061)</td>
						</tr>
						<tr>
							<td class="bold-border">Net increase in cash and cash equivalents</td>
							<td class="right bold-border"></td>
							<td class="right bold-border">(90,534)</td>
						</tr>
						<tr>
							<td class="bold">Cash and cash equivalents at the beginning of the period</td>
							<td class="right"></td>
							<td class="right">690,892</td>
						</tr>
						<tr>
							<td class="bold-border border-bottom">Cash and cash equivalents at 31 December 2016</td>
							<td class="right bold-border border-bottom"></td>
							<td class="right bold-border border-bottom">600,358</td>
						</tr>
						<tr>
							<td class=""></td>
							<td class="right"></td>
							<td class="right">600,358</td>
						</tr>

					</table>
		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="statementChangesEquity" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background ">
			<div class="container-960">	
				<div id="example" class="k-content saleSummaryStatement">
					<span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<div class="block-title">
						<h3>Company is Name</h3>
						<h2>Statement Changes Equity</h2>
						<p>for the year ended 31 December 2016</p>
					</div>
			    
					<table width="100%">
						<tr>
							<th></th>
							<th class="center">Share Retained</th>
							<th class="center">Capital Earning</th>
							<th class="center">Total</th>
						</tr>
						<tr>
							<td></td>
							<td class="center bold">USD</td>
							<td class="center bold">USD</td>
							<td class="center bold">USD</td>
						</tr>
						<tr>
							<td>Balance as at 01 January 2015</td>
							<td class="right">1,000,000</td>
							<td class="right">84,202</td>
							<td class="right">1,084,202</td>
						</tr>
						<tr>
							<td>Capital injection</td>
							<td class="right">1,000,000</td>
							<td class="right">-</td>
							<td class="right">1,000,000</td>
						</tr>
						<tr>
							<td>Net profit during the year of 2015</td>
							<td class="right bigBorderbottom">-</td>
							<td class="right bigBorderbottom">80,481</td>
							<td class="right bigBorderbottom">80,481</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="bold">Balance as at 31 December 2015</td>
							<td class="right bold bigBordertop under-bottom">2,000,000</td>
							<td class="right bold bigBordertop under-bottom">164,683</td>
							<td class="right bold bigBordertop under-bottom">2,164,683</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>Balance as at 01 January 2016</td>
							<td class="right">2,000,000</td>
							<td class="right">164,683</td>
							<td class="right">2,164,683</td>
						</tr>
						<tr>
							<td>Capital injection</td>
							<td class="right">-</td>
							<td class="right"></td>
							<td class="right">0</td>
						</tr>
						<tr>
							<td>Realized profit inter-company sale</td>
							<td class="right"></td>
							<td class="right">0</td>
							<td class="right"></td>
						</tr>
						<tr>
							<td>Net profit during the year of 2016</td>
							<td class="right bigBorderbottom">-</td>
							<td class="right bigBorderbottom">-327,700</td>
							<td class="right bigBorderbottom">-327,700</td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="bold">Balance as at 31 December 2016</td>
							<td class="right bold bigBordertop under-bottom">2,000,000</td>
							<td class="right bold bigBordertop under-bottom">-163,017</td>
							<td class="right bold bigBordertop under-bottom">1,836,983</td>
						</tr>
					</table>
		        </div>		        
			</div>							
		</div>
	</div>
</script>
<script id="recurringJournalList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">				
						
				    <span class="glyphicons no-js remove_2 pull-right" 
							onclick="javascript: window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>


					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>Recurring Journal List</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<br>			   
				   
					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;">No.</th>
				                <th style="width: 30%">NAME</th>
				                <th class="center" style="width: 10%">TYPE</th>
				                <th class="center">START DATE</th>
				                <th class="center">FREQUENCY</th>
				                <th></th>			                			                
				            </tr> 
				        </thead>
				        <tbody></tbody>			        
				    </table>											

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="auditTrialReport" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>Audit Trial Report</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<div class="row-fluid">
						<div class="span5">
							<div class="total-customer">
								<div class="span6">
									<p>N Edit</p>
									<span>-</span>
								</div>
								<div class="span6">
									<p>N Delete</p>
									<span>-</span>
								</div>	
							</div>
						</div>
						<div class="span7">
							<div class="total-customer">
								<div class="span6">
									<p>N Adjustment</p>
									<span>-</span>
								</div>
								<div class="span6">
									<p>Account</p>
									<span>-</span>
								</div>
							</div>
						</div>
					</div>

					<table class="table table-borderless table-condensed ">
						<tr>
							<th>Date</th>
							<th>Type</th>
							<th>Last modified by</th>
							<th>Modified by</th>
							<th>Name</th>							
							<th>Description</th>
							<th>Account</th>
							<th>Dr</th>
							<th>Cr</th>
							<th>Status</th>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</table>
				</div>		
			</div>
		</div>
	</div>
</script>


<script id="accountingSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2 data-bind="text: lang.lang.general_accounting_setting"></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <!-- <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.financial_report"></span></span></a>
	            </li> -->
	           <!--  <li><a href="#tab2-1" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">Chart of Accounts Condition</span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Segments Setting</span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Transaction Item </span></a>
	            </li>
	            <li><a href="#tab5-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Tax Setting </span></a>
	            </li>	 -->
	            <li class="active"><a href="#tab1-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.prefix_setting"></span> </span></a>
	            </li>	                        
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Branch content -->
	            <!-- <div class="tab-pane active" id="tab1-1">
	            	<p>The selected Financial Reporting Standard</p>
	            	<div class="tab1-aacountsetting">
	            		<p>
	            			BanhJi does not guarantee the full compliance with above selected financial reporting 
	            			standards. We only provide the recommended format of the financial statements of selected standard.
	            		</p>
	            		<a href="" class="btn-change">Change</a>
	            	</div>
	            	<p class="noted">
	            		<b>Noted:</b>
	            		BanhJi does not guarantee the full compliance with above selected financial reporting 
	            		standards. We only provide the recommended format of the financial statements of selected standard. 
	            	</p>	            
	            </div> -->
	            <!-- // Tab Branch content END -->

	            <!-- Tab Contact Type content -->
	            <!-- <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-method-template"
				                data-template="customerSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div> -->
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Block content -->
	           <!--  <div class="tab-pane" id="tab2-1">
            		<div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentTermName">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="term ..." data-bind="value: paymentTerm">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="% ..." data-bind="value: paymentTermPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th>Term</th>
	            				<th>%</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-term-template"
				                data-template="customerSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div> -->
	            <!-- // Tab Block content END -->

	            <!-- Tab Block content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr class="widget-head">
	            				<th class="center" data-bind="text: lang.lang.type"></th>
	            				<th class="center" data-bind="text: lang.lang.abbr"></th>
	            				<th class="center" data-bind="text: lang.lang.startup_number"></th>
	            				<th style="text-align: left;padding-left: 5px;" data-bind="text: lang.lang.name"></th>
	            				<th class="center"><span data-bind="text: lang.lang.action"></span></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
								 data-selectable="false"
				                 data-template="accountSetting-prefix-template"
				                 data-bind="source: prefixDS">				            
	            		</tbody>
	            	</table>

	            </div>
	            <!-- // Tab Block content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="accountSetting-prefix-template" type="text/x-kendo-template">
	<tr>
		<td > #=type#  </a></td>
		<td style="text-align: center; padding-left: 10px!important;"> 
			#= abbr# 
		</td>
		<td class="center"> 
			#= startup_number#
		</td>
		<td class="center" style="text-align: left;">
			<a style="text-align: left;padding-left: 5px;" href="\\#/add_accountingprefix/#= id # ">#= name# </a>
		</td>
		<td class="center">
			<a class="btn-action glyphicons pencil btn-success" href="\\#/add_accountingprefix/#= id # "><i></i></a>
		</td>
	</tr>
</script>

<script id="addAccountingprefix" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" 
							data-bind="click: cancel"><i></i></span>						
					</div>
			        <h2 style="padding:0 15px;"">Edit Accounting Prefix</h2>
				    <br>	
				    <div class="row span12" style="margin-left:0;margin-bottom: 20px;">			   				
						
						<input type="text" placeholder="Abbr" class="k-textbox k-invalid span4" data-bind="value: obj.abbr" >
						<input type="text" placeholder="Startup Number" class="k-textbox k-invalid span2" data-bind="value: obj.startup_number" >
					</div>
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>
						<div class="row">
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;float:right; margin-right: 15px;"><i></i> Save Close</span>	
						</div>
					</div>
					<!-- // Form actions END -->	
				</div>							
			</div>
		</div>
	</div>
</script>

<script id="accountingSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="accountingSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="accountingSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="accountingSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="accountingSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
    		 #:term#
   		</td>
   		<td>
    		 #:discount_percentage#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="accountingSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:net_due" name="term" required="required" validationMessage="required" />
                <span data-for="term" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_percentage" name="percentage" required="required" validationMessage="required" />
                <span data-for="percentage" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="accountingList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input data-role="dropdownlist"
							   data-option-label="(--- TYPE ---)"
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: contact_type_id,
			                              source: contactTypeDS" />

							<button id="search" type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>		
						</div>

						<h3 align="center"><span data-bind="text: lang.lang.customer_list"></span></h3>
				
						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>

<script id="segment" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960" style="overflow: hidden;">					
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>
					<br>
					<br>
			        <h2 span data-bind="text: lang.lang.segment"></h2>

			        <div class="row">
				        <div class="span6">
				        	<p>
					        	<span data-bind="text: lang.lang.segment_is_important"></span>
					        </p>
				        </div>
				         <div class="span6">
				         	<button class="btn btn-inverse" data-bind="click: openWindow"><i class="icon-plus icon-white"></i>&nbsp&nbsp<span data-bind="text: lang.lang.add_new_segment"></span></button>
							
				        </div>
			        </div>				    			   

				    <br>

				    <!-- Window -->
				    <div data-role="window"
			                 data-title="Segment"		                 
			                 data-width="280"
			                 data-height="165"
			                 data-actions="{}"
			                 data-position="{top: '30%', left: '37%'}"
			                 data-bind="visible: windowVisible">
				    	
				    	<table>							
							<tr style="border-bottom: 8px solid #fff;">
								<td width="40%"><span data-bind="text: lang.lang.name"></span></td>
								<td>
									<input class="k-textbox" placeholder="name..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>		
						</table>

						<br>

						<div style="text-align: center;">
							<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i><span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i><span data-bind="text: lang.lang.close"></span></span>  
						</div>
					</div>
							
	                <div class="row-fluid">
		                <div class="span12 table-segment" style="padding: 0;">	                					
			            	<table class="table table-condensed">
			            		<thead style="background-color: #1E4E78; color: #fff; font-weight: bold">
			            			<tr>
			            				<th data-bind="text: lang.lang.name"></th>            					            	
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"			            			
						                data-template="segment-template"
						                data-bind="source: dataSource"></tbody>
			            	</table>
		            	</div>

		            <!-- Item Window -->
		            <div data-role="window"
			                 data-title="Segment Item"		                 
			                 data-width="250"
			                 data-height="201"
			                 data-actions="{}"
			                 data-position="{top: '30%', left: '37%'}"		                 
			                 data-bind="visible: windowItemVisible">
	            		<table>
							<tr style="border-bottom: 8px solid #fff;">
								<td width="35%"><span data-bind="text: lang.lang.code"></span></td>
								<td>
									<input class="k-textbox" placeholder="type code ..." data-bind="value: item.code" style="width: 100%;">
								</td>
							</tr>
							<tr style="border-bottom: 8px solid #fff;">
								<td><span data-bind="text: lang.lang.name"></span></td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: item.name" style="width: 100%;">
								</td>
							</tr>
						</table>

						<br>
						<div style="text-align: center;">
							<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: saveItem"><i></i><span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindowItem"><i></i><span data-bind="text: lang.lang.close"></span></span>  
						</div>
					</div>

					<h3 data-bind="text: objName"></h3>

					<div class="row">
		            	<div class="span12">		                	
						    <table class="table table-bordered table-white">
			            		<thead>
			            			<tr>
			            				<th data-bind="text: lang.lang.code"></th>
			            				<th data-bind="text: lang.lang.name"></th>
			            				<th data-bind="text: lang.lang.segment"></th>   					            		
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"			            				
						                data-template="segment-item-template"
						                data-auto-bind="false"
						                data-bind="source: itemDS"></tbody>
			            	</table>
		            	</div>
	            	</div>
				</div>							
			</div>
		</div>
	</div>
</script>
<script id="segment-template" type="text/x-kendo-tmpl">                    
    <tr>    	
    	<td>#=name#</td>
    	<td>
    		<span data-bind="click: edit"><i class="icon-edit"></i> Edit</span>
    		#if(!is_system=="1"){#
	    		|
	    		<span data-bind="click: delete"><i class="icon-remove"></i> Delete</span>
    		#}#
    		|
    		<span data-bind="click: view"><i class="icon-view"></i> View Item</span>
    		|
    		<span data-bind="click: addItem"><i class="icon-plus icon-white"></i> Add Item</span>
    	</td>
   	</tr>
</script>
<script id="segment-item-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=code#</td>
    	<td>#=name#</td>
    	<td>#=segment[0].name#</td>
   		<td>
    		<span data-bind="click: editItem"><i class="icon-edit"></i> Edit</span>
    		#if(!is_system=="1"){#
	    		|
	    		<span data-bind="click: deleteItem"><i class="icon-remove"></i> Delete</span>
    		#}#
    	</td>
   	</tr>
</script>


<script id="saleTaxReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>SALE TAX REPORTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td width="50%">
								<h3><a href="#/sale_journal">Sale Journal</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/purchase_journal">Purchase Journal</a></h3>								
							</td>						
						</tr>
						<tr>
							<td width="50%">
								<p>
									
								</p>
								
							</td>
							<td width="50%">
								<p>
									
								</p>
							</td>
							
						</tr>
						
					</table>
				</div>
			</div>

		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			
		</div>
	</div>
</script>
<script id="saleJournal" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					<div class="block-title">
						<h3 data-bind="text: company.name"></h3>
						<h2>សៀវភៅទិន្នានុប្បវត្តិលក់</h2>
						<p>Sale Journal</p>
						<p>ខែ កក្ដដា ឆ្នំា​  ២០១៦ For  July  2016</p>
					</div>

					<div class="row-fluid company-name">
						<div class="span7" style="padding-left: 0; padding-right: 15px;">
							<table>
								<tr style="border-bottom: 1px solid #000;">
									<td>
										នាមករណ៍សហគ្រាសៈ
										<br>
										Company's name:
									</td>
									<td>
										បញ្ចី
										<br>
										Banh Ji
									</td>
								</tr>
															
								<tr>
									<td>
										អាស័យដ្ឋាន:
										<br/>
										Address:
									</td>
									<td>#245 ផ្លូវ 182 ភូមិ  ៧ សង្កាត់ ទឹកល្អក់ទី ២ ខណ្ឌ ទួលគោក រាជធានីភ្នំពេញ</td>
								</tr>
							</table>
						</div>
						<div class="span5">
							<table>
								<tr style="border-bottom: 1px solid #000;">
									<td>
										លេខអត្តសញ្ញាណកម្មអតប:
										<br>
										Tax Identification No:
									</td>
									<td>
										100100260	
									</td>
								</tr>
								<tr>
									<td>
										អត្រាប្តូរប្រាក់មធ្យមៈ
										<br>
										Average Exchange Rate:
									</td>
									<td>
										 4,090
									</td>
								</tr>								
							</table>
						</div>
					</div>

					<br>
					<div class="row-fluid table-company">						
						<table class="table table-bordered">
							<tbody>
								<tr>
									<th style="text-align:center !important" colspan="5">វិក័យប័ត្រ<br>Invoice</th>
									<th style="text-align:center !important" colspan="7">ការផ្គត់ផ្គង់<br>Supplies</th>	
									<th></th>	
								</tr>
								<tr>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">ថ្ងៃទី<br>Date</td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">លេខវិក័យប័ត្រ<br>Invoicen<sup>o</sup> <br></td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">អ្នកទិញ<br>Client</td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">លេខអតប<br>VAT Tin</td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">បរិយាយ<br>Description<br></td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">បរិមាណ<br>Qty<br></td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">ផ្គត់ផ្គង់មិនជាប់អាករ<br>Non-taxable sale<br></td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">ការនាំចេញ<br>Value of Exports<br></td>
									<td style="text-align:center !important;vertical-align: top !important;" colspan="4">ការលក់ជាប់អាករ<br>Taxable sale</td>
									<td style="text-align:center !important;vertical-align: top !important;" rowspan="3">សរុបតម្លៃលក់រួមទាំងអាករ<br>Total Taxable Value</td>
									
								</tr>
								<tr>
									<td colspan="2" style="text-align:center;">លក់អោយបុគ្គលជាប់អាករ<br>Sales to Taxable Persons</td>
									<td colspan="2" style="text-align:center;">លក់អោយអ្នកប្រើប្រាស់<br>Sales to Customers</td>
								</tr>
								<tr>
									<td style="text-align:center !important">តម្លៃជាប់អាករ<br>Taxable Value</td>
									<td style="text-align:center !important">អាករ<br>VAT<br></td>
									<td style="text-align:center !important">តម្លៃជាប់អាករ<br>Taxable Value</td>
									<td style="text-align:center !important">អាករ<br>VAT</td>
								</tr>
								<tr>
									<td style="text-align:center !important">S1</td>
									<td style="text-align:center !important">S2</td>
									<td style="text-align:center !important">S3</td>
									<td style="text-align:center !important">S4</td>
									<td style="text-align:center !important">S5</td>
									<td style="text-align:center !important">S6</td>
									<td style="text-align:center !important">S7</td>
									<td style="text-align:center !important">S8</td>
									<td style="text-align:center !important">S9</td>
									<td style="text-align:center !important">S10</td>
									<td style="text-align:center !important">S11</td>
									<td style="text-align:center !important">S12</td>
									<td style="text-align:center !important">S13=sum(S7:S12)</td>
									
								</tr>
								</tbody><tbody class="sale_tax">
									<tr class="none-padding">
										<td><p style="padding:5px !important; padding-left:10px !important;" class="no">1</p></td>
										<td><input type="text" name="s2[]" id="s2" class="form-control s2" value=""></td>
										<td><input type="text" name="s3[]" id="s3" class="form-control s3" value="" ></td>
										<td><input type="text" name="s4[]" id="s4" class="form-control s4" value=""></td>
										<td><input type="text" name="s5[]" id="s5" class="form-control s5" value=""></td>
										<td><input type="text" name="s6[]" id="s6" class="checknb form-control text-center s6" value=""></td>
										<td><input type="text" name="s7[]" id="s7" class="checknb form-control text-right s7" value=""></td>
										<td><input type="text" name="s8[]" id="s8" class="checknb form-control text-right s8" value="" style="width:100px;"></td>
										<td><input type="text" name="s9[]" id="s9" class="checknb form-control text-right s9" value=""></td>
										<td><input type="text" name="s10[]" id="s10" class="checknb form-control text-right s10" value=""></td>
										<td><input type="text" name="s11[]" id="s11" class="checknb form-control text-right s11" value=""></td>
										<td><input type="text" name="s12[]" id="s12" class="checknb form-control text-right s12" value=""></td>
										<td><input type="text" name="s13[]" id="s13" class="form-control text-right s13" style="font-weight:bold;" value="" readonly=""></td>
										
									</tr>
								</tbody>						
								<tbody><tr>
									<td style="text-align:right !important" colspan="7">សរុបលក់ជារៀល<br>Total Sale in KHR</td>
									<td name="total_s7" id="total_s7" class="total_s7" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s8" id="total_s8" class="total_s8" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s9" id="total_s9" class="total_s9" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s10" id="total_s10" class="total_s10" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s11" id="total_s11" class="total_s11" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s12" id="total_s12" class="total_s12" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									
								</tr>
								<tr id="hide-border">
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td style="text-align:center !important">Box12</td>
									<td style="text-align:center !important">Box13</td>
									<td style="text-align:center !important">Box14</td>
									<td style="text-align:center !important">Box15</td>
									<td style="text-align:center !important">Box14</td>
									<td style="text-align:center !important">Box15</td>
									<td></td>	
								</tr>
							</tbody>
						</table>
					
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>
<script id="purchaseJournal" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="block-title">
						<h3 data-bind="text: company.name"></h3>
						<h2>សៀវភៅទិន្នានុប្បវត្តិទិញ</h2>
						<p>PURCHASE JOURNAL</p>
						<p>ខែ កក្ដដា ឆ្នំា​  ២០១៦ For  July  2016</p>
					</div>

					<div class="row-fluid company-name">
						<div class="span7" style="padding-left: 0; padding-right: 15px;">
							<table>
								<tr style="border-bottom: 1px solid #000;">
									<td>
										នាមករណ៍សហគ្រាសៈ
										<br>
										Company's name:
									</td>
									<td>
										បញ្ចី
										<br>
										Banh Ji
									</td>
								</tr>
															
								<tr>
									<td>
										អាស័យដ្ឋាន:
										<br/>
										Address:
									</td>
									<td>#245 ផ្លូវ 182 ភូមិ  ៧ សង្កាត់ ទឹកល្អក់ទី ២ ខណ្ឌ ទួលគោក រាជធានីភ្នំពេញ</td>
								</tr>
							</table>
						</div>
						<div class="span5">
							<table>
								<tr style="border-bottom: 1px solid #000;">
									<td>
										លេខអត្តសញ្ញាណកម្មអតប:
										<br>
										Tax Identification No:
									</td>
									<td>
										100100260	
									</td>
								</tr>
								<tr>
									<td>
										អត្រាប្តូរប្រាក់មធ្យមៈ
										<br>
										Average Exchange Rate:
									</td>
									<td>
										 4,090
									</td>
								</tr>								
							</table>
						</div>
					</div>

					<br>
					<div class="row-fluid table-company">						
						<table class="table table-bordered">
							<tbody>
								<tr>
							        <td style="text-align:center !important" colspan="6">វិក័យប័ត្រ<br>Invoice    </td>
							        <td style="text-align:center !important" colspan="6">ការផ្គត់ផ្គង់<br>Supplies    </td>
							       
							    </tr>
							    <tr>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">ថ្ងៃទី<br>Date</td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">លេខវិក័យប័ត្រ<br>Invoice n<sup>o</sup></td>
							        <td style="text-align:center !important;vertical-align: middle !important;"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    rowspan="3">អ្នកទិញ<br>Client</td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">លេខ អ ត ប<br>VAT Tin    </td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">បរិយាយ<br>Description    </td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">បរិមាណ<br>Qty    </td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">ការទិញមិនជាប់អាករ<br>Non-taxable Purchase    </td>
							        <td style="text-align:center !important;vertical-align: middle !important;" colspan="4">ការទិញជាប់អាករ<br>Taxable Purchase    </td>
							        <td style="text-align:center !important;vertical-align: middle !important;" rowspan="3">សរុបតម្លៃទិញរួមទាំងអាករ<br>Total Value Including VAT    </td>
							        
							    </tr>
							    <tr>
							        <td style="text-align:center !important" colspan="2">ការនាំចូល<br>Imports    </td>
							        <td style="text-align:center !important" colspan="2">ការទិញក្នុងស្រុក<br>Local Purchases    </td>
							    </tr>
							    <tr>
							        <td style="text-align:center !important">តម្លៃជាប់អាករ<br>Taxable Value</td>
							        <td style="text-align:center !important">អាករ<br>VAT    </td>
							        <td style="text-align:center !important">តម្លៃជាប់អាករ<br>Taxable Value    </td>
							        <td style="text-align:center !important">អាករ<br>VAT    </td>
							    </tr>
							   
							    <tr>
							        <td style="text-align:center !important">P1</td>
							        <td style="text-align:center !important">P2</td>
							        <td style="text-align:center !important">P3</td>
							        <td style="text-align:center !important">P4</td>
							        <td style="text-align:center !important">P5</td>
							        <td style="text-align:center !important">P6</td>
							        <td style="text-align:center !important">P7</td>
							        <td style="text-align:center !important">P8</td>
							        <td style="text-align:center !important">P9</td>
							        <td style="text-align:center !important">P10</td>
							        <td style="text-align:center !important">P11</td>
							        <td style="text-align:center !important">P13=sum(P7:P11)</td>
							       
							    </tr>
							</tbody>
								<tbody class="sale_tax">
									<tr class="none-padding">
										<td><input type="text" name="s1[]" id="s1" class="form-control datetime s1" value="" ></td>
										<td><input type="text" name="s2[]" id="s2" class="form-control s2" value=""></td>
										<td><div class="select2-container form-control s3" id="s2id_s3"><a href="javascript:void(0)" class="select2-choice select2-default" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-8"></span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation"></b></span></a><label for="s2id_autogen8" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen" type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-8" id="s2id_autogen8"><div class="select2-drop select2-display-none select2-with-searchbox">   <div class="select2-search">       <label for="s2id_autogen8_search" class="select2-offscreen"></label>       <input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input" role="combobox" aria-expanded="true" aria-autocomplete="list" aria-owns="select2-results-8" id="s2id_autogen8_search" placeholder="">   </div>   <ul class="select2-results" role="listbox" id="select2-results-8">   </ul></div></div><select name="s3[]" id="s3" class="form-control s3" tabindex="-1" title="" style="display: none;"><option value=""></option><option value="1">Owner</option><option value="2">Owner</option><option value="398">WG company</option><option value="401">Coffe shop</option></select></td>
										<td><input type="text" name="s4[]" id="s4" class="checknb form-control s4" value=""></td>
										<td><input type="text" name="s5[]" id="s5" class="form-control s5" value=""></td>
										<td><input type="text" name="s6[]" id="s6" class="checknb form-control text-center s6" value=""></td>
										<td><input type="text" name="s7[]" id="s7" class="checknb form-control text-right s7" value=""></td>
										<td><input type="text" name="s9[]" id="s9" class="checknb form-control text-right s9" value=""></td>
										<td><input type="text" name="s10[]" id="s10" class="checknb form-control text-right s10" value=""></td>
										<td><input type="text" name="s11[]" id="s11" class="checknb form-control text-right s11" value=""></td>
										<td><input type="text" name="s12[]" id="s12" class="checknb form-control text-right s12" value=""></td>
										<td><input type="text" name="s13[]" id="s13" class="form-control text-right s13" style="font-weight:bold;" value="" readonly=""></td>
										
									</tr>
								</tbody>				
								
							    <tbody><tr>
							        <td style="text-align:right !important" colspan="6">សរុបទិញជារៀល<br>Total Purchase in KHR</td>
							        <td name="total_s7" id="total_s7" class="total_s7" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s9" id="total_s9" class="total_s9" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s10" id="total_s10" class="total_s10" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s11" id="total_s11" class="total_s11" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s12" id="total_s12" class="total_s12" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									<td name="total_s13" id="total_s13" class="total_s13" style="padding-right:15px; text-align:right; font-weight:bold;"></td>
									
							    </tr>
							    <tr id="hide-border">
							        <td></td>
							        <td></td>
							        <td></td>
							        <td></td>
							        <td></td>
							        <td></td>
							        <td>Box06</td>
							        <td>Box09</td>
							        <td>Box10</td>
							        <td>Box07</td>
							        <td>Box08</td>
							       	<td>Box09</td>
							    </tr>										
							</tbody>
						</table>					
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>



<!-- ***************************
*	Employee Section            *
**************************** -->
<script id="employeeDashboard" type="text/x-kendo-template">

	<div class="row-fluid">

		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
					
			        <td valign="top">
			        	<h2>EMPLOYEE</h2>
			        	<p>
			        		In here, you can manage your employee information, and other related transactions.
			        	</p>
			        	<div class="supplier-icon">
					       	<div class="span4">
						       	<a href="#/employee" class="center">
						       		<img title="Add Employee" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/employees.ico" />
						       	</a>
						       </div>
						    <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
						       	</a>
						    </div>
						</div>

			        </td>
			 	</tr>
			</table>
			<table class="table table-borderless table-condensed table-vertical-center">
				<tr>
					<td class="center">
						<a href="#/cash_advance">
							<img title="Add Cash Advance" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_advance.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">Advance</span>
						</a>						
					</td>
					<td class="center">
						<a href="#/expense">
							<img title="Add Expense" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/expense.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">Expense</span>
						</a>
					</td>
					<td class="center">
						<a href="#/cash_transaction">				
							<img title="Add Cash Transaction" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_transaction.png" width="110" height="200" />						
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">Cash Tnx.</span>
						</a>					
					</td>					
				</tr>							
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8">

			<!-- Summary -->
			<div class="row-fluid">
	
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons coins"><i></i></span>Expense</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert alert-primary">
							
							<div align="center" class="text-large strong" data-bind="text: sale"></div>
							<table width="100%">
								<tr align="center">
									<td width="33%">										
										<span data-bind="text: sale_customer"></span>
										<br>
										<span>Employee</span>
									</td>
									<td width="33%">
										<span data-bind="text: sale_product"></span>
										<br>
										<span>Product</span>
									</td>
									<td width="33%">
										<span data-bind="text: sale_order"></span>
										<br>
										<span>Order</span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons cart_in"><i></i></span>Order</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info">
							
							<div align="center" class="text-large strong" data-bind="text: order"></div>
							<table width="100%">
								<tr align="center">
									<td width="50%">										
										<span data-bind="text: order_avg"></span>
										<br>
										<span>Average</span>
									</td>
									<td width="50%">
										<span data-bind="text: order_open"></span>
										<br>
										<span>Open</span>
									</td>									
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons credit_card"><i></i></span>Receivable</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info3" style="background-color: LightGray">
							
							<div align="center" class="text-large strong" data-bind="text: ar"></div>
							<table width="100%">
								<tr align="center">
									<td width="33%">										
										<span data-bind="text: ar_open"></span>
										<br>
										<span>Open</span>
									</td>
									<td width="33%">
										<span data-bind="text: ar_customer"></span>
										<br>
										<span>Customer</span>
									</td>
									<td width="33%">
										<span data-bind="text: ar_overdue"></span>
										<br>
										<span>Overdue</span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">
					<h4>Top 5 Employees</h4>					
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;" class="center">#</th>
				                <th>Name</th>			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="customerDashBoard-top-customer-template"
			                 data-bind="source: topCustomerDS"></tbody>			        
				    </table>			
				</div>						
			</div>

			<!-- Graph -->
			<div>
				<div id="graph" style="height: 100%;"></div>
			</div>

		</div>		

	</div>
</script>
<script id="employeeDashBoard-top-customer-template" type="text/x-kendo-tmpl">	
	<tr data-uid="#: uid #">
		<td>#:banhji.customerDashboard.topCustomerDS.indexOf(data)+1#</td>		
		<td>
			<span>#=name#</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>		
	</tr>
</script>
<script id="employeeDashBoard-top-ar-template" type="text/x-kendo-tmpl">
	<tr>
		<td>#:banhji.customerDashboard.topARDS.indexOf(data)+1#</td>		
		<td>
			<span>#=name#</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>
	</tr>
</script>
<script id="employeeDashBoard-top-product-template" type="text/x-kendo-tmpl">
	<tr>
		<td>#:banhji.customerDashboard.topProductDS.indexOf(data)+1#</td>		
		<td>
			<span>#=name#</span>
			<span class="pull-right">#=kendo.toString(quantity, "n0")#</span>
		</td>
	</tr>
</script>

<script id="employeeCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Employee ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%;">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: contactDS"
						 data-auto-bind="false" 
						 data-row-template="employeeCenter-customer-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							        	<li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.number"></span>
							            	
							            	<span data-bind="text: obj.fullname"></span>
							            </li>
							            <li class="glyphicons text_bigger active"><span data-toggle="tab" data-target="#tab1-7"><i></i></span>
							            </li>							           
							            <li class="glyphicons riflescope"><span data-toggle="tab" data-target="#tab2-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab3-7"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab4-7"><i></i></span>
							            </li>
							            <li class="glyphicons edit"><span data-bind="click: goEditContact"><i></i></span>
							            </li>							            							            							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Transactions Tab content -->
							            <div id="tab1-7" class="tab-pane active box-generic">
							            	<table class="table table-borderless table-condensed cart_total">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashadvance">Cash Advance</span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goExpense">Expense</span>								            			
								            		</td>								            	
							            	</table>
							            </div>
							            <!-- // Transactions Tab content END -->

							            <!-- SEARCH Tab content -->
							            <div id="tab2-7" class="tab-pane box-generic">
							                <input data-role="dropdownlist"
							                	   data-auto-bind="false"
						            			   data-option-label="Select Customer Type..."					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: contact_type_id,
								                              source: contactTypeDS"
								                   style="width: 100%"/>

							                <input data-role="dropdownlist"
						            			   data-option-label="Select Currency..."
						            			   data-template="currency-list-tmpl"					            			   		                   
								                   data-value-primitive="true"
								                   data-text-field="code"
								                   data-value-field="id"
								                   data-bind="value: currency_id,
								                              source: currencyDS"
								                   style="width: 100%"/>

								            <br><br>
								            <span class="btn btn-primary btn-icon glyphicons search pull-right" data-bind="click: search"><i></i> <span data-bind="text: lang.lang.search"></span></span>
								            <br>
							            </div>
							            <!-- // SEARCH Tab content END -->							            

							            <!-- INFO Tab content -->
							            <div id="tab3-7" class="tab-pane box-generic">
							            	<div class="row-fluid">
								            	<div class="span6">
										
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons user"><i></i> <span data-bind="text: obj.wnumber"></span> <span data-bind="text: obj.fullname"></span></h4>
														</div>
														<div class="widget-body">
															<ul class="unstyled icons margin-none">
																<li class="glyphicons group"><i></i> <span data-bind="text: obj.contact_type"></span></li>
																<li class="glyphicons phone"><i></i> <span data-bind="text: obj.phone"></span></li>
																<li class="glyphicons envelope"><i></i> <span data-bind="text: obj.email"></li>
																<li class="glyphicons calendar"><i></i> <span data-bind="text: obj.registered_date"></li>
															</ul>
														</div>
													</div>
													<!-- // Bio END -->
													
												</div>
												<div class="span6">
													<!-- Bio -->
													<div class="widget widget-heading-simple widget-body-gray margin-none">
														<div class="widget-head">
															<h4 class="heading glyphicons edit" data-bind="click: goEditContact"><i></i> <span data-bind="text: lang.lang.edit"></span></h4>
														</div>
														<div class="widget-body">
															<p><i class="icon-home"></i> <span data-bind="text: obj.address"></span></p>
														</div>
													</div>
													<!-- // Bio END -->
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab4-7" class="tab-pane box-generic">

										    <div class="chat-controls">															
												<form class="margin-none">
													<div class="row-fluid">
														<div class="span10">
															<input type="text" name="message" class="input-block-level margin-none" data-bind="value: note" placeholder="កំណត់Memo ...">
														</div>
														<div class="span2">
															<span class="btn btn-block btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.save"></span></span>
														</div>
													</div>
												</form>															
											</div>

											<br>

									    	<div data-role="grid"
									    	 	 data-height="100"
					 							 data-scrollable="{virtual: true}"									                 
								                 data-row-template="customerCenter-note-tmpl"
								                 data-bind="source: noteDS"
								                 data-columns="[{title: ''}]"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->							            								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt">Total Advance<span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadDeposit">
										<span class="glyphicons briefcase"><i></i></span>
										<span class="txt">Business Adva<span data-bind="text: deposit" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: outInvoice"></span> Open</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> Over Due</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input id="sorter" name="sorter"
				    	   data-role="dropdownlist"                   
				           data-value-primitive="true"
				           data-text-field="text"
				           data-value-field="value"
				           data-bind="value: sorter,
				                      source: sortList" />
				                                   
				        <input id="sdate" name="sdate"						           
					           data-bind="value: sdate"
					           placeholder="From ..." />
				        
				       	<input id="edate" name="edate"						           
					           data-bind="value: edate"
					           placeholder="To ..." />

			            <button id="search" type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th>Date</th>
								<th>Type</th>								
								<th>Reference No</th>
								<th>Amount</th>
								<th>Status</th>
								<th>Action</th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="customerCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="employeeCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(type=="Invoice" || type=="Cash_Sale" || type=="Quote" || type=="Sale_Order" || type=="GDN" || type=="Sale_Return"){#
				<a href="\#/#=type.toLowerCase()#/#=id#"><i></i> #=number#</a>						
			#}else{#
				#=number#
			#}#        	
        </td>
    	<td class="right">
    		#if(type=="GDN"){#
    			#=kendo.toString(amount, "n0")#
    		#}else{#
    			#=kendo.toString(amount, locale=="km-KH"?"c0":"c", locale)#
    		#}#
    	</td>
    	<td>        	
        	#if(type==="Invoice"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#
        	#}else if(type==="Sale_Order" || type==="GDN"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="Quote"){#        		
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Approved        			
        		#}#
        	#}#			
		</td>    	
    	<td align="center">
			#if(type==="Invoice"){#
				<a href="\#/invoice/#=id#"><i></i> Send</a>

				#if(status==="0" || status==="2"){#					
					| <a href="\#/cashier/#=id#"><i></i> Pay</a>
				#}#        	
			#}else if(type==="Sale_Order"){#
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="Quote"){#
        		<a href="\#/quote/#=id#"><i></i> Send</a>        		
        		#if(status==="0"){#
        			
        		#}#
        	#}else if(type==="GDN"){#        		
        		#if(status==="0"){#
        			
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="employeeCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=number# #=fullname#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="employeeCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="employee" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">				
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

			        <h2>Employee</h2>

			        <br>				

			    	<div class="row-fluid">
			    		<div class="span6 well">

							<div class="row-fluid">

								<div class="span6">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlContactType">Employee Type<span style="color:red">*</span></label>
										<input id="ddlContactType" name="ddlContactType"
											   data-role="dropdownlist"
											   data-option-label="(--- Select ---)"									                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.contact_type_id,
							                   			  disabled: obj.is_pattern, 
							                              source: contactTypeDS,
							                              events:{change: contactTypeChanges}"
							                   required data-required-msg="required"
							                   style="width: 100%;" />									            
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">							
										<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
				              			<input id="number" name="number" class="k-textbox"
					              				data-bind="value: obj.number, disabled: obj.is_pattern" 
					              				placeholder="e.g. ID0001" required data-required-msg="required"
					              				style="width: 100%;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->											
								</div>
							</div>
							
							<div class="row-fluid">
								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
					              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname, disabled: obj.is_pattern" 
							              		placeholder="surname ..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
							            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name, disabled: obj.is_pattern" 
							              		placeholder="name ..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid">	
								<!-- Map -->
								<div id="map" class="span12" style="height: 130px;"></div>
							</div>

							<div class="separator line bottom"></div>

						
						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						            
						            <li class="span2 glyphicons usd active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.account"></span></a>
						            </li>								           							            
						            <li class="span2 glyphicons nameplate_alt">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.info"></span></a>
						            </li>
						            <li class="span2 glyphicons paperclip">
						            	<a href="#tab3" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.info"></span></a>
						            </li>
						            									           						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">
						        <!-- //ACCOUNTING INFO -->
						        <div class="tab-pane active" id="tab1">
						        	
						        	<div class="row-fluid">

						            	<div class="span3">													
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlAD">Advance Account<span style="color:red">*</span></label>
												<input id="ddlAD" name="ddlAD"
													   data-role="dropdownlist"
													   data-header-template="account-header-tmpl"
													   data-option-label="(--- Select ---)"											                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.account_id,
									                              source: adDS"
									                   required data-required-msg="required"											                              
									                   style="width: 100%;" />									            
											</div>
											<!-- // Group END -->													
										</div>												
										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="ddlSA">Salary Account<span style="color:red">*</span></label>
												<input id="ddlSA" name="ddlSA"
													   data-role="dropdownlist"
													   data-option-label="(--- Select ---)"											                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-header-template="account-header-tmpl"
									                   data-value-field="id"
									                   data-bind="value: obj.salary_account_id,
									                              source: saDS"
									                   required data-required-msg="required"											                              
									                   style="width: 100%;" />
										    </div>
											<!-- // Group END -->	
										</div>
										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
									            <input id="currency" name="currency" 
									            	data-role="dropdownlist"
									            	data-value-primitive="true"
									                data-text-field="code"
									                data-value-field="id"
													data-bind="value: obj.currency_id, source: currencyDS"
													data-option-label="(--- Select ---)" 
													required data-required-msg="required" style="width: 100%;" />
											</div>													
										</div>																																				
							        </div>	
							        <div class="separator line bottom"></div>
					        	</div>
						        <!-- //ACCOUNTING INFO END -->								        

						        <!-- //GENERAL INFO -->
						        <div class="tab-pane" id="tab2">
					            	<table class="table table-borderless table-condensed cart_total">						            	
					            		<tr>
							                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
							              	<td>
							              		<input id="customerStatus" name="customerStatus" 
							              				data-role="dropdownlist"
									            		data-text-field="name"
						           						data-value-field="id"
						           						data-value-primitive="true" 
									            		data-bind="source: statusList, value: obj.status"
									            		data-option-label="(--- Select ---)"
									            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
							              	</td>							              	
							            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
							              	<td>
							              		<input id="registered_date" name="registered_date" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.registered_date" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
							              	</td>
							            </tr>									            
							            <tr>
							                <td><span data-bind="text: lang.lang.email"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" /></td>							              	
							            	<td><span data-bind="text: lang.lang.phone"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
							            </tr>									           							            
							            <tr>
							            	<td><span data-bind="text: lang.lang.address"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
							            	<td><span data-bind="text: lang.lang.memo"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
							            </tr>
							            <tr>
							            	<td><label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label></td>
							              	<td><input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />							              	
							            	<td><span data-bind="text: lang.lang.ship_to"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." /></td>									              	
							            </tr>							            							            								            								            			            
							        </table>
					        	</div>
						        <!-- //GENERAL INFO END -->	
						        <div class="tab-pane" id="tab3">	
						        	<input name="files"
					                   type="file"
					                   data-role="upload"
					                   data-async="{ saveUrl: 'save', removeUrl: 'remove', autoUpload: false }">								     
						        </div>						        
						    </div>
						</div>
					</div>

					<br>											
							
							<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> Save New</span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> Save Close</span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> Cancel</span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> Delete</span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->	          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	 
</script>
<script id="employee-contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="employeeReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>EMPLOYEE REPORTS</h2>
				<p>
					The following reports provide summary and detailed reports on employee related transactions.   
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/">Inventory Position Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/">Inventory Sale by Item Analysis</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Summarizes each inventory balance by quantity on hand, on purchase 
									order and sale order. In addition, it also includes average cost and price.
								</p>
								
							</td>
							<td >
								<p>
									Lists of all transactions related to and grouped by each inventory 
									with analysis of average gross profit margin.
								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/">Inventory Position Detail</a></h3>
							</td>
							<td >
								<h3><a href="#/">Inventory Turnover List</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual inventory movement transactions by date for 
									each inventory within a period of time.
								</p>
							</td>
							<td >
								<p>
									Provides analysis of inventory turnover days by each inventory.
								</p>
							</td>
						</tr>
					</table>					
				</div>
			</div>
			<div class="row-fluid recevable-report">
				<h2>OTHER REPORTS/ LISTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/">Inventory List</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/">Recurring Inventory Template List</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Lists the products you purchase and sold. The following 
									information is included: name, description, cost, sales price, and quantity on hand.s						

								</p>
								
							</td>
							<td >
							</td>							
						</tr>
					</table>
				</div>
			</div>
		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart">
				<div class="widget-body alert alert-primary sale-overview">
					<h2>Inventory Balance</h2>
					<div align="center" class="text-large strong">$183,690,640</div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span>6</span>
								<br>
								<span>Inventory items </span>
							</td>
							<td>
								<span>1</span>
								<br>
								<span>Categories</span>
							</td>
							<td>
								<span>10%</span>
								<br>
								<span>Average Margin</span>
							</td>
							<td>
								<span>20 days</span>
								<br>
								<span>Turnover Days</span>
							</td>
						</tr>
					</table>
				</div>
				<div id="sale-report-chart">Chart</div>
			</div>
		</div>
	</div>
</script>

<script id="cashAdvance" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">					
			    
		    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

		        <h4 span data-bind="text: lang.lang.cash_advance"></h4>			    		   

			    <br>				   				
					
				<!-- Upper Part -->
				<div class="row-fluid">
					<div class="span4">
						<div class="box-generic well" style="height: 150px;">				
							<table class="table table-borderless table-condensed cart_total">									
								<tr data-bind="visible: isEdit">				
									<td><span data-bind="text: lang.lang.no_"></span></td>
									<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.date"></span></td>
									<td class="right">
										<input id="issuedDate" name="issuedDate" 
												data-role="datepicker"
												data-format="dd-MM-yyyy"
												data-parse-formats="yyyy-MM-dd" 
												data-bind="value: obj.issued_date, 
															events:{ change : setRate }" 
												required data-required-msg="required"
												style="width:100%;" />
									</td>
								</tr>								
								<tr>
									<td><span data-bind="text: lang.lang.currency"></span></td>
									<td>
										<input id="cbbCurrency" name="cbbCurrency"
													   data-role="combobox"				                
									                   data-value-primitive="true"
									                   data-template="currency-list-tmpl"				   
									                   data-text-field="code"
									                   data-value-field="locale"
									                   data-bind="value: obj.locale, 
									                   			source: currencyDS, 
									                   			events: {change : setRate}"
									                   placeholder="Add currency..." 
									                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.employee"></span></td>
									<td>
										<input id="cbbContact" name="cbbContact"
											   data-role="combobox"
											   data-auto-bind="false"
											   data-header-template="employee-header-tmpl"                  
							                   data-value-primitive="true"
							                   data-template="contact-list-tmpl"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS"
							                   data-placeholder="Type Name.."                    
							                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>																							
							</table>

							<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
								data-bind="style: { backgroundColor: amtDueColor}">
								<div align="left"><span data-bind="text: lang.lang.total_amount"></span></div>
								<h2 data-bind="text: total" align="right"></h2>
							</div>

						</div>
					</div>					   

					<div class="span8">

						<div class="box-generic-noborder" style="min-height: 55px;padding-bottom: 15px;">

						    <!-- Tabs Heading -->
						    <div class="tabsbar tabsbar-2">
						        <ul class="row-fluid row-merge">
						        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons pencil"><a href="#tab2-4" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons paperclip"><a href="#tab3-4" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons history"><a href="#tab4-4" data-toggle="tab"><i></i></a>
						            </li>								            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						        <!-- Option Tab content -->
						        <div class="tab-pane active" id="tab1-4">
						        	
						        	<table class="table table-borderless table-condensed cart_total">
										<tr>										
											<td><span data-bind="text: lang.lang.expected_date"></span></td>
											<td>
												<input id="txtExpectedDate" name="txtExpectedDate" 
														data-role="datepicker"
														data-format="dd-MM-yyyy"
														data-parse-formats="yyyy-MM-dd" 
														data-bind="value: obj.due_date" 
														required data-required-msg="required"
														style="width:100%;" />
											</td>
										</tr>
										<tr>										
											<td><span data-bind="text: lang.lang.method"></span></td>
											<td>
												<input id="ddlPaymentMethod" name="ddlPaymentMethod"
													   data-role="dropdownlist"								                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-header-template="cash-payment-method-header-tmpl"
									                   data-value-field="id"
									                   data-bind="value: obj.payment_method_id,
									                              source: paymentMethodDS"							                   
									                   data-option-label="(--- Select ---)"
									                   required data-required-msg="required" 
									                   style="width: 100%;" />
									        </td>
										</tr>
										<tr>									
											<td><span data-bind="text: lang.lang.cash_account"></span></td>
											<td>
												<input id="cbbAccount" name="cbbAccount"
													   data-role="combobox"                   
									                   data-value-primitive="true"
									                   data-header-template="account-header-tmpl"                  
									                   data-template="account-list-tmpl"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.account_id,
									                              source: cashAccountDS"
									                   data-placeholder="Select Account.."					                                      
									                   required data-required-msg="required" style="width: 100%" />									            
											</td>
										</tr>
										<tr>										
											<td><span data-bind="text: lang.lang.segment"></span></td>
											<td>
												<select data-role="multiselect"
													   data-value-primitive="true"
													   data-header-template="segment-header-tmpl"							   
													   data-item-template="segment-list-tmpl"				    
													   data-value-field="id" 
													   data-text-field="code"
													   data-bind="value: obj.segments, 
													   			source: segmentItemDS,
													   			events:{ change: transactionSegmentChanges }"
													   data-placeholder="Add Segment.."				   
													   style="width: 100%" /></select>									            
											</td>
										</tr>
									</table>

						        </div>
						        <!-- // Option Tab content END -->

						        <!-- Memo Tab content -->
						        <div class="tab-pane" id="tab2-4">
						        	<textarea id="memo2" cols="0" rows="4" class="k-textbox" 
						        		data-bind="value: obj.memo2" style="width:100%;" 
						        		placeholder="Please enter transaction purpose here ..."></textarea>
						        </div>
						        <!-- // Memo Tab content END -->

						        <!-- Attach Tab content -->
						        <div class="tab-pane" id="tab3-4">
						         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							       
						            <input id="files" name="files"
					                   type="file"
					                   data-role="upload"
					                   data-show-file-list="false"
					                   data-bind="events: { 
			                   				select: onSelect
					                   }">

						            <table class="table table-bordered">
								        <thead>
								            <tr>			                
								                <th data-bind="text: lang.lang.file_name"></th>
								                <th data-bind="text: lang.lang.description"></th>
								                <th data-bind="text: lang.lang.date"></th>
								                <th style="width: 13%;"></th>                			                
								            </tr> 
								        </thead>
								        <tbody data-role="listview" 
								        		data-template="attachment-list-tmpl" 
								        		data-auto-bind="false"
								        		data-bind="source: attachmentDS"></tbody>			        
								    </table>

						        </div>
						        <!-- // Attach Tab content END -->						        

						        <!-- Recuring Tab content -->
						        <div class="tab-pane" id="tab4-4">							            	
						            
						            <div class="span5">

							        	<input data-role="combobox"
						                   data-placeholder="Select existing recuring ..."
						                   data-value-primitive="true"
						                   data-auto-bind="false"
						                   data-text-field="recurring_name"
						                   data-value-field="id"
						                   data-bind="value: obj.recurring_id,
						                              source: recurringDS,
						                              events:{ change:applyRecurring }"
						                   style="width: 100%" />

						                <br><br>

						                <div align="right">
							                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						                
							            </div>

						            </div>

						            <div class="span7">

							            <table style="width: 100%">
							            	<tr align="right">
							            		<td>
							            			<span data-bind="text: lang.lang.name"></span>
							            		</td>
							            		<td>
							            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
							            					placeholder="Recurring name.." 
							            					style="width: 40%;" />
							            			<span data-bind="text: lang.lang.start"></span>
									                <input data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd"
															data-bind="value: obj.start_date"
															style="width: 40%;" />
							            		</td>
							            	</tr>
							            	<tr align="right">
							            		<td>
								            		<span data-bind="text: lang.lang.every"></span>
								            	</td>
							            		<td>
								            		<input data-role="numerictextbox"
									                   data-format="n0"
									                   data-min="0"								                   
									                   data-bind="value: obj.interval"
									                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.frequency,
										                              source: frequencyList,
										                              events: { change: frequencyChanges }"
										                   style="width: 45%;" />
								            	</td>
							            	</tr>
								            <tr align="right">
								            	<td>
								            		<span data-bind="text: lang.lang.on"></span>
								            	</td>							            	
								            	<td>

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month,
										                   			  visible: showMonth,
										                              source: monthList"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month_option,
										                   			  visible: showMonthOption,
										                              source: monthOptionList,
										                              events: { change: monthOptionChanges }"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.week,
										                   			  visible: showWeek,
										                              source: weekDayList"										                  
										                   style="width: 45%;" />										            
										        
								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.day,
										                   			  visible: showDay,
										                              source: dayList"										                   
										                   style="width: 45%;" />

								            	</td>
								            </tr>
							            </table>

							        </div>									     
						            
						        </div>
						        <!-- // Recuring Tab content END -->								        

						    </div>
						</div>

				    </div>
				</div>

				<!-- Item List -->
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
			                <th style="width: 20%;"><span data-bind="text: lang.lang.account"></span></th>
			                <th data-bind="text: lang.lang.description"></th>
			                <th data-bind="visible: showRef" style="width: 7%;"><span data-bind="text: lang.lang.reference"></span></th>
			                <th data-bind="visible: showSegment" style="width: 15%;"><span data-bind="text: lang.lang.segment"></span></th>
			                <th style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>			                			  
			            </tr> 
			        </thead>
			        <tbody data-role="listview" 
			        		data-template="cashAdvance-template" 
			        		data-auto-bind="false"
			        		data-bind="source: lineDS"></tbody>			        
			    </table>			    
								
	            <!-- Bottom part -->
	            <div class="row-fluid">
		
					<!-- Column -->
					<div class="span6 hidden-print">
						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

						<div class="btn-group">
							<div class="leadcontainer">
								
							</div>
							<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
							<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
								<li>
									<input type="checkbox" data-bind="checked: showRef" /> <span data-bind="text: lang.lang.reference"></span>
								</li>
								<li>
									<input type="checkbox" data-bind="checked: showSegment" /> <span data-bind="text: lang.lang.segment"></span>
								</li>								
							</ul>
						</div>

												
						
					</div>
					<!-- Column END -->
					
					<!-- Column -->
					<div class="span6">
						<table class="table table-borderless table-condensed cart_total">
							<tbody>								
								<tr>
									<td class="right"><span data-bind="text: lang.lang.total"></span></td>
									<td class="right strong"><span data-bind="text: total"></span></td>
								</tr>								
							</tbody>
						</table>
					</div>
					<!-- // Column END -->
					
				</div>
	           
	            <br>
				
				<!-- Form actions -->
				<div class="box-generic bg-action-button">
					<div id="ntf1" data-role="notification"></div>

					<!-- Delete Confirmation -->
					<div data-role="window"
		                 data-title="Delete Confirmation"
		                 data-width="350"
		                 data-height="200"
		                 data-iframe="true"
		                 data-modal="true"
		                 data-visible="false"
		                 data-position="{top:'40%',left:'35%'}"
		                 data-actions="{}"
		                 data-resizable="false"
		                 data-bind="visible: showConfirm"
		                 style="text-align:center;">
		                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
					    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
					    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
		            </div>
		            <!-- // Delete Confirmation -->

					<div class="row">
						<div class="span3">
							<input data-role="dropdownlist"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.transaction_template_id,
				                              source: txnTemplateDS"
				                   data-option-label="Select Template..." />
						</div>
						<div class="span9" align="right">
							<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
							<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
							<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
							<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
						</div>
					</div>
				</div>
				<!-- // Form actions END -->								

			</div>							
			</div>
		</div>
	</div>
</script>
<script id="cashAdvance-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: remove }"></i>
			#:banhji.cashAdvance.lineDS.indexOf(data)+1#			
		</td>			
		<td>
			<input id="cbbAccounts" name="cbbAccounts"
				   data-role="combobox"                   
                   data-value-primitive="true"
                   data-header-template="account-header-tmpl"                  
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: advAccountDS"
                   data-placeholder="Add Account.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td data-bind="visible: showRef">
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>			
		<td data-bind="visible: showSegment">
			<select data-role="multiselect" id="ddlSegment"
				   data-value-primitive="true"				   
				   data-item-template="segment-list-tmpl"				    
				   data-value-field="id" 
				   data-text-field="code"
				   data-bind="value: segments, 
				   			source: segmentItemDS,
				   			events:{ change: segmentChanges }"
				   data-placeholder="Add Segment.."				   
				   style="width: 100%" /></select>					
		</td>
		<td class="right">
			<input id="txtAmount" name="txtAmount" 
					data-role="numerictextbox" 
					data-format="n0"
					data-spinners="false"
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>			
    </tr>   
</script>

<script id="expense" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">					
			    
		    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

		        <h2 span data-bind="text: lang.lang.c_expense"></h2>			    		   

			    <br>				   				
					
				<!-- Upper Part -->
				<div class="row-fluid">
					<div class="span4">
						<div class="box-generic well" style="height: 190px;">				
							<table class="table table-borderless table-condensed cart_total">									
								<tr data-bind="visible: isEdit">				
									<td><span data-bind="text: lang.lang.no_"></span></td>
									<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.date"></span></td>
									<td class="right">
										<input id="issuedDate" name="issuedDate" 
												data-role="datepicker"
												data-format="dd-MM-yyyy"
												data-parse-formats="yyyy-MM-dd" 
												data-bind="value: obj.issued_date, 
															events:{ change : setRate }" 
												required data-required-msg="required"
												style="width:100%;" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.currency"></span></td>
									<td>
										<input id="cbbCurrency" name="cbbCurrency"
											   data-role="combobox"											                    
							                   data-value-primitive="true"
							                   data-template="currency-list-tmpl"
							                   data-text-field="code"
							                   data-value-field="locale"
							                   data-bind="value: obj.locale,
							                              source: currencyDS,
							                              events:{ change: setRate }"
							                   data-placeholder="Type Name.."                    
							                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>								
								<tr>
									<td><span data-bind="text: lang.lang.employee"></span></td>
									<td>
										<input id="cbbContact" name="cbbContact"
											   data-role="combobox"
											   data-auto-bind="false"                   
							                   data-value-primitive="true"
							                   data-header-template="employee-header-tmpl"
							                   data-template="contact-list-tmpl"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS,
							                              events:{ change: contactChanges }"
							                   data-placeholder="Type Name.."                    
							                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>																							
							</table>

							<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.c_amount_paid"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>
						</div>
					</div>					   

					<div class="span8">

						<div class="box-generic-noborder">

						    <!-- Tabs Heading -->
						    <div class="tabsbar tabsbar-2">
						        <ul class="row-fluid row-merge">
						            <li class="span1 glyphicons cogwheels active"><a href="#tab1-3" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons paperclip"><a href="#tab2-3" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons history"><a href="#tab3-3" data-toggle="tab"><i></i></a>
						            </li>								            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						        <!-- Option Tab content -->
						        <div class="tab-pane active" id="tab1-3" >
						        	<table class="table table-borderless table-condensed cart_total">
						        		<tr>
							        		<td colspan="2">
							        			<table>
						            				<tr>
						            					<td>
									            			<input type="radio" value="Direct_Expense" class="k-radio"
									            					name="payOption" id="payOption1"
									            					data-bind="checked: obj.type, 
									            								events:{ change: typeChanges }"> 
									            			<label class="k-radio-label" for="payOption1"><span data-bind="text: lang.lang.c_direct_expense"></span></label>
									            		</td>
									            		<td>
												            <input type="radio" value="Reimbursement" class="k-radio"
												            		name="payOption" id="payOption2"
												            		data-bind="checked: obj.type, 
												            					events:{ change: typeChanges }"> 
												            <label class="k-radio-label" for="payOption2"><span data-bind="text: lang.lang.c_reimbursement"></span></label>
										            	</td>
										            	<td>
												            <input type="radio" value="Advance_Settlement" class="k-radio"
												            		name="payOption" id="payOption3"
												            		data-bind="checked: obj.type, 
												            					events:{ change: typeChanges }"> 
												            <label class="k-radio-label" for="payOption3"><span data-bind="text: lang.lang.c_advance_settlement"></span></label>
										            	</td>
										            </tr>
									            </table>
							        		</td>
						        		</tr>
							        	<tr>
							        		<td><span data-bind="text: lang.lang.cash_account"></span></td>
							        		<td>
							        			<input id="cbbAccount" name="cbbAccount"
													   data-role="combobox"                   
									                   data-value-primitive="true"
									                   data-header-template="account-header-tmpl"                 
									                   data-template="account-list-tmpl"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.account_id,
									                              source: cashAccountDS"
									                   data-placeholder="Select Account.."					                                      
									                   required data-required-msg="required" style="width: 100%" />
							        		</td>
							        	</tr>
							        	<tr data-bind="visible: showCashAdvance">
							        		<td><span data-bind="text: lang.lang.cash_advance"></span></td>
							        		<td>
							        			<input data-role="combobox"                   
									                   data-value-primitive="true"
									                   data-auto-bind="false"                   
									                   data-template="reference-list-tmpl"
									                   data-text-field="number"
									                   data-value-field="id"
									                   data-bind="value: obj.reference_id,
									                              source: referenceDS,
									                              events: { change: referenceChanges }"
									                   data-placeholder="Select Cash Advance.." style="width: 100%" />	
							        		</td>
							        	</tr>
							        	<tr>
											<td><span data-bind="text: lang.lang.segment"></span></td>
											<td>
												<select data-role="multiselect"
													   data-value-primitive="true"
													   data-header-template="segment-header-tmpl"							   
													   data-item-template="segment-list-tmpl"				    
													   data-value-field="id" 
													   data-text-field="code"
													   data-bind="value: obj.segments, 
													   			source: segmentItemDS,
													   			events:{ change: transactionSegmentChanges }"
													   data-placeholder="Add Segment.."				   
													   style="width: 100%" /></select>
											</td>
										</tr>
										<tr>
											<td><span data-bind="text: lang.lang.job"></span></td>
											<td>
												<input id="ddlJob" name="ddlJob"
													   data-role="dropdownlist"
													   data-header-template="job-header-tmpl"
													   data-template="job-list-tmpl"
									                   data-value-primitive="true"		   
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.job_id, 
									                   			source: jobDS"
									                   data-option-label="Select job..." 
									                   style="width: 100%" />										
											</td>
										</tr>
						        	</table>
						        </div>
						        <!-- // Option Tab content END -->						       

						        <!-- Attach Tab content -->
						        <div class="tab-pane" id="tab2-3">

						        	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>					       
						            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

						            <table class="table table-bordered" style="margin-bottom: 0;">
								        <thead>
								            <tr>			                
								                <th data-bind="text: lang.lang.file_name"></th>
								                <th data-bind="text: lang.lang.description"></th>
								                <th data-bind="text: lang.lang.date"></th>
								                <th style="width: 13%;"></th>                			                
								            </tr> 
								        </thead>
								        <tbody data-role="listview" 
								        		data-template="attachment-list-tmpl" 
								        		data-auto-bind="false"
								        		data-bind="source: attachmentDS"></tbody>			        
								    </table>

						        </div>
						        <!-- // Attach Tab content END -->

						        <!-- Recuring Tab content -->
						        <div class="tab-pane" id="tab3-3">							            	
						            
						            <div class="span5">

							        	<input data-role="combobox"
						                   data-placeholder="Select existing recuring ..."
						                   data-value-primitive="true"
						                   data-auto-bind="false"
						                   data-text-field="recurring_name"
						                   data-value-field="id"
						                   data-bind="value: obj.recurring_id,
						                              source: recurringDS,
						                              events:{ change:applyRecurring }"
						                   style="width: 100%" />

						                <br><br>

						                <div align="right">
							                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						                
							            </div>

						            </div>

						            <div class="span7">

							            <table style="width: 100%">
							            	<tr align="right">
							            		<td>
							            			<span data-bind="text: lang.lang.name"></span>
							            		</td>
							            		<td>
							            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
							            					placeholder="Recurring name.." 
							            					style="width: 40%;" />
							            			<span data-bind="text: lang.lang.start"></span>
									                <input data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd"
															data-bind="value: obj.start_date"
															style="width: 40%;" />
							            		</td>
							            	</tr>
							            	<tr align="right">
							            		<td>
								            		<span data-bind="text: lang.lang.every"></span>
								            	</td>
							            		<td>
								            		<input data-role="numerictextbox"
									                   data-format="n0"
									                   data-min="0"								                   
									                   data-bind="value: obj.interval"
									                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.frequency,
										                              source: frequencyList,
										                              events: { change: frequencyChanges }"
										                   style="width: 45%;" />
								            	</td>
							            	</tr>
								            <tr align="right">
								            	<td>
								            		<span data-bind="text: lang.lang.on"></span>
								            	</td>							            	
								            	<td>

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month,
										                   			  visible: showMonth,
										                              source: monthList"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month_option,
										                   			  visible: showMonthOption,
										                              source: monthOptionList,
										                              events: { change: monthOptionChanges }"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.week,
										                   			  visible: showWeek,
										                              source: weekDayList"										                  
										                   style="width: 45%;" />										            
										        
								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.day,
										                   			  visible: showDay,
										                              source: dayList"										                   
										                   style="width: 45%;" />

								            	</td>
								            </tr>
							            </table>

							        </div>									     
						            
						        </div>
						        <!-- // Recuring Tab content END -->								        

						    </div>
						</div>

				    </div>
				</div>							
				
				<!-- Item List -->
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
			                <th style="width: 20%;"><span data-bind="text: lang.lang.account"></span></th>
			                <th data-bind="text: lang.lang.description"></th>
			                <th style="width: 15%;"><span data-bind="text: lang.lang.supplier"></span></th>
			                <th style="width: 8%;"><span data-bind="text: lang.lang.inv_"></span></th>
			                <th style="width: 13%;"><span data-bind="text: lang.lang.date"></span></th>			                			  
			                <th data-bind="visible: showJob" style="width: 10%;">JOB</th>
			                <th data-bind="visible: showSegment" style="width: 10%;"><span data-bind="text: lang.lang.segment"></span></th>	
			                <th style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>
			                <th style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>			                			  
			            </tr> 
			        </thead>
			        <tbody data-role="listview" 
			        		data-template="expense-template" 
			        		data-auto-bind="false"
			        		data-bind="source: lineDS"></tbody>			        
			    </table>			    
								
	            <!-- Bottom part -->
	            <div class="row-fluid">
		
					<!-- Column -->
					<div class="span4 hidden-print">
						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

						<div class="btn-group">
							<div class="leadcontainer">
								
							</div>
							<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
							<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
								<li>
									<input type="checkbox" id="chbJob" class="k-checkbox" data-bind="checked: showJob" />												
									<label class="k-checkbox-label" for="chbJob"><span data-bind="text: lang.lang.job"></span></label>
								</li>
								<li>
									<input type="checkbox" id="chbSegment" class="k-checkbox" data-bind="checked: showSegment" />												
									<label class="k-checkbox-label" for="chbSegment"><span data-bind="text: lang.lang.segment"></span></label>
								</li>								
							</ul>
						</div>

						<br><br>
						<div class="well">
							<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							<br>						
							<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
						</div>
					</div>
					<!-- Column END -->

					<div class="span4">
						<table class="table table-condensed table-striped table-white" data-bind="visible: showCashAdvance">
							<tbody>								
								<tr>
									<td class="right"><span data-bind="text: lang.lang.total_cash_advanced"></span></td>
									<td class="right strong"><span data-bind="text: credit"></span></td>
								</tr>
								<tr>
									<td class="right"><span data-bind="text: lang.lang.amount_due"></span></td>
									<td class="right strong"><span data-bind="text: remain"></span></td>
								</tr>								
							</tbody>
						</table>
					</div>
					
					<!-- Column -->
					<div class="span4">
						<table class="table table-condensed table-striped table-white">
							<tbody>
								<tr>
									<td class="right"><span data-bind="text: lang.lang.sub_total"></span></td>
									<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
								</tr>								
								<tr>
									<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
									<td class="right strong"><span data-bind="text: tax"></span></td>
								</tr>																
								<tr>
									<td class="right"><h4 span data-bind="text: lang.lang.total"></h4></td>
									<td class="right strong"><h4 data-bind="text: total"></h4></td>
								</tr>																
							</tbody>
						</table>
					</div>
					<!-- // Column END -->
					
				</div>
	           
	            <br>
				
				<!-- Form actions -->
				<div class="box-generic bg-action-button">
					<div id="ntf1" data-role="notification"></div>

					<!-- Delete Confirmation -->
					<div data-role="window"
		                 data-title="Delete Confirmation"
		                 data-width="350"
		                 data-height="200"
		                 data-iframe="true"
		                 data-modal="true"
		                 data-visible="false"
		                 data-position="{top:'40%',left:'35%'}"
		                 data-actions="{}"
		                 data-resizable="false"
		                 data-bind="visible: showConfirm"
		                 style="text-align:center;">
		                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
					    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
					    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
		            </div>
		            <!-- // Delete Confirmation -->

					<div class="row">
						<div class="span3">
							<input data-role="dropdownlist"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.transaction_template_id,
				                              source: txnTemplateDS"
				                   data-option-label="Select Template..." />
						</div>
						<div class="span9" align="right">
							<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
							<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
							<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
							<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
						</div>
					</div>
				</div>
				<!-- // Form actions END -->

			</div>							
			</div>
		</div>
	</div>
</script>
<script id="expense-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: remove }"></i>
			#:banhji.expense.lineDS.indexOf(data)+1#			
		</td>			
		<td>
			<input id="cbbAccounts" name="cbbAccounts-#:uid#"
				   data-role="combobox"                   
                   data-value-primitive="true" 
                   data-header-template="account-header-tmpl"                 
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: expenseAccountDS"
                   data-placeholder="Add Account.."                                     
                   required data-required-msg="required" style="width: 100%" />	
		</td>
		<td>
			<input type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input data-role="combobox" id="ddlVendor"                  
                   data-value-primitive="true" 
                   data-header-template="vendor-header-tmpl"                  
                   data-template="contact-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: contact_id,
                              source: supplierDS"
                   data-placeholder="Add Supplier.." style="width: 100%" />	
		</td>
		<td>
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>
		<td>
			<input id="issuedDate" name="issuedDate" 
					data-role="datepicker"
					data-format="dd-MM-yyyy"
					data-parse-formats="yyyy-MM-dd" 
					data-bind="value: reference_date" 
					required data-required-msg="required"
					style="width:100%;" />
		</td>
		<td data-bind="visible: showJob">
			<input id="ddlJob" name="ddlJob"
				   data-option-label="Add Job..." 
				   data-role="dropdownlist"                   
                   data-value-primitive="true"                   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: job_id,
                              source: jobDS"
                   data-placeholder="Add Job.."
                   style="width: 80px;" />	
		</td>							
		<td data-bind="visible: showSegment">
			<select data-role="multiselect" id="ddlSegment"
				   data-value-primitive="true"				   
				   data-item-template="segment-list-tmpl"				    
				   data-value-field="id" 
				   data-text-field="code"
				   data-bind="value: segments, 
				   			source: segmentItemDS,
				   			events:{ change: segmentChanges }"
				   data-placeholder="Add Segment.."				   
				   style="width: 100%" /></select>					
		</td>
		<td class="right">
			<input id="txtAmount-#:uid#" name="txtAmount-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0"
					data-spinners="false"
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>
		<td>
			<input data-role="combobox"   id="ccbTaxItem"                			   
                   data-text-field="name"                   
                   data-value-field="id"
                   data-header-template="tax-header-tmpl"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>			
    </tr>   
</script>





<!-- ***************************
*	Vendor Section            *
**************************** -->
<script id="vendorDashboard" type="text/x-kendo-template">
	<div class="row-fluid">
		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<h2 data-bind="text: lang.lang.supplier"></h2>
			        	<p>
			        		<span data-bind="text: lang.lang.S_inhere"></span>
			        	</p>
			        	<div class="supplier-icon">
					       	<div class="span4">
						       	<a href="#/vendor" class="center">
						       		<img title="Add Suppliers" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/suppliers.ico" />
						       	</a>
						       </div>
						    <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
						       	</a>
						    </div>
						</div>
			        </td>
			 	</tr>
			</table>

			<table class="table table-borderless table-condensed table-vertical-center">
				<tr>
					<td class="center">
						<a href="#/purchase_order">
							<img title="Add Purchase Order" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/purchase_order.png" width="110" height="200" />
							<span data-bind="text: lang.lang.po" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">
						<a href="#/grn">
							<img title="Add Received Note" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/received_note.png" width="110" height="200" />
							<span data-bind="text: lang.lang.goods_received_note" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center" style="width:121px;">
						<a href="#/vendor_deposit">
							<img title="Add Supplier Deposit" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/supplier_deposit.png" width="110" height="200" />
							<span data-bind="text: lang.lang.deposit" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>					
				</tr>
				<tr>
					<td class="center" style="vertical-align: top;">
						<a href="#/purchase">
							<img title="Add Purchase" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/purchase.png" width="110" height="200" />
							<span data-bind="text: lang.lang.purchase" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center" style="vertical-align: top;">
						<a href="#/purchase_return">
							<img title="Add Purchase Return" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/purchase_return.png" width="110" height="200" />
							<span data-bind="text: lang.lang.c_purchase_return" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center" style="vertical-align: top;">						
						<a href="#/cash_payment">
							<img title="Add Cash Payment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_payment.png" width="110" height="200" />
							<span data-bind="text: lang.lang.cash_payment" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>										
				</tr>				
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8">

			<!-- Summary -->
			<div class="row-fluid">
	
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<a href="#/expense_purchase_summary_supplier"><div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons coins"><i></i></span><span data-bind="text: lang.lang.purchase"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert alert-primary">
							
							<div align="center" class="text-large strong" data-bind="text: purchase"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: purchase_supplier"></span>
										<br>
										<span><span data-bind="text: lang.lang.supplier"></span></span>
									</td>
									<td>
										<span data-bind="text: purchase_product"></span>
										<br>
										<span><span data-bind="text: lang.lang.product"></span></span>
									</td>
									<td>
										<span data-bind="text: purchase_order"></span>
										<br>
										<span><span data-bind="text: lang.lang.order"></span></span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div></a>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<a href="#/sale_summary_customer"><div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons cart_in"><i></i></span><span data-bind="text: lang.lang.purchase_order"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/open_purchase_order"><div class="widget-body alert-info">
							
							<div align="center" class="text-large strong" data-bind="text: order"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: order_avg"></span>
										<br>
										<span><span data-bind="text: lang.lang.average"></span></span>
									</td>
									<td>
										<span data-bind="text: order_open"></span>
										<br>
										<span><span data-bind="text: lang.lang.open"></span></span>
									</td>									
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<a href="#/sale_summary_customer"><div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons credit_card"><i></i></span><span data-bind="text: lang.lang.payables"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/suppliers_balance_summary"><div class="widget-body alert-info3" style="background-color: LightGray">
							
							<div align="center" class="text-large strong" data-bind="text: ap"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: ap_open"></span>
										<br>
										<span><span data-bind="text: lang.lang.open"></span></span>
									</td>
									<td>
										<span data-bind="text: ap_customer"></span>
										<br>
										<span><span data-bind="text: lang.lang.supplier"></span></span>
									</td>
									<td>
										<span data-bind="text: ap_overdue"></span>
										<br>
										<span><span data-bind="text: lang.lang.overdue"></span></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">			
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>				                
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_suppliers"></span></th>			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="vendorDashboard-top-vendor-template"
			                 data-bind="source: topContactDS"></tbody>			        
				    </table>			
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_ap_balance"></span></th>
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                  
			                 data-template="vendorDashboard-top-ap-template"
			                 data-bind="source: topAPDS"></tbody>			        
				    </table>
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_purchased_products"></span></th>			                		                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"                
			                 data-template="vendorDashboard-top-product-template"
			                 data-bind="source: topProductDS"></tbody>			        
				    </table>
				</div>		
			</div>

			<!-- Graph -->
			<div class="home-chart">
				<div data-role="chart"
	                 data-legend="{ position: 'top' }"
	                 data-series-defaults="{ type: 'column' }"
	                 data-tooltip='{
	                    visible: true,
	                    format: "{0}%",
	                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
	                 }'                 
	                 data-series="[
	                                 { field: 'sale', name: 'Monthly Purchase', categoryField:'month', color: '#236DA4' },
	                                 { field: 'order', name: 'Monthly Purchase Order', categoryField:'month', color: '#A6C9E3' }
	                             ]"
	                 data-auto-bind="false"	                             
	                 data-bind="source: graphDS"
	                 style="height: 250px;" ></div>            
            </div>
            <!-- End Graph -->

		</div>
	</div>
</script>
<script id="vendorDashboard-top-vendor-template" type="text/x-kendo-tmpl">	
	<tr data-uid="#: uid #">
		<!-- <td style="width: 1%">#:banhji.vendorDashboard.topContactDS.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>		
	</tr>
</script>
<script id="vendorDashboard-top-ap-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.vendorDashboard.topAPDS.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>
	</tr>
</script>
<script id="vendorDashboard-top-product-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.vendorDashboard.topProductDS.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(quantity, "n0")#</span>
		</td>
	</tr>
</script>

<script id="vendorCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Number or Name ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%; margin-bottom: 10px;">								
								<input data-role="dropdownlist"
									   data-value-primitive="true"
					                   data-option-label="Select Type..."
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: contact_type_id,
					                              source: contactTypeDS"
					                   style="width: 100%" />									
							</div>

						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total()"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid"
						 data-bind="source: contactDS"						  
						 data-row-template="vendorCenter-vendor-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons text_bigger active"><span data-toggle="tab" data-target="#tab1-4"><i></i></span>
							            </li>							            							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab2-4"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab3-4"><i></i></span>
							            </li>
							            <li class="glyphicons paperclip"><span data-toggle="tab" data-target="#tab4-4"><i></i></span>
							            </li>
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">							           

							            <!-- TRANSACTIONS Tab content -->
							            <div id="tab1-4" class="tab-pane active box-generic">
							            	<table class="table table-borderless table-condensed cart_total cash-table">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-inverse" data-bind="click: goPO"><span data-bind="text: lang.lang.purchase_order"></span></span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goPurchase"><span data-bind="text: lang.lang.purchase"></span></span>								            											            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goGRN"><span data-bind="text: lang.lang.goods_received_note"></span></span>								            			
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goPurchaseReturn"><span data-bind="text: lang.lang.purchase_return"></span></span>								            			
								            		</td>
								            	</tr>								            	
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goDeposit"><span data-bind="text: lang.lang.deposit"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashPayment"><span data-bind="text: lang.lang.cash_payment"></span></span>								            			
								            		</td>
								            	</tr>								            	
							            	</table>
							            </div>
							            <!-- // TRANSACTIONS Tab content END -->							            						            

							            <!-- INFO Tab content -->
							            <div id="tab2-4" class="tab-pane box-generic">
							            	<div class="row-fluid">
							            		<div class="accounCetner-textedit">
									            	<table width="100%">
														<tr>
															<td width="40%"><span data-bind="text: lang.lang.supplier_type"></span></td>
															<td width="60%">
																<span class="strong" data-bind="text: obj.contact_type"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.number"></span></td>
															<td>
																<span class="strong" data-bind="text: obj.abbr"></span>
																<span class="strong" data-bind="text: obj.number"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.name"></span></td>
															<td>
																<span data-bind="text: obj.name"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.billde_address"></span></td>
															<td>
																<span data-bind="text: obj.address"></span>
															</td>
														</tr>								
														<tr>
															<td><span data-bind="text: lang.lang.phone"></span></td>
															<td>
																<span data-bind="text: obj.phone"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.currency"></span></td>
															<td>										
																<span data-bind="text: currencyCode"></span>
															</td>
														</tr>
													</table>

													<span class="btn btn-primary btn-icon glyphicons edit pull-right" data-bind="click: goEdit"><i></i><span data-bind="text: lang.lang.view_all_info_edit"></span></span>
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab3-4" class="tab-pane box-generic">

										    <div>
												<input type="text" class="k-textbox" 
														data-bind="value: note, events:{change:saveNoteEnter}" 
														placeholder="Add memo ..." 
														style="width: 350px;" />
												<span class="btn btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.add"></span></span>
											</div>

											<br>

									    	<div class="table table-condensed" style="height: 100;"						 
												 data-role="grid"
												 data-auto-bind="false"						 
												 data-bind="source: noteDS"
												 data-row-template="vendorCenter-note-tmpl"
												 data-columns="[{title: ''}]"
												 data-height="100"						 
												 data-scrollable="{virtual: true}"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- Attach Tab content -->
								        <div id="tab4-4" class="tab-pane">							            	
								            <p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>
								            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

								            <table class="table table-bordered">
										        <thead>
										            <tr>			                
										                <th><span data-bind="text: lang.lang.file_name"></span></th>
										                <th><span data-bind="text: lang.lang.description"></span></th>
										                <th><span data-bind="text: lang.lang.date"></span></th>
										                <th style="width: 13%;"></th>                			                
										            </tr> 
										        </thead>
										        <tbody data-role="listview" 
										        		data-template="attachment-list-tmpl" 
										        		data-auto-bind="false"
										        		data-bind="source: attachmentDS"></tbody>			        
										    </table>

										    <span class="btn btn-icon btn-success glyphicons ok_2" data-bind="click: uploadFile" style="color: #fff; padding: 5px 38px; text-align: left; width: 98px !important; display: inline-block; margin-top: 10px;"><i></i><span data-bind="text: lang.lang.save"></span></span>

								        </div>
								        <!-- // Attach Tab content END -->								            								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6" style="margin-bottom:10px;">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.balance"></span><span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadPO">
										<span class="glyphicons truck"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.po"></span><span data-bind="text: po" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: openInvoice"></span><span data-bind="text: lang.lang.open"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span><span data-bind="text: lang.lang.overdue"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >

					  	<button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type"></span></th>								
								<th><span data-bind="text: lang.lang.reference_no"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
								<th><span data-bind="text: lang.lang.status"></span></th>
								<th><span data-bind="text: lang.lang.action"></span></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="vendorCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="vendorCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>		
			#if(type=="Cash_Purchase" || type=="Credit_Purchase"){#
				<a href="\#/purchase/#=id#">#=number#</a>
			#}else if(type=="Vendor_Deposit" && amount<0){#
				<a href="\#/purchase/#=reference.length>0?reference[0].id:0#">#=number#</a>						
			#}else{#
				<a href="\#/#=type.toLowerCase()#/#=id#">#=number#</a>
			#}#
        </td>
    	<td class="right">
    		#if(type=="GRN"){#
    			#=kendo.toString(amount, "n0")#
    		#}else{#
    			#=kendo.toString(amount-deposit, locale=="km-KH"?"c0":"c", locale)#
    		#}#
    	</td>
    	<td align="center">        	
        	#if(type==="Credit_Purchase"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#
        	#}else if(type==="Purchase_Order"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="GRN"){#
        		Received 	
        	#}#			
		</td>    	
    	<!-- Actions -->
    	<td align="center">
    		#if(type==="Credit_Purchase"){#
    			#if(status==="0" || status==="2") {#
        			<a data-bind="click: payBill"><i></i> Pay Bill</a>
        		#}#	
        	#}#
		</td>     	
    </tr>
</script>
<script id="vendorCenter-vendor-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body strong">				
				<span>#=abbr##=number#</span>
				<span>#=name#</span>
			</div>
		</td>
	</tr>
</script>
<script id="vendorCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="vendor" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.supplier"></h2>			    		   

				    <br>

				    <!-- Top Part -->
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row">
								<div class="span6">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlContactType"><span data-bind="text: lang.lang.supplier_type"></span><span style="color:red">*</span></label>
										<input id="ddlContactType" name="ddlContactType"
												   data-role="dropdownlist"
												   data-header-template="vendor-type-header-tmpl"       
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_type_id,
								                   			  disabled: obj.is_pattern,
								                              source: contactTypeDS,
								                              events:{change: typeChanges}"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />																				            
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6" style="padding-right: 0;">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtAbbr"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>										
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" required data-required-msg="required"
					              				style="width: 55px;" />
					              		-
					              		<input id="txtNumber" name="txtNumber" class="k-textbox"					              			   					                   
							                   data-bind="value: obj.number, 
							                   			  disabled: obj.is_pattern, 
							                   			  events:{change: checkExistingNumber}"
							                   placeholder="eg. 001" required data-required-msg="required"
							                   style="width: 143px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->											
								</div>
							</div>
							
							<div class="row">
								<div class="span12">	
									<!-- Group -->
									<div class="control-group">								
										<label for="fullname"><span data-bind="text: lang.lang.full_name"></span><span style="color:red">*</span></label>
							            <input id="fullname" name="fullname" class="k-textbox" 
							            		data-bind="value: obj.name, 
							            					disabled: obj.is_pattern,
							            					attr: { placeholder: phFullname }" 
							              		required data-required-msg="required"
							              		style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>
							</div>

							<div class="row">
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="customerStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="customerStatus" name="customerStatus" 
							              				data-role="dropdownlist"
									            		data-text-field="name"
						           						data-value-field="id"
						           						data-value-primitive="true" 
									            		data-bind="source: statusList, value: obj.status"
									            		data-option-label="(--- Select ---)"
									            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="registeredDate"><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></label>
							            <input id="registeredDate" name="registeredDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.registered_date, disabled: obj.is_pattern" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>
							</div>																					
						</div>
						<div class="span6">
							<div class="row-fluid">	
								<!-- Map -->
								<div id="map" class="span12" style="height: 130px;"></div>
							</div>

							<div class="separator line bottom"></div>

							<div class="row-fluid">	
								<div class="span6">									
									<!-- Group -->
									<div class="control-group">
						    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
										<div class="input-prepend">
											<span class="add-on glyphicons direction"><i></i></span>
											<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
										</div>
									</div>									
									<!-- // Group END -->
								</div>	
								
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">
						    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
						    			<div class="input-prepend">
											<span class="add-on glyphicons google_maps"><i></i></span>
											<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
										</div>										
									</div>
									<!-- // Group END -->
								</div>										
							</div>
						</div>
					</div>								
							
					<!-- // Bottom Part -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">
						        	<li class="span2 glyphicons nameplate_alt active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.info"></span></a>
						            </li>						            
						            <li class="span2 glyphicons usd">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.account"></span></a>
						            </li>
						            <li class="span2 glyphicons credit_card">
						            	<a href="#tab3" data-toggle="tab"><i></i><span data-bind="text: lang.lang.payment"></span></a>
						            </li>
						            <li class="span2 glyphicons parents">
						            	<a href="#tab4" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.agents"></span></a>
						            </li>						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						    	<!-- //GENERAL INFO -->
						        <div class="tab-pane active" id="tab1">
					            	<table class="table table-borderless table-condensed cart_total">					            		
							            <tr>
							                <td><span data-bind="text: lang.lang.vat_no"></span></td>
							              	<td>
					            				<input class="k-textbox" data-bind="value: obj.vat_no" 
													placeholder="e.g. 01234567897" style="width: 100%;" />									
							              	</td>							              	
							            	<td><span data-bind="text: lang.lang.phone"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" style="width: 100%;" /></td>
							            </tr>
							            <tr>
							            	<td><span data-bind="text: lang.lang.country"></span></td>
							              	<td>
							              		<input data-role="dropdownlist"
							              			   data-option-label="(--- Select ---)"									                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.country_id,
									                              source: countryDS" style="width: 100%;" />
							              	</td>							            								              	
							            	<td><span data-bind="text: lang.lang.email"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" style="width: 100%;" />							            	
							            </tr>
							            <tr>
							            	<td><span data-bind="text: lang.lang.city"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.city" placeholder="city name ..." style="width: 100%;" />							              	
							            	<td><span data-bind="text: lang.lang.post_code"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.post_code" placeholder="e.g. 12345" style="width: 100%;" />
							            </tr>							            
							            <tr>
							            	<td><span data-bind="text: lang.lang.address"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." style="width: 100%;" />									            								              	
							            	<td><span data-bind="text: lang.lang.memo"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." style="width: 100%;" /></td>							              	
							            </tr>									            
							            <tr>
							            	<td>
							            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
							            	</td>
							            	<td>
							            		<textarea rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="billed to ..."></textarea>
							            	</td>
							            	<td><span data-bind="text: lang.lang.delivered_to"></span></td>
							            	<td>
							            		<textarea rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="delivered to ..."></textarea>
							            	</td>
							            </tr>							            							            							            								            								            			            
							        </table>
					        	</div>
						        <!-- //GENERAL INFO END -->

						        <!-- //ACCOUNTING -->
						        <div class="tab-pane" id="tab2">
						        	
						        	<div class="row-fluid">

						            	<div class="span3">													
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlAP"><span data-bind="text: lang.lang.account_payable"></span><span style="color:red">*</span></label>
												<input id="ddlAP" name="ddlAP"
													   data-role="dropdownlist"
													   data-header-template="account-header-tmpl"
													   data-template="account-list-tmpl"
													   data-option-label="(--- Select ---)"											                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.account_id,
									                              source: apDS"
									                   required data-required-msg="required"											                              
									                   style="width: 100%;" />									            
											</div>
											<!-- // Group END -->													
										</div>												
										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="ddlTradeDiscountAccount"><span data-bind="text: lang.lang.trade_discount"></span><span style="color:red">*</span></label>
												<input id="ddlTradeDiscountAccount" name="ddlTradeDiscountAccount"
														   data-role="dropdownlist"
														   data-header-template="account-header-tmpl"
														   data-template="account-list-tmpl"
														   data-option-label="(--- Select ---)"												                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.trade_discount_id,
										                              source: tradeDiscountDS"
										                   required data-required-msg="required"											                              
										                   style="width: 100%;" />
										    </div>
											<!-- // Group END -->	
										</div>
										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="ddlSettlementDiscountAccount"><span data-bind="text: lang.lang.settlement_discount"></span><span style="color:red">*</span></label>
												<input id="ddlSettlementDiscountAccount" name="ddlSettlementDiscountAccount"
														   data-role="dropdownlist"
														   data-header-template="account-header-tmpl"
														   data-template="account-list-tmpl"
														   data-option-label="(--- Select ---)"												                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.settlement_discount_id,
										                              source: settlementDiscountDS"
										                   required data-required-msg="required"											                              
										                   style="width: 100%;" />
										    </div>
											<!-- // Group END -->	
										</div>
										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="ddlPrePaymentAccount"><span data-bind="text: lang.lang.prepayment_account"></span><span style="color:red">*</span></label>
												<input id="ddlPrePaymentAccount" name="ddlPrePaymentAccount"
														   data-role="dropdownlist"
														   data-option-label="(--- Select ---)"
														   data-header-template="account-header-tmpl"
														   data-template="account-list-tmpl"												                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.deposit_account_id,
										                              source: prepaidAccountDS"
										                   required data-required-msg="required"											                              
										                   style="width: 100%;" />
										    </div>
											<!-- // Group END -->	
										</div>
																																		
							        </div>								        										        

							        <div class="separator line bottom"></div>

							        <div class="row-fluid">

							        	<div class="span3">						
								            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
								            <input id="currency" name="currency" 
								            	data-role="dropdownlist"
								            	data-template="currency-list-tmpl"
								            	data-value-primitive="true"
								                data-text-field="code"
								                data-value-field="locale"
												data-bind="value: obj.locale, 
															disabled: isProtected,
															source: currencyDS"
												data-option-label="(--- Select ---)" 
												required data-required-msg="required" style="width: 100%;" />
								        </div>

										<div class="span3">
											<!-- Group -->
											<div class="control-group">
												<label for="ddlTax"><span data-bind="text: lang.lang.tax"></span></label>
												<input id="ddlTax" name="ddlTax"
														   data-role="dropdownlist"
														   data-header-template="tax-header-tmpl"
														   data-option-label="(--- Select ---)"																   												                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.tax_item_id,
										                              source: taxItemDS"											                              
										                   style="width: 100%;" />
										    </div>
											<!-- // Group END -->
										</div>

										<!-- Group -->
										<div class="span3">	
									        <div class="control-group">
												<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
									            <input data-role="numerictextbox"
									                   data-format="n"
									                   data-min="0"										                   
									                   data-bind="value: obj.credit_limit"										                  
									                   style="width: 100%;">
											</div>
										</div>												

									</div>
					        	</div>
						        <!-- //ACCOUNTING END -->

						        <!-- //PAYMENT -->
						        <div class="tab-pane" id="tab3">
						        	
					            	<table class="table table-borderless table-condensed cart_total">						            	
					            		<tr>							            			
							                <td><span data-bind="text: lang.lang.payment_method"></span></td>
							              	<td>
							              		<input id="ddlPaymentMethod" name="ddlPaymentMethod"
													data-role="dropdownlist"
													data-header-template="vendor-payment-method-header-tmpl"
									            	data-value-primitive="true"
									                data-text-field="name"
									                data-value-field="id"
													data-bind="value: obj.payment_method_id, source: paymentMethodDS"
													data-option-label="(--- Select ---)" 
													style="width: 100%;" />
							              	</td>
							              	<td><span data-bind="text: lang.lang.payment_term"></span></td>
							              	<td>
							              		<input id="ddlPaymentTerm" name="ddlPaymentTerm"
													data-role="dropdownlist"
													data-header-template="vendor-payment-term-header-tmpl"
									            	data-value-primitive="true"
									                data-text-field="name"
									                data-value-field="id"
													data-bind="value: obj.payment_term_id, source: paymentTermDS" 
													data-option-label="(--- Select ---)"
													style="width: 100%;" />
							              	</td>									            	
							            </tr>
							            <tr>
							                <td><span data-bind="text: lang.lang.bank_name"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.bank_name" placeholder="bank name ..." style="width: 100%;" /></td>							              	
							            	<td><span data-bind="text: lang.lang.account_number"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.bank_account_number" placeholder="account number ..." style="width: 100%;" /></td>
							            </tr>									           							            
							            <tr>
							            	<td><span data-bind="text: lang.lang.account_name"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.bank_account_name" placeholder="account name ..." style="width: 100%;" />							              	
							            	<td><span data-bind="text: lang.lang.bank_address"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.bank_address" placeholder="bank address ..." style="width: 100%;" /></td>
							            </tr>
							            <tr>
							            	<td><span data-bind="text: lang.lang.name_on_check"></span></td>
							            	<td><input class="k-textbox" data-bind="value: obj.name_on_cheque" placeholder="name on check ..." style="width: 100%;" /></td>
							            	<td></td>
							            	<td></td>
							            </tr>									            						            							            								            								            			            
							        </table>
					        	</div>
						        <!-- //PAYMENT END -->						        

						        <!-- //CONTACT PERSON -->
						        <div class="tab-pane" id="tab4">
						        	<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
						        	
						        	<table class="table table-bordered table-white">
								        <thead>
								            <tr>
								                <th><span data-bind="text: lang.lang.name"></span></th>
								                <th><span data-bind="text: lang.lang.department"></span></th>						                
								                <th><span data-bind="text: lang.lang.phone"></span></th>
								                <th><span data-bind="text: lang.lang.email"></span></th>
								                <th width="20px"></th>										               
								            </tr>
								        </thead>
								        <tbody data-role="listview"										        		
								        		data-auto-bind="false"										        						        		 
								        		data-template="vendor-contact-person-row-tmpl" 
								        		data-bind="source: contactPersonDS">
								        </tbody>										        						        
								    </table>
					        	</div>
						        <!-- //CONTACT PERSON END -->

						    </div>
						</div>
					</div>

					<br>											
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> Save New</span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> Delete</span>					

							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="vendor-contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="purchaseOrder" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.c_purchase_order"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span>.</td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.suppliers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="vendor-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_ordered"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i><span data-bind="text: lang.lang.recuring"></span></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span><span data-bind="text: balance"></span>
												</td>										
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span><span data-format="n" data-bind="text: obj.credit_allowed"></span>
												</td>
											</tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.expected_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">											
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"		   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Select job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">
							         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i><span data-bind="text: lang.lang.save_recurring"></span></span>						                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
				                <th data-bind="text: lang.lang.item"></th>
				                <th data-bind="text: lang.lang.description"></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.qty1"></span></th>
				                <th style="width: 13%;"><span data-bind="text: lang.lang.cost1"></span></th>
				                <th style="width: 1%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>
				                <th style="width: 10%;" data-bind="visible: showRequiredDate"><span data-bind="text: lang.lang.tax"></span><span data-bind="text: lang.lang.deliv_date"></span></th>			                
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>			                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="purchaseOrder-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount">
	  									<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>
									<li>
										<input type="checkbox" id="chbRequiredDate" class="k-checkbox" data-bind="checked: showRequiredDate">
      									<label class="k-checkbox-label" for="chbRequiredDate"><span data-bind="text: lang.lang.delivery_date"></span></label>
									</li>															
								</ul>
							</div>
							
							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
						  				 				
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

							<br><br>
							<div class="well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							</div>
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>					
									<tr>
										<td class="right"><h4 data-bind="text: lang.lang.total"></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="purchaseOrder-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.purchaseOrder.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement"
				   data-role="dropdownlist"
				   data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: measurement_id,
                   			  source: measurementDS"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false"
					data-bind="value: cost, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>
		<td class="center" data-bind="visible: showRequiredDate">
			<input data-role="datepicker"
					data-format="dd-MM-yyyy"
					data-parse-formats="yyyy-MM-dd" 
					data-bind="value: required_date"
					style="width:100%;" />
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
				   data-role="combobox"
				   data-header-template="tax-header-tmpl"			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>				
    </tr>   
</script>
<script id="grn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">					
			    
		    	<span class="glyphicons no-js remove_2 pull-right" 
    				onclick="javascript:window.history.back()"
					data-bind="click: cancel"><i></i></span>

		        <h2 data-bind="text: lang.lang.goods_received_note"></h2>			    		   

			    <br>				   				
					
				<!-- Upper Part -->
				<div class="row-fluid">
					<div class="span4">
						<div class="box-generic well" style="height: 190px;">				
							<table class="table table-borderless table-condensed cart_total">									
								<tr data-bind="visible: isEdit">				
									<td><span data-bind="text: lang.lang.no_"></span>.</td>
									<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.date"></span></td>
									<td class="right">
										<input id="issuedDate" name="issuedDate" 
												data-role="datepicker"
												data-format="dd-MM-yyyy"
												data-parse-formats="yyyy-MM-dd" 
												data-bind="value: obj.issued_date, 
															events:{ change : setRate }" 
												required data-required-msg="required"
												style="width:100%;" />
									</td>
								</tr>								
								<tr>
									<td><span data-bind="text: lang.lang.supplier"></span></td>
									<td>
										<input id="cbbContact" name="cbbContact"
											   data-role="combobox"											                    
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-header-template="vendor-header-tmpl"
							                   data-template="contact-list-tmpl"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS,
							                              events:{ change: contactChanges }"
							                   data-placeholder="Type Name.."                    
							                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>																															
							</table>

							<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
								data-bind="style: { backgroundColor: amtDueColor}">
								<div align="left"><span data-bind="text: lang.lang.total_quantity"></span></div>
								<h2 data-bind="text: total" align="right"></h2>
							</div>							

						</div>						
					</div>					   

					<div class="span8">

						<div class="box-generic-noborder">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons pen"><a href="#tab2-4" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab3-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab4-4" data-toggle="tab"><i></i></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-4">						            
							            <table class="table table-borderless table-condensed cart_total">											
								            <tr>
								            	<td><span data-bind="text: lang.lang.expected_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>							           
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	            						            		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}" 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Memo Tab content -->
							        <div class="tab-pane" id="tab2-4">
							        	<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
										<br>						
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab3-4">
							         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab4-4">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i><span data-bind="text: lang.lang.save_recurring"></span></span>						                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

				    </div>
				</div>

				<!-- Item List -->
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
			                <th><span data-bind="text: lang.lang.items"></span></th>
			                <th><span data-bind="text: lang.lang.description"></span></th>
			                <th style="width: 20%;"><span data-bind="text: lang.lang.quantity"></span></th>			                			                			                			                
			            </tr> 
			        </thead>
			        <tbody data-role="listview" 
			        		data-template="grn-template" 
			        		data-auto-bind="false"
			        		data-bind="source: lineDS"></tbody>			        
			    </table>			    
								
	            <!-- Bottom part -->
	            <div class="row-fluid">
		
					<!-- Column -->
					<div class="span4">	
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>									
						
						<!-- Add New Item -->
						<ul class="topnav addNew">
							<li role="presentation" class="dropdown ">
						  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
						  			<span data-bind="text: lang.lang.add_new_item"></span>
			    					<span class="caret"></span>
						  		</a>
					  			<ul class="dropdown-menu addNewItem">  				  				
					  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
					  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
					  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
					  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
					  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
					  				 				
					  			</ul>
						  	</li>				
						</ul>
						<!--End Add New Item -->

					</div>
					<!-- Column END -->

					<!-- Column -->
					<div class="span4" align="center">
						<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />
					</div>
					<!-- Column END -->
					
					<!-- Column -->
					<div class="span4">
						<table class="table table-condensed table-striped table-white">
							<tbody>																								
								<tr>
									<td class="right"><h4><span data-bind="text: lang.lang.total"></span></h4></td>
									<td class="right strong"><h4 data-format="n0" data-bind="text: obj.amount"></h4></td>
								</tr>								
							</tbody>
						</table>
					</div>
					<!-- // Column END -->
					
				</div>	           
				
				<!-- Form actions -->
				<div class="box-generic bg-action-button">
					<div id="ntf1" data-role="notification"></div>

					<!-- Delete Confirmation -->
					<div data-role="window"
		                 data-title="Delete Confirmation"
		                 data-width="350"
		                 data-height="200"
		                 data-iframe="true"
		                 data-modal="true"
		                 data-visible="false"
		                 data-position="{top:'40%',left:'35%'}"
		                 data-actions="{}"
		                 data-resizable="false"
		                 data-bind="visible: showConfirm"
		                 style="text-align:center;">
		                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
					    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
					    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no_"></span></button>
		            </div>
		            <!-- // Delete Confirmation -->

					<div class="row">
						<div class="span3">
							<input data-role="dropdownlist"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.transaction_template_id,
				                              source: txnTemplateDS"
				                   data-option-label="Select Template..." />
						</div>
						<div class="span9" align="right">
							<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_new"></span></span>
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
							<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
							<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.delete"></span></span>					
						</div>
					</div>
				</div>
				<!-- // Form actions END -->

			</div>							
			</div>
		</div>
	</div>
</script>
<script id="grn-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.grn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement"
					data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"            
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: measurement_id,
                   			  source: measurementDS"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>						
    </tr>   
</script>
<script id="vendorDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">					
			    
		    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

		        <h2 data-bind="text: lang.lang.vendor_deposit"></h2>			    		   

			    <br>				   				
					
				<!-- Upper Part -->
				<div class="row-fluid">
					<div class="span4">
						<div class="box-generic well" style="height: 150px;">				
							<table class="table table-borderless table-condensed cart_total">									
								<tr data-bind="visible: isEdit">				
									<td><span data-bind="text: lang.lang.no_"></span></td>
									<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.date"></span></td>
									<td class="right">
										<input id="issuedDate" name="issuedDate" 
												data-role="datepicker"
												data-format="dd-MM-yyyy"
												data-parse-formats="yyyy-MM-dd" 
												data-bind="value: obj.issued_date, 
															events:{ change : setRate }" 
												required data-required-msg="required"
												style="width:100%;" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.suppliers"></span></td>
									<td>
										<input id="cbbContact" name="cbbContact"
											   data-role="combobox"											                    
							                   data-value-primitive="true"
							                   data-header-template="vendor-header-tmpl"
							                   data-template="contact-list-tmpl"
							                   data-auto-bind="false"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS,
							                              events:{ change: contactChanges }"
							                   data-placeholder="Type Name.."                    
							                   required data-required-msg="required" style="width: 100%" />
									</td>
								</tr>													
							</table>

							<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
								data-bind="style: {backgroundColor: amtDueColor}">
								<div align="left"><span data-bind="text: lang.lang.amount_deposited"></span></div>
								<h2 data-bind="text: total" align="right"></h2>
							</div>

						</div>
					</div>					   

					<div class="span8">

						<div class="box-generic-noborder">

						    <!-- Tabs Heading -->
						    <div class="tabsbar tabsbar-2">
						        <ul class="row-fluid row-merge">
						        	<li class="span1 glyphicons cogwheels active" ><a href="#tab1-4" data-toggle="tab" ><i></i></a>
						            </li>
						            <li class="span1 glyphicons pencil"><a href="#tab2-4" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span1 glyphicons paperclip"><a href="#tab3-4" data-toggle="tab"><i></i></a>
						            </li>
						            <li class="span2 glyphicons history"><a href="#tab4-4" data-toggle="tab"><i></i><span data-bind="text: lang.lang.recurring"></span></a>
						            </li>								            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						    	<!-- Option Tab content -->
						    	<div class="tab-pane active" id="tab1-4">
							       	<table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">						
										<tr>
											<td style="width: 15%"><span data-bind="text: lang.lang.deposit_to"></span></td>
											<td style="width: 40%">
												<input id="cbbAccount" name="cbbAccount"
													   data-role="combobox"                   
									                   data-value-primitive="true"
									                   data-header-template="account-header-tmpl"                
									                   data-template="account-list-tmpl"
									                   data-text-field="name"								                  
									                   data-value-field="id"
									                   data-bind="value: obj.account_id,
									                   			  source: depositAccountDS"
									                   data-placeholder="Add Account.."					                                      
									                   required data-required-msg="required" style="width: 100%" />
											</td>
										</tr>
										<tr>
											<td style="width: 10%"><span data-bind="text: lang.lang.segment"></span></td>
											<td style="width: 40%">
												<select data-role="multiselect"
											   data-value-primitive="true"
											   data-header-template="segment-header-tmpl"							   
											   data-item-template="segment-list-tmpl"				    
											   data-value-field="id" 
											   data-text-field="code"
											   data-bind="value: obj.segments, 
											   			source: segmentItemDS,
											   			events:{ change: segmentChanges }"
											   data-placeholder="Add Segment.."				   
											   style="width: 100%" /></select>
											</td>														
										</tr>
										<tr>							            				
											<td>
							            		<span data-bind="text: lang.lang.reference"></span>	            						            		
							            	</td>
							            	<td>
												<input data-role="combobox"
														data-template="reference-list-tmpl"
														data-auto-bind="false"
							              				data-value-primitive="true"
														data-text-field="number" 
							              				data-value-field="id"	 
							              				data-bind="value: obj.reference_id,
							              							enabled: enableRef,
							              							source: referenceDS,						              							
							              							events:{change: referenceChanges}" 
							              				placeholder="Select Reference..." style="width: 100%" />
											</td>
										</tr>									
									</table>
						   		</div>
						   		<!-- Option Tab content END -->

						        <!-- Memo Tab content -->
						        <div class="tab-pane" id="tab2-4">
						        	<textarea id="memo2" cols="0" rows="4" class="k-textbox" 
						        		data-bind="value: obj.memo2" style="width:100%;" 
						        		placeholder="Please enter transaction purpose here ..."></textarea>
						        </div>
						        <!-- // Memo Tab content END -->

						        <!-- Attach Tab content -->
						        <div class="tab-pane" id="tab3-4">
						        	 <p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>						            	
						            
						            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

						            <table class="table table-bordered">
								        <thead>
								            <tr>			                
								                <th><span data-bind="text: lang.lang.file_name"></span></th>
								                <th><span data-bind="text: lang.lang.description"></span></th>
								                <th><span data-bind="text: lang.lang.date"></span></th>
								                <th style="width: 13%;"></th>                			                
								            </tr> 
								        </thead>
								        <tbody data-role="listview" 
								        		data-template="attachment-list-tmpl" 
								        		data-auto-bind="false"
								        		data-bind="source: attachmentDS"></tbody>			        
								    </table>

						        </div>
						        <!-- // Attach Tab content END -->

						        <!-- Recuring Tab content -->
						        <div class="tab-pane" id="tab4-4">							            	
						            
						            <div class="span5">

							        	<input data-role="combobox"
						                   data-placeholder="Select existing recuring ..."
						                   data-value-primitive="true"
						                   data-auto-bind="false"
						                   data-text-field="recurring_name"
						                   data-value-field="id"
						                   data-bind="value: obj.recurring_id,
						                              source: recurringDS,
						                              events:{ change:applyRecurring }"
						                   style="width: 100%" />

						                <br><br>

						                <div align="right">
							                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i><span data-bind="text: lang.lang.save_recurring"></span></span>						                
							            </div>

						            </div>

						            <div class="span7">

							            <table style="width: 100%">
							            	<tr align="right">
							            		<td>
							            			<span data-bind="text: lang.lang.name"></span>
							            		</td>
							            		<td>
							            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
							            					placeholder="Recurring name.." 
							            					style="width: 40%;" />
							            			<span data-bind="text: lang.lang.start"></span>
									                <input data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd"
															data-bind="value: obj.start_date"
															style="width: 40%;" />
							            		</td>
							            	</tr>
							            	<tr align="right">
							            		<td>
								            		<span data-bind="text: lang.lang.every"></span>
								            	</td>
							            		<td>
								            		<input data-role="numerictextbox"
									                   data-format="n0"
									                   data-min="0"								                   
									                   data-bind="value: obj.interval"
									                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.frequency,
										                              source: frequencyList,
										                              events: { change: frequencyChanges }"
										                   style="width: 45%;" />
								            	</td>
							            	</tr>
								            <tr align="right">
								            	<td>
								            		<span data-bind="text: lang.lang.on"></span>
								            	</td>							            	
								            	<td>

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month,
										                   			  visible: showMonth,
										                              source: monthList"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.month_option,
										                   			  visible: showMonthOption,
										                              source: monthOptionList,
										                              events: { change: monthOptionChanges }"										                   
										                   style="width: 45%;" />

								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.week,
										                   			  visible: showWeek,
										                              source: weekDayList"										                  
										                   style="width: 45%;" />										            
										        
								            		<input data-role="dropdownlist"									                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.day,
										                   			  visible: showDay,
										                              source: dayList"										                   
										                   style="width: 45%;" />

								            	</td>
								            </tr>
							            </table>

							        </div>									     
						            
						        </div>
						        <!-- // Recuring Tab content END -->								        

						    </div>
						</div>

				    </div>
				</div>								
				<!-- Item List -->
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			               
			                <th style="width: 30%;"><span data-bind="text: lang.lang.account"></span></th>
			                <th><span data-bind="text: lang.lang.description"></span></th>
			                <th style="width: 10%;"><span data-bind="text: lang.lang.ref"></span></th>			                
			                <th style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>			                			                
			            </tr> 
			        </thead>
			        <tbody data-role="listview" 
			        		data-template="vendorDeposit-template" 
			        		data-auto-bind="false"
			        		data-bind="source: lineDS"></tbody>			        
			    </table>			    
								
	            <!-- Bottom part -->
	            <div class="row-fluid">
		
					<!-- Column -->
					<div class="span6 hidden-print">
						
						<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>	
						
						<!-- Add New Item -->
						<ul class="topnav addNew">
							<li role="presentation" class="dropdown ">
						  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
						  			<span data-bind="text: lang.lang.add_new_item"></span>
			    					<span class="caret"></span>
						  		</a>
					  			<ul class="dropdown-menu addNewItem">  				  				
					  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
					  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
					  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
					  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
					  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
					  				 				
					  			</ul>
						  	</li>				
						</ul>
						<!--End Add New Item -->
						 

					</div>
					<!-- Column END -->
					
					<!-- Column -->
					<div class="span6">
						<table class="table table-borderless table-condensed cart_total">
							<tbody>								
								<tr>
									<td class="right"><span data-bind="text: lang.lang.total"></span></td>
									<td class="right strong"><span data-bind="text: total"></span></td>
								</tr>								
							</tbody>
						</table>
					</div>
					<!-- // Column END -->
					
				</div>
	           
	            <br>
				
				<!-- Form actions -->
				<div class="box-generic bg-action-button">
					<div id="ntf1" data-role="notification"></div>

					<!-- Delete Confirmation -->
					<div data-role="window"
		                 data-title="Delete Confirmation"
		                 data-width="350"
		                 data-height="200"
		                 data-iframe="true"
		                 data-modal="true"
		                 data-visible="false"
		                 data-position="{top:'40%',left:'35%'}"
		                 data-actions="{}"
		                 data-resizable="false"
		                 data-bind="visible: showConfirm"
		                 style="text-align:center;">
		                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
					    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
					    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
		            </div>
		            <!-- // Delete Confirmation -->

					<div class="row">
						<div class="span3">
							<input data-role="dropdownlist"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.transaction_template_id,
				                              source: txnTemplateDS"
				                   data-option-label="Select Template..." />
						</div>
						<div class="span9" align="right">
							<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save"></span><span data-bind="text: lang.lang.new"></span></span>
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
							<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
							<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.delete"></span></span>					
						</div>
					</div>
				</div>
				<!-- // Form actions END -->								

			</div>							
			</div>
		</div>
	</div>
</script>
<script id="vendorDeposit-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: remove }"></i>
			#:banhji.vendorDeposit.lineDS.indexOf(data)+1#			
		</td>				
		<td>
			<input id="cbbAccounts" name="cbbAccounts"
				   data-role="combobox"                   
                   data-value-primitive="true"
                   data-header-template="account-header-tmpl"                  
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: accountDS"
                   data-placeholder="Add Account.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>		
		<td class="right">
			<input id="txtAmount" name="txtAmount" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false"
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>			
    </tr>   
</script>
<script id="purchase" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.purchase"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.supplier"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="vendor-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_purchased"></span></div>
									<h2 data-bind="text: amount_due" align="right"></h2>
								</div>
							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab2-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab3-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table class="table table-borderless table-condensed cart_total">
							            	<tr>
							            		<td style="width: 40%">
							            			<table>
							            				<tr>
							            					<td>
										            			<input type="radio" value="Cash_Purchase" class="k-radio"
										            					name="payOption" id="payOption1"
										            					data-bind="checked: obj.type, 
										            								events:{ change: typeChanges }"> 
										            			<label class="k-radio-label" for="payOption1"><span data-bind="text: lang.lang.cash"></span></label>
										            		</td>
										            		<td>
													            <input type="radio" value="Credit_Purchase" class="k-radio"
													            		name="payOption" id="payOption2"
													            		data-bind="checked: obj.type, 
													            					events:{ change: typeChanges }"> 
													            <label class="k-radio-label" for="payOption2"><span data-bind="text: lang.lang.credit"></span></label>
											            	</td>
											            </tr>
										            </table>
							            		</td>
							            		<td style="width: 60%" data-bind="invisible: isCash">
							            			<span data-bind="text: lang.lang.due_date"></span>						            			
								            		<input id="txtDueDate" name="txtDueDate" class="pull-right"
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" />
							            		</td>						            		
							            	</tr>							            
											<tr>
								            	<td>
								            		<span data-bind="text: lang.lang.bill_no"></span>
								            		<input class="k-textbox pull-right" data-bind="value: obj.reference_no" style="width: 170px;" />
								            	</td>
								            	<td>
								            		<span data-bind="text: lang.lang.bill_date"></span>
								            		<input id="txtBillDate" name="txtBillDate" class="pull-right" 
								            				data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.bill_date" />							            		
								            	</td>
								            </tr>
											<tr>
								            	<td><span data-bind="text: lang.lang.account"></span></td>				
												<td>
													<input id="ddlAccount" name="ddlAccount" 
															data-role="dropdownlist"
															data-auto-bind="false"														
								              				data-value-primitive="true"
								              				data-header-template="account-header-tmpl"
								              				data-template="account-list-tmpl"
															data-text-field="name" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.account_id,
								              							source: accountDS"
								              				data-option-label="Select Account..."
								              				required data-required-msg="required" 
								              				style="width: 100%" />
												</td>
											</tr>																				
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	            						            		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}"
								              				placeholder="Select Reference..." 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	
										<table class="table table-borderless table-condensed cart_total">
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"							   
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"									                   				   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>
											<tr data-bind="invisible: isCash">
								            	<td><span data-bind="text: lang.lang.payment_term"></span></td>				
												<td>
													<input data-role="dropdownlist"														
								              				data-value-primitive="true"
															data-text-field="name" 
								              				data-value-field="id"
								              				data-header-template="vendor-payment-term-header-tmpl"					              				 
								              				data-bind="value: obj.payment_term_id,
								              							source: paymentTermDS"
								              				data-option-label="Select Term..." 
								              				style="width: 100%" />
												</td>
											</tr>
											<tr data-bind="visible: isCash">
								            	<td><span data-bind="text: lang.lang.payment_method"></span></td>				
												<td>
													<input data-role="dropdownlist"														
								              				data-value-primitive="true"
															data-text-field="name" 
								              				data-value-field="id"
								              				data-header-template="vendor-payment-method-header-tmpl"						              				 
								              				data-bind="value: obj.payment_method_id,
								              							source: paymentMethodDS"
								              				data-option-label="Select Method..." 
								              				style="width: 100%" />
												</td>
											</tr>							            
								            <tr data-bind="visible: isCash">
								            	<td><span data-bind="text: lang.lang.check_no"></span></td>				
												<td>
													<input class="k-textbox" data-bind="value: obj.check_no" style="width: 100%" />
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->						        

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">

							        	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i><span data-bind="text: lang.lang.save_recurring"></span></span>						                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Middle Part -->
					<div class="box-generic">

					    <!-- Tabs Heading -->
					    <div class="tabsbar tabsbar-2">
					        <ul class="row-fluid row-merge">
					        	<li class="span6 glyphicons cargo active"><a href="#tab1-2" data-toggle="tab"><i></i><span data-bind="text: lang.lang.items_expense"></span></a>
					            </li>
					            <li class="span6 glyphicons circle_plus"><a href="#tab2-2" data-toggle="tab"><i></i><span data-bind="text: lang.lang.additional_costs"></span></a>
					            </li>				            					            								            
					        </ul>
					    </div>
					    <!-- // Tabs Heading END -->

					    <div class="tab-content">

					    	<!-- Item Tab content -->
					        <div class="tab-pane active" id="tab1-2">						            
					        	<!-- Item List -->
								<table class="table table-bordered table-primary table-striped table-vertical-center">
							        <thead>
							            <tr>
							                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
							                <th><span data-bind="text: lang.lang.items"></span></th>
							                <th><span data-bind="text: lang.lang.description"></span></th>
							                <th style="width: 20%;"><span data-bind="text: lang.lang.quantity"></span></th>
							                <th style="width: 10%;"><span data-bind="text: lang.lang.cost"></span></th>
							                <th style="width: 1%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>			                
							                <th class="center" style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>
							                <th class="center" style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>
							                <th class="center" style="width: 1%;" data-bind="visible: showAdditionalCost">+Cost</th>			                			                			                
							            </tr> 
							        </thead>
							        <tbody data-role="listview" 
							        		data-template="purchase-item-line-template" 
							        		data-auto-bind="false"
							        		data-bind="source: lineDS"></tbody>			        
							    </table>

							    <!-- Item Add Row part -->
					            <div class="row">		
															
									<div class="span12">
										<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

										<div class="btn-group">
											<div class="leadcontainer">
												
											</div>
											<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
											<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
												<li>
													<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount" />												
													<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
												</li>
												<li>
													<input type="checkbox" id="chbAdditionalCost" class="k-checkbox" data-bind="checked: showAdditionalCost" />												
													<label class="k-checkbox-label" for="chbAdditionalCost"><span data-bind="text: lang.lang.additional_costs"></span></label>
												</li>																									
											</ul>
										</div>

										<!-- Add New Item -->
										<ul class="topnav addNew">
											<li role="presentation" class="dropdown ">
										  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
										  			<span data-bind="text: lang.lang.add_new_item"></span>
							    					<span class="caret"></span>
										  		</a>
									  			<ul class="dropdown-menu addNewItem">  				  				
									  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
									  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
									  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
									  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
									  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
									  				 				
									  			</ul>
										  	</li>				
										</ul>
										<!--End Add New Item -->

									</div>										
									
								</div>

								<br>

							    <!-- Account List -->				
								<table class="table table-bordered table-primary table-striped table-vertical-center">
							        <thead>
							            <tr>
							                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
							                <th style="width: 20%;"><span data-bind="text: lang.lang.account"></span></th>
							                <th><span data-bind="text: lang.lang.description"></span></th>
							                <th data-bind="visible: showRef" style="width: 7%;"><span data-bind="text: lang.lang.ref"></span></th>			                
							                <th data-bind="visible: showSegment" style="width: 15%;"><span data-bind="text: lang.lang.segment"></span></th>
							                <th class="center" style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>
							                <th class="center" style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>			                			                
							            </tr> 
							        </thead>
							        <tbody data-role="listview" 
							        		data-template="purchase-account-line-template" 
							        		data-auto-bind="false"
							        		data-bind="source: accountLineDS"></tbody>			        
							    </table>
							    <!-- Add Row Account -->
							    <div>
									<button class="btn btn-inverse" data-bind="click: addRowAccount"><i class="icon-plus icon-white"></i></button>												

									<div class="btn-group">
										<div class="leadcontainer">
											
										</div>
										<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
										<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
											<li>											
												<input type="checkbox" id="chbReference" class="k-checkbox" data-bind="checked: showRef" />												
												<label class="k-checkbox-label" for="chbReference"><span data-bind="text: lang.lang.reference"></span></label>
											</li>
											<li>											
												<input type="checkbox" id="chbSegment" class="k-checkbox" data-bind="checked: showSegment" />												
												<label class="k-checkbox-label" for="chbSegment"><span data-bind="text: lang.lang.segment"></span></label>
											</li>															
										</ul>
									</div>

									<!-- Add New Item -->
									<ul class="topnav addNew">
										<li role="presentation" class="dropdown ">
									  		<a href="#/account" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
									  			<span data-bind="text: lang.lang.add_account"></span>
						    					<!-- <span class="caret"></span> -->
									  		</a>
								  			<!-- <ul class="dropdown-menu addNewItem">  				  				
								  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
								  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
								  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
								  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
								  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
								  				 				
								  			</ul> -->
									  	</li>				
									</ul>
									<!--End Add New Item -->
																
								</div>

					        </div>
					        <!-- // Item Tab content END -->

					        <!-- Additional Cost Tab content -->
					        <div class="tab-pane" id="tab2-2">				        	
								<table class="table table-bordered table-primary table-striped table-vertical-center">
							        <thead>
							            <tr>
							                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
							                <th><span data-bind="text: lang.lang.type"></span></th>
							                <th><span data-bind="text: lang.lang.account"></span></th>
							                <th><span data-bind="text: lang.lang.supplier"></span></th>
							                <th data-bind="text: lang.lang.inv_"></th>
							                <th><span data-bind="text: lang.lang.date"></span></th>
							                <th data-bind="visible: showDueDateColumn"><span data-bind="text: lang.lang.due_date"></span></th>
							                <th data-bind="visible: showDescriptionColumn"><span data-bind="text: lang.lang.description"></span></th>						                						                			                
							                <th class="center" style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>
							                <th class="center" style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>			                			                			                
							            </tr> 
							        </thead>
							        <tbody data-role="listview" 
							        		data-template="purchase-additional-cost-template" 
							        		data-auto-bind="false"
							        		data-bind="source: additionalCostDS"></tbody>			        
							    </table>

							    <!-- Add Row part -->
					            <div class="row-fluid">		
															
									<div class="span8">

										<table>
											<tr>
												<td>
													<button class="btn btn-inverse" data-bind="click: addRowAdditionalCost"><i class="icon-plus icon-white"></i></button>

													<div class="btn-group">
														<div class="leadcontainer">
															
														</div>
														<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
														<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
															<li>
																<input type="checkbox" id="chbDueDateColumn" class="k-checkbox" data-bind="checked: showDueDateColumn" />												
																<label class="k-checkbox-label" for="chbDueDateColumn"><span data-bind="text: lang.lang.due_date"></span></label>
															</li>																										
														</ul>
													</div>
												</td>
												<td><span data-bind="text: lang.lang.additional_cost_apply"></span></td>
												<td>
													<input type="radio" name="engine" id="engine1" class="k-radio" value="Equal" 
															data-bind="checked: obj.additional_apply,
																		events:{ change: changes }">
										            <label class="k-radio-label" for="engine1"><span data-bind="text: lang.lang.equal"></span></label>
							            		</td>						            	
							            		<td>						         
										            <input type="radio" name="engine" id="engine2" class="k-radio" value="Weighted"
										            		data-bind="checked: obj.additional_apply,
																		events:{ change: changes }">
										            <label class="k-radio-label" for="engine2"><span data-bind="text: lang.lang.weighted"></span></label>
							            		</td>
							            	</tr>
							            </table>
									</div>

									<div class="span4">
										<table class="table table-condensed table-striped table-white">
											<tbody>
												<tr>												
													<td class="right"><span data-bind="text: lang.lang.costs_allocated"></span></td>
													<td class="right strong" width="40%"><span data-bind="text: additional_cost"></span></td>
												</tr>
											</tbody>
										</table>
									</div>										
									
								</div>
					        </div>
					        <!-- // Additional Cost Tab content END -->				        						        								        

					    </div>
					</div>							    	    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">														
							<div class="span12 well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							</div>
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>																
									<tr>
										<td class="right"><h4><span data-bind="text: lang.lang.total"></span></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.deposit"></span>
											<span data-format="n" data-bind="text: total_deposit"></span>										
										</td>
										<td class="right">
											<input data-role="numerictextbox"
								                   data-format="n"
								                   data-spinners="false"
								                   data-min="0"							                                      
								                   data-bind="value: obj.deposit,
								                              events: { change: changes }"
								                   style="width: 90%; text-align: right;">
										</td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.remaining"></span>
										</td>
										<td class="right">
											<span data-bind="text: remaining"></span>
										</td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no_"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> Cancel</span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="purchase-item-line-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.purchase.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="txtMeasurement-#:uid#" name="txtMeasurement-#:uid#"
				   data-role="dropdownlist"
                   data-header-template="item-measurement-header-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: measurement_id,
                   			  source: measurementDS"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false"
					data-bind="value: cost, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-header-template="tax-header-tmpl"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>
		<td class="center" data-bind="visible: showAdditionalCost">
			<span data-format="n" data-bind="text: additional_cost"></span>
						
			<input type="checkbox" data-bind="checked: additional_applied,
										events:{ change: changes }" />
							
		</td>				
    </tr>   
</script>
<script id="purchase-account-line-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: removeRowAccount }"></i>
			#:banhji.purchase.accountLineDS.indexOf(data)+1#			
		</td>			
		<td>
			<input id="cbbAccounts" name="cbbAccounts-#:uid#"
				   data-role="combobox"                   
                   data-value-primitive="true"
                   data-header-template="account-header-tmpl"                  
                   data-template="account-list-tmpl"                                     
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: expenseAccountDS"
                   data-placeholder="Add Account.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td data-bind="visible: showRef">
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>			
		<td data-bind="visible: showSegment">
			<select data-role="multiselect"
				   data-value-primitive="true"				   
				   data-item-template="segment-list-tmpl"				    
				   data-value-field="id" 
				   data-text-field="code"
				   data-bind="value: segments, 
				   			source: segmentItemDS,
				   			events:{ change: segmentChanges }"
				   data-placeholder="Add Segment.."				   
				   style="width: 100%" /></select>					
		</td>
		<td class="right">
			<input id="txtAmount-#:uid#" name="txtAmount-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n0" 
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItemAccount-#:uid#"
				   data-role="combobox"                   			   
                   data-text-field="name"
                    data-header-template="tax-header-tmpl"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>			
    </tr>   
</script>
<script id="purchase-additional-cost-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: removeRowAdditionalCost }"></i>
			#:banhji.purchase.additionalCostDS.indexOf(data)+1#			
		</td>			
		<td>
			<input id="ddlType-#:uid#" name="ddlType-#:uid#"
				   data-role="dropdownlist"                   
                   data-value-primitive="true"                   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: type,
                              source: typeList,
                              events:{ change : typeColumnChanges }"                                       
                   required data-required-msg="required" style="width: 100%" />	
		</td>
		<td>
			<input id="ddlAccount" name="ddlAccount-#:uid#" 
					data-role="dropdownlist"
					data-auto-bind="false"														
      				data-value-primitive="true"
      				data-header-template="account-header-tmpl"
      				data-template="account-list-tmpl"
					data-text-field="name" 
      				data-value-field="id"						              				 
      				data-bind="value: account_id,
      							source: accountList"
      				data-option-label="Select Account..."
      				required data-required-msg="required" 
      				style="width: 100%" />
		</td>
		<td>
			<input id="ddlVendor" name="ddlVendor-#:uid#"
					data-role="combobox"                   
                   data-value-primitive="true"
                   data-header-template="vendor-header-tmpl"
                   data-template="contact-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: contact_id,
                              source: contactListDS,
                              events:{ change : contactColumnChanges }"
                   data-placeholder="Add Name.."                    
                   style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>
		<td>
			<input id="txtIssuedDate" name="txtIssuedDate" 
					data-role="datepicker"
					data-format="dd-MM-yyyy"
					data-parse-formats="yyyy-MM-dd" 
					data-bind="value: issued_date"
					style="width:100%;" />
		</td>
		<td data-bind="visible: showDueDateColumn">
			<input data-role="datepicker"
					data-format="dd-MM-yyyy"
					data-parse-formats="yyyy-MM-dd" 
					data-bind="value: due_date"
					style="width:100%;" />
		</td>		
		<td data-bind="visible: showDescriptionColumn">
			<input type="text" class="k-textbox" 
					data-bind="value: memo"					
					style="width: 100%; margin-bottom: 0;" />
		</td>				
		<td class="right">
			<input id="txtSubTotal-#:uid#" name="txtSubTotal-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n0" 
					data-bind="value: sub_total, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>		
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-header-template="tax-header-tmpl"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>			
    </tr>   
</script>

<script id="purchaseReturn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.c_purchase_return"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.supplier"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="vendor-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_received"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons pen"><a href="#tab2-4" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab3-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons paperclip"><a href="#tab4-4" data-toggle="tab"><i></i></a>
							            </li>
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-4">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">										
											<tr>							            				
												<td><span data-bind="text: lang.lang.relate_purchase"></span></td>
								            	<td>
													<input data-role="combobox"														
															data-auto-bind="false"
								              				data-value-primitive="true"
								              				data-template="reference-list-tmpl"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}"
								              				placeholder="Type number..." 
								              				style="width: 100%" />
												</td>
											</tr>		            	
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"	
														   data-header-template="segment-header-tmpl"							   
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"									                   				   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->						        

							        <!-- Memo Tab content -->
							        <div class="tab-pane" id="tab2-4">
							        	<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
										<br>						
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for internal ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab3-4">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->						        

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-4">

							        	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>						            	
							            
							            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 13%;"><span data-bind="text: lang.lang.cost"></span></th>		                
				                <th style="width: 1%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>			                
				                <th class="center" style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th class="center" style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>		                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="purchaseReturn-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>
									
		            <!-- Bottom part -->
		            <div class="row">
			
						<!-- Column -->
						<div class="span9">		
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												
						
							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount" />												
										<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>																
								</ul>
							</div>
							
							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
						  				 				
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->
							
							<br><br>					

							<table class="table table-bordered table-inverse table-striped table-vertical-center" data-bind="visible: showReturn">
						        <thead>
						            <tr>
						            	<th class="center" style="width: 1%;">
						            		<button type="button" data-role="button" data-bind="click: addRowOption"><i class="icon-plus"></i></button>
						            	</th>
						            	<th style="width: 30%"><span data-bind="text: lang.lang.type_of_return"></span></th>					               
						                <th><span data-bind="text: lang.lang.condition"></span></th>					                		                
						                <th style="width: 20%"><span data-bind="text: lang.lang.amount"></span></th>		                			                			                
						            </tr> 
						        </thead>
						        <tbody data-role="listview" 
						        		data-template="purchaseReturn-return-line-template" 
						        		data-auto-bind="false"
						        		data-bind="source: returnDS"></tbody>			        
						    </table>
														
						</div>
						<!-- Column END -->

						<!-- Column -->
						<!-- <div class="span3" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div> -->
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span3">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>																
									<tr>
										<td class="right"><h4><span data-bind="text: lang.lang.total"></span></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.amount_paid"></span></td>
										<td class="right strong">
											<span data-format="n" data-bind="text: obj.amount_paid"></span>
										</td>
									</tr>
									<tr>							
										<td class="right"><span data-bind="text: lang.lang.remaining"></span></td>
										<td class="right strong">
											<span data-format="n" data-bind="text: remaining"></span>
										</td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="purchaseReturn-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.purchaseReturn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement"
				   data-role="dropdownlist"
                   data-header-template="item-measurement-header-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: measurement_id,
                   			  source: measurementDS"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n" 
					data-bind="value: cost, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>					
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
				   data-role="combobox" 
				   data-header-template="tax-header-tmpl"                  			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>						
    </tr>   
</script>
<script id="purchaseReturn-return-line-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: removeRowOption }"></i>					
		</td>			
		<td>
			<input id="ddlOption" name="ddlOption-#:uid#"
				   data-role="dropdownlist"				                      			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: type, 
                   			  source: optionList,
                   			  events:{ change: optionChanges }"
                   data-option-label="Select Option..." 
                   style="width: 100%" />            
		</td>
		<td>
			<input id="cbbInvoice" name="cbbInvoice-#:uid#"
				   data-role="combobox"
				   data-template="reference-list-tmpl"				                      			   
                   data-text-field="number"
                   data-value-field="id"
                   data-bind="value: reference_id, 
                   			  source: invoiceDS,
                   			  visible: showInvoice,
                   			  events:{ change: invoiceChanges }"
                   placeholder="Select Invoice..." 
                   style="width: 100%" />

            <input id="ddlAccount" name="ddlAccount-#:uid#"
				   data-role="dropdownlist"
				   data-template="account-list-tmpl"				                      			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id, 
                   			  source: accountDS,
                   			  visible: showAccount"                   
                   style="width: 100%" />            
		</td>						
		<td>
			<input id="txtAmount-#:uid#" name="txtAmount-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n" 
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>								
    </tr>   
</script>

<script id="vendorSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2 data-bind="text: lang.lang.general_supplier_setting"></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.supplier_type"></span></span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.payment_method"></span></span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.payment_term"></span></span></a>
	            </li>
	            <li><a href="#tab4-1" class="glyphicons list" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.custom_forms"></span></span></a>
	            </li>	                       
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Enter New Vendor Type here ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i><span data-bind="text: lang.lang.add_type"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.type"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="vendorSetting-edit-contact-type-template"
				                data-template="vendorSetting-contact-type-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- PAYMENT METHOD -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i><span data-bind="text: lang.lang.add_method"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.name"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="vendorSetting-edit-payment-method-template"
				                data-template="vendorSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div>
	            <!-- // PAYMENT METHOD END -->

	            <!-- PAYMENT TERM -->
	            <div class="tab-pane" id="tab3-1">
            		<div class="input-append">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentTermName">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="net due ..." data-bind="value: paymentTermNetDue">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="period ..." data-bind="value: paymentTermPeriod">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="% ..." data-bind="value: paymentTermPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i><span data-bind="text: lang.lang.add_term"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.name"></span></th>
	            				<th><span data-bind="text: lang.lang.net_due"></span></th>
	            				<th><span data-bind="text: lang.lang.discount_period"></span></th>
	            				<th><span data-bind="text: lang.lang.discount_persentage"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="vendorSetting-edit-payment-term-template"
				                data-template="vendorSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div>
	            <!-- // PAYMENT TERM END -->

	            <!-- Tab Invocice Custom content -->
	            <div class="tab-pane" id="tab4-1">
            		
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr class="widget-head">
	            				<th class="center"><span data-bind="text: lang.lang.name"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.form_type"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.last_edited"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.action"></span></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
								 data-selectable="false"
				                 data-template="customerSetting-form-template"
				                 data-bind="source: txnTemplateDS">				            
	            		</tbody>
	            	</table>
	            	<a id="addNew" class="btn-icon btn-primary glyphicons ok_2" data-bind="click: goInvoiceCustom" style="width: 110px;"><i></i><span data-bind="text: lang.lang.add_new"></span></a>
	            </div>
	            <!-- // Tab Invoice Custom content END -->
	        </div>
	    </div>

	</div>
</script>
<script id="vendorSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#
		        <span class="k-button" data-bind="click: goPattern"><span data-bind="text: lang.lang.pattern"></span></span>
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="vendorSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#		        
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="vendorSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">
    		#:net_due#
   		</td>
   		<td align="center">
    		#:discount_period#
   		</td>
   		<td align="center">
    		#:discount_percentage#
   		</td>
   		<td>   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#		        
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="vendorSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:net_due" name="netDue" required="required" validationMessage="required" />
                <span data-for="netDue" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_period" name="period" required="required" validationMessage="required" />
                <span data-for="period" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_percentage" name="percentage" required="required" validationMessage="required" />
                <span data-for="percentage" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>

<script id="vendorReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>EXPENSE/PURCHASE MANAGEMENT REPORTS</h2>
				<p>
					The following reports provide summary and detailed reports in different ways to help analyze what 
					you spent and their impact on your cash flow and performance. 
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/expenses_purchase_summary_supplier">Expenses/ Purchase Summary by Supplier</a></h3>
							</td>
							<td >
								<h3><a href="#/suppliers_transaction_list">Suppliers Transaction List</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Summarizes total expenses/ purchase for each suppliers within a period of time.
								</p>
								
							</td>
							<td >
								<p>
									Lists of all transactions related to and grouped by each suppliers
								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/expenses_purchase_detail_supplier">Expenses/Purchase Detail by Supplier</a></h3>
							</td>
							<td >
								<h3><a href="#/deposit_detail_supplier">Deposit Detail by Supplier</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual expenses/ purchase transactions by date for each supplier within a period of time.
								</p>
							</td>
							<td >
								<p>
									Provides detailed information about supplier deposit for specific order, prepayment, or credit.
								</p>
							</td>
						</tr>

						<tr>
							<td >
								<h3><a href="#/purchase_summary_product_services">Purchase Summary by Product/ Services</a></h3>
							</td>
							<td >
								<h3><a href="#/open_purchase_order">Open Purchase Order</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Summarizes total expenses/ purchase for each product/ service within a period of time. 
								</p>
							</td>
							<td >
								<p>
									Lists all the open purchase order grouped by suppliers including the original amount as well.
								</p>
							</td>
						</tr>
						<tr>
							<td >
								<h3><a href="#/purchase_detail_product_services">Purchase Detail by Product/ Services</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual sale transactions by date for each product/ service with a period of time.
								</p>
							</td>
						</tr>

					</table>
				</div>
			</div>

			<div class="row-fluid recevable-report">
				<h2>PAYABLES MANAGEMENT REPORTS</h2>
				<p>
					The following reports provide summary and detailed reports.
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/suppliers_balance_summary">Suppliers Balance Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/suppliers_balance_detail">Suppliers Balance Detail</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Show each supplier’s total outstanding balances.
								</p>
								
							</td>
							<td >
								<p>
									Lists individual unpaid bill for each supplier
								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/payables_aging_summary">Payables Aging Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/payables_aging_detail">Payables Aging Detail</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists all unpaid bills for the current period, 30, 60, 90, and more than 90 days, grouped by individual suppliers. 
								</p>
							</td>
							<td >
								<p>
									Lists individual unpaid bills, grouped by suppliers. This includes due date, outstanding days (aging days), and amount.
								</p>
							</td>
						</tr>

						<tr>
							<td >
								<h3><a href="#/list_bills_paid">List of bills to be paid</a></h3>
							</td>
							<td >
								<h3><a href="#/bill_payment_list">Bill Payment List</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists all unpaid invoices, grouped by Due today and Overdue.
								</p>
							</td>
							<td >
								<p>
									Lists of paid bills for the select period of time, group by method of payments.
								</p>
							</td>
						</tr>						

					</table>
				</div>
			</div>
			<div class="row-fluid recevable-report">
				<h2>OTHER REPORTS/ LISTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<!-- <td style="width: 48%; padding-right: 8px !important;">
								<h3><a href="#/product_service_list">Product/ Service List</a></h3>
							</td> -->
							<td >
								<h3><a href="#/supplier_list">Supplier List</a></h3>								
							</td>
							<td >
								<h3><a href="#/customer_recurring">Recurring Supplier Template List</a></h3>								
							</td>						
						</tr>
						<tr>
							<!-- <td style="width: 48%; padding-right: 8px !important;" >
								<p>
									Lists the products and services you purchase. The following information is included: name, 
									description, cost, sales price, and quantity on hand.
								</p>								
							</td> -->
							<td >
								<p>
									Lists of all active suppliers
								</p>
							</td>
							<td>								
							</td>						
						</tr>
						<!-- <tr>
							<td>
							</td>
							<td >
								<h3><a href="#/customer_recurring">Recurring Supplier Template List</a></h3>								
							</td>
						</tr> -->
					</table>
				</div>
			</div>
		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart">
				<div class="widget-body alert alert-primary sale-overview">
					<h2>Expenses/ Purchase Overview</h2>
					<div align="center" class="text-large strong" data-bind="text: purchase"></div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span data-bind="text: purchase_supplier"></span>
								<br>
								<span>Suppliers</span>
							</td>
							<td>
								<span data-bind="text: purchase_product"></span>
								<br>
								<span>Products</span>
							</td>
							<td>
								<span data-bind="text: purchase_order"></span>
								<br>
								<span>Order</span>
							</td>
						</tr>
					</table>
				</div>
				<!-- Graph -->
				<div class="home-chart">
					<div data-role="chart"
		                 data-legend="{ position: 'top' }"
		                 data-series-defaults="{ type: 'column' }"
		                 data-tooltip='{
		                    visible: true,
		                    format: "{0}%",
		                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
		                 }'                 
		                 data-series="[
		                                 { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#236DA4' },
		                                 { field: 'order', name: 'Monthly Order', categoryField:'month', color: '#A6C9E3' }
		                             ]"	                             
		                 data-bind="source: graphDS"
		                 style="height: 250px;" ></div>
	            <!-- End Graph -->
			</div>
			<div class="report-chart">
				<div class="widget-body receivable-overview" style="background-color: LightGray">
					<h2>PAYABLES MANAGEMENT</h2>
					<div align="center" class="text-large strong" data-bind="text: ap"></div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span data-bind="text: ap_open"></span>
								<br>
								<span>Open</span>
							</td>
							<td>
								<span data-bind="text: ap_supplier"></span>
								<br>
								<span>Supplier</span>
							</td>
							<td>
								<span data-bind="text: ap_overdue"></span>
								<br>
								<span>Overdue</span>
							</td>
							<td>
								<span data-bind="text: collection_day"></span>
								<br>
								<span>Payable Payment Days</span>
							</td>
						</tr>
					</table>
				</div>
				<!-- Graph -->
				<div class="home-chart">
					<div data-role="chart"
		                 data-legend="{ position: 'top' }"
		                 data-series-defaults="{ type: 'column' }"
		                 data-tooltip='{
		                    visible: true,
		                    format: "{0}%",
		                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
		                 }'                 
		                 data-series="[
		                                 { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#236DA4' },
		                                 { field: 'order', name: 'Monthly Order', categoryField:'month', color: '#A6C9E3' }
		                             ]"	                             
		                 data-bind="source: graphDS"
		                 style="height: 250px;" ></div>
	            <!-- End Graph -->
			</div>
		</div>
	</div>
</script>
<script id="expensesPurchaseSummarySupplier" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: purchaseSummary.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Expenses/ Purchase Summary by Supplier</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Supplier</p>
									<span data-bind="text: count"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-sale">
									<p>Total Expenses/ Purchase</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Supplier</span></th>
									<th><span>Total Expenses/ Purchase</span></th>								
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: purchaseSummary.dataSource"
										 data-template="expensesPurchaseSummarySupplier-temp"
							></tbody>
							<tfoot>
								<tr>
									<th><span>Total</span></th>
									<th><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>					
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="expensesPurchaseSummarySupplier-temp" type="text/x-kendo-template" >
	<tr>
		<td>#=customer#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="suppliersTransactionList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: supplierTransaction.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Suppliers Transaction List</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span4">
										<p>Total Suppliers</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span4">
										<p>Cash Purchase</p>
										<span data-bind="text: totalCashPurchase"></span>
									</div>	
									
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Cash Payment</p>
										<span data-bind="text: totalCashPayment"></span>
									</div>	
									<div class="span6">
										<p>Total Purchase</p>
										<span data-bind="text: total"></span>
									</div>
								</div>
							</div>
						</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>
								<th><span data-bind="text: lang.lang.memo"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
									 data-bind="source: supplierTransaction.dataSource"
									 data-template="suppliersTransactionList-temp"
						></tbody>
						<tfoot>
							<tr>
								<th colspan="4"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="4" data-bind="text: total"></th>
							</tr>
						</tfoot>
					</table>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="suppliersTransactionList-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>		
					#if(items[i].type=="Cash_Purchase" || items[i].type=="Credit_Purchase"){#
						<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
					#}else if(items[i].type=="Vendor_Deposit" && items[i].amount<0){#	
						<a href="\#/Vendor_Deposit/#=items[i].id#">#=items[i].number#</a>					
					#}else{#
						<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
					#}#
		        </td>
				<td>#=items[i].memo#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="expensesPurchaseDetailSupplier" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: purchaseDetail.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Expenses/ Purchase Detail by Supplier</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Supplier</p>
									<span data-bind="text: count"></span>
								</div>

							</div>
							<div class="span7">
								<div class="total-sale">
									<p>Total Expenses/ Purchase</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>							
								<th><span data-bind="text: lang.lang.amount"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview" data-bind="source: purchaseDetail.dataSource" 
						       data-auto-bind="false" 
						       data-template="expensesPurchaseDetailSupplier-temp">
						</tbody>
						<tfoot>
							<tr>
								<th colspan="2"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="2"><span data-bind="text: total"></span></th>
							</tr>
						</tfoot>
					</table>

				</div>		
			</div>
		</div>
	</div>
</script>
<script id="expensesPurchaseDetailSupplier-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>		
					#if(items[i].type=="Cash_Purchase" || items[i].type=="Credit_Purchase"){#
						<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
					#}else{#
						<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
					#}#
		        </td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: 700;">
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="depositDetailSupplier" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: depositDetail.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Deposit Detail by Supplier</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">								
									<p>Number of Supplier Deposit</p>
									<span data-bind="text: count"></span>								
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">								
									<p>Supplier Deposit Balance</p>
									<span data-bind="text: total"></span>							
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>

									<th><span data-bind="text: lang.lang.type"></span></th>
									<th><span data-bind="text: lang.lang.date"></span></th>
									<th><span data-bind="text: lang.lang.no_"></span></th>
									<th><span data-bind="text: lang.lang.memo"></span></th>
									<th><span data-bind="text: lang.lang.amount"></span></th>

								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: depositDetail.dataSource"
										 data-template="depositDetailSupplier-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4"><span>Total</span></th>
									<th colspan="4"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="depositDetailSupplier-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>		
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
		        </td>
				<td>#=items[i].memo#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: black">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="purchaseSummaryProductServices" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: summaryProduct.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Purchase Summary by Product/ Services</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Product/services</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>AVG Purchase</p>
										<span data-bind="text: total_avg"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Purchase</p>
										<span data-bind="text: total_sale"></span>
									</div>
									<div class="span6">
										<p>Gross Profit Margin</p>
										<span data-bind="text: gpm"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>ITEM</span></th>
									<th><span>QTY</span></th>
									<th><span>AMOUNT</span></th>
									<th><span>AVG PRICE</span></th>
									<th><span>AVG COST</span></th>
									<th><span>GROSS PROFIT MARGIN</span></th>								
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: summaryProduct.dataSource"
										 data-template="purchaseSummaryProductServices-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4"><span>Total</span></th>
									<th colspan="4"><span data-bind="text: total_sale"></span></th>
								</tr>
							</tfoot>
						</table						
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="purchaseSummaryProductServices-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td>#=qty#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(avg_price, 'c')#</td>
		<td style="text-align: right;">#=kendo.toString(cost, 'c2')#</td>			
		<td style="text-align: right;">#=kendo.toString(gross_profit_margin, 'p')#</td>	
	</tr>
</script>
<script id="openPurchaseOrder" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: purchaseOrder.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Open Purchase Order</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Customer</p>
										<span data-bind="text: customer"></span>
									</div>
									<div class="span6">
										<p>Order</p>
										<span data-bind="text: order"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">								
									<p>Purchase Order</p>
									<span data-bind="text: total"></span>									
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Customer</span></th>
									<th><span>PO</span></th>
									<th><span>Item</span></th>
									<th><span>Memo</span></th>
									<th><span>COST</span></th>								
									<th><span>QTY</span></th>
									<th><span>Price</span></th>	
									<th><span>Amount</span></th>							
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: purchaseOrder.dataSource"
										 data-template="openPurchaseOrder-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4"><span>Total</span></th>
									<th colspan="4"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="openPurchaseOrder-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=customer#</td>
		<td>#=PO#</td>
		<td>#=item#</td>
		<td>#=memo#</td>		
		<td style="text-align: right;">#=kendo.toString(cost, 'c2')#</td>
		<td style="text-align: right;">#=qty#</td>
		<td style="text-align: right;">#=kendo.toString(price, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="purchaseDetailProductServices" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: detailProduct.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Purchase Detail by Product/Service</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Product</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Qty on Hand</p>
										<span data-bind="text: totaProdcuts"></span>									
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">									
									<p>Total Purchase</p>
									<span data-bind="text: total"></span>								
								</div>
							</div>
						</div>

					</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>
								<th><span data-bind="text: lang.lang.memo"></span></th>
								<th><span data-bind="text: lang.lang.qty"></span></th>
								<th><span data-bind="text: lang.lang.price"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
									 data-bind="source: detailProduct.dataSource"
									 data-template="purchaseDetailProductServices-temp"
						></tbody>
						<tfoot>
							<tr>
								<th colspan="4"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="4" data-bind="text: total"></th>
							</tr>
						</tfoot>
					</table>
					</div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="purchaseDetailProductServices-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>		
					#if(items[i].type=="Cash_Purchase" || items[i].type=="Credit_Purchase"){#
						<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
					#}else{#
						<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
					#}#
		        </td>
				<td>#=items[i].memo#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].qty, 'n0')#</td>
				<td style="text-align: right;">#=items[i].price#</td>				
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: red">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		
	</tr>
</script>
<script id="suppliersBalanceSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: supplierBalance.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Suppliers Balance Summary</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Suppliers</p>
										<span data-bind="text: supplierCount"></span>
									</div>	
									<div class="span6">
										<p>Number Suppliers</p>
										<span data-bind="text: count"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Suppliers Balance</p>
										<span data-bind="text: total"></span>
									</div>
									<div class="span6">
										<p>Open Credit Purchase</p>
										<span data-bind="text: openPurchase"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>SUPPLIER NAME</span></th>
									<th><span>BALANCE</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="suppliersBalanceSummary-tmpl"
					                data-bind="source: supplierBalance.dataSource" >
					        </tbody>
		            	</table>
		            </div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="suppliersBalanceSummary-tmpl" type="text/x-kendo-template">
	<tr> 
		<td>#=customer#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="suppliersBalanceDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: balanceDetailSupplier.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Supplier Balance Detail</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Supplier</p>
										<span data-bind="text: supplierCount"></span>
									</div>
									<div class="span6">
										<p>Number Supplier</p>
										<span data-bind="text: count"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Supplier Balance</p>
										<span data-bind="text: total"></span>
									</div>
									<div class="span6">
										<p>Opean Credit Purchase</p>
										<span data-bind="text: openBill"></span>
									</div>
								</div>
							</div>
						</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>
								<th><span data-bind="text: lang.lang.memo"></span></th>								
								<th><span data-bind="text: lang.lang.amount"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
									 data-bind="source: balanceDetailSupplier.dataSource"
									 data-template="suppliersBalanceDetail-temp"
						></tbody>
						<tfoot>
							<tr>
								<th colspan="4"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="3"><span data-bind="text: total"></span></th>
							</tr>
						</tfoot>
					</table>

					
					</div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="suppliersBalanceDetail-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>		
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].memo#</td>				
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="payablesAgingSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: payablesAging.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Payables Aging Summary</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Supplier</p>
										<span data-bind="text: supplierCount"></span>
									</div>	
									<div class="span6">
										<p>NUmber of Supplier</p>
										<span data-bind="text: count"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Supplier Balance</p>
										<span data-bind="text: total"></span>
									</div>									
									<div class="span6">
										<p>Average Aging</p>
										<span data-bind="text: aging"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Supplier</span></th>
									<th><span>CURRENT</span></th>
									<th><span>1-30</span></th>
									<th><span>31-60</span></th>
									<th><span>61-90</span></th>
									<th><span>OVER 90</span></th>
									<th><span>TOTAL</span></th>							
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: payablesAging.dataSource"
										 data-template="payablesAgingSummary-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4"><span>Total</span></th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="payablesAgingSummary-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td style="text-align: right;">#=kendo.toString(underThirty, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(thirty, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(sixty, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(ninety, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(overNinety, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="payablesAgingDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: payablesAging.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div id="invFormContent">

					<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Payables Aging Detail</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

					
					<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Supplier</p>
									<span data-bind="text: supplierCount"></span>>
									</div>	
									<div class="span6">
										<p>Supplier Balance</p>
									<span data-bind="text: total"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number Supplier</p>
									<span data-bind="text: count"></span>
									</div>									
									<div class="span6">
										<p>Average Aging</p>
									<span data-bind="text: aging"></span>
									</div>
								</div>
							</div>
						</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>
								<th><span data-bind="text: lang.lang.memo"></span></th>
								<th><span data-bind="text: lang.lang.aging"></span></th>
								<th><span data-bind="text: lang.lang.balance"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
									 data-bind="source: payablesAgingDetail.dataSource"
									 data-template="payablesAgingDetail-temp"
						></tbody>
						<tfoot>
							<tr>
								<th colspan="4"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="3"  data-bind="text: total"></th>
							</tr>
						</tfoot>
					</table>
					</div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="payablesAgingDetail-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].memo#</td>
				<td>#=items[i].outstanding#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="listBillsPaid" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: listBillsPaid.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>List of bills to be paid</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Supplier</p>
										<span data-bind="text: supplierCount"></span>
									</div>
									<div class="span6">
										<p>Supplier Balance</p>
										<span data-bind="text: total"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number of Supplier Balance</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Average Aging</p>
										<span data-bind="text: aging"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>								
									<th><span>Memo</span></th>								
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: listBillsPaid.dataSource"
										 data-template="listBillsPaid-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4"><span>Total</span></th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="listBillsPaid-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=items[i].date#</td>
				<td>
					<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
				</td>				
				<td>#=items[i].memo#</td>				
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="billPaymentList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: billPaymentList.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Bill Payment List</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Purchase</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number Supplier</p>
										<span data-bind="text: count"></span>
									</div>							
									<div class="span6">
										<p>Number</p>
										<span data-bind="text: numberPayment"></span>
									</div>
								</div>
							</div>
						</div>

					</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.no_"></span></th>							
								<th><span data-bind="text: lang.lang.memo"></span></th>							
								<th><span data-bind="text: lang.lang.balance"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
									 data-bind="source: billPaymentList.dataSource"
									 data-template="billPaymentList-temp"
						></tbody>
						<tfoot>
							<tr>
								<th colspan="4"><span data-bind="text: lang.lang.total"></span></th>
								<th colspan="3" data-bind="text: total"></th>
							</tr>
						</tfoot>
					</table>									
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="billPaymentList-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/purchase/#=items[i].id#">#=items[i].number#</a>
				</td>				
				<td>#=items[i].memo#</td>				
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="productServiceList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>Product/ Service List</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<div class="row-fluid">
						<div class="span5">
							<div class="total-customer">
								<div class="span6">
									<p>Product Items</p>
									<span>#</span>
								</div>
								<div class="span6">
									<p>Product Items on Hand</p>
									<span>-</span>
								</div>	
							</div>
						</div>
						<div class="span7">
							<div class="total-customer">
								<div class="span6">
									<p>Service Items</p>
									<span>#</span>
								</div>
								<div class="span6">
									<p>Service Items on Hand</p>
									<span>-</span>
								</div>
							</div>
						</div>
					</div>

					<table class="table table-borderless table-condensed ">
						<tr>
							<th>Item Name</th>
							<th>Description</th>
							<th>Type</th>
							<th>Sale Tax</th>							
							<th>Record P</th>
							<th>Cost</th>
							<th>Sale Price</th>
							<th>QOH</th>
							<th>Suppliers</th>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>						
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>					
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>						
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>				
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>				
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>						
						</tr>
						<tr>
							<th colspan="9" style="text-align: left; padding-left: 8px !important;">Total</th>
						</tr>
					</table>

				</div>		
			</div>
		</div>
	</div>
</script>
<script id="supplierList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content">

					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2"
							onclick="javascript:window.history.back()"><i></i></span>

						<input data-role="dropdownlist"
						   data-option-label="Select Type..."
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: contact_type_id,
		                              source: contactTypeDS" />

		                <input data-role="dropdownlist"
						   data-option-label="Select Status..."
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: status,
		                              source: statusList" />

						<button id="search" type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
					</div>

					<h3 align="center" data-bind="text: lang.lang.customer_list"></h3>

					<br>

					<div data-role="grid"
						 data-groupable="true"
						 data-sortable="true"
						 data-pageable="true"
		                 data-columns="[
                             { field: 'number', title:'Number' },
                             { field: 'surname', title:'Surname' },
                             { field: 'name', title:'Name' },
                             { field: 'contact_type_id', title:'Type', template:'#=contact_type#' },
                             { field: 'phone', title:'Phone' },
                             { field: 'status', title:'Status', template:'#=status==1?&quot;Active&quot;:&quot;Inactive&quot;#' }
                                                       ]"
		                 data-bind="source: dataSource"></div>

				</div> <!-- //End div example-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>
</script>


<script id="vendorRecurring" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<div class="hidden-print">
				    	<div class="pull-right">

				    		<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>						
						</div>

				        <h2>Supplier Recurring</h2>				        				        				        	
				    </div>			   

				    <br>

				    <div data-role="window"
		                 data-title="Job"		                 
		                 data-width="600"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '30%'}"
		                 data-height="300"
		                 data-bind="visible: isVisible">

						<table class="table table-bordered table-primary table-striped table-vertical-center">							
							<tr>
								<td>Name</td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Description</td>
								<td>
									<input class="k-textbox" placeholder="type description ..." data-bind="value: obj.description" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Customer</td>
								<td>
									<input data-role="combobox"
										   data-template="contact-list-tmpl"				            			               			   		                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.contact_id,
						                              source: contactDS"
						                   style="width: 100%;" />
								</td>
							</tr>							
						</table>

						<br>

						<div align="center">
							<span class="btn btn-icon btn-primary glyphicons ok_2" data-bind="click: save" style="width: 80px;"><i></i> Save</span>
							<span class="btn btn-icon btn-danger glyphicons remove_2" data-bind="click: closeWindow" style="width: 80px;"><i></i> Close</span>						
						</div>
					</div>
					
										                           					
	            	<table class="table table-bordered table-primary table-striped table-vertical-center">
	            		<thead style="background-color: blue; color: #fff; font-weight: bold">
	            			<th style="width: 1%;">No.</th>
			                <th>TEMPLATE NAME</th>
			                <th>NAME</th>
			                <th class="center" style="width: 10%">TYPE</th>
			                <th class="center">START DATE</th>
			                <th class="center">FREQUENCY</th>
			                <th></th>
	            		</thead>
	            		<tbody ></tbody>
	            	</table>
	            </div>	            						
			</div>
		</div>
	</div>
</script>


<!-- ***************************
*	Customer Section           *
**************************** -->
<script id="customerDashboard" type="text/x-kendo-template">

	<div class="row-fluid">

		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<h2 data-bind="text: lang.lang.customers"></h2>
			        	<p>
			        		<span data-bind="text: lang.lang.in_here"></span>
			        	</p>
			        	<div class="supplier-icon">
					       	<div class="span4">
						       	<a href="#/customer" class="center">
						       		<img title="Add Customers" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/customers.ico" />
						       	</a>
						       </div>
						    <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" width="83" height="83" />
						       	</a>
						    </div>
						</div>
			        </td>
			 	</tr>
			</table>
			<table class="table table-borderless table-condensed table-vertical-center">
				<tr>
					<td class="center">
						<a href="#/quote">
							<img title="Add Quote" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/quotation.png" width="110" height="200" />
							<span data-bind="text: lang.lang.quotation" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">
						<a href="#/sale_order">
							<img title="Add Sale Order" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/sale_order.png" width="110" height="200" />
							<span data-bind="text: lang.lang.sale_order" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center" >
						<a href="#/customer_deposit">
							<img title="Add Customer Deposit" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/customer_deposit.png" width="110" height="200" />
							<span data-bind="text: lang.lang.c_deposit" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>					
				</tr>
				<tr>
					<td class="center">
						<a href="#/cash_sale">
							<img title="Add Cash Sale" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/sale_receipt.png" width="110" height="200" />
							<span data-bind="text: lang.lang.cash_sale" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center">
						<a href="#/invoice">
							<img title="Add Invoice" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/invoice.png" width="110" height="200" />
							<span data-bind="text: lang.lang.invoice" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center">						
						<a href="#/cash_receipt">
							<img title="Add Cash Receipt" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_receipt.png" width="110" height="200" />
							<span data-bind="text: lang.lang.cash_receipt" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>										
				</tr>
				<tr>				
					<td style="vertical-align:top;" class="center">
						<a href="#/gdn">
							<img title="Add Delivery Note" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/delivery_note.png" width="110" height="200" />
							<span data-bind="text: lang.lang.delivery_note" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td width="186" class="center">
						<a href="#/sale_return">
							<img title="Add Sale Return" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/sale_return.png" width="110" height="200" />
							<span data-bind="text: lang.lang.sale_return" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>				
					<td width="186" class="center">
						<a href="#/statement">
							<img title="Add Statement" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/statement.png" width="110" height="200" />
							<span data-bind="text: lang.lang.statement" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
				</tr>				
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8">

			<!-- Summary -->
			<div class="row-fluid">
	
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border"  >
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons coins"><i></i></span><span data-bind="text: lang.lang.sale"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/sale_summary_customer"><div class="widget-body alert alert-primary" style="min-height: 148px;">
							
							<div align="center" class="text-large strong" data-bind="text: sale"></div>
							<table width="100%">
								<tr align="center">
									<td width="33%" style="vertical-align: top">										
										<span data-bind="text: sale_customer"></span>
										<br>
										<span><span data-bind="text: lang.lang.customers"></span></span>
									</td>
									<td width="33%" style="vertical-align: top">
										<span data-bind="text: sale_product"></span>
										<br>
										<span><span data-bind="text: lang.lang.product"></span></span>
									</td>
									<td width="33%" style="vertical-align: top">
										<span data-bind="text: sale_order"></span>
										<br>
										<span><span data-bind="text: lang.lang.order"></span></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<a href="#/sale_order_list"><div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons cart_in"><i></i></span><span data-bind="text: lang.lang.sale_order"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info" style="min-height: 148px;">
							
							<div align="center" class="text-large strong" data-bind="text: order"></div>
							<table width="100%">
								<tr align="center">
									<td width="50%" style="vertical-align: top">										
										<span data-bind="text: order_avg"></span>
										<br>
										<span><span data-bind="text: lang.lang.average"></span></span>
									</td>
									<td width="50%" style="vertical-align: top">
										<span data-bind="text: order_open"></span>
										<br>
										<span><span data-bind="text: lang.lang.order_open"></span></span>
									</td>									
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons credit_card"><i></i></span><span data-bind="text: lang.lang.receivable"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/customer_balance_summary"><div class="widget-body alert-info3" style="background-color: LightGray; min-height: 148px;">
							
							<div align="center" class="text-large strong" data-bind="text: ar"></div>
							<table width="100%">
								<tr align="center">
									<td width="33%" style="vertical-align: top">										
										<span data-bind="text: ar_open"></span>
										<br>
										<span><span data-bind="text: lang.lang.open"></span></span>
									</td>
									<td width="33%" style="vertical-align: top">
										<span data-bind="text: ar_customer"></span>
										<br>
										<span><span data-bind="text: lang.lang.customers"></span></span>
									</td>
									<td width="33%" style="vertical-align: top">
										<span data-bind="text: ar_overdue"></span>
										<br>
										<span><span data-bind="text: lang.lang.overdue"></span></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">								
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_customers"></span></th>				                			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="customerDashBoard-top-customer-template"
			                 data-bind="source: topCustomerDS"></tbody>			        
				    </table>			
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>				           
				            <tr>
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_ar_balance"></span></th>				                			                
				            </tr>					        
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                  
			                 data-template="customerDashBoard-top-ar-template"
			                 data-bind="source: topARDS"></tbody>			        
				    </table>
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>				           
				            <tr>
				                <th class="center" colspan="2"><span data-bind="text: lang.lang.top_5_products"></span></th>				                			                
				            </tr>					        
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"                
			                 data-template="customerDashBoard-top-product-template"
			                 data-bind="source: topProductDS"></tbody>			        
				    </table>
				</div>		
			</div>

			<!-- Graph -->
			<div class="home-chart">
				<div data-role="chart"
	                 data-legend="{ position: 'top' }"
	                 data-series-defaults="{ type: 'column' }"
	                 data-tooltip='{
	                    visible: true,
	                    format: "{0}%",
	                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
	                 }'                 
	                 data-series="[
	                                 { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#236DA4' },
	                                 { field: 'order', name: 'Monthly Order', categoryField:'month', color: '#A6C9E3' }
	                             ]"
	                 data-auto-bind="false"	                             
	                 data-bind="source: graphDS"
	                 style="height: 250px;" ></div>
            <!-- End Graph -->
            </div>
		</div>		

	</div>		
</script>
<script id="customerDashBoard-top-customer-template" type="text/x-kendo-tmpl">	
	<tr data-uid="#: uid #">
		<!-- <td style="width: 1%">#:banhji.customerDashboard.topCustomerDS.indexOf(data)+1#</td -->>		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>		
	</tr>
</script>
<script id="customerDashBoard-top-ar-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.customerDashboard.topARDS.indexOf(data)+1#</td>		 -->
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>
	</tr>
</script>
<script id="customerDashBoard-top-product-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.customerDashboard.topProductDS.indexOf(data)+1#</td>		 -->
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(quantity, "n0")#</span>
		</td>
	</tr>
</script>

<script id="customerCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Number or Name..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>						
							<div class="select2-container" style="width: 100%;  margin-bottom: 10px;">
								<input data-role="dropdownlist"
					                   data-option-label="Select Type..."
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: contact_type_id,
					                              source: contactTypeDS"
					                   style="width: 100%;" />							
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid"						 
						 data-bind="source: contactDS"
						 data-row-template="customerCenter-customer-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							        	<li style="font-size: large; color: black; font-weight: bold;">							            	
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons text_bigger active"><span data-toggle="tab" data-target="#tab1-4"><i></i></span>
							            </li>							            							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab2-4"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab3-4"><i></i></span>
							            </li>
							            <li class="glyphicons paperclip"><span data-toggle="tab" data-target="#tab4-4"><i></i></span>
							            </li>							            							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Transactions Tab content -->
							            <div id="tab1-4" class="tab-pane active box-generic">
							            	<table class="table table-borderless table-condensed cart_total cash-table">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-inverse" data-bind="click: goQuote"><span><span data-bind="text: lang.lang.quote"></span></span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goDeposit"><span><span data-bind="text: lang.lang.c_deposit"></span></span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goSaleOrder"><span><span data-bind="text: lang.lang.sale_order"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashSale"><span><span data-bind="text: lang.lang.cash_sale"></span></span>								            											            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goSaleReturn"><span data-bind="text: lang.lang.sale_return1"></span></span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goInvoice"><span data-bind="text: lang.lang.invoice"></span></span>								            											            			
								            		</td>
								            	</tr>
								            	<tr>								            		
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goGDN"><span data-bind="text:lang.lang.c_gdn"></span></span>
								            		</td>
								            		<td class="center">
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashReceipt"><span data-bind="text: lang.lang.cash_receipt"></span></span>								            			

								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-inverse" data-bind="click: goStatement"><span data-bind="text: lang.lang.statement"></span></span>
								            		</td>
								            		<td>
								            			
								            		</td>
								            	</tr>
							            	</table>
							            </div>
							            <!-- // Transactions Tab content END -->							           					            

							            <!-- INFO Tab content -->
							            <div id="tab2-4" class="tab-pane box-generic">
							            	<div class="row-fluid">
							            		<div class="accounCetner-textedit">
									            	<table width="100%">
														<tr>
															<td width="40%"><span data-bind="text: lang.lang.customer_type"></span></td>
															<td width="60%">
																<span class="strong" data-bind="text: obj.contact_type"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.number"></span></td>
															<td>
																<span class="strong" data-bind="text: obj.abbr"></span>
																<span class="strong" data-bind="text: obj.number"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.name"></span></td>
															<td>
																<span data-bind="text: obj.name"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.billed_address"></span></td>
															<td>
																<span data-bind="text: obj.address"></span>
															</td>
														</tr>								
														<tr>
															<td><span data-bind="text: lang.lang.phone"></span></td>
															<td>
																<span data-bind="text: obj.phone"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.currency"></span></td>
															<td>										
																<span data-bind="text: currencyCode"></span>
															</td>
														</tr>
													</table>

													<span class="btn btn-primary btn-icon glyphicons edit pull-right" data-bind="click: goEdit"><i></i><span data-bind="text: lang.lang.view_edit_profile"></span></span>
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab3-4" class="tab-pane">

										    <div>
												<input type="text" class="k-textbox" 
														data-bind="value: note, events:{change:saveNoteEnter}" 
														placeholder="Add memo ..." 
														style="width: 366px;" />
												<span class="btn btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.add"></span></span>
											</div>

											<br>

											<div class="table table-condensed" style="height: 100;"						 
												 data-role="grid"
												 data-auto-bind="false"						 
												 data-bind="source: noteDS"
												 data-row-template="customerCenter-note-tmpl"
												 data-columns="[{title: ''}]"
												 data-height="100"						 
												 data-scrollable="{virtual: true}"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- Attach Tab content -->
								        <div id="tab4-4" class="tab-pane">							            	
								            <p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>
								            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

								            <table class="table table-bordered">
										        <thead>
										            <tr>			                
										                <th><span data-bind="text: lang.lang.file_name"></span></th>
										                <th><span data-bind="text: lang.lang.description"></span></th>
										                <th><span data-bind="text: lang.lang.date"></span></th>
										                <th style="width: 13%;"></th>                			                
										            </tr> 
										        </thead>
										        <tbody data-role="listview" 
										        		data-template="attachment-list-tmpl" 
										        		data-auto-bind="false"
										        		data-bind="source: attachmentDS"></tbody>			        
										    </table>

										    <span class="btn btn-icon btn-success glyphicons ok_2" data-bind="click: uploadFile" style="color: #fff; padding: 5px 38px; text-align: left; width: 98px !important; display: inline-block; margin-top: 10px;"><i></i> <span data-bind="text: lang.lang.save"></span></span>

								        </div>
								        <!-- // Attach Tab content END -->							            								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6" style="margin-bottom: 10px;">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.balance"></span><span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadDeposit">
										<span class="glyphicons briefcase"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.deposit"></span><span data-bind="text: deposit" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: outInvoice"></span> <span data-bind="text: lang.lang.open_invoice"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> <span data-bind="text: lang.lang.over_due"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>
					</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >

					  	<button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type"></span></th>								
								<th><span data-bind="text: lang.lang.reference_no"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
								<th><span data-bind="text: lang.lang.status"></span></th>
								<th><span data-bind="text: lang.lang.action"></span></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="customerCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="customerCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <!-- Reference -->
        <td>
        	#if(type=="Customer_Deposit" && amount<0){#			
				<a href="\#/#=reference[0].type.toLowerCase()#/#=reference[0].id#"><i></i> #=number#</a>			
			#}else{#
				<a href="\#/#=type.toLowerCase()#/#=id#"><i></i> #=number#</a>
			#}#        	
        </td>
        <!-- Amount -->
    	<td class="right">
    		#if(type=="GDN"){#
    			#=kendo.toString(amount, "n0")#
    		#}else{#
    			#=kendo.toString(amount-deposit, locale=="km-KH"?"c0":"c", locale)#
    		#}#
    	</td>
    	<!-- Status -->
    	<td align="center">
    		#if(type==="Quote"){#       		
				#if(status==="0"){#
        			Open
        		#}else{#
        			Used        			
        		#}#
        	#}else if(type==="Sale_Order"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="GDN"){#
        		Delivered
        	#}else if(type==="Invoice"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#        	
        	#}#        				
		</td>
		<!-- Actions -->
    	<td align="center">
			#if(type==="Invoice"){#
				#if(status==="0" || status==="2") {#
        			<a data-bind="click: payInvoice"><i></i> <span data-bind="text: lang.lang.receive_payment"></span></a>
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="customerCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body strong">				
				<span>#=abbr##=number#</span>
				<span>#=name#</span>
			</div>
		</td>
	</tr>
</script>
<script id="customerCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="customer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>						
					
			        <h2 span data-bind="text: lang.lang.customers"></h2>			    		   

				    <br>

				    <!-- Top Part -->
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row">
								<div class="span6">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlContactType"><span data-bind="text: lang.lang.customer_type"></span> <span style="color:red">*</span></label>
										<input id="ddlContactType" name="ddlContactType"
												   data-role="dropdownlist"
												   data-header-template="customer-type-header-tmpl"       
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_type_id,
								                   			  disabled: obj.is_pattern,
								                              source: contactTypeDS,
								                              events:{change: typeChanges}"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />																				            
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6" style="padding-right: 0;">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtAbbr"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>										
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" required data-required-msg="required"
					              				style="width: 55px;" />
					              		-					              		
					              		<input id="txtNumber" name="txtNumber" class="k-textbox"					              			   					                   
							                   data-bind="value: obj.number, 
							                   			  disabled: obj.is_pattern, 
							                   			  events:{change: checkExistingNumber}"
							                   placeholder="eg. 001" required data-required-msg="required"
							                   style="width: 143px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->											
								</div>
							</div>
							
							<div class="row">
								<div class="span12">	
									<!-- Group -->
									<div class="control-group">								
										<label for="fullname"><span data-bind="text: lang.lang.full_name"></span> <span style="color:red">*</span></label>
							            <input id="fullname" name="fullname" class="k-textbox" 
							            		data-bind="value: obj.name, 
							            					disabled: obj.is_pattern,
							            					attr: { placeholder: phFullname }" 
							              		required data-required-msg="required"
							              		style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>
							</div>

							<div class="row">
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="customerStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="customerStatus" name="customerStatus" 
							              				data-role="dropdownlist"
									            		data-text-field="name"
						           						data-value-field="id"
						           						data-value-primitive="true" 
									            		data-bind="source: statusList, value: obj.status"
									            		data-option-label="(--- Select ---)"
									            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">								
										<label for="registeredDate"><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></label>
							            <input id="registeredDate" name="registeredDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.registered_date, disabled: obj.is_pattern" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>
							</div>																					
						</div>
						<div class="span6">
							<div class="row-fluid">	
								<!-- Map -->
								<div id="map" class="span12" style="height: 130px;"></div>
							</div>

							<div class="separator line bottom"></div>

							<div class="row-fluid">	
								<div class="span6">									
									<!-- Group -->
									<div class="control-group">
						    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
										<div class="input-prepend">
											<span class="add-on glyphicons direction"><i></i></span>
											<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
										</div>
									</div>									
									<!-- // Group END -->
								</div>	
								
								<div class="span6">	
									<!-- Group -->
									<div class="control-group">
						    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
						    			<div class="input-prepend">
											<span class="add-on glyphicons google_maps"><i></i></span>
											<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
										</div>										
									</div>
									<!-- // Group END -->
								</div>										
							</div>
						</div>
					</div>								
							
					<!-- // Bottom Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						            
						            <li class="span2 glyphicons nameplate_alt active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
						            </li>								            
						            <li class="span2 glyphicons usd">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.account"></span></span></a>
						            </li>
						            <li class="span2 glyphicons parents">
						            	<a href="#tab3" data-toggle="tab"><i></i> <span><span ></span>Contact</span></a>
						            </li>						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						    	<!-- //GENERAL INFO -->
						        <div class="tab-pane active" id="tab1">
					            	<table class="table table-borderless table-condensed cart_total">					            		
							            <tr>
							                <td><span data-bind="text: lang.lang.vat_no"></span></td>
							              	<td>
					            				<input class="k-textbox" data-bind="value: obj.vat_no" 
													placeholder="e.g. 01234567897" style="width: 100%;" />									
							              	</td>							              	
							            	<td><span data-bind="text: lang.lang.phone"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" style="width: 100%;" /></td>
							            </tr>
							            <tr>
							            	<td><span data-bind="text: lang.lang.country"></span></td>
							              	<td>
							              		<input data-role="dropdownlist"
							              			   data-option-label="(--- Select ---)"									                   
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.country_id,
									                              source: countryDS" style="width: 100%;" />
							              	</td>							            								              	
							            	<td><span data-bind="text: lang.lang.email"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" style="width: 100%;" />							            	
							            </tr>
							            <tr>
							            	<td><span data-bind="text: lang.lang.city"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.city" placeholder="city name ..." style="width: 100%;" />							              	
							            	<td><span data-bind="text: lang.lang.post_code"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.post_code" placeholder="e.g. 12345" style="width: 100%;" />
							            </tr>							            
							            <tr>
							            	<td><span data-bind="text: lang.lang.address"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." style="width: 100%;" />									            								              	
							            	<td><span data-bind="text: lang.lang.memo"></span></td>
							              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." style="width: 100%;" /></td>							              	
							            </tr>									            
							            <tr>
							            	<td>
							            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
							            	</td>
							            	<td>
							            		<textarea rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="billed to ..."></textarea>
							            	</td>
							            	<td><span data-bind="text: lang.lang.delivered_to"></span></td>
							            	<td>
							            		<textarea rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="delivered to ..."></textarea>
							            	</td>
							            </tr>							            							            							            								            								            			            
							        </table>
					        	</div>
						        <!-- //GENERAL INFO END -->

						        <!-- //ACCOUNTING -->
						        <div class="tab-pane" id="tab2">
						        	
						        	<div class="row-fluid">								        		
						            	<div class="span3">
											<label for="ddlAR"><span data-bind="text: lang.lang.account_receiveable"></span> <span style="color:red">*</span></label>
											<input id="ddlAR" name="ddlAR"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"      
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.account_id,
								                              source: arDS"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />													
										</div>
										<div class="span3">
											<label for="ddlRA"><span data-bind="text: lang.lang.revenue_account"></span> <span style="color:red">*</span></label>
											<input id="ddlRA" name="ddlRA"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl" 
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.ra_id,
								                              source: raDS"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />													
										</div>
										<div class="span3">
											<label for="ddlDepositAccount"><span data-bind="text: lang.lang.deposit_account"></span> <span style="color:red">*</span></label>
											<input id="ddlDepositAccount" name="ddlDepositAccount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"      
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.deposit_account_id,
								                              source: depositDS"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />													
										</div>
										<div class="span3">
											<label for="ddlTradeDiscount"><span data-bind="text: lang.lang.trade_discount"></span> <span style="color:red">*</span></label>
											<input id="ddlTradeDiscount" name="ddlTradeDiscount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"      
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.trade_discount_id,
								                              source: tradeDiscountDS"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />														
										</div>												
							        </div>

							        <div class="separator line bottom"></div>

							        <div class="row-fluid">
						        		<div class="span3">						
								            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
								            <input id="currency" name="currency" 
								            	data-role="dropdownlist"
								            	data-template="currency-list-tmpl"
								            	data-value-primitive="true"
								                data-text-field="code"
								                data-value-field="locale"
												data-bind="value: obj.locale,
															disabled: isProtected, 
															source: currencyDS"
												data-option-label="(--- Select ---)" 
												required data-required-msg="required" style="width: 100%;" />
								        </div>
						            	<div class="span3">
											<label for="ddlPaymentTerm"><span data-bind="text: lang.lang.payment_term"></span></label>
											<input id="ddlPaymentTerm" name="ddlPaymentTerm"
												data-header-template="customer-term-header-tmpl"
												data-role="dropdownlist"
								            	data-value-primitive="true"
								                data-text-field="name"
								                data-value-field="id"
												data-bind="value: obj.payment_term_id, source: paymentTermDS" 
												data-option-label="(--- Select ---)"
												style="width: 100%;" />
										</div>
										<div class="span3">
											<label for="ddlPaymentMethod"><span data-bind="text: lang.lang.payment_method"></span></label>
											<input id="ddlPaymentMethod" name="ddlPaymentMethod"
												data-header-template="customer-payment-method-header-tmpl"
												data-role="dropdownlist"
								            	data-value-primitive="true"
								                data-text-field="name"
								                data-value-field="id"
												data-bind="value: obj.payment_method_id, source: paymentMethodDS"
												data-option-label="(--- Select ---)" 
												style="width: 100%;" />
										</div>
										<div class="span3">
											<label for="ddlSettlementDiscount"><span data-bind="text: lang.lang.settlement_discount"></span> <span style="color:red">*</span></label>
											<input id="ddlSettlementDiscount" name="ddlSettlementDiscount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"      
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.settlement_discount_id,
								                              source: settlementDiscountDS"
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" style="width: 100%;" />														
										</div>												
							        </div>

							        <div class="separator line bottom"></div>

							        <div class="row-fluid">
							        	<div class="span3">
											<label for="ddlTaxItem"><span data-bind="text: lang.lang.tax"></span></label>
											<input id="ddlTaxItem" name="ddlTaxItem"
												   data-role="dropdownlist"								
												   data-header-template="tax-header-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.tax_item_id,
								                              source: taxItemDS"
								                   data-option-label="(--- Select ---)"
								                   style="width: 100%;" />
										</div>	
								        <div class="span3">
											<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
								            <input data-role="numerictextbox"
								                   data-format="n"
								                   data-min="0"										                   
								                   data-bind="value: obj.credit_limit"										                  
								                   style="width: 100%;">
										</div>																							
									</div>
					        	</div>
						        <!-- //ACCOUNTING END -->						       

						        <!-- //CONTACT PERSON -->
						        <div class="tab-pane" id="tab3">
						        	<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i><span data-bind="text: lang.lang.new_contact_person"></span></span>

						        	<table class="table table-bordered table-white">
								        <thead>
								            <tr>
								                <th><span data-bind="text: lang.lang.name"></span></th>
								                <th><span data-bind="text: lang.lang.department"></span></th>						                
								                <th><span data-bind="text: lang.lang.phone"></span></th>
								                <th><span data-bind="text: lang.lang.email"></span></th>
								                <th width="20px"></th>										               
								            </tr>
								        </thead>
								        <tbody data-role="listview"										        		
								        		data-auto-bind="false"										        						        		 
								        		data-template="contact-person-row-tmpl" 
								        		data-bind="source: contactPersonDS">
								        </tbody>										        						        
								    </table>
					        	</div>
						        <!-- //CONTACT PERSON END -->
						    </div>
						</div>
					</div>

					<br>											
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> Delete</span>					

							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="quote" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.quote"></h2>

				    <br>
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_quoted"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.recuring"></span></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span> <span data-bind="text: balance"></span>
												</td>										
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span> <span data-format="n" data-bind="text: obj.credit_allowed"></span>
												</td>
											</tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.validity_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>							           
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.refrence"></span>	            						            		
								            	</td>
								            </tr>
								            <tr>
								            	<td>
								            		<span data-bind="text: lang.lang.term"></span>     		
								            	</td>				
												<td>
													<input data-role="dropdownlist"														
								              				data-value-primitive="true"
															data-text-field="name" 
								              				data-value-field="id"	
								              				data-header-template='customer-term-header-tmpl'					              				 
								              				data-bind="value: obj.payment_term_id,
								              							source: paymentTermDS,
								              							events:{ change: setTerm }"
								              				data-option-label="Select Term..." 
								              				style="width: 100%" />
												</td>
											</tr>
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">							                        	
											<tr>
												<td><span data-bind="text: lang.lang.sale_rep"></span></td>
												<td>
													<input id="cbbEmployee" name="cbbEmployee"
														   data-role="combobox"
										                   data-value-primitive="true"
										                   data-header-template="employee-header-tmpl"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.employee_id,
										                              source: employeeDS"
										                   data-placeholder="Type Name..." 
										                   style="width: 100%" />
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"		   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Select job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">
							         	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>					                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>             
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.price"></span></th>
				                <th style="width: 10%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>			                
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.tax"></span></th>			                			                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="quote-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>											 
	 									<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount">
	  									<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>

									</li>															
								</ul>
							</div>

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
						  				 				
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

							<br><br>
							<div class="well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							</div>
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>															
									<tr>
										<td class="right"><h4 span data-bind="text: lang.lang.total"></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="quote-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.quote.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" 
					name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" 
					data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" 
					style="width: 40%;" />

			<input 	id="ddlMesurement"
					data-role="dropdownlist"					
					data-header-template="item-measurement-header-tmpl"                 
                	data-text-field="measurement"
                   	data-value-field="measurement_id"
                   	data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input 	id="txtPrice-#:uid#" 
					name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false"
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input 	id="ccbTaxItem" 
					name="ccbTaxItem-#:uid#"
					data-header-template="tax-header-tmpl"
				   	data-role="combobox"                   			   
                   	data-text-field="name"
                   	data-value-field="id"
                   	data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   	style="width: 100%" />			
		</td>						
    </tr>   
</script>
<script id="saleOrder" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">				    
			    	
		    		<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>					

			        <h2 data-bind="text: lang.lang.sale_order"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: {backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_ordered"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i> Recuring</a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span> <span data-bind="text: balance"></span>
												</td>										
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span> <span data-format="n" data-bind="text: obj.credit_allowed"></span>
												</td>
											</tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.expected_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>							           
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	                    		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}" 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">							                        	
											<tr>
												<td><span data-bind="text: lang.lang.sale_rep"></span></td>
												<td>
													<input id="cbbEmployee" name="cbbEmployee"
														   data-role="combobox"
										                   data-value-primitive="true"
										                   data-header-template="employee-header-tmpl"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.employee_id,
										                              source: employeeDS"
										                   data-placeholder="Type Name..." 
										                   style="width: 100%" />
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"		   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Select job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">
							         	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>		
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>					                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>                
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.price"></span></th>
				                <th style="width: 10%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>
				                <th style="width: 10%;" data-bind="visible: showRequiredDate"><span data-bind="text: lang.lang.delivery_date"></span></th>               
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.tax"></span></th>
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="saleOrder-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount">
      									<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>
									<li>
										<input type="checkbox" id="chbRequiredDate" class="k-checkbox" data-bind="checked: showRequiredDate">
      									<label class="k-checkbox-label" for="chbRequiredDate"><span data-bind="text: lang.lang.delivery_date"></span></label>
									</li>															
								</ul>
							</div>

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>	
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->
							
							<br><br>
							<div class="well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							</div>
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>
									<tr>
										<td class="right"><h4><span data-bind="text: lang.lang.total"></span></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="saleOrder-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.saleOrder.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" 
					data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement"  data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"                
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false" 
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>
		<td class="center" data-bind="visible: showRequiredDate">
			<input data-role="datepicker"
					data-format="dd-MM-yyyy"
					data-parse-formats="yyyy-MM-dd" 
					data-bind="value: required_date"
					style="width:100%;" />
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
					data-header-template="tax-header-tmpl"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>						
    </tr>   
</script>
<script id="customerDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.customer_deposit"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 150px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: {backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_deposited"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" style="height: 190px;">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.recurring"></span></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span> <span data-bind="text: balance"></span>
												</td>										
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span> <span data-format="n" data-bind="text: obj.credit_allowed"></span>
												</td>
											</tr>   
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>   						     		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}" 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">							                        	
											<tr>
												<td><span data-bind="text: lang.lang.sale_rep"></span></td>
												<td>
													<input id="cbbEmployee" name="cbbEmployee"
														   data-role="combobox"
										                   data-value-primitive="true"
										                   data-header-template="employee-header-tmpl"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.employee_id,
										                              source: employeeDS"
										                   data-placeholder="Type Name..." 
										                   style="width: 100%" />
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"		   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Select job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">
							         	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p> 
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>              
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			               
				                <th style="width: 30%;"><span data-bind="text: lang.lang.account"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.reference"></span></th>			                
				                <th style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="customerDeposit-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row">
			
						<!-- Column -->
						<div class="span6">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
							
							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li> 
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

						</div>
						<!-- Column END -->


						
						<!-- Column -->
						<div class="span6">
							<table class="table table-borderless table-condensed cart_total">
								<tbody>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total"></span>:</td>
										<td class="right strong"><span data-bind="text: total"></span></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>
		           
		            <br>

					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>															
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="customerDeposit-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.customerDeposit.lineDS.indexOf(data)+1#			
		</td>				
		<td>
			<input id="cbbAccounts" name="cbbAccounts"
				   data-role="combobox"                   
                   data-value-primitive="true"
                   data-header-template="account-header-tmpl"                   
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: accountDS"
                   data-placeholder="Add Account.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>		
		<td class="" >
			<input id="txtAmount" name="txtAmount" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n" 
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%; text-align: right;" /> 						
		</td>			
    </tr>   
</script>
<script id="cashSale" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.cash_sale"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_received"></span></div>
									<h2 data-bind="text: amount_due" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i> Recuring</a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span>
													<span data-bind="text: balance"></span>
												</td>
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span>
													<span data-format="n" data-bind="text: obj.credit_allowed"></span>
												</td>
											</tr>
											<tr>
								            	<td><span data-bind="text: lang.lang.payment_method"></span></td>				
												<td>
													<input data-role="dropdownlist"
								              				data-value-primitive="true"
								              				data-header-template="customer-payment-method-header-tmpl"
															data-text-field="name" 
								              				data-value-field="id"
								              				data-bind="value: obj.payment_method_id,
								              							source: paymentMethodDS"
								              				data-option-label="Select method..."							              				 
								              				style="width: 100%" />
												</td>
											</tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.cash_account"></span></td>				            	
							            		<td>
							            			<input id="ddlCash" name="ddlCash"
							            				data-role="dropdownlist"
							            				data-header-template="account-header-tmpl"
							            				data-template="account-list-tmpl"
							              				data-value-primitive="true"
														data-text-field="name" 
							              				data-value-field="id"
							              				data-bind="value: obj.account_id,
							              							source: cashAccountDS"
							              				data-option-label="Select Account..." 
							              				required data-required-msg="required" 
							              				style="width: 100%" />
												</td>							            	
								            </tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.check_no"></span></td>							            	
							            		<td>
													<input class="k-textbox" placeholder="type check number ..." data-bind="value: obj.check_no" style="width: 100%;">
												</td>							            	
								            </tr>
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	                		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}"
								              				placeholder="Select Reference..." 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">
											<tr>
												<td><span data-bind="text: lang.lang.sale_rep"></span></td>
												<td>
													<input id="cbbEmployee" name="cbbEmployee"
														   data-role="combobox"
										                   data-value-primitive="true"
										                   data-header-template="employee-header-tmpl"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.employee_id,
										                              source: employeeDS"
										                   data-placeholder="Type Name..." 
										                   style="width: 100%" />
												</td>
											</tr>		            	
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"	   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">

							        	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>		
							            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						        
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			          
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.price"></span></th>
				                <th style="width: 10%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>	                
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.tax"></span></th>
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="cashSale-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount">
	  									<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>															
								</ul>
							</div>

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li> 	
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->
							
							<br><br>
							<div class="well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							</div>
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right"><span data-bind="text: tax"></span></td>
									</tr>						
									<tr>
										<td class="right" style="font-size:20px;"><span data-bind="text: lang.lang.total"></span></td>
										<td class="right strong" style="font-size:20px;" data-bind="text: total"></td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.deposit"></span>
											<span data-format="n" data-bind="text: total_deposit"></span>										
										</td>
										<td class="right">
											<input data-role="numerictextbox"
								                   data-format="n"
								                   data-spinners="false"
								                   data-min="0"							                                      
								                   data-bind="value: obj.deposit,
								                              events: { change: changes }"
								                   style="width: 90%; text-align: right;">
										</td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.remaining"></span>
										</td>
										<td class="right">
											<span data-bind="text: remaining"></span>
										</td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>											
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="cashSale-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.cashSale.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement" data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false" 
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
					data-header-template="tax-header-tmpl"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>				
    </tr>   
</script>
<script id="invoice" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.invoice"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"
												   data-auto-bind="false"											                    
								                   data-value-primitive="true"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_due"></span></div>
									<h2 data-bind="text: amount_due" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-5" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-5" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab5-5" data-toggle="tab"><i></i></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-5">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">							            
											<tr>
												<td>
													<span data-bind="text: lang.lang.balance"></span>
													<span data-bind="text: balance"></span>
												</td>
												<td>
													<span data-bind="text: lang.lang.credit_allowed"></span>
													<span data-format="n" data-bind="text: obj.credit_allowed"></span> 
												</td>
											</tr>
											<tr>
								            	<td>
								            		<span data-bind="text: lang.lang.term"></span>		            		
								            	</td>				
												<td>
													<input data-role="dropdownlist"														
								              				data-value-primitive="true"
															data-text-field="name" 
								              				data-value-field="id"	
								              				data-header-template='customer-term-header-tmpl'					              				 
								              				data-bind="value: obj.payment_term_id,
								              							source: paymentTermDS,
								              							events:{ change: setTerm }"
								              				data-option-label="Select Term..." 
								              				style="width: 100%" />
												</td>
											</tr>
								            <tr>
								            	<td><span data-bind="text: lang.lang.due_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	            		
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}"
								              				placeholder="Select Reference..." 
								              				style="width: 100%" />
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-5">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-5">
							        	
										<table class="table table-borderless table-condensed cart_total">
								            <tr>
												<td><span data-bind="text: lang.lang.sale_rep"></span></td>
												<td>
													<input id="cbbEmployee" name="cbbEmployee"
														   data-role="combobox"
										                   data-value-primitive="true"
										                   data-header-template="employee-header-tmpl"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.employee_id,
										                              source: employeeDS"
										                   data-placeholder="Type Name..." 
										                   style="width: 100%" />
												</td>
											</tr>						            	
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"								   
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"									                   				   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-5">

							        	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>		
							            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab5-5">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						            
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			  
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 13%;"><span data-bind="text: lang.lang.price"></span></th>
				                <th style="width: 1%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>			                
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 11%;"><span data-bind="text: lang.lang.tax"></span></th>			                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="invoice-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding-left: 10px">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount">
      									<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>															
								</ul>
							</div>

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  	
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->
							
							<br><br>
							<div class="well">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
								<br>						
								<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>
									<tr>
										<td class="right"><h4 span data-bind="text: lang.lang.total"></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.deposit"></span>
											<span data-format="n" data-bind="text: total_deposit"></span>										
										</td>
										<td class="right">
											<input data-role="numerictextbox"
								                   data-format="n"
								                   data-spinners="false"
								                   data-min="0"							                                      
								                   data-bind="value: obj.deposit,
								                              events: { change: changes }"
								                   style="width: 90%; text-align: right;">
										</td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.remaining"></span>
										</td>
										<td class="right">
											<span data-bind="text: remaining"></span>
										</td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>															
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->					

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="invoice-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.invoice.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement" data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false" 
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
					data-header-template="tax-header-tmpl"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>				
    </tr>   
</script>
<script id="gdn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>						
					</div>

			        <h2 data-bind="text: lang.lang.goods_delivery_note"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.total_quantity"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" style="height: 190px;">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons pen"><a href="#tab2-4" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab3-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons history"><a href="#tab4-4" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.recurring"></span></a>
							            </li>						            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-4">						            
							            <table class="table table-borderless table-condensed cart_total">											
								            <tr>
								            	<td><span data-bind="text: lang.lang.expected_date"></span></td>
								            	<td>
								            		<input id="txtDueDate" name="txtDueDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.due_date" 
															required data-required-msg="required"
															style="width:100%;" />
								            	</td>
								            </tr>							           
											<tr>							            				
												<td>
								            		<span data-bind="text: lang.lang.reference"></span>	            						  
								            	</td>
								            	<td>
													<input data-role="combobox"
															data-template="reference-list-tmpl"
															data-auto-bind="false"
								              				data-value-primitive="true"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							enabled: enableRef,
								              							source: referenceDS,						              							
								              							events:{change: referenceChanges}" 
								              				style="width: 100%" />
												</td>
											</tr>
											<tr>
												<td valign="top">
													<span data-bind="text: lang.lang.billing_address"></span>
												</td>
												<td>
													<textarea cols="0" rows="2" class="k-textbox"
															data-bind="value: obj.bill_to" 
															placeholder="Billing to ..." style="width:100%"></textarea>
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Memo Tab content -->
							        <div class="tab-pane" id="tab2-4">
							        	<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
										<br>						
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab3-4">
							         	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>	
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->						        

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab4-4">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						             
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		On
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->						        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			     
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.quantity"></span></th>			                			                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="gdn-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span4">	
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
							
							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  	
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

						</div>
						<!-- Column END -->

						<!-- Column -->
						<div class="span4" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span4">
							<table class="table table-condensed table-striped table-white">
								<tbody>																								
									<tr>
										<td class="right"><h4 span data-bind="text: lang.lang.total"></h4></td>
										<td class="right strong"><h4 data-format="n0" data-bind="text: obj.amount"></h4></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>															
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="gdn-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.gdn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement" data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>						
    </tr>   
</script>
<script id="saleReturn" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.sale_return"></h2>
				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 190px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>								
									<tr>
										<td><span data-bind="text: lang.lang.customers"></span></td>
										<td>
											<input id="cbbContact" name="cbbContact"
												   data-role="combobox"
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{ change: contactChanges }"
								                   data-placeholder="Type Name.."                    
								                   required data-required-msg="required" style="width: 100%" />
										</td>
									</tr>																															
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.amount_return"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>						
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" style="height: 190px;">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons pen"><a href="#tab2-4" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab3-4" data-toggle="tab"><i></i></a>
							            </li>						            
							            <li class="span1 glyphicons paperclip"><a href="#tab4-4" data-toggle="tab"><i></i></a>
							            </li>
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-4">						            
							            <table class="table table-borderless table-condensed cart_total">										
											<tr>							            				
												<td><span data-bind="text: lang.lang.related_invoices"></span></td>
								            	<td>
													<input data-role="combobox"														
															data-auto-bind="false"
								              				data-value-primitive="true"
								              				data-template="reference-list-tmpl"
															data-text-field="number" 
								              				data-value-field="id"						              				 
								              				data-bind="value: obj.reference_id,
								              							source: referenceDS,
								              							enabled: enableRef,						              							
								              							events:{change: referenceChanges}"
								              				placeholder="Select Invoice..." 
								              				style="width: 100%" />
												</td>
											</tr>			            	
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"									                   				   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>	
							            </table>						            
							        </div>
							        <!-- // Options Tab content E4D -->						        

							        <!-- Memo Tab content -->
							        <div class="tab-pane" id="tab2-4">
							        	<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
										<br>						
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab3-4">
							        	<span data-bind="text: lang.lang.billing_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.delivery_address"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->						        

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-4">
							        	<p><span data-bind="text: lang.lang.file_type"></span>: [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>
							            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th><span data-bind="text: lang.lang.file_name"></span></th>
									                <th><span data-bind="text: lang.lang.description"></span></th>
									                <th><span data-bind="text: lang.lang.date"></span></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->					        								        

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			      
				                <th><span data-bind="text: lang.lang.items"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.quantity"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.price"></span></th>
				                <th style="width: 10%;" data-bind="visible: showDiscount"><span data-bind="text: lang.lang.discount"></span></th>	                
				                <th style="width: 10%;"><span data-bind="text: lang.lang.amount"></span></th>
				                <th style="width: 10%;"><span data-bind="text: lang.lang.tax"></span></th>		                			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="saleReturn-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row">
			
						<!-- Column -->
						<div class="span9">
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbDiscount" class="k-checkbox" data-bind="checked: showDiscount" />												
										<label class="k-checkbox-label" for="chbDiscount"><span data-bind="text: lang.lang.discount"></span></label>
									</li>																
								</ul>
							</div>

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  	
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

							<br><br>					

							<table class="table table-bordered table-inverse table-striped table-vertical-center" data-bind="visible: showReturn">
						        <thead>
						            <tr>
						            	<th class="center" style="width: 1%;">
						            		<button type="button" data-role="button" data-bind="click: addRowOption"><i class="icon-plus"></i></button>
						            	</th>
						            	<th style="width: 30%"><span data-bind="text: lang.lang.type_of_return"></span></th>			
						                <th><span data-bind="text: lang.lang.condition"></span></th>					                	
						                <th style="width: 20%"><span data-bind="text: lang.lang.amount"></span></th>                          
						            </tr> 
						        </thead>
						        <tbody data-role="listview" 
						        		data-template="saleReturn-return-line-template" 
						        		data-auto-bind="false"
						        		data-bind="source: returnDS"></tbody>			        
						    </table>
														
						</div>
						<!-- Column END -->

						<!-- Column -->
						<!-- <div class="span3" align="center">
							<img data-bind="visible: isEdit, attr: { src: statusSrc }" width="150px;" height="150px;" />	
						</div> -->
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span3">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_tax"></span></td>
										<td class="right strong"><span data-bind="text: tax"></span></td>
									</tr>																
									<tr>
										<td class="right"><h4 span data-bind="text: lang.lang.total"></h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.amount_paid"></span>
										</td>
										<td class="right">
											<span data-format="n" data-bind="text: obj.amount_paid"></span>
										</td>
									</tr>
									<tr>
										<td class="right">
											<span data-bind="text: lang.lang.remaining"></span>
										</td>
										<td class="right">
											<span data-bind="text: remaining"></span>
										</td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>															
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
							</div>
						</div>
					</div>
					<!-- // Form actions END -->							

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="saleReturn-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.saleReturn.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement" data-role="dropdownlist"
					data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="measurement"
                   data-value-field="measurement_id"
                   data-bind="value: measurement_id,
                   			  source: item_prices,
                   			  events:{ change: measurementChanges }"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>					
		<td>
			<input id="txtPrice-#:uid#" name="txtPrice-#:uid#" 
					data-role="numerictextbox" 
					data-format="n"
					data-spinners="false"
					data-bind="value: price, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>					
		<td class="center" data-bind="visible: showDiscount">
			<input data-role="numerictextbox"
                   data-format="p0"
                   data-min="0"
                   data-max="0.99"
                   data-step="0.1"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 65px;">			
		</td>				
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>
		<td>
			<input id="ccbTaxItem" name="ccbTaxItem-#:uid#"
					data-header-template="tax-header-tmpl"
				   data-role="combobox"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: tax_item_id, 
                   			  source: taxItemDS,
                   			  events:{ change: changes }"
                   style="width: 100%" />			
		</td>						
    </tr>   
</script>
<script id="saleReturn-return-line-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: removeRowOption }"></i>					
		</td>			
		<td>
			<input id="ddlOption" name="ddlOption-#:uid#"
				   data-role="dropdownlist"				                      			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: type, 
                   			  source: optionList,
                   			  events:{ change: optionChanges }"
                   data-option-label="Select Option..." 
                   style="width: 100%" />            
		</td>
		<td>
			<input id="cbbInvoice" name="cbbInvoice-#:uid#"
				   data-role="combobox"
				   data-template="reference-list-tmpl"				                      			   
                   data-text-field="number"
                   data-value-field="id"
                   data-bind="value: reference_id, 
                   			  source: invoiceDS,
                   			  visible: showInvoice,
                   			  events:{ change: invoiceChanges }"
                   placeholder="Select Invoice..." 
                   style="width: 100%" />

            <input id="ddlAccount" name="ddlAccount-#:uid#"
				   data-role="dropdownlist"
				   data-template="account-list-tmpl"				                      			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id, 
                   			  source: accountDS,
                   			  visible: showAccount"                   
                   style="width: 100%" />            
		</td>						
		<td>
			<input id="txtAmount-#:uid#" name="txtAmount-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n"
					data-spinners="false"
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />
		</td>								
    </tr>   
</script>

<script id="statement" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content saleSummaryCustomer">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br><br>

					<div class="row-fluid">
						<!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">	
							    <!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>
										<li><a class="glyphicons print" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
							    <!-- // Tabs Heading END -->
								<div class="widget-body">
								    <div class="tab-content">

								    	<!-- //GENERAL INFO -->
								        <div class="tab-pane active" id="tab-1">									
									       <input id="cbbContact" name="cbbContact"
												   data-role="combobox"											                    
								                   data-value-primitive="true"
								                   data-auto-bind="false"
								                   data-header-template="contact-header-tmpl"
								                   data-template="contact-list-tmpl"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: contact_id,
								                              source: contactDS"
								                   data-placeholder="Customer..." />

											<input data-role="dropdownlist"
												   class="sorter"                  
										           data-value-primitive="true"
										           data-text-field="text"
										           data-value-field="value"
										           data-bind="value: sorter,
										                      source: sortList,                              
										                      events: { change: sorterChanges }" />

											<input data-role="datepicker"
												   class="sdate"
												   data-format="dd-MM-yyyy"
										           data-bind="value: sdate,
										           			  max: edate"
										           placeholder="From ..." >

										    <input data-role="datepicker"
										    	   class="edate"
										    	   data-format="dd-MM-yyyy"
										           data-bind="value: edate,
										                      min: sdate"
										           placeholder="To ..." >

										  	 <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //ACCOUNTING -->
								        <!--div class="tab-pane" id="tab-2">
								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div-->
								        <!-- //ACCOUNTING END -->						       

								       
								    </div>
								</div>
							</div>
						</div>
					
					</div>

					<br><br>
					
					<div class="block-title">
						<h3 data-bind="text: company.name"></h3>
						<h2 data-bind="text: lang.lang.statement"></h2>
						<p data-bind="text: obj.name"></p>
						<p data-bind="text: displayDate"></p>
					</div>

					<div class="row-fluid" >
						<div class="span5" style="margin-bottom: 15px;">
							<table class="table-statement" style="margin-top: 0;">
								<tr>
									<td style="font-weight: 600;background-color: #ddd;">Customer Info</td>
								</tr>
								<tr>
									<td data-bind="text: obj.bill_to"></td>
								</tr>
							</table>
						</div>
						<div class="span2"></div>
						<div class="span5" style="margin-bottom: 15px;">
							<div class="strong" style="margin-bottom: 0px; width: 100%; padding: 10px; background-color: rgb(213, 219, 219);" align="center" >
									<div align="left"><span>Amount Due</span></div>
									<h2 align="right" data-bind="text: total"></h2>
								</div>
						</div>

					</div>				
					
					<table class="table table-borderless table-condensed">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type"></span></th>
								<th><span data-bind="text: lang.lang.job"></span></th>
								<th><span data-bind="text: lang.lang.reference_no"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
								<th><span data-bind="text: lang.lang.balance"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
							data-auto-bind="false"
							data-bind="source: dataSource"
							data-template="statement-row-template"
						></tbody>
					</table>

					<table class="table-statement">
						<thead>
							<tr>
								<th class="center"><span data-bind="text: lang.lang.current"></span></th>
								<th class="center">30</th>
								<th class="center">60</th>
								<th class="center">90</th>
								<th class="center">> 90</th>
								<th class="center"><span data-bind="text: lang.lang.amount_due"></span></th>
							</tr>
						</thead>
						<tbody data-role="listview"
							data-auto-bind="false"
							data-bind="source: agingDS"
							data-template="statement-aging-row-template"
						></tbody>
					</table>
				</div>							
			</div>
		</div>
	</div>
</script>
<script id="statement-row-template" type="text/x-kendo-template" >
	<tr>
		<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
		<td>#=type#</td>
		<td>#=job#</td>
		<td>#=reference_no#</td>		
		<td align="right">#=kendo.toString(amount, "c", locale)#</td>
		<td align="right">#=kendo.toString(balance, "c", locale)#</td>
	</tr>
</script>
<script id="statement-aging-row-template" type="text/x-kendo-template" >
	<tr>
		<td align="right">#=kendo.toString(current, "c", locale)#</td>
		<td align="right">#=kendo.toString(oneMonth, "c", locale)#</td>
		<td align="right">#=kendo.toString(twoMonth, "c", locale)#</td>
		<td align="right">#=kendo.toString(threeMonth, "c", locale)#</td>		
		<td align="right">#=kendo.toString(overMonth, "c", locale)#</td>
		<td align="right">#=kendo.toString(amount, "c", locale)#</td>
	</tr>
</script>


<script id="customerSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2 data-bind="text: lang.lang.general_customer_setting"></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.customer_type"></span></span></a>

	            </li>
	            <li><a href="#tab2-4" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.payment_method"></span></span></a>
	            </li>
	            <li><a href="#tab3-4" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.payment_terms"></span></span></a>
	            </li>
	            <li><a href="#tab4-4" class="glyphicons list" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.custom_forms"></span></span></a>
	            </li>	                        
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- CUSTOMER TYPE -->
	            <div class="tab-pane active" id="tab1-4">
	            	<div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="input customer type ..." data-bind="value: contactTypeName">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="input abbr ..." data-bind="value: contactTypeAbbr">
					    <select class="span3" id="appendedInputButtons" data-bind="value: contactTypeCompany" >
			                <option value="0"><span data-bind="text: lang.lang.not_a_company"></span></option>
			                <option value="1"><span data-bind="text: lang.lang.it_is_a_company"></span></option>			                
			            </select>
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_type"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th class="center"><span data-bind="text: lang.lang.type"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.abbr"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.is_company"></span></th>
	            				<th class="center"></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-contact-type-template"
				                data-template="customerSetting-contact-type-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // CUSTOMER TYPE END -->

	            <!-- PAYMENT METHOD -->
	            <div class="tab-pane" id="tab2-4">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_method"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th class="center"><span data-bind="text: lang.lang.name"></span></th>
	            				<th class="center"></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-method-template"
				                data-template="customerSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div>
	            <!-- // PAYMENT METHOD END -->

	            <!-- PAYMENT TERM -->
	            <div class="tab-pane" id="tab3-4">
            		<div class="input-append">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentTermName">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="net due ..." data-bind="value: paymentTermNetDue">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="period ..." data-bind="value: paymentTermPeriod">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="% ..." data-bind="value: paymentTermPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_term"></span></button>
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th class="center"><span data-bind="text: lang.lang.name"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.net_due"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.discount_period"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.discount_percentage"></span></th>
	            				<th class="center"></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-term-template"
				                data-template="customerSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div>
	            <!-- // PAYMENT TERM END -->

	            <!-- Tab Invocice Custom content -->
	            <div class="tab-pane" id="tab4-4">
            		
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr class="widget-head">
	            				<th class="center"><span data-bind="text: lang.lang.name"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.form_type"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.last_edited"></span></th>
	            				<th class="center"><span data-bind="text: lang.lang.action"></span></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
								 data-selectable="false"
				                 data-template="customerSetting-form-template"
				                 data-bind="source: txnTemplateDS">				            
	            		</tbody>
	            	</table>

	            	<a id="addNew" class="btn-icon btn-primary glyphicons ok_2" data-bind="click: goInvoiceCustom" style="width: 110px;"><i></i>Add New</a>

	            </div>
	            <!-- // Tab Invoice Custom content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="customerSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">
    		#:abbr#
   		</td>
   		<td align="center">
    		#if(is_company=="1"){#
    			Yes
    		#}else{#
    			No
    		#}#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#
		        <span class="k-button" data-bind="click: goPattern"><span data-bind="text: lang.lang.pattern"></span></span>
		   	</div>		   	
   		</td>   		
   	</tr>
</script>
<script id="customerSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <dl>                
            <dd>
                <select data-bind="value: is_company" >
	                <option value="0"><span data-bind="text: lang.lang.not_a_company"></span></option>
	                <option value="1"><span data-bind="text: lang.lang.it_is_a_company"></span></option>			                
	            </select>
            </dd>              
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="customerSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#		        
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="customerSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="customerSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">
    		#:net_due#
   		</td>
   		<td align="center">
    		#:discount_period#
   		</td>
   		<td align="center">
    		#:discount_percentage#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#		        
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="customerSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:net_due" name="netDue" required="required" validationMessage="required" />
                <span data-for="netDue" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_period" name="period" required="required" validationMessage="required" />
                <span data-for="period" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_percentage" name="percentage" required="required" validationMessage="required" />
                <span data-for="percentage" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="customerSetting-form-template" type="text/x-kendo-template">
	<tr>
		<td ><a style="text-align: left;" href="\\#/invoice_custom/#= id # "> #=name#  </a></td>
		<td style="text-align: center; padding-left: 10px!important;"> 
			#= type.replace("_"," ")# 
		</td>
		<td class="center"> #if( updated_at ){ # 
				#=kendo.toString(new Date(updated_at),"D")# 
			 #}else{ #
			 	#=kendo.toString(new Date(created_at),"D")# 
			 #}#
		</td>
		<td class="center">
			#if( status == 0){ #
			<a class="btn-action glyphicons pencil btn-success" href="\\#/invoice_custom/#= id # "><i></i></a>
			<a data-bind="click: deleteForm" class="btn-action glyphicons remove_2 btn-danger"><i></i></a>
			# } #
		</td>
	</tr>
</script>

<script id="job" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<div class="hidden-print">
				    	<div class="pull-right">

				    		<span class="glyphicons no-js remove_2" 
								data-bind="click: cancel"><i></i></span>						
						</div>

				        <h2 data-bind="text: lang.lang.job"></h2>				        				        				        	
				    </div>			   

				    <br>

				    <div data-role="window"
		                 data-title="Job"		                 
		                 data-width="600"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '30%'}"
		                 data-height="300"
		                 data-bind="visible: isVisible">

						<table class="table table-bordered table-primary table-striped table-vertical-center">							
							<tr>
								<td><span data-bind="text: lang.lang.name"></span></td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Description</td>
								<td>
									<input class="k-textbox" placeholder="type description ..." data-bind="value: obj.description" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td><span data-bind="text: lang.lang.customers"></span></td>
								<td>
									<input data-role="combobox"
										   data-template="contact-list-tmpl"				            			               			   		                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.contact_id,
						                              source: contactDS"
						                   style="width: 100%;" />
								</td>
							</tr>							
						</table>

						<br>

						<div align="center">
							<span class="btn btn-icon btn-primary glyphicons ok_2" data-bind="click: save" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-icon btn-danger glyphicons remove_2" data-bind="click: closeWindow" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.close"></span></span>						
						</div>
					</div>
					
					<button style="margin-bottom: 15px;" class="btn btn-inverse" data-bind="click: openWindow"><i class="icon-plus icon-white"></i> <span data-bind="text: lang.lang.add_new_job"></span></button>
					                                					

	            	<table class="table table-bordered table-primary table-striped table-vertical-center">
	            		<thead style="background-color: blue; color: #fff; font-weight: bold">
	            			<tr>	            				
	            				<th><span data-bind="text: lang.lang.name"></span></th>
	            				<th><span data-bind="text: lang.lang.description"></span></th>
	            				<th><span data-bind="text: lang.lang.customers"></span></th>	            					 			
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"			            			
				                data-template="job-template"
				                data-bind="source: dataSource"></tbody>
	            	</table>
	            </div>	            						
			</div>
		</div>
	</div>
</script>
<script id="job-template" type="text/x-kendo-tmpl">                    
    <tr>    	
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>
    		#if(contact.length>0){#
    			#if(contact[0].company){#
    				#=contact[0].company#
    			#}else{#
    				#=contact[0].surname# #=contact[0].name#
    			#}#
    		#}#
    	</td>    	
    	<td align="center">
    		<span data-bind="click: edit"><i class="icon-edit"></i> <span data-bind="text: lang.lang.edit"></span></span>
    		|
    		<span data-bind="click: delete"><i class="icon-remove"></i> <span data-bind="text: lang.lang.delete"></span></span>
    	</td>
   	</tr>
</script>

<script id="customerReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">

		<div class="span7">
			<div class="row-fluid sale-report">				
				<h2>SALE MANAGEMENT REPORTS</h2>
				<p>
					The following reports provide summary and detailed reports in 
					different ways to help analyze your revenue performance.
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td width="50%">
								<h3><a href="#/sale_summary_customer">Sale Summary by Customer</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/customer_transaction_list">Customer Transaction List</a></h3>								
							</td>						
						</tr>
						<tr>
							<td width="50%">
								<p>
									Summarizes total sales for each customer within a period 
									of time so you can see which ones generate the most revenue for you.
								</p>
								
							</td>
							<td width="50%">
								<p>
									List of all transactions related to and grouped by each customer, including invoice, cash sale
								</p>
							</td>
							
						</tr>
						<tr>
							<td width="50%">
								<h3><a href="#/sale_detail_customer">Sale Detail by Customer</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/deposit_detail_customer">Deposit Detail by Customer</a></h3>
							</td>
						</tr>
						<tr>
							<td width="50%">
								<p>
									Lists individual sale transactions by date for each customer with a period of time.
								</p>
							</td>
							<td width="50%">
								<p>
									Provides detailed information about customer deposit for specific order, prepayment, or credit.
								</p>
							</td>
						</tr>

						<tr>
							<td width="50%">
								<h3><a href="#/sale_summary_product">Sale Summary by Product/ Services</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/sale_detail_product">Sale Detail by Product/ Services</a></h3>
							</td>
						</tr>
						<tr>
							<td width="50%">
								<p>
									Summarizes total sales for each product/ service within a period of time. In addition, it also includes gross profit margin, quantity, amount, cost, and average prices. 
								</p>
							</td>
							<td width="50%">
								<p>
									Lists individual sale transactions by date for each product/ service with a period of time.
								</p>
							</td>
						</tr>
						<tr>
							<td width="50%">
								<h3><a href="#/sale_job_engagement">Sale by Job/Engagement</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/sale_order_list">Sale Order List</a></h3>
							</td>
						</tr>
					</table>
				</div>
			</div>

			<div class="row-fluid recevable-report">

				<h2 data-bind="text: lang.lang.receivable_management_reports"></h2>

				<p>
					The following reports provide summary and detailed reports.
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td >
								<h3><a href="#/customer_balance_summary">Customer Balance Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/customer_balance_detail">Customer Balance Detail</a></h3>								
							</td>						
						</tr>
						<tr>
							<td>
								<p>
									Show each customer’s total outstanding balances.
								</p>
								
							</td>
							<td >
								<p>
									Lists individual unpaid invoices for each customer
								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/receivable_aging_summary">Receivable Aging Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/receivable_aging_detail">Receivable Aging Detail</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists all unpaid invoices for the current period, 30, 60, 90, 
									and more than 90 days, grouped by individual customers.
								</p>
							</td>
							<td >
								<p>
									Lists individual unpaid invoices, grouped by customer. This includes due date, 
									outstanding days (aging days), and amount.
								</p>
							</td>
						</tr>

						<tr>
							<td >
								<h3><a href="#/list_invoices_collect">List of invoices to be collected</a></h3>
							</td>
							<td >
								<h3><a href="#/collect_report">Collection Report</a></h3>
							</td>
						</tr>
						<tr>
							<td>
								<p>
									Lists all unpaid invoices, grouped by Due today and Overdue.
								</p>
							</td>
							<td >
								<p>
									Lists of collected invoices for the select period of time, group by method of payment.
								</p>
							</td>
						</tr>

						<tr>
							<td >
								<h3><a href="#/invoice_list">Invoice List</a></h3>
							</td>
							<td >
								<h3><a href="#/customer_list">Customer List</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Shows a chronological list of all your invoices for a selected date range.
								</p>
							</td>
							<td >
								<p>
									List of all active customers
								</p>
							</td>
						</tr>

					</table>
				</div>
			</div>
			
			<div class="row-fluid recevable-report">
				<h2>OTHER REPORTS/ LISTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td style="width: 48%; padding-right: 8px !important;">
								<h3><a href="#/customer_recurring">Recurring Customer Template List</a></h3>
							</td>
							<td >
								<h3><a href="#/customer_setting">Payment Method & Term List</a></h3>								
							</td>						
						</tr>
						<tr>
							<td style="width: 48%; padding-right: 8px !important;">
								<p></p>								
							</td>
							<td>
								<p>
									List the types of payments and the term that determine due date for payment from customers.
								</p>
							</td>
							
						</tr>
						<tr >
							<td></td>														
						</tr>

					</table>
				</div>
			</div>
		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart">
				<div class="widget-body alert alert-primary sale-overview">
					<h2>SALE OVERVIEW</h2>
					<div align="center" class="text-large strong" data-bind="text: sale"></div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span data-bind="text: sale_customer"></span>
								<br>
								<span>Customer</span>
							</td>
							<td>
								<span data-bind="text: sale_product"></span>
								<br>
								<span>Product</span>
							</td>
							<td>
								<span data-bind="text: order"></span>
								<br>
								<span>Order</span>
							</td>
							<td >
								<span data-bind="text: sale_order"></span>
								<br>
								<span>Sale Order</span>
							</td>

						</tr>
					</table>
				</div>
				<!-- Graph -->
				<div class="home-chart">
					<div data-role="chart"
		                 data-legend="{ position: 'top' }"
		                 data-series-defaults="{ type: 'column' }"
		                 data-tooltip='{
		                    visible: true,
		                    format: "{0}%",
		                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
		                 }'                 
		                 data-series="[
		                                 { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#236DA4' },
		                                 { field: 'order', name: 'Monthly Order', categoryField:'month', color: '#A6C9E3' }
		                             ]"	                             
		                 data-bind="source: graphDS"
		                 style="height: 250px;" ></div>
	            <!-- End Graph -->
	            </div>
			</div>
			<div class="report-chart">
				<div class="widget-body receivable-overview" style="background-color: LightGray">
					<h2>RECEIVABLES MANAGEMENT</h2>
					<div align="center" class="text-large strong" data-bind="text: ar"></div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span data-bind="text: ar_open"></span>
								<br>
								<span>Open</span>
							</td>
							<td>										
								<span data-bind="text: ar_customer"></span>
								<br>
								<span>Customer</span>
							</td>
							<td>
								<span data-bind="text: ar_overdue"></span>
								<br>
								<span>Overdue</span>
							</td>
							<td>
								<span data-bind="text: collection_day"></span> days
								<br>
								<span>Collection Days</span>
							</td>
						</tr>
					</table>
				</div>
				<!-- Graph -->
				<div class="home-chart">
					<div data-role="chart"
		                 data-legend="{ position: 'top' }"
		                 data-series-defaults="{ type: 'column' }"
		                 data-tooltip='{
		                    visible: true,
		                    format: "{0}%",
		                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
		                 }'                 
		                 data-series="[
		                                 { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#236DA4' },
		                                 { field: 'order', name: 'Monthly Order', categoryField:'month', color: '#A6C9E3' }
		                             ]"	                             
		                 data-bind="source: graphDS"
		                 style="height: 250px;" ></div>
	            <!-- End Graph -->
            </div>
			</div>
		</div>
	</div>
</script>
<script id="saleSummaryCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: saleSummary.search"><i class="icon-search"></i></button>							
									    </div>							        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale Summary by Customer</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Customer</p>
									<span data-bind="text: count"></span>
								</div>

							</div>
							<div class="span7">
								<div class="total-sale">
									<p>Total Sale</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>
						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Customer</span></th>
									<th><span>Total Sale</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="sale-summary-tmpl"
					                data-bind="source: saleSummary.dataSource" >
					        </tbody>
		            	</table>
		            </div>
				</div>
			</div>
		</div>
	</div>	
</script>
<script id="sale-summary-tmpl" type="text/x-kendo-template">
	<tr>
		<td>#=customer#</td>
		<td align="right">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="customerTransactionList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: customerTransaction.search"><i class="icon-search"></i></button>							
									    </div>							        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Customer Transaction List</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Customer</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Cash Receipt</p>
										<span data-bind="text: totalCashReceipt"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-sale">
									<div class="span6">
										<p>Total Sale</p>
										<span data-bind="text: total"></span>
									</div>
									<div class="span6">
										<p>Customer Balance</p>
										<span data-bind="text: customerBalance"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Amount</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: customerTransaction.dataSource"
										 data-template="customertransactionlist-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="3">Total</th>
									<th colspan="4"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="customertransactionlist-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="saleDetailCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: detailSummary.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale Detail by Customer</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Customers</p>
									<span data-bind="text: count"></span>
								</div>

							</div>
							<div class="span7">
								<div class="total-sale">
									<p>Total Sale</p>
									<span data-bind="text: total"></sapn>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Item/service</span></th>
									<th><span>Qty</span></th>
									<th><span>Price</span></th>
									<th><span>Amount</span></th>
								</tr>
							</thead>
							<tbody data-role="listview" data-bind="source: detailSummary.dataSource" data-auto-bind="false" data-template="saleDetailCustomerReportItem">
							</tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="4"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<br>
	<hr>
	<br>
</script>
<script id="saleDetailCustomerReportItem" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			#for(var x = 0; x < items[i].lines.length; x++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].lines[x].name#</td>
				<td>#=items[i].lines[x].quantity#</td>
				<td align="right">#=kendo.toString(items[i].lines[x].price, 'c2')#</td>
				<td align="right">#=kendo.toString(items[i].lines[x].amount, 'c2')#</td>
			</tr>
			#}#
		#}#
	#}#
	<tr style="font-weight: 700;">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>	
<script id="saleSummaryProduct" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: summaryProductSale.search"><i class="icon-search"></i></button>							
									    </div>
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale Summary by Product/Services</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Product/services</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>AVG Sale</p>
										<span data-bind="text: total_avg"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Sale</p>
										<span data-bind="text: total_sale"></span>
									</div>
									<div class="span6">
										<p>Gross Profit Margin</p>
										<span data-bind="text: gpm"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>ITEM</span></th>
									<th><span>QTY</span></th>
									<th><span>AMOUNT</span></th>
									<th><span>AVG PRICE</span></th>
									<th><span>COST</span></th>
									<th><span>GROSS PROFIT MARGIN</span></th>								
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: summaryProductSale.dataSource"
										 data-template="saleSummary-product-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="4"><span data-bind="text: total_sale"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="saleSummary-product-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td>#=qty#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(avg_price, 'c2')#</td>	
		<td style="text-align: right;">#=kendo.toString(cost, 'c2')#</td>	
		<td style="text-align: right;">#=kendo.toString(gross_profit_margin, 'p')#</td>			
	</tr>
</script>
<script id="depositDetailCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: depositDetail.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Deposit Detail By Customer</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Number of Customer Deposit</p>
									<span data-bind="text: count"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Customer Deposit Balance</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Memo</span></th>
									<th><span>Amount</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: depositDetail.dataSource"
										 data-template="cusotmerDeposit-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="3"> <span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="cusotmerDeposit-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].memo#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: 700;">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="saleDetailProduct" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: detailCustomerSale.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale Detail by Product/Service</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Product/services</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Number of Product Sale</p>
										<span data-bind="text: productSale"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">									
									<p>Total Sale</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Memo</span></th>
									<th><span>QTY</span></th>
									<th><span>PRICE</span></th>
									<th><span>AMOUNT</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: detailCustomerSale.dataSource"
										 data-template="productSale-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="productSale-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].memo#</td>
				<td>#=kendo.toString(items[i].qty, 'n0')#</td>
				<td>#=kendo.toString(items[i].price, 'c2')#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<!-- <tr style="font-weight: bold; color: red">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>		
	</tr> -->
</script>
<script id="customerBalanceSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: summaryBalance.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Customer Balance Summary</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Customer</p>
										<span data-bind="text: customerCount"></span>
									</div>
									<div class="span6">
										<p>Number Customer</p>
										<span data-bind="text: count"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Customer Balance</p>
										<span data-bind="text: total"></span>
									</div>
									<div class="span6">
										<p>Open Invoice</p>
										<span data-bind="text: openInvoice"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>CUSTOMER NAME</span></th>
									<th><span>ACCOUNT RECEIVABLE BALANCE</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="balance-summary-tmpl"
					                data-bind="source: summaryBalance.dataSource" >
					        </tbody>
		            	</table>
		            </div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="balance-summary-tmpl" type="text/x-kendo-template">
	<tr>
		<td>#=customer#</td>
		<td align="right">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>	
<script id="customerBalanceDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: saleDetail.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Customer Balance Detail</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Customer</p>
										<span data-bind="text: customerCount"></span>
									</div>
									<div class="span6">
										<p>Number Customer</p>
										<span data-bind="text: count"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Total Customer Balance</p>
										<span data-bind="text: total"></span>
									</div>	
									<div class="span6">
										<p>Open Invoice</p>
										<span data-bind="text: openInvoice"></span>
									</div>							
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>								
									<th><span>AMOUNT</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: saleDetail.dataSource"
										 data-template="customerBalanceDetail-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="3">Total</th>
									<th colspan="1"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="customerBalanceDetail-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>			
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
</script>
<script id="receivableAgingSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: receivableAging.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Receivable Aging Summary</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Customer</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Average Aging</p>
										<span data-bind="text: aging"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Customer Balance</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Name</span></th>
									<th><span>CURRENT</span></th>
									<th><span>1-30</span></th>
									<th><span>31-60</span></th>
									<th><span>61-90</span></th>
									<th><span>OVER 90</span></th>
									<th><span>TOTAL</span></th>							
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: receivableAging.dataSource"
										 data-template="receivableAginglist-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="receivableAginglist-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td>#=kendo.toString(underThirty, 'c2')#</td>
		<td>#=kendo.toString(thirty, 'c2')#</td>
		<td>#=kendo.toString(sixty, 'c2')#</td>
		<td>#=kendo.toString(ninety, 'c2')#</td>
		<td>#=kendo.toString(overNinety, 'c2')#</td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="receivableAgingDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: receivableDetail.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Receivable Aging Detail</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Total Customer Balance</p>
									<span data-bind="text: total"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number of Customer</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Average Aging</p>
										<span data-bind="text: aging"></span>	
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>Due Date</span></th>
									<th><span>No</span></th>
									<th><span>Aging</span></th>
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: receivableDetail.dataSource"
										 data-template="receivableAgingDetaillist-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="3">Total</th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="receivableAgingDetaillist-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				# var dueDate = kendo.toString(new Date(items[i].dueDate),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>#=dueDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].outstanding# days</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: black">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="listInvoicesCollect" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: listInvoicesCollect.search"><i class="icon-search"></i></button>							
									    </div>									        								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>List Invoices Collect</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">								
									<p>Total Sale</p>
									<span data-bind="text: total"></span>								
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number of Customer Balance</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Average Aging</p>
										<span data-bind="text: aging"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>Name</span></th>
									<th><span>No</span></th>									
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: listInvoicesCollect.dataSource"
										 data-template="listInvoicesCollectlist-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="2">Total</th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="listInvoicesCollectlist-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>#=items[i].name#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>				
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: \#000;">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="collectReport" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: collectReportDB.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: institute.name"></h3>
							<h2>Collect Report</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
										<p>Total Sale</p>
										<span data-bind="text: total"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number of Customer</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Number</p>
										<span data-bind="text: totalInvoice"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: collectReportDB.dataSource"
										 data-template="collectReportlist-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="3">Total</th>
									<th colspan="5"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="collectReportlist-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: \#000;">
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="invoiceList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">
			    	<span class="pull-right glyphicons no-js remove_2"
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: invoiceListDB.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Invoice List</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">									
									<p>Customer Balance</p>
									<span data-bind="text: totalCreditSale"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<div class="span6">
										<p>Number of Customer</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Number Invoice</p>
										<span data-bind="text: totalInvoice"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Due Date</span></th>
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: invoiceListDB.dataSource"
										 data-template="invoice-list-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="4"><span data-bind="text: totalBalance"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>
<script id="invoice-list-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				# var due_date = kendo.toString(new Date(items[i].due_date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=due_date#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: black;">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="customerList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content">
					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<input data-role="dropdownlist"
						   data-option-label="Select Type..."		                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: contact_type_id,
		                              source: contactTypeDS" />

		                <input data-role="dropdownlist"
						   data-option-label="Select Status..."		                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: status,
		                              source: statusList" />

						<button id="search" type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>		
					</div>

					<h3 align="center" data-bind="text: lang.lang.customer_list"></h3>

					<br>
			
					<div data-role="grid"
						 data-groupable="true"
						 data-sortable="true"
						 data-pageable="true"			                 		                 
		                 data-columns="[
                             { field: 'number', title:'Number' },
                             { field: 'surname', title:'Surname' },
                             { field: 'name', title:'Name' },
                             { field: 'contact_type_id', title:'Type', template:'#=contact_type#' },
                             { field: 'phone', title:'Phone' },
                             { field: 'status', title:'Status', template:'#=status==1?&quot;Active&quot;:&quot;Inactive&quot;#' }
                                                       ]"
		                 data-bind="source: dataSource"></div>

				</div> <!-- //End div example-->				
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="customerBalance" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content">									

					<div class="box-generic hidden-print">
						
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						Type:
						<input data-role="dropdownlist"
						   data-option-label="Select Type..."		                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: contact_type_id,
		                              source: contactTypeDS" />

		                Status:
		                <input data-role="dropdownlist"
						   data-option-label="Select Status..."		                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: status,
		                              source: statusList" />

		                As of Date:
		                <input data-role="datepicker"	                       
		                   data-format="dd-MM-yyyy"
		                   data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: date"
		                   placeholder="Pick A Date..." />

						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>		
					</div>

					<br>

					<h3 align="center">Customer Balance</h3>

					<br>

					<div class="row-fluid row-merge">
						<div class="col-md-6">
							<div class="innerAll padding-bottom-none-phone">
								<a href="" class="widget-stats widget-stats-gray widget-stats-4">
									<span class="txt">Total Customer </span>
									<span class="count" data-format="n0" data-bind="text: dataSource.total()"></span>
									<span class="glyphicons user"><i></i></span>
									<div class="clearfix"></div>
									<i class="icon-play-circle"></i>
								</a>
							</div>
						</div>						
						<div class="col-md-6">
							<div class="innerAll padding-bottom-none-phone">
								<a href="" class="widget-stats widget-stats-primary widget-stats-4">
									<span class="txt">Total Balance As Of <span data-format="dd-MM-yyyy" data-bind="text: date"></span> </span>
									<span class="count" data-bind="text: total"></span>
									<span class="glyphicons coins"><i></i></span>
									<div class="clearfix"></div>
									<i class="icon-play-circle"></i>
								</a>
							</div>
						</div>												
					</div>

					<br>					
			
					<div data-role="grid"
						 data-auto-bind="false"
						 data-groupable="true"
						 data-sortable="true"
						 data-pageable="true"			                 		                 
		                 data-columns="[
                            { field: 'number', title:'Number' },
                            { field: 'fullname', title:'Name' },                             
                            { field: 'contact_type_id', title:'Type', template:'#=contact_type#' },
                            { field: 'balance', title:'Balance', 
                            	template:'#=kendo.toString(balance, &quot;c0&quot;, banhji.locale)#', 
                            	attributes:{style:'text-align:right;'} 
                            }
                         ]"
		                 data-bind="source: dataSource"></div>

				</div> <!-- //End div example-->				
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>

<script id="saleJobEngagement" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: saleJob.search"><i class="icon-search"></i></button>							
									    </div>									        						       
								    </div>
								</div>
							</div>
						</div>
					</div>	
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale by Job/Engagement</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Total Sale</p>
										<span data-bind="text: saleNumber"></span>
									</div>
									<div class="span6">
										<p>Number of Customer</p>
										<span data-bind="text: count"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
										<p>Customer Balance</p>
										<span data-bind="text: total"></span>							
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Date</span></th>
									<th><span>No</span></th>
									<th><span>Memo</span></th>
									<th><span>Segment</span></th>
									<th><span>Amount</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: saleJob.dataSource"
										 data-template="saleJobEngagement-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="3"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>					
					</div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="saleJobEngagement-temp" type="text/x-kendo-template" >
	# kendo.culture(banhji.customerSale.locale); #
	<tr style="font-weight: bold">
		<td>#=group#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (items.length) {#
		#for(var i= 0; i <items.length; i++) {#
			<tr>
				# var myDate = kendo.toString(new Date(items[i].date),'dd-MM-yyyy'); #
				<td>&nbsp;&nbsp;#=items[i].type#</td>
				<td>#=myDate#</td>
				<td>
					<a href="\#/#=items[i].type.toLowerCase()#/#=items[i].id#">#=items[i].number#</a>
				</td>
				<td>#=items[i].memo#</td>

				<td>#if (items[i].segments.length){#
					#for (var x=0; x<items[i].segments.length; x++) {#
						#=items[i].segments[x].code#
						<br>

					#}#
				#}#</td>
				<td style="text-align: right;">#=kendo.toString(items[i].amount, 'c2')#</td>
			</tr>

		#}#
	#}#
	<tr style="font-weight: bold; color: red">
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right;">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>
<script id="saleOrderList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>
					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: saleOrderDB.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Sale Order List</h2>
							<p>From <span data-bind="text: displayDateStart"></span> to <span data-bind="text: displayDateEnd"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Customer Order</p>
										<span data-bind="text: customer"></span>
									</div>
									<div class="span6">
										<p>Order</p>
										<span data-bind="text: order"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">									
									<div class="span6">
										<p>Amount Order</p>
										<span data-bind="text: total"></span>
									</div>
									<div class="span6">
										<p>QTY Order</p>
										<span data-bind="text: totalQty"></span>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Customer Name</span></th>
									<th><span>Date</span></th>
									<th><span>Sale Order</span></th>
									<th><span>Item</span></th>									
									<th><span>QTY</span></th>
									<th><span>Price</span></th>
									<th><span>Balance</span></th>
								</tr>
							</thead>
							<tbody data-role="listview"
										 data-bind="source: saleOrderDB.dataSource"
										 data-template="saleOrder-list-temp"
							></tbody>
							<tfoot>
								<tr>
									<th colspan="4">Total</th>
									<th colspan="4"><span data-bind="text: total"></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="saleOrder-list-temp" type="text/x-kendo-template">
	# kendo.culture(banhji.customerSale.locale); #
	<tr>
		# var myDate = kendo.toString(new Date(date),'dd-MM-yyyy'); #
		<td>#=customer#</td>
		<td>#=myDate#</td>
		<td>
			<a href="\#/#=type.toLowerCase()#/#=id#">#=SO#</a>
		</td>
		<td>#=item#</td>		
		<td>#=kendo.toString(qty, 'n')#</td>
		<td align="right">#=kendo.toString(price, 'c2')#</td>
		<td align="right">#=kendo.toString(amount, 'c2')#</td>
	</tr>
</script>

<script id="customerRecurring" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<div class="hidden-print">
				    	<div class="pull-right">

				    		<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>						
						</div>

				        <h2>Customer Recurring</h2>				        				        				        	
				    </div>			   

				    <br>

				    <div data-role="window"
		                 data-title="Job"		                 
		                 data-width="600"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '30%'}"
		                 data-height="300"
		                 data-bind="visible: isVisible">

						<table class="table table-bordered table-primary table-striped table-vertical-center">							
							<tr>
								<td>Name</td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Description</td>
								<td>
									<input class="k-textbox" placeholder="type description ..." data-bind="value: obj.description" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Customer</td>
								<td>
									<input data-role="combobox"
										   data-template="contact-list-tmpl"				            			               			   		                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.contact_id,
						                              source: contactDS"
						                   style="width: 100%;" />
								</td>
							</tr>							
						</table>

						<br>

						<div align="center">
							<span class="btn btn-icon btn-primary glyphicons ok_2" data-bind="click: save" style="width: 80px;"><i></i> Save</span>
							<span class="btn btn-icon btn-danger glyphicons remove_2" data-bind="click: closeWindow" style="width: 80px;"><i></i> Close</span>						
						</div>
					</div>
					
					                           					
	            	<table class="table table-bordered table-primary table-striped table-vertical-center">
	            		<thead style="background-color: blue; color: #fff; font-weight: bold">
	            			<th style="width: 1%;">No.</th>
			                <th>TEMPLATE NAME</th>
			                <th>NAME</th>
			                <th class="center" style="width: 10%">TYPE</th>
			                <th class="center">START DATE</th>
			                <th class="center">FREQUENCY</th>
			                <th></th>
	            		</thead>
	            		<tbody ></tbody>
	            	</table>
	            </div>	            						
			</div>
		</div>
	</div>
</script>


<script id="invoiceCustom" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" 
							data-bind="click: cancel"><i></i></span>						
					</div>
			        <h2 style="padding:0 15px;"" data-bind="text: lang.lang.custom_forms"></h2>
				    <br>	
				    <div class="row" style="margin-left:0;">			   				
						<div class="span4">	
							<div class="span12">
								<select class="span12 selectType" 
									data-role="dropdownlist" 
									data-value-primitive="true" 
									data-text-field="name" 
									data-value-field="id" 
									data-bind="value: obj.type, 
												source: selectTypeList, 
												events:{change: onChange}" ></select>
							</div>
							<div class="span12" style="margin-bottom: 10px;">
								<input type="text" id="formName" name="Form Name" class="k-textbox" placeholder="Form Name" required validationMessage="" data-bind="value: obj.name" style="width: 100%;" />
							</div>
							<div class="span12">
								<h2 class="btn btn-block btn-primary">Form Style</h2>
								<div class="row formstyle">
									<div id="formStyle"
										 data-role="listview"
										 data-selectable="true"
						                 data-template="invoiceCustom-txn-form-template"
						                 data-bind="source: txnFormDS"
						                 style="overflow: auto">
						            </div>
						        </div>
							</div>
							<div class="span12" style="margin-left:0; margin-top: 10px;">
								<h2 class="btn btn-block btn-primary">Form Color</h2>
								<div class="colorPalatte span12">
									<div class="" style="margin-top: 15px;">
										<div data-selectable="true" data-bind="value: obj.color, events: { change : colorCC }" data-tile-size='{ width: 60, height: 35 }' data-role="colorpalette" data-columns="6" data-palette='[ "#ffffff", "#000000", "#eeece1", "#1f497d", "#4f81bd", "#c0504d", "#9bbb59", "#dbeef3", "#8064a2", "#f79646", "#f2f2f2", "#7f7f7f", "#ddd9c3", "#c6d9f0", "#dbe5f1", "#f2dcdb", "#ebf1dd", "#e5e0ec"]'></div>
                                	</div>
                                </div>
							</div>
							<div class="span12" style="margin-left:0; margin-top: 10px;padding-bottom: 30px;">
								<h2 class="btn btn-block btn-primary">Form Appearance</h2>
								<div class="colorPalatte span12">
									<div class="" style="margin-top: 15px;">
										<input type="text" id="formtitle" name="Form Title" class="k-textbox" placeholder="Form Title" required validationMessage="" data-bind="value: obj.title" style="width: 100%;" />
										<textarea data-bind="value: obj.note, text: obj.note" placeholder="Note" class="span12" style="min-height: 100px;margin-top: 15px;padding-left: 10px;"></textarea>
                                	</div>
                                </div>
							</div>
						</div>
						<div class="span8" id="invFormContent" style="padding-left:0;padding-right: 0;width: 63%;border:1px solid #eee;margin-bottom:20px;">

						</div>
					</div>
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>
						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save-close"></span></span>			
							</div>
						</div>
					</div>
					<!-- // Form actions END -->	
				</div>							
			</div>
		</div>
	</div>
</script>
<script id="invoiceForm" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" 
							data-bind="click: cancel"><i></i></span>						
					</div>
			        <h2>PREVIEW FORM</h2>
				    <br>	
				    <div class="row" style="margin-left:0;">	 				
						<div class="span10" id="invFormContent" style="min-height: 300px;border:1px solid #ccc; margin: 0 auto;float:none;padding-bottom:20px;margin-bottom: 30px;">	
							<div id="loading-inv" style="margin-left: -15px;text-align: center;position: absolute;width: 100%; height: 100%;background: rgba(142, 159, 167, 0.8);z-index: 9999;">
								<i class="fa fa-circle-o-notch fa-spin" style="font-size: 50px;color: #fff;position: absolute; top: 45%;left: 45%"></i>
							</div>
						</div>
					</div>
					<!-- Form actions -->
					<div class="box-generic" align="right" style="background-color: #0B0B3B;">
						<span id="notification"></span>

						<span id="savePrint" class="btn btn-icon btn-primary glyphicons print" data-bind="click: printGrid" style="width: 80px;"><i></i>Print / PDF</span>
						<!--span id="savePDF" class="btn btn-icon btn-success glyphicons edit" data-bind="click: savePDF" style="width: 120px;"><i></i> Save PDF</span-->									
					</div>
					<!-- // Form actions END -->
				</div>							
			</div>
		</div>
	</div>
</script>
<script id="invoiceForm1" type="text/x-kendo-template">
	<div class="inv1">
    	<div class="head">
        	<div class="logo">
            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
            </div>
            <div class="cover-name-company">
            	<h2 ></h2>
                <h3 style="text-align:left;" data-bind="text: company.name"></h3>
                <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span>
                </div>
                <div class="clear">
                	<pre>អាស័យ​ដ្ឋាន Address: <span data-bind="text: company.address"></span></pre>
                    <pre>ទូរស័ព្ទលេខ HP <span data-bind="text: company.phone"></span></pre>
                </div>
            </div>
        </div>
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear mid-header" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
        	<div class="clear">
            	<table cellpadding="0" cellspacing="0" border="1" class="span12">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td style="text-align: right; padding-right: 5px;" data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សរុប (បូក​បញ្ចូល​ទាំង​អាករ)​ Total (VAT included)</td>
                            <td style="text-align: right; padding-right: 5px;" data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">ប្រាក់កក់ Deposit</td>
                            <td style="text-align: right; padding-right: 5px;" data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td style="text-align: right; padding-right: 5px;" data-bind="text: obj.amount_due"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<script id="invoiceForm2" type="text/x-kendo-template">
	<div class="inv1">
    	<div class="head">
        	<div class="logo">
            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
            </div>
            <div class="cover-name-company">
            	<h2 ></h2>
                <h3 style="text-align:left;" data-bind="text: company.name"></h3>
                <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span>
                </div>
                <div class="clear">
                	<pre>អាស័យ​ដ្ឋាន Address: <span data-bind="text: company.address"></span></pre>
                    <pre>ទូរស័ព្ទលេខ HP <span data-bind="text: company.phone"></span></pre>
                </div>
            </div>
        </div>
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រអាករ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear mid-header" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                    <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span><p style="font-size:8px;font-weight:normal;margin-left: 8px;">(ប្រសិន​បើ​មាន / If any)</p>
                	</div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
            
        	<div class="clear inv2">
            	<table cellpadding="0" cellspacing="0" border="1" style="width:100%;">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">សរុប​ Sub Total</td>
                            <td data-bind="text: obj.sub_total"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">អាករ​លើ​តម្លៃ​បន្ថែម ១០% VAT (10%)</td>
                            <td data-bind="text: obj.tax"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">សរុបរួម​ Grand Total</td>
                            <td data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">ប្រាក់កក់ Deposit</td>
                            <td data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td data-bind="text: obj.amount_due"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<!--script id="invoiceForm3" type="text/x-kendo-template">
	<div class="inv1 sale-order">
    	<div class="head">
        	<h1>Sale Order</h1>
        	<div class="span12">
        		<div class="span10" style="text-align:right;">
        			Date : <br>
        			SONo : 
        		</div>
        		<div class="span2" style="text-align:left;padding-left: 10px;">
        			<p data-bind="text: obj.issued_date"></p>
        			<p data-bind="text: obj.number"></p>
        		</div>
        	</div>
        </div>
        <div class="content clear">
        	<table class="span12">
        		<thead>
        			<tr>
	        			<th colspan="2">
	        				CUSTOMER INFORMATION
	        			</th>
	        			<th colspan="2">
	        				DELIVERED TO ADDRESS
	        			</th>
	        		</tr>
        		</thead>
        		<tbody>
        			<tr style="height: 100px">
        				<td colspan="2">
        					<p><span data-bind="text: obj.contact[0].name"></span><br>
        					<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
	        			</td>
	        			<td colspan="2">
	        				<p><span data-bind="text: obj.contact[0].name"></span><br>
        					<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
	        			</td>
        			</tr>
        			<tr>
	        			<td class="span3">TERM OF PAYMENT</td>
	        			<td class="span3"></td>
	        			<td class="span3">DELIVERY DATE</td>
	        			<td class="span3" data-bind="text: obj.issued_date"></td>
	        		</tr>
	        		<tr>
	        			<td class="span3">MODE OF PAYMENT</td>
	        			<td class="span3"></td>
	        			<td class="span3">TERM OF DELIVERY</td>
	        			<td class="span3"></td>
	        		</tr>
        		</tbody>
        	</table>
        	<table class="span12" style="margin-top: 5px;">
        		<thead>
        			<tr>
	        			<th data-bind="style: {backgroundColor: obj.color}">
	        				Item <br>Code
	        			</th>
	        			<th data-bind="style: {backgroundColor: obj.color}">
	        				Description
	        			</th>
	        			<th width="70" data-bind="style: {backgroundColor: obj.color}">
	        				Required<br>Date
	        			</th>
	        			<th width="40" data-bind="style: {backgroundColor: obj.color}">
	        				UM
	        			</th>
	        			<th width="40" data-bind="style: {backgroundColor: obj.color}">
	        				QTY
	        			</th>
	        			<th width="100" data-bind="style: {backgroundColor: obj.color}">
	        				Unit Price
	        			</th>
	        			<th width="70" data-bind="style: {backgroundColor: obj.color}">
	        				Total
	        			</th>
	        		</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template3"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td colspan="4" rowspan="4" style="text-align:left;padding-left:20px;">
	        				<b>Note:</b><br>
	        				<ol>
								<li>Please notify us immediately if you are unable to deliver as specified.</li>
								<li>Check will be used to settled this order if the settled amount is equal to or greater than 500 USD</li>
								<li>Please send all correspondence to address above.</li>
							</ol>
        				</td>
        				<td style="text-align:left;padding-left:20px;" colspan="2"><b>SUB TOTAL</b></td>
        				<td data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td style="text-align:left;padding-left:20px;" colspan="2"><b>VAT​(10%) if applicable</b></td>
        				<td data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td style="text-align:left;padding-left:20px;" colspan="2"><b>Other charges</b></td>
        				<td></td>
        			</tr>
        			<tr>
        				<td style="text-align:left;padding-left:20px;" colspan="2"><b>Total</b></td>
        				<td data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<div class="span12 clear" style="margin-top: 15px">
	        	<div class="span6">
	        		<div class="span6">
	        			<p>Approved by: </p>
	        			<p style="margin-top: 40px;padding-top: 5px;width: 80%;border-top: 1px solid #000;">Name:<br>Date:<p>
	        		</div>
	        		<div class="span6">
	        			<p>Recieved by: </p>
	        			<p style="margin-top: 40px;padding-top: 5px;width: 80%;border-top: 1px solid #000;">Name:<br>Date:<p>
	        		</div>
	        	</div>
	        	<div class="span6">
	        		<table class="span12">
	        			<tr>
	        				<thead><th>I hereto accept the terms and conditions in the contract and purchase order:</th></thead>
	        			</tr>
	        			<tr><td>Customer Name:</td></tr>
	        			<tr><td>Position:</td></tr>
	        			<tr><td>Date:</td></tr>
	        		</table>
	        	</div>
	        </div>
        </div>
    </div>
</script>
<script id="invoiceForm4" type="text/x-kendo-template">
	<div class="inv1 quotation">
        <div class="content clear">
        	<table class="span12">
        		<tbody>
        			<tr>
        				<td style="border-top: none;border-left: none" width="500" colspan="2" rowspan="3">
        					<h2>Quotation Form</h2>
	        			</td>
	        			<td width="120">
	        				<b>Date</b>
	        			</td>
	        			<td data-bind="text: obj.issued_date"></td>
        			</tr>
        			<tr>
	        			<td ><b>Quotation Form #</b></td>
	        			<td data-bind="text: obj.number"></td>
	        		</tr>
	        		<tr>
	        			<td><b>Requisition #</b></td>
	        			<td></td>
	        		</tr>
	        		<tr>
	        			<td width="150"><b>Customer Name:</b></td>
	        			<td data-bind="text: obj.contact[0].name"></td>
	        			<td ><b>Date of contact:</b></td>
	        			<td ></td>
	        		</tr>
	        		<tr>
	        			<td width="150"><b>Contact Information:</b></td>
	        			<td data-bind="text: obj.contact[0].address"></td>
	        			<td ><b>Time of contact:</b></td>
	        			<td ></td>
	        		</tr>
	        		<tr>
	        			<td width="150"><b>Validity Date</b></td>
	        			<td ></td>
	        			<td ><b>Date price provided </b></td>
	        			<td ></td>
	        		</tr>
        		</tbody>
        	</table>
        	<table class="span12" style="margin-top: 5px;">
        		<thead>
        			<tr>
	        			<th data-bind="style: {backgroundColor: obj.color}">
	        				No
	        			</th>
	        			<th width="70" data-bind="style: {backgroundColor: obj.color}">
	        				Item<br>Code
	        			</th>
	        			<th width="" data-bind="style: {backgroundColor: obj.color}">
	        				Description
	        			</th>
	        			<th width="30" data-bind="style: {backgroundColor: obj.color}">

	        			</th>
	        			<th width="40" data-bind="style: {backgroundColor: obj.color}">
	        				UM
	        			</th>
	        			<th width="40" data-bind="style: {backgroundColor: obj.color}">
	        				QTY
	        			</th>
	        			<th width="80" data-bind="style: {backgroundColor: obj.color}">
	        				Unit Price
	        			</th>
	        			<th width="70" data-bind="style: {backgroundColor: obj.color}">
	        				Extended<br>Price
	        			</th>
	        		</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template4"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="text-align:right;padding-right:10px;" colspan="7"><b>Total</b></td>
        				<td data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<div class="span12 clear" style="margin-top: 10px">
	        	<p><b>Additional Specifications </b></p>
	        	<table class="span12" style="margin-top:10px;">
	        		<tr>
	        			<td colspan="3">
	        			<br><br><br><br>
	        			</td>
	        		</tr>
	        		<tr>
	        			<td colspan="3"><b>Prepared By:<br>Position:<br>Date:</b></td>
	        		</tr>
	        		<tr>
	        			<td rowspan="2">This form is used only when official quotation from supplier is not feasible.<td>
	        			<td>&nbsp;</td>
	        		</tr>
	        		<tr>
	        			<td width="80">&nbsp;</td>
	        			<td width="80">&nbsp;</td>
	        		</tr>
	        	</table>
	        </div>
        </div>
    </div>
</script>
<script id="invoiceForm5" type="text/x-kendo-template">
	<div class="inv1 quotation">
        <div class="content clear">
        	<table class="span12">
        		<tbody>
        			<tr>
        				<td class="main-color" width="300" colspan="4" rowspan="3">
        					<h2>GOODS DELIVERED NOTE </h2>
	        			</td>
	        			<td width="120">
	        				<b>GDN #</b>
	        			</td>
	        			<td width="100">&nbsp;</td>
        			</tr>
        			<tr>
	        			<td ><b>Date</b></td>
	        			<td data-bind="text: obj.issued_date"></td>
	        		</tr>
	        		<tr>
	        			<td><b>SO/ CONTRACT #</b></td>
	        			<td></td>
	        		</tr>
	        		<tr>
	        			<td width="90"><b>Name</b></td>
	        			<td width="80" data-bind="text: obj.contact[0].name"></td>
	        			<td width="90"><b>CODE</b></td>
	        			<td width="80"></td>
	        			<td ><b>CUSTOMER<br>INVOICE #</b></td>
	        			<td data-bind="text: obj.number"></td>
	        		</tr>
	        		<tr>
	        			<td ><b>ADDRESS</b></td>
	        			<td colspan="3" data-bind="text: obj.contact[0].address"></td>
	        			<td><b>DELIVERY NOTE #</b></td>
	        			<td ></td>
	        		</tr>
        		</tbody>
        	</table>
        	<table class="span12" style="margin-top: 5px;">
        		<thead>
        			<tr>
	        			<th rowspan="2" width="70" data-bind="style: {backgroundColor: obj.color}">
	        				Item<br>Code
	        			</th>
	        			<th rowspan="2" data-bind="style: {backgroundColor: obj.color}">
	        				DESCRIPTION
	        			</th>
	        			<th rowspan="2" data-bind="style: {backgroundColor: obj.color}">
	        				INSPECTION<br>CRITERIA
	        			</th>
	        			<th colspan="5" data-bind="style: {backgroundColor: obj.color}">
	        				QUANTITY
	        			</th>
	        		</tr>
	        		<tr>
	        			<th data-bind="style: {backgroundColor: obj.color}"><b style="font-size:10px">ORDERED</b></th>
	        			<th data-bind="style: {backgroundColor: obj.color}"><b style="font-size:10px">RECEIVED</b></th>
	        			<th data-bind="style: {backgroundColor: obj.color}"><b style="font-size:10px">INSPECTED</b></th>
	        			<th data-bind="style: {backgroundColor: obj.color}"><b style="font-size:10px">ACCEPTED</b></th>
	        			<th data-bind="style: {backgroundColor: obj.color}"><b style="font-size:10px">REJECTED</b></th>
	        		</tr>
        		</thead>
        		<tbody id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template5"
						data-bind="source: lineDS">
        		<tfoot>
        			
        			<tr>
        				<td style="text-align:center;color:#fff;background:#000" colspan="8">Goods/ Materials received are delivered correctly in term of quantity, quality and other specifications according to the specified SO.</td>
        			</tr>
        		</tfoot>
        	</table>
        	<div class="span12 clear" style="margin-top: 10px">
	        	<div class="span6" style="padding-left: 30px;">
	        		<strong>
	        			Delivered By:<br>
	        			Received By:<br>
	        			Inspected By:
	        		</strong>
	        	</div>
	        	<div class="span6" style="padding-left: 30px;">
	        		<strong>
	        			Date/ Time:<br>
	        			Date/ Time:<br>
	        			Date/ Time:
	        		</strong>
	        	</div>
	        	<table class="span12" style="margin-top: 10px;">
	        		<tr>
	        			<td width="280">
	        				<b>Sample Lot</b><br><br>
	        				<p>Lot Size:_______________<span style="float:right;padding-right:10px;">Delivery Damage</span></p>
	        				<p><span style="float:right;padding-right:10px;">Markings/Finish</span></p><br>
	        				<p>Sample Qty:____________<span style="float:right;padding-right:10px;">Attributes</span></p><br>
	        			</td>
	        			<td>
	        				<b>Conformance/Discrepancies to Specifications</b><br><br>
	        			</td>
	        		</tr>
	        	</table>
	        </div>
        </div>
    </div>
</script-->

<script id="invoiceForm6" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 35%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template6"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>

        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm7" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 35%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template6"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>

        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>

        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm8" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template8"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm9" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template8"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm10" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 35%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template10"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm11" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 35%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template10"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm12" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template12"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>

        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        				
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm13" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT PRICE</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template12"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm14" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header" style="background:none;">
        		<div class="span3" style="margin-right: 15px;">
        			<b>Customer Information</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span6" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title" style="font-size: 26px"></p>
        			<p><b>Sale Order Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>Sale Order No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12">
        		<tr>
        			<td style="background: #c6d9f1;text-align: left;padding-left: 5px;" width="150"><b>SALE ORDER #</b></td>
        			<td width="100"><b data-bind="text: obj.reference_no"></b></td>
        			<td width="150" style="background: #c6d9f1;text-align: left;padding-left: 5px;"><b>INVOICE #</b></td>
        			<td><b></b></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;text-align: left;padding-left: 5px;"><b>JOB/ CONTRACT #</b></td>
        			<td><b></b></td>
        			<td style="background: #c6d9f1"><b></b></td>
        			<td><b></b></td>
        		</tr>
        	</table>
        	<table class="span12" style="margin: 5px 0;">
        		<thead>
        			<tr>
        				<th width="50" style="background: #c6d9f1;">NO</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">ITEM CODE</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">DESCRIPTION</th>
        				<th style="background: #c6d9f1;">UM</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">QTY</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">REMARK</th>
        			</tr>
        		</thead>
        		<tbody id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template14"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12">
        		<tr>
        			<td style="background: #c6d9f1" width="150">ISSUED BY</td>
        			<td width="100"></td>
        			<td width="150" style="background: #c6d9f1">DATE</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">DELIVERED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">RECEIVED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE/TIME</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">ACKNOWLEDGED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE/TIME</td>
        			<td></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm15" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2 data-bind="text: obj.title"></h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12" border="1">
        			<tr>
        				<td width="200">លេខសក្ខីប័ត្រ TV No.</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td>Rational for transfer</td>
        				<td colspan="3"></td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="border-top: none;">
        		<tr>
        			<td colspan="4" style="background: #10253f; color: #fff;border-top: 0;">
        				ផ្ទេរប្រាក់​ពី Transfer from
        			</td>
        			<td colspan="2" style="background: #eee;border-top: 0;">
        				ផ្ទេរប្រាក់ទៅ Transfer to
        			</td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;">
        				No.
        			</td>
        			<td style="background: #c6d9f1;">
        				Nature
        			</td>
        			<td style="background: #c6d9f1;">
        				Amount
        			</td>
        			<td style="background: #c6d9f1;">
        				Cheque No./<br>Account No.
        			</td>
        			<td>
        				Nature
        			</td>
        			<td>
        				Bank Account No./ Cash<br>Account Code
        			</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនសរុប<br>Total</td>
        			<td></td>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនជាអក្សរ<br>Amount in Words</td>
        			<td></td>
        		</tr>
        	</table>
        	<div class="span12" style="background: #eee;padding: 5px;">
        		<div class="span9" style="background: #fff;border:1px solid #ccc;padding: 8px;">
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">រៀបចំដោយ<br>Prepared by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">ត្រួតពិនិត្យដោយ<br>Reviewed by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;font-weight:bold;">ពិនិត្យ និងសំរេចដោយ<br>Approved by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        		</div>
        		<div class="span3" style="padding: 10px;">
        			<p style="margin-bottom:45px;font-size:10px;">Transerred by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
        		</div>
        	</div>
        	<table class="span12" border="1">
        		<tr>
        			<td colspan="3" style="background: #10253f; color: #fff;padding-left: 5px;text-align:left;">
        				សម្រាប់ការិយាល័យហិរញ្ញវត្ថុ For Accounting Department
        			</td>
        		</tr>
        		<tr>
        			<td style="text-align: center;">លេខគណនី<br>Account code</td>
        			<td>ឥណពន្ធ<br>Debit</td>
        			<td>ឥណទាន<br>Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: left;padding-left: 5px;">
        				<span style="font-size: 10px; margin-right: 100px;">Posted By:</span> Date:
        			</td>
        		</tr>
        	</table>
        	<table class="span12" border="1">
        		<tr>
        			<td rowspan="2" style="border-top:0;text-align: left;padding-left: 5px;">Used for internal deposit, withdraw, transfer amoung the company's Bank account to<br> bank account and to on hand and deposit back to the bank accounts.</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;">Version</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;"><b>V.01</b></td>
        		</tr>
        		<tr>
        			<td style="text-align: left;padding-left: 5px;">Doc. Control</td>
        			<td style="text-align: left;padding-left: 5px;"><b>TRM02-07</b></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm16" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2>សក្ខីប័ត្រដាក់សាច់ប្រាក់ Deposit Voucher</h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12" border="1">
        			<tr>
        				<td width="200">លេខសក្ខីប័ត្រ TV No.</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td>Rational for Deposit</td>
        				<td colspan="3"></td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="border-top: none;">
        		<tr>
        			<td colspan="4" style="background: #10253f; color: #fff;border-top: 0;">
        				ដាក់ប្រាក់​ពី Deposit from
        			</td>
        			<td colspan="2" style="background: #eee;border-top: 0;">
        				ដាក់ប្រាក់ទៅ Deposit to
        			</td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;">
        				No.
        			</td>
        			<td style="background: #c6d9f1;">
        				Nature
        			</td>
        			<td style="background: #c6d9f1;">
        				Amount
        			</td>
        			<td style="background: #c6d9f1;">
        				Cheque No./<br>Account No.
        			</td>
        			<td>
        				Nature
        			</td>
        			<td>
        				Bank Account No./ Cash<br>Account Code
        			</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនសរុប<br>Total</td>
        			<td></td>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនជាអក្សរ<br>Amount in Words</td>
        			<td></td>
        		</tr>
        	</table>
        	<div class="span12" style="background: #eee;padding: 5px;">
        		<div class="span9" style="background: #fff;border:1px solid #ccc;padding: 8px;">
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">រៀបចំដោយ<br>Prepared by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">ត្រួតពិនិត្យដោយ<br>Reviewed by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;font-weight:bold;">ពិនិត្យ និងសំរេចដោយ<br>Approved by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        		</div>
        		<div class="span3" style="padding: 10px;">
        			<p style="margin-bottom:45px;font-size:10px;">Deposited by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
        		</div>
        	</div>
        	<table class="span12" border="1">
        		<tr>
        			<td colspan="3" style="background: #10253f; color: #fff;padding-left: 5px;text-align:left;">
        				សម្រាប់ការិយាល័យហិរញ្ញវត្ថុ For Accounting Department
        			</td>
        		</tr>
        		<tr>
        			<td style="text-align: center;">លេខគណនី<br>Account code</td>
        			<td>ឥណពន្ធ<br>Debit</td>
        			<td>ឥណទាន<br>Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: left;padding-left: 5px;">
        				<span style="font-size: 10px; margin-right: 100px;">Posted By:</span> Date:
        			</td>
        		</tr>
        	</table>
        	<table class="span12" border="1">
        		<tr>
        			<td rowspan="2" style="border-top:0;text-align: left;padding-left: 5px;">Used for internal deposit, withdraw, transfer amoung the company's Bank account to<br> bank account and to on hand and deposit back to the bank accounts.</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;">Version</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;"><b>V.01</b></td>
        		</tr>
        		<tr>
        			<td style="text-align: left;padding-left: 5px;">Doc. Control</td>
        			<td style="text-align: left;padding-left: 5px;"><b>TRM02-07</b></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm17" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2>សក្ខីប័ត្រដកប្រាក់ Withdrawal Voucher</h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12" border="1">
        			<tr>
        				<td width="200">លេខសក្ខីប័ត្រ TV No.</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td>Rational for Withdraw</td>
        				<td colspan="3"></td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="border-top: none;">
        		<tr>
        			<td colspan="4" style="background: #10253f; color: #fff;border-top: 0;">
        				ដកប្រាក់​ពី Withdraw from
        			</td>
        			<td colspan="2" style="background: #eee;border-top: 0;">
        				ដកប្រាក់ទៅ Withdraw to
        			</td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;">
        				No.
        			</td>
        			<td style="background: #c6d9f1;">
        				Nature
        			</td>
        			<td style="background: #c6d9f1;">
        				Amount
        			</td>
        			<td style="background: #c6d9f1;">
        				Cheque No./<br>Account No.
        			</td>
        			<td>
        				Nature
        			</td>
        			<td>
        				Bank Account No./ Cash<br>Account Code
        			</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនសរុប<br>Total</td>
        			<td></td>
        			<td style="background: #c6d9f1;text-align: right;padding-right: 5px;" colspan="2">ចំនួនជាអក្សរ<br>Amount in Words</td>
        			<td></td>
        		</tr>
        	</table>
        	<div class="span12" style="background: #eee;padding: 5px;">
        		<div class="span9" style="background: #fff;border:1px solid #ccc;padding: 8px;">
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">រៀបចំដោយ<br>Prepared by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;">ត្រួតពិនិត្យដោយ<br>Reviewed by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        			<div class="span4">
        				<p style="margin-bottom:30px;font-size:10px;font-weight:bold;">ពិនិត្យ និងសំរេចដោយ<br>Approved by:</p>
        				_______________
        				<p style="font-size:10px;">Name: <br>Date:</p>
        			</div>
        		</div>
        		<div class="span3" style="padding: 10px;">
        			<p style="margin-bottom:45px;font-size:10px;">Withdrew by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
        		</div>
        	</div>
        	<table class="span12" border="1">
        		<tr>
        			<td colspan="3" style="background: #10253f; color: #fff;padding-left: 5px;text-align:left;">
        				សម្រាប់ការិយាល័យហិរញ្ញវត្ថុ For Accounting Department
        			</td>
        		</tr>
        		<tr>
        			<td style="text-align: center;">លេខគណនី<br>Account code</td>
        			<td>ឥណពន្ធ<br>Debit</td>
        			<td>ឥណទាន<br>Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: left;padding-left: 5px;">
        				<span style="font-size: 10px; margin-right: 100px;">Posted By:</span> Date:
        			</td>
        		</tr>
        	</table>
        	<table class="span12" border="1">
        		<tr>
        			<td width="450" style="border-top:0;text-align: left;padding-left: 5px;"></td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;">Version</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;"><b>V.01</b></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm18" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2>សក្ខីប័ត្របុរេប្រទាន ADVANCE VOUCHER</h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12 left-tbl" border="1">
        			<tr>
        				<td width="200">អ្នកស្នើសុំ NAME</td>
        				<td width="200"></td>
        				<td width="200">លេខសក្ខីប័ត្រ AV No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">តំណែង Position</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">ផ្នែក Department</td>
        				<td width="200"></td>
        				<td width="200">លេខប័ណ្ណលទ្ធកម្ម PR No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">ទូទាត់ដោយ Mode of<br>Payment</td>
        				<td colspan="3">ទូទាត់ដោយ mode of payment </td>
        			</tr>
        			<tr>
        				<td width="200">គោលបំណងនៃ​បុរេប្រទាន<br>Purpose of Advance</td>
        				<td colspan="3">&nbsp;</td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="border-top: none;">
        		<tr style="background: #c6d9f1;">
        			<th style="border-top: 0;">
        				No.
        			</th>
        			<th style="border-top: 0;">
        				បរិយាយ DESCRIPTION
        			</th>
        			<th style="border-top: 0;">
        				REF.
        			</th>
        			<th style="border-top: 0;">
        				AMOUNT
        			</th>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">សរុប Total</td>
        			<td></td>
        		</tr>
        	</table>
        	<table class="span12 left-tbl" >
        		<tr>
        			<td colspan="2" style="border-top: none;text-align:right;padding-right:5px;">
        				 ចំនួនជាអក្សរ<br>Amount in Words
        			</td>
        			<td colspan="3" style="border-top: none;">&nbsp;</td>
        		</tr>
        		<tr>
        			<td colspan="2"></td>
        			<td style="background: #000; color: #fff;text-align:center;">SIGNATURE</td>
        			<td style="background: #000; color: #fff;text-align:center;">POSITION</td>
        			<td style="background: #000; color: #fff;text-align:center;">DATE</td>
        		</tr>
        		<tr>
        			<td style="background: #10253f; color: #fff;text-align:center;" rowspan="2" width="20"><p class="upside">Requestiong<br>Dept</p></td>
        			<td width="100">រៀបចំដោយ<br>PREPARED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>យល់ស្របដោយ<br>ENDORSED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td rowspan="4" style="text-align:center;" width="20"><p class="upside">Finance Department</p></td>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>សំរេចដោយ<br>APPROVED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>ទួទាត់ដោយ<br>PAID BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>ទទួលដោយ<br>RECEIVED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background:#000;"></td>
        			<td colspan="4">For Accounting Department Only</td>
        		</tr>
        		<tr>
        			<td></td>
        			<td style="text-align:center;">Account Code</td>
        			<td style="text-align:center;">Account Description</td>
        			<td style="text-align:center;">Debit</td>
        			<td style="text-align:center;">Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td style="background: #c6d9f1;"></td>
        			<td style="background: #c6d9f1;">កត់ត្រាដោយ<br>POSTED BY</td>
        			<td style="text-align:center;"></td>
        			<td style="text-align:center;"></td>
        			<td style="text-align:center;"></td>
        		</tr>
        	</table>
        	<table class="span12" border="1" style="margin-top:5px;">
        		<tr>
        			<td rowspan="2" width="400" style="text-align: left;padding-left: 5px;">Advance Voucher should be used to account for cash advance request (either for operational or salary advance). No additional voucher is required to disburse cash. This is a pre-printed form and there are two copies, one of which (original) will be given to advance requestor; while another one is for the Finance Department.</td>
        			<td style="text-align: left;padding-left: 5px;">Version</td>
        			<td style="text-align: left;padding-left: 5px;"><b>V.01</b></td>
        		</tr>
        		<tr>
        			<td style="text-align: left;padding-left: 5px;">Doc. Control</td>
        			<td style="text-align: left;padding-left: 5px;"><b>APM02-02</b></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm19" type="text/x-kendo-template">
    <div class="inv1 pcg">
        <div class="content clear">
        	<div class="span12 clear" style="padding:20px 0;">
        		<div class="span5" style="margin-right: 15px;">
        			<div class="logo" style="width: 100%;">
		            	<img style="width: 45%" data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
		            </div>
        			
        		</div>
        		<div class="span6" style="float:right;">
        			<p class="form-title" style="font-size: 24px;margin-bottom: 5px;margin-top: 22px;line-height: 28px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ឈ្មោះ Name : <span data-bind="text: obj.contact.name"> </span></div>
        		<div class="span6" style="text-align: left;padding-left: 10px;">ទូទាត់ដោយ Mode of Payment : <span data-bind="text: obj.payment_method[0].name"></span></div>
				<div class="span12" style="text-align: left;padding-left: 10px;margin-top: 10px;">គោលបំណងការចំណាយ Purpose of Payment : <span ></span></div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
	        		<tr style="background: #c6d9f1;">
	        			<th style="border-top: 0;" width="60">
	        				ល.រ<br>No.
	        			</th>
	        			<th style="border-top: 0;" width="120">
	        				វិក្កយបត្រលេខ<br>Invoice No.
	        			</th>
	        			<th style="border-top: 0;text-align: left;padding-left: 10px;">
	        				បរិយាយ​<br>Description
	        			</th>
	        			<th style="border-top: 0;" width="120">
	        				ចំនួន<br>Amount
	        			</th>
	        		</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template19"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="2" rowspan="4">
        				</td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				
        				<td style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>

        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tbody>
	        		<tr>
	        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
	        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
	        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
	        		</tr>
	        		<tr>
	        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
	        			<td>តំណែង<br>POSITION</td><td width="80"></td>
	        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
	        		</tr>
	        		<tr>
	        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
	        			<td>តំណែង<br>POSITION</td><td width="80"></td>
	        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
	        		</tr>
	        		<tr>
	        			<td>ទួទាត់ដោយ<br>PAID BY</td><td></td>
	        			<td>តំណែង<br>POSITION</td><td width="80"></td>
	        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
	        		</tr>
	        		<tr>
	        			<td>ទទួលដោយ<br>RECEIVED BY</td><td></td>
	        			<td>តំណែង<br>POSITION</td><td width="80"></td>
	        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
	        		</tr>
	        	</tbody>
        	</table>

        	<table class="span12 left-tbl" style="margin-top: 30px;">
        		<tr class="mid-header">
        			<td colspan="4" style="text-align:center;font-weight: bold;">For Accounting Department Only</td>
        		</tr>
        		<tr>
        			<td >Account Code</td>
        			<td >Account Description</td>
        			<td >Debit</td>
        			<td >Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm20" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2>សក្ខីប័ត្រចំណាយ REIMBURSEMENT VOUCHER</h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12 left-tbl" border="1">
        			<tr>
        				<td width="200">ឈ្មោះ NAME</td>
        				<td width="200"></td>
        				<td width="200">លេខសក្ខីប័ត្រ PV No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">អ្នកផ្គត់ផ្គង់ Supplier Code</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">ផ្នែក Department</td>
        				<td width="200"></td>
        				<td width="200">លេខសក្ខីប័ត្របំណុល APV No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">ទូទាត់ដោយ Mode of<br>Payment</td>
        				<td colspan="3">ទូទាត់ដោយ mode of payment </td>
        			</tr>
        			<tr>
        				<td width="200">គោលបំណងការចំណាយ<br>Purpose of Advance</td>
        				<td colspan="2">&nbsp;</td>
        				<td>Budgeted: </td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="border-top: none;">
        		<tr style="background: #c6d9f1;">
        			<th style="border-top: 0;">
        				No.
        			</th>
        			<th style="border-top: 0;" width="100">
        				Invoice No.
        			</th>
        			<th style="border-top: 0;">
        				Description
        			</th>
        			<th style="border-top: 0;" width="120">
        				Amount
        			</th>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">Total</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">Settlement Discounts</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;background: #c6d9f1;">NET AMOUNT PAID</td>
        			<td></td>
        		</tr>
        	</table>
        	<table class="span12 left-tbl" >
        		<tr>
        			<td colspan="2" style="background: #c6d9f1;border-top: none;text-align:right;padding-right:5px;">
        				Amount in Words
        			</td>
        			<td colspan="3" style="border-top: none;">&nbsp;</td>
        		</tr>
        		<tr>
        			<td colspan="2"></td>
        			<td style="background: #000; color: #fff;text-align:center;">SIGNATURE</td>
        			<td style="background: #000; color: #fff;text-align:center;">POSITION</td>
        			<td width="120" style="background: #000; color: #fff;text-align:center;">DATE</td>
        		</tr>
        		<tr>
        			<td style="background: #10253f; color: #fff;text-align:center;" rowspan="5" width="20"><p class="upside">Finance Department</p></td>
        			<td width="100">រៀបចំដោយ<br>PREPARED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td><b>សំរេចដោយ<br>APPROVED BY</b></td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>ទួទាត់ដោយ<br>PAID BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td>ទទួលដោយ<br>RECEIVED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background:#000;"></td>
        			<td colspan="4">For Accounting Department Only</td>
        		</tr>
        		<tr>
        			<td></td>
        			<td style="text-align:center;">Account Code</td>
        			<td style="text-align:center;">Account Description</td>
        			<td style="text-align:center;">Debit</td>
        			<td style="text-align:center;">Credit</td>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td style="background: #c6d9f1;"></td>
        			<td style="background: #c6d9f1;">កត់ត្រាដោយ<br>POSTED BY</td>
        			<td style="text-align:center;"></td>
        			<td style="text-align:center;"></td>
        			<td style="text-align:center;"></td>
        		</tr>
        	</table>
        	<table class="span12" border="1">
        		<tr>
        			<td rowspan="2" width="400" style="border-top:0;text-align: left;padding-left: 5px;">This is an automated voucher generated based on the payment made to outstanding invoice, reimbursements, claims, and other disbursement. The purpose of this voucher is used to approve payment transactions.</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;">Version</td>
        			<td style="border-top:0;text-align: left;padding-left: 5px;"><b>V.01</b></td>
        		</tr>
        		<tr>
        			<td style="text-align: left;padding-left: 5px;">Doc. Control</td>
        			<td style="text-align: left;padding-left: 5px;"><b>TRM02-03</b></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm21" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2>សក្ខីប័ត្រជំរះបុរេប្រទាន<br>ADVANCE SETTLEMENT VOUCHER</h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12 left-tbl" border="1">
        			<tr>
        				<td width="200">អ្នកស្នើសុំ NAME</td>
        				<td width="200"></td>
        				<td width="200">លេខសក្ខីប័ត្រ AS No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">តំណែង Position</td>
        				<td width="200"></td>
        				<td width="200">កាលបរិច្ឆេទ Date</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">ផ្នែក Department</td>
        				<td width="200"></td>
        				<td width="200">លេខសំណើរបុរេប្រទាន ADR No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">គោលបំណងនៃ​ការទូទាត់បុរេប្រទាន <br>Purpose of Advance</td>
        				<td colspan="3">&nbsp;</td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12" style="margin-top: 5px;">
        		<tr style="background: #c6d9f1;height: 30px;">
        			<th width="160">
        				ACCOUNT CODE
        			</th>
        			<th >
        				បរិយាយ DESCRIPTION
        			</th>
        			<th >
        				REF.
        			</th>
        			<th width="120">
        				AMOUNT
        			</th>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">សរុបចំណាយជាក់ស្តែង TOTAL EXPENSES</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">ចំនួនបុរេប្រទាន ADVANCED AMOUNT</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;">ប្រាក់ត្រូវ NET AMOUNT DUE <input type="checkbox" name="nad"> បង់អោយបុគ្គលិក TO STAFF <input type="checkbox" name="ts"> ទទួលពីបុគ្គលិក FROM STAFF <input type="checkbox" name="fs"></td>
        			<td></td>
        		</tr>
        	</table>
        	<table class="span12 left-tbl" >
        		<tr>
        			<td colspan="2" style="background: #c6d9f1;border-top: none;text-align:right;padding-right:5px;">
        				 ចំនួនជាអក្សរ<br>Amount in Words
        			</td>
        			<td colspan="3" style="border-top: none;">&nbsp;</td>
        		</tr>
        		<tr>
        			<td colspan="2"></td>
        			<td style="background: #000; color: #fff;text-align:center;">SIGNATURE</td>
        			<td style="background: #000; color: #fff;text-align:center;">POSITION</td>
        			<td style="background: #000; color: #fff;text-align:center;">DATE</td>
        		</tr>
        		<tr>
        			<td style="text-align:center;" rowspan="4" width="20"></td>
        			<td width="100" style="background: #c6d9f1;">រៀបចំដោយ<br>PREPARED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;">ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		
        		<tr>
        			<td style="background: #c6d9f1;"><b>សំរេចដោយ<br>APPROVED BY</b></td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;">កត់ត្រាដោយ<br>POSTED BY</td>
        			<td></td>
        			<td></td>
        			<td></td>
        		</tr>
        	</table>
        	
        </div>
    </div>
</script>
<script id="invoiceForm22" type="text/x-kendo-template">
	<div class="inv1 pcg-cash">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<h2 data-bind="text: obj.title"></h2>
        	</div>
        	<div class="span12" style="background:none;margin-top: 15px;">
        		<table class="span12 left-tbl" border="1">
        			<tr>
        				<td width="200" style="text-align:center;"><b>លេខសក្ខីប័ត្រ JV No.</b></td>
        				<td width="200" style="text-align:center;" data-bind="text: obj.number"></td>
        				<td width="200" style="text-align:center;"><b>កាលបរិច្ឆេត Date<b></td>
        				<td width="200" style="text-align:center;" data-bind="text: obj.issued_date"></td>
        			</tr>
        			<tr>
        				<td colspan="4">ប្រភេទប្រតិបត្តិការ Type of transaction : <span data-bind="text: obj."></span></td>
        			</tr>
        			
        			<tr>
        				<td colspan="4">Please specify, if applicable</td>
        			</tr>
        			<tr>
        				<td width="200">វិក្ក័យប័ត្រ Invoice No.</td>
        				<td width="200"></td>
        				<td width="200">សក្ខីប័ត្របុរេប្រទាន<br>Advance Voucher No.</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">សក្ខីប័ត្របំណុល<br>AP Voucher No.</td>
        				<td width="200"></td>
        				<td width="200">សក្ខីប័ត្រចំណាយ<br>Payment Voucher No</td>
        				<td width="200"></td>
        			</tr>
        			<tr>
        				<td width="200">សក្ខីប័ត្រទិន្នានុប្បវត្តិ<br>Journal Voucher No.</td>
        				<td width="200"></td>
        				<td width="200">Other</td>
        				<td width="200"></td>
        			</tr>
        		</table>
        	</div>
        	<table class="span12 left-tbl" style="margin-top: 5px;">
        		<tr>
        			<td style="background: #c6d9f1;">
        				 ពន្យាល់ Description of the transaction
        			</td>
        		</tr>
        		<tr>
        			<td style="padding: 5px 0;">&nbsp;</td>
        		</tr>
        	</table>
        	<table class="span12" style="margin-top: 5px;">
        		<tr>
        			<th><b>លេខកូជគណនី<br>Account Code</b></th>
        			<th><b>ឈ្មោះគណនី</b>Account Name</th>
        			<th><b>ពិពណ៌នា Description</b></th>
        			<th><b>ឥណពន្ធ<br>Debit</b></th>
        			<th><b>ឥណទាន<br>Credit</b></th>
        		</tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td></tr>
        		<tr>
        			<td colspan="3" style="text-align: right;padding-right: 5px;"><b>សរុប Total</b></td>
        			<td></td>
        			<td></td>
        		</tr>
        	</table>
        	<div class="span12" style="background: #eee;padding: 5px;">
    			<div class="span3">
    				<p style="margin-bottom:30px;font-size:10px;">រៀបចំដោយ<br>Prepared by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
    			</div>
    			<div class="span3">
    				<p style="margin-bottom:30px;font-size:10px;">ត្រួតពិនិត្យដោយ<br>Reviewed by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
    			</div>
    			<div class="span3">
    				<p style="margin-bottom:30px;font-size:10px;font-weight:bold;">អ្នកអនុម័ត<br>Approved by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
    			</div>
        		<div class="span3">
        			<p style="margin-bottom:30px;font-size:10px;">អ្នកកត់ត្រា<br>Recorded by:</p>
    				_______________
    				<p style="font-size:10px;">Name: <br>Date:</p>
        		</div>
        	</div>
        	
        </div>
    </div>
</script>
<script id="invoiceForm23" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span3" style="margin-right: 15px;">
        			<b>Customer Information</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span3">
        			<b>Delivered to</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>PO Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>PO No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span3">TERM OF PAYMENT</div>
        		<div class="span3">MODE OF PAYMENT</div>
        		<div class="span3">DELIVERY DATE</div>
        		<div class="span3">SALE REP</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th width="90">CODE</th>
        				<th>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>QTY</th>
        				<th>UNIT PRICE</th>
        				<th width="80">Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template6"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="3"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td style="border:none;" colspan="3"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">TAX (Rate:       )</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td style="border:none;" colspan="3"></td>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="120">PREPARED BY</td><td width="100"></td>
        			<td>POSITION</td><td width="100"></td>
        			<td>DATE</td><td width="80"></td>
        		</tr>
        		<tr>
        			<td>REVIEWED BY</td><td></td>
        			<td>POSITION</td><td></td>
        			<td>DATE</td><td></td>
        		</tr>
        		<tr>
        			<td>APROVED BY</td><td></td>
        			<td>POSITION</td><td></td>
        			<td>DATE</td><td></td>
        		</tr>
        		<tr>
        			<td>ACCEPTED BY</td><td></td>
        			<td>POSITION</td><td></td>
        			<td>DATE</td><td></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm24" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header" style="background:none;">
        		<div class="span3" style="margin-right: 15px;">
        			<b>Customer Information</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<b>Address: </b> <span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span6" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title" style="font-size: 26px"></p>
        			<p><b>Sale Order Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>Sale Order No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12">
        		<tr>
        			<td style="background: #c6d9f1;text-align: left;padding-left: 5px;" width="150"><b>SALE ORDER #</b></td>
        			<td width="100"><b></b></td>
        			<td width="150" style="background: #c6d9f1;text-align: left;padding-left: 5px;"><b>INVOICE #</b></td>
        			<td><b></b></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1;text-align: left;padding-left: 5px;"><b>JOB/ CONTRACT #</b></td>
        			<td><b></b></td>
        			<td style="background: #c6d9f1"><b></b></td>
        			<td><b></b></td>
        		</tr>
        	</table>
        	<table class="span12" style="margin: 5px 0;">
        		<thead>
        			<tr>
        				<th width="50" style="background: #c6d9f1;">NO</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">ITEM CODE</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">DESCRIPTION</th>
        				<th style="background: #c6d9f1;">ឯកតា<br>UM</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">QTY</th>
        				<th style="background: #c6d9f1;text-align: left;padding-left: 5px;">REMARK</th>
        			</tr>
        		</thead>
        		<tbody id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template14"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12">
        		<tr>
        			<td style="background: #c6d9f1" width="150">ISSUED BY</td>
        			<td width="100"></td>
        			<td width="150" style="background: #c6d9f1">DATE</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">DELIVERED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">RECEIVED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE/TIME</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td style="background: #c6d9f1">ACKNOWLEDGED BY</td>
        			<td></td>
        			<td style="background: #c6d9f1">DATE/TIME</td>
        			<td></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm25" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span12">
	        	<div class="span7">
	        		<div class="logo" style="width: 40%">
		            	<img style="width: " data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
		            </div>
	        	</div>
	        	<div class="span5">
	        		<div class="span12" style="margin-bottom: 10px;">
	        			<h2 style="font-size: 24px;text-align: left;color:#10253f " data-bind="text: obj.title"></h2>
	        			<!--img src="<?php echo base_url(); ?>assets/invoice/img/official-receipt.jpg" /-->
	        		</div>
	        		<div class="span12">
	        			<table class="span12">
	        				<tr>
	        					<td class="light-blue-td" width="100">កាលបរិច្ឆេទ Date</td>
	        					<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.issued_date"></td>
	        				</tr>
	        				<tr>
	        					<td class="light-blue-td">លេខបបង្កាន់ដៃ Receipt No.</td>
	        					<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.number"></td>
	        				</tr>
	        			</table>
	        		</div>
	        	</div>
	        </div>
        	<div class="span12" style="margin-top: 10px;">
		    	<div class="span7" style="margin-top: 10px;">
		    		<table class="span11">
						<tr>
							<td class="light-blue-td" width="120">ទទួលពីឈ្មោះ​ <br>Recieve From</td>
							<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.issued_date"></td>
						</tr>
						<tr>
							<td class="light-blue-td">អស័យដ្ឋាន <br>Contact Address</td>
							<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.contact[0].address"></td>
						</tr>
						<tr>
							<td class="light-blue-td">គោលបំណង​​ <br>Purpose</td>
							<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.memo"></td>
						</tr>
						<tr>
							<td class="light-blue-td">លេខយោង <br> Reference Document</td>
							<td style="text-align: left;padding-left: 5px;" data-bind="text: obj.reference_id"></td>
						</tr>
					</table>
		    	</div>
		    	<div class="span5" style="float:right">
		    		<p style="padding: 5px 0; text-align: left;font-weight: bold;color: #000;">ចំនួនទទួលសរុប​ <br> TOTAL RECEIVED AMOUNT</p>
		    		<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}">
		    			<p><span class="total-amount" data-bind="text: obj.amount"></span></p>		    			
		    		</div>
		    		<p style="padding: 5px 0;font-weight: bold;color: #000;clear:both;">វិធីសាស្រ្តទូទាត់​ Mode of payment</p>
		    		<p style="padding: 5px 0;font-weight: bold;color: #000;clear:both;" data-bind="text: obj.payment_method"></p>
		    	</div>
		    </div>
        	<div class="span12">
        		<div class="span8">
        			<p style="color:black;margin: 10px 0;" data-bind="text: obj.note"></p>
        		</div>
        	</div>
        	<div class="span12">
        		<div class="span5">
        			<p>On behalf of <span data-bind="text: company.name"></span></p>
        			<div style="height: 60px;border-bottom: 1px solid #000" class="span12"></div>
        			<p style="font-weight: bold;">Name</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p>Paid By:</p>
        			<div style="height: 60px;border-bottom: 1px solid #000" class="span12"></div>
        			<p style="font-weight: bold;">Name</p>
        		</div>
        	</div>
        	<div style="margin-top: 15px" class="span12">
        		<p>Address: <span data-bind="text: company.address"></span> <sapn data-bind="text: company.city"></sapn> <span data-bind="text: company.country.name"></span>.</p>
        	</div>
        </div>
    </div>
</script>
<script id="invoiceForm26" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<table class="span12 left-tbl">
        		<tr>
        			<td colspan="4" rowspan="2" data-bind="style: {backgroundColor: obj.color}" style="text-align:center;padding-left:0;" class="main-color">
        			ប័ណ្ណកែតម្រូវបរិមាណសន្និធិ<br>Material Adjustment Note
        			</td>
        			<td colspan="2">កាលបរិច្ឆេត Date</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="2">លេខ MA No</td>
        			<td></td>
        		</tr>
        		<tr>
        			<td colspan="2" width="100">
        				គម្រោង Project
        			</td>
        			<td colspan="2" width="100">

        			</td>
        			<td colspan="2">
        				ផល្ូវ Street #
        			</td>
        			<td width="120">

        			</td>
        		</tr>
        		<tr>
        			<td colspan="2">
        				ល្វែង Bloc #
        			</td>
        			<td colspan="2">

        			</td>
        			<td colspan="2">
        				អគារ House #
        			</td>
        			<td>

        			</td>
        		</tr>
        		<tr>
        			<td colspan="2">
        				មេការ
        			</td>
        			<td colspan="2">

        			</td>
        			<td colspan="2">
        				មេជាង
        			</td>
        			<td>

        			</td>
        		</tr>
        		<tr class="center-tbl" style="background: #c6d9f1;">
        			<td>
        				ល.រ<br>No
        			</td>
        			<td colspan="2">
        				ប្រភេទសន្និធិ ឬ​សម្ភារៈ<br>Item Description
        			</td>
        			<td>
        				លេខកូដ<br>Sku
        			</td>
        			<td>
        				ខ្នាត<br>UM
        			</td>
        			<td>
        				ចំនួន Qty
        			</td>
        			<td>
        				ផ្សេងៗ Remark
        			</td>
        		</tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td>&nbsp;</td><td colspan="2"></td><td></td><td></td><td></td><td></td></tr>
        		<tr><td colspan="7"></td></tr>
        		<tr>
        			<td colspan="2" width="100">
        				អ្នករៀបចំ<br>Prepared By
        			</td>
        			<td colspan="2" width="100">

        			</td>
        			<td colspan="2">
        				អ្នកយល់ព្រម<br>Approved By
        			</td>
        			<td width="120">

        			</td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm27" type="text/x-kendo-template">
	<div class="inv1">
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear mid-header" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
        	<div class="clear">
            	<table cellpadding="0" cellspacing="0" border="1" class="span12">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សរុប Total</td>
                            <td data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">ប្រាក់កក់ Deposit</td>
                            <td data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td data-bind="text: obj.amount_due"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<script id="invoiceForm28" type="text/x-kendo-template">
	<div class="inv1">
    	<div class="head">
        	<div class="logo">
            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
            </div>
            <div class="cover-name-company">
            	<h2 ></h2>
                <h3 style="text-align:left;" data-bind="text: company.name"></h3>
                <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span>
                </div>
                <div class="clear">
                	<pre>អាស័យ​ដ្ឋាន Address: <span data-bind="text: company.address"></span></pre>
                    <pre>ទូរស័ព្ទលេខ HP <span data-bind="text: company.phone"></span></pre>
                </div>
            </div>
        </div>
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
        	<div class="clear">
            	<table cellpadding="0" cellspacing="0" border="1" class="span12">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សរុប (បូក​បញ្ចូល​ទាំង​អាករ)​ Total (VAT included)</td>
                            <td data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">ប្រាក់កក់ Deposit</td>
                            <td data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td data-bind="text: obj.amount_due"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ទទួលបាន Cash Receipt</td>
                            <td data-bind="text: obj.cash_receipt"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សមតុល្យ Balance</td>
                            <td data-bind="text: obj.balance"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<script id="invoiceForm29" type="text/x-kendo-template">
	<div class="inv1">
    	<div class="head">
        	<div class="logo">
            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
            </div>
            <div class="cover-name-company">
            	<h2 ></h2>
                <h3 style="text-align:left;" data-bind="text: company.name"></h3>
                <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span>
                </div>
                <div class="clear">
                	<pre>អាស័យ​ដ្ឋាន Address: <span data-bind="text: company.address"></span></pre>
                    <pre>ទូរស័ព្ទលេខ HP <span data-bind="text: company.phone"></span></pre>
                </div>
            </div>
        </div>
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រអាករ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                    <div class="vattin">
                	<p>លេខ​អត្ត​សញ្ញាណ​កម្ម អតប (VATTIN)</p><span id="vat_number" data-bind="text: company.vat_number"></span><p style="font-size:8px;font-weight:normal;margin-left: 8px;">(ប្រសិន​បើ​មាន / If any)</p>
                	</div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
            
        	<div class="clear inv2">
            	<table cellpadding="0" cellspacing="0" border="1" style="width:100%;">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">សរុប​ Sub Total</td>
                            <td data-bind="text: obj.sub_total"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">អាករ​លើ​តម្លៃ​បន្ថែម ១០% VAT (10%)</td>
                            <td data-bind="text: obj.tax"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">សរុបរួម​ Grand Total</td>
                            <td data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">ប្រាក់កក់ Deposit</td>
                            <td data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">
                        	សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td data-bind="text: obj.amount_due"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">
                        	សាច់ប្រាក់ទទួលបាន Cash Receipt</td>
                            <td data-bind="text: obj.cash_receipt"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding-right:10px;font-weight:bold;">
                        	សមតុល្យ Balance</td>
                            <td data-bind="text: obj.balance"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<script id="invoiceForm30" type="text/x-kendo-template">
	<div class="inv1">
        <div class="content">
        	<div style="overflow: hidden;padding:10px 0;">
        		<h1>វិក្កយបត្រ</h1>
            	<h2 data-bind="text: obj.title"></h2>
        	</div>
            <div class="clear" style="padding: 10px;background: #dce6f2;padding-bottom: 10px;">
            	<div class="cover-customer">
                	<h5>ព័ត៌មានអតិថិជន​ CUSTOMER INFO:</h5>
                    <div class="clear">
                        <div class="left dotted-ruler" style="width: 62%;">
                        	<p style="font-weight:bold">
                        		<span data-bind="text: obj.contact[0].name"></span><br>
                        		<span data-bind="text: obj.contact[0].address"></span>
                        	</p>
                        </div>
                    </div>
                    <div class="clear">
                    	<!--div class="left">
                    		<p>ទូរស័ព្ទ​លេខ HP:</p>
                        </div-->
                        <div class="left dotted-ruler" style="width: 78%;">
                        	<p style="font-weight:bold" data-bind="text: obj.contact[0].phone"></p>
                        </div>
                    </div>
                </div>
                <div class="cover-inv-number">
                	<div class="clear">
                    	<div class="left">
                    		<p>លេខ No. :</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 42%;">
                        	<p style="font-weight:bold" data-bind="text: obj.number"></p>
                        </div>
                    </div>
                    <div class="clear">
                    	<div class="left">
                    		<p>កាល​បរិច្ឆេទ Date:</p>
                        </div>
                        <div class="left dotted-ruler" style="width: 57%;">
                        	<p style="font-weight:bold" data-bind="text: obj.issued_date"></p>
                        </div>
                    </div>
                </div>
            </div>
        	<div class="clear">
            	<table cellpadding="0" cellspacing="0" border="1" class="span12">
                	<thead>
                        <tr class="main-color" style="height: 45px;" data-bind="style: {backgroundColor: obj.color}">
                            <th>ល.រ<br />N<sup>0</sup></th>
                            <th>បរិយាយ​មុខ​ទំនិញ<br />Description</th>
                            <th>បរិមាណ<br />Quantity</th>
                            <th>ថ្លៃឯកតា​<br />Unit Price</th>
                            <th>ថ្លៃ​ទំនិញ<br />Amount</th>
                        </tr>
                    </thead>
                    <tbody style="margin-top: 2px" id="formListView" data-role="listview"
										 data-auto-bind="false"
						                 data-template="invoiceForm-lineDS-template"
						                 data-bind="source: lineDS">
                    </tbody>
                    <tfoot>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">បញ្ចុះតម្លៃ Discount</td>
                            <td data-bind="text: obj.discount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សរុប Total</td>
                            <td data-bind="text: obj.amount"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">ប្រាក់កក់ Deposit</td>
                            <td data-bind="text: obj.deposit"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ត្រូវទូទាត់ Amount Due</td>
                            <td data-bind="text: obj.amount_due"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សាច់ប្រាក់ទទួលបាន Cash Receipt</td>
                            <td data-bind="text: obj.cash_receipt"></td>
                        </tr>
                        <tr>
                        	<td colspan="4" style="text-align:right;padding:5px;font-weight: bold;">សមតុល្យ Balance</td>
                            <td data-bind="text: obj.balance"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
        <div class="foot">
        	<div class="cover-signature">
            	<div class="singature" style="float:left">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នក​ទិញ<br />Customer's Signature & Name</p>
                </div>
                <div class="singature" style="float:right">
                	<p>ហត្ថលេខា និងឈ្មោះ​អ្នកលក់<br />Seller's Signature & Name</p>
                </div>
            </div>
            <h6>សម្គាល់៖ <span>ច្បាប់​ដើម​សម្រាប់​អ្នក​ទិញ ច្បាប់​ចម្លង​សម្រាប់​អ្នក​លក់</span><br /><span style="font-size: 10px"><strong>Note:</strong> Original invoice for customer, copied invoice for seller</span></h6>
        </div>
    </div>
</script>
<script id="invoiceForm31" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" style="font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template31"
						data-bind="source: lineDS">
        		
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">ចេញដោយ <br>ISSUED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">ដឹកជញ្ជូន <br>DELIVERED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm32" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" style="font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template31"
						data-bind="source: lineDS">
        		
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">ចេញដោយ <br>ISSUED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">ដឹកជញ្ជូន <br>DELIVERED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm33" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template33"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">ចេញដោយ <br>ISSUED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">ដឹកជញ្ជូន <br>DELIVERED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm34" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអតិថិជន CUSTOMER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template33"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">ចេញដោយ <br>ISSUED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">ដឹកជញ្ជូន <br>DELIVERED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm35" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង់ SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT COST</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template6"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm36" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង់ SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT COST</th>
        				<th width="80" class="rside">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template6"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;text-align: left;" colspan="3" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" class="rside" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color lside" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td class="rside" style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm37" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង់ SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT COST</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template8"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm38" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			<div class="span12 main-color order-price" data-bind="style: {backgroundColor: obj.color}"><p>សរុប TOTAL <span data-bind="text: obj.amount"></span></p></div>
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង់ SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<div class="span12 mid-title main-color" data-bind="style: {backgroundColor: obj.color}">
        		<div class="span6" style="text-align: left;padding-left: 10px;">ល្ខខណ្ឌ<br>TERM OF PAYMENT</div>
        		
        		<div class="span6" style="text-align: left;padding-left: 10px;">សុពលភាព <br>VALIDITY PERIOD</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">តម្លៃ​ឯកតា<br>UNIT COST</th>
        				<th class="rside" width="80">សរុប<br>Total</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template8"
						data-bind="source: lineDS">
        		<tfoot>
        			<tr>
        				<td style="border:none;" colspan="2" rowspan="4" data-bind="text: obj.note"></td>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">បញ្ចុះតម្លៃ Discount</td>
        				<td class="rside" style="background-color: #eee;" data-bind="text: obj.discount"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">សរុបរង SUB TOTAL</td>
        				<td style="background-color: #eee;" data-bind="text: obj.sub_total"></td>
        			</tr>
        			<tr>
        				<td colspan="2" style="text-align: left;padding-left: 10px;color: #000;font-weight:bold;">ពន្ធ TAX</td>
        				<td style="background-color: #eee;" data-bind="text: obj.tax"></td>
        			</tr>
        			<tr>
        				<td colspan="2" class="main-color" data-bind="style: {backgroundColor: obj.color}" style="text-align: center;color: #fff;font-weight:bold;">សរុបរួម GRAND TOTAL</td>
        				<td style="background-color: #dce6f2;" data-bind="text: obj.amount"></td>
        			</tr>
        		</tfoot>
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 20px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm39" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" style="font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template31"
						data-bind="source: lineDS">
        		
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm40" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" style="float:right">
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear mid-header">
        		<div class="span7" style="margin-right: 15px;">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        		<div class="span4" style="float:right;">
        			<p class="form-title" style="font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template31"
						data-bind="source: lineDS">
        		
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm41" type="text/x-kendo-template">
	<div class="inv1 pcg">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template33"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>
<script id="invoiceForm42" type="text/x-kendo-template">
	<div class="inv1 pcg pcg-border">
        <div class="content clear">
        	<div class="span5">
        		<div class="logo" style="width: 50%">
	            	<img data-bind="attr: { src: company.logo.url, alt: company.name, title: company.name }" />
	            </div>
        	</div>
        	<div class="span7">
        		<div class="span5" style="margin-right: 30px;">
        			<p data-bind="text: company.name"></p>
        			<p><b>អស័យដ្ឋាន Address:</b> <span data-bind="text: company.address"></span></p>
        		</div>
        		<div class="span5" >
        			<p><b>Tel: </b><span data-bind="text: company.phone"></span></p>
        			<p><b>Email: </b><span data-bind="text: company.email"></span></p>
        			<p><b>Website: </b><span data-bind="text: company.website"></span></p>
        		</div>
        	</div>
        	<div class="span12 clear" style="margin: 20px 0;">
        		<div class="span4" style="margin-right:45px;">
        			<p class="form-title" style="margin-bottom: 15px;font-size: 24px;" data-bind="text: obj.title"></p>
        			<p><b>កាលបរិច្ឆេត Date : </b><span data-bind="text: obj.issued_date"></span></p>
        			<p><b>លេខ No. : </b><span data-bind="text: obj.number"></span></p>
        			
        		</div>
        		<div class="span7">
        			<b style="font-size: 14px;line-height: 24px;">ព័ត៌មានអ្នកផ្គត់ផ្គង SUPPLIER INFO</b><br><br>
        			<p><span data-bind="text: obj.contact[0].name"></span><br>
        			<span data-bind="text: obj.contact[0].address"></span>
        			</p>
        		</div>
        	</div>
        	<table class="span12" rules="rows">
        		<thead>
        			<tr class="main-color ten">
        				<th width="90">លេខកូដ<br>CODE</th>
        				<th class="lside">ពិពណ៌នា<br>ITEM DESCRIPTION</th>
        				<th>ឯកតា<br>UM</th>
        				<th>ចំនួន<br>QTY</th>
        				<th class="rside">កំណត់សំគាល់<br>REMARK</th>
        			</tr>
        		</thead>
        		<tbody style="margin-top: 2px" id="formListView" 
        				data-role="listview"
						data-auto-bind="false"
						data-template="invoiceForm-lineDS-template33"
						data-bind="source: lineDS">
        	</table>
        	<table class="span12 left-tbl ten" rules="rows" style="margin-top: 40px;">
        		<tr>
        			<td width="90">រៀបចំដោយ <br>PREPARED BY</td><td width="120"></td>
        			<td width="80">តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        		<!--tr>
        			<td>ត្រួតពិនិត្យដោយ<br>REVIEWED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr-->
        		<tr>
        			<td>អនុម័តដោយ<br>APPROVED BY</td><td></td>
        			<td>តំណែង<br>POSITION</td><td width="80"></td>
        			<td>កាលបរិច្ឆេទ<br>DATE</td><td width="120"></td>
        		</tr>
        	</table>
        </div>
    </div>
</script>

<script id="invoiceCustom-txn-form-template" type="text/x-kendo-template">
	<a class="span4 #= type #" data-id="#= id #" data-bind="click: selectedForm" style="padding-right: 0; width: 32%;">
    	<img src="<?php echo base_url(); ?>assets/invoice/img/#= image_url #.jpg" alt="#: name # image" />
    </a>
</script>
<script id="invoiceForm-lineDS-template" type="text/x-kendo-template">
	<tr>
		<td><i>#:banhji.invoiceForm.lineDS.indexOf(data)+1#</i>&nbsp;</td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template3" type="text/x-kendo-template">
	<tr>
		<td><i>#:banhji.invoiceForm.lineDS.indexOf(data)+1#</i></td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td style="text-align: left; padding-left: 5px;"></td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template4" type="text/x-kendo-template">
	<tr>
		<td><i>#:banhji.invoiceForm.lineDS.indexOf(data)+1#</i></td>
		<td style="text-align: left; padding-left: 5px;"></td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td></td>
		<td></td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template5" type="text/x-kendo-template">
	<tr>
		<td style="text-align: left; padding-left: 5px;">&nbsp;</td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td style="text-align: right; padding-right: 5px;"></td>
		<td style="text-align: right; padding-right: 5px;"></td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template6" type="text/x-kendo-template">
	<tr>
		<td >&nbsp;#= item_id #</td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="background-color: \\#eee">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template8" type="text/x-kendo-template">
	<tr>
		<td style="text-align: left; padding-left: 5px;">&nbsp;#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="background-color: \\#eee">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template10" type="text/x-kendo-template">
	<tr>
		<td >&nbsp;#= item_id #</td>
		<td class="lside" style="text-align: left; padding-left: 5px;">#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td class="rside" style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td class="rside" style="background-color: \\#eee">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template12" type="text/x-kendo-template">
	<tr>
		<td style="text-align: left; padding-left: 5px;">#= description.length>0 ? description: "&nbsp;"#</td>
		<td style="text-align: left; padding-left: 5px;">#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="background-color: \\#eee;text-align: right; padding-right: 5px;">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template14" type="text/x-kendo-template">
	<tr>
		<td>#:banhji.invoiceForm.lineDS.indexOf(data)+1#</td>
		<td style="text-align: left; padding-left: 5px;"></td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;"></td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template19" type="text/x-kendo-template">
	<tr>
		<td>#:banhji.invoiceForm.lineDS.indexOf(data)+1#</td>
		<td style="text-align: left; padding-left: 5px;"></td>
		<td style="text-align: left; padding-left: 5px;"></td>
		<td></td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template31" type="text/x-kendo-template">
	<tr>
		<td style="text-align: left; padding-left: 5px;">&nbsp;</td>
		<td style="text-align: left; padding-left: 5px;">#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
	</tr>
</script>
<script id="invoiceForm-lineDS-template33" type="text/x-kendo-template">
	<tr>
		<td style="text-align: left; padding-left: 5px;">&nbsp;#= description#</td>
		<td>#= item_prices.length>0 ? item_prices[0].measurement : "" #</td>
		<td>#= quantity#</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(price, "c", locale) #</td>
		<td style="text-align: right; padding-right: 5px;">#= kendo.toString(amount, "c", locale) #</td>
	</tr>
</script>





<!-- ***************************
*	Cash Section      	  *
**************************** -->
<script id="cashier" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">				
			<div class="span12">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.cashier"></span></h3>

					<div class="row-fluid">
						<div class="span3">
							<br>

							<input id="ddlContact" data-bind="value: customer_id" style="width: 100%"  />

							<br><br>							
					      					
							<h5><i class="icon-info-sign"></i> <span data-bind="text: lang.lang.customer_info"></span></h5>				
							<table width="100%" style="background-color:Silver; color:black;">
								<tr>
									<td colspan="2">
										<i class="icon-user icon-li icon-fixed-width"></i> 
										<span data-bind="text: customer.fullIdName"></span>										
									</td>																			
								</tr>
								<tr>
									<td colspan="2">								
										<span data-bind="text: lang.lang.balance"></span>: <span data-bind="text: customer.balance"></span>
										<span data-bind="text: customer.currency[0].code">
									</td>
								</tr>
								<tr>
									<td colspan="2">
										<span data-bind="text: lang.lang.deposit"></span>: <span data-bind="text: customer.deposit"></span>
										<span data-bind="text: customer.currency[0].code">
									</td>							
								</tr>
								<tr>
									<td>
										<i class="icon-money icon-li icon-fixed-width"></i> <span data-bind="text: customer.currency[0].code"></span>
									</td>
									<td>
										<i class="icon-phone icon-li icon-fixed-width"></i> <span data-bind="text: customer.phone"></span>
									</td>
								</tr>											
								<tr>
									<td colspan="2">
										<i class="icon-home icon-li icon-fixed-width"></i> <span data-bind="text: customer.address"></span>
									</td>						
								</tr>
							</table>

							<br>			
							
							<h5><i class="icon-list"></i> <span data-bind="text: lang.lang.activities"></span></h5>

							<table class="table table-bordered table-striped table-white">
						        <thead>
						            <tr>
						            	<th><span data-bind="text: lang.lang.date"></span></th>						                
						                <th><span data-bind="text: lang.lang.type"></span></th>						                
						                <th><span data-bind="text: lang.lang.amount"></span></th>						                						                
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false"					        		 
						        		data-template="cashier-transaction-row-template" 
						        		data-bind="source: transactionDS"></tbody>						        					        
						    </table>
							
							<div id="pager" class="k-pager-wrap"					    		
				             	data-role="pager"
				             	data-auto-bind="false" 
				             	data-bind="source: transactionDS"></div>
						
						</div> <!-- //End span3 -->

						<div id="exampleValidator" class="span9">
							<div class="row-fluid">
								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="javascript:void(0)" class="widget-stats widget-stats-gray widget-stats-4"> 
											<span class="txt"><span data-bind="text: lang.lang.customer"></span></span>
											<span class="count" data-bind="text: total_customer"></span>
											<span class="glyphicons user"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i> 
										</a>
									</div>
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="#/wPayment_summary" class="widget-stats widget-stats-primary widget-stats-4">
											<span class="txt"><span data-bind="text: lang.lang.today_payment"></span></span>
											<span class="count"><span data-bind="text: total_payment" style="font-size: 35px;"></span></span>
											<span class="glyphicons coins"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i>
										</a>
									</div>
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a href="#/reconcile" class="widget-stats widget-stats-inverse widget-stats-5">
											<span class="glyphicons refresh"><i></i></span>
											<span class="txt"><span data-bind="text: lang.lang.reconcile"></span> &<br><br> <span data-bind="text: lang.lang.transfer"></span></span>
											<div class="clearfix"></div>
										</a>
									</div>
								</div>				

							</div> <!-- //End row-fluid -->
														
							<br>

							<table class="table table-bordered table-striped table-white">
						        <thead>
						            <tr>
						                <th></th>
						                <th><span data-bind="text: lang.lang.no"></span></th>						                
						                <th><span data-bind="text: lang.lang.date"></span></th>
						                <th><span data-bind="text: lang.lang.name"></span></th>
						                <th><span data-bind="text: lang.lang.invoice"></span></th>
						                <th class="right"><span data-bind="text: lang.lang.amount"></span></th>
						                <th class="right"><span data-bind="text: lang.lang.pay"></span></th>							                
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false"					        		 
						        		data-template="cashier-row-template" 
						        		data-bind="source: invoiceList"></tbody>
						        <tfoot data-template="cashier-footer-template" 
						        		data-bind="source: this"></tfoot>						        
						    </table>						    

							<br>
							
							<span id="notification"></span>

							<div class="row-fluid">
								<div class="span4">						
									<table>
										<tr>
											<td><span data-bind="text: lang.lang.payment_date"></span></td>
						              		<td>
						              			<input id="txtPaymentDate" name="txtPaymentDate" 
						              				data-role="datepicker" 
						              				data-format="dd-MM-yyyy"
						              				data-parse-formats="dd-MM-yyyy"
							              			data-bind="value: payment_date" 
							              			required data-required-msg="ត្រូវការ ថ្ងៃទទួលប្រាក់" />
											</td>
										</tr>										
										<tr>
						                    <td><span data-bind="text: lang.lang.payment_method"></span></td>
						                  	<td>
						                  		<input id="ddlPaymentMethod" id="ddlPaymentMethod"
						                  			   data-role="dropdownlist"
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: payment_method_id,
									                              source: paymentMethodDS"									                   
									                   required data-required-msg="ត្រូវការ វីធីបង់ប្រាក់" />						                  					                  		
						                  	</td>
						                <tr>
										<tr>
							                <td><span data-bind="text: lang.lang.cheque"></span></td>
							                <td><input id="check_no" class="k-textbox" data-bind="value: check_no" style="width: 161px;" /></td>
							            <tr>
							            <tr>
											<td><span data-bind="text: lang.lang.cash_account"></span></td>
											<td>
												<input id="ddlCashAccount" name="ddlCashAccount" 
														data-bind="value: account_id" 
														required data-required-msg="required" />												
											</td>
										</tr>										
									</table>							
								</div>																
								<div class="span4">
									<table>	
										<tr>
											<td><span data-bind="text: lang.lang.total_payment"></span>:</td>
											<td align="right"><span data-bind="text: pay_amount"></span></td>
										</tr>									
										<tr>
											<td><span data-bind="text: lang.lang.discount"></span>:</td>
											<td>
												<input data-role="numerictextbox" 
														data-format="c0" data-culture="km-KH" 
														data-bind="value: discount, events: {change : change}" />
											</td>
										</tr>
										<tr>
											<td><span data-bind="text: lang.lang.fine"></span>:</td>							
											<td>
												<input data-role="numerictextbox" 
														data-format="c0" data-culture="km-KH" 
														data-bind="value: fine, events: {change : change}" />
											</td>
										</tr>										
										<tr>
											<td><span data-bind="text: lang.lang.remain"></span>:</td>
											<td align="right"><span data-bind="text: remain"></span></td>
										</tr>
									</table>		          	
								</div>

								<div class="span4">
									<div class="innerAll padding-bottom-none-phone">
										<a id="save" name="save" class="widget-stats widget-stats-info widget-stats-4">
											<span class="txt"><span data-bind="text: lang.lang.save"></span></span>
											<span class="count" style="font-size: 35px;" data-bind="text: receive_amount"></span>
											<span class="glyphicons cart_in"><i></i></span>
											<div class="clearfix"></div>
											<i class="icon-play-circle"></i>
										</a>
									</div>								
								</div>
							</div>							

						</div> <!-- //End span9 -->
					</div>
				</div> <!-- //End example -->
			</div>
		</div>
	</div>
</script>
<script id="cashier-transaction-row-template" type="text/x-kendo-tmpl">
    <tr>        
        <td>#:kendo.toString(new Date(issued_date), "dd-MM-yy")#</td>
        <td>#:type# </td>
        <td align="right">#:kendo.toString(kendo.parseFloat(amount), "c", locale)#</td>        
   	</tr>
</script>
<script id="cashier-row-template" type="text/x-kendo-tmpl">		
	<tr id="rowGrid-#:id#">
		<td>
			<input type="checkbox" data-bind="checked: isPay, events:{change: checkPay}">			
		</td>
		<td class="sno">1</td>			
		<td>#:kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>		
		<td>#=fullname#</td>
		<td>#:number#</td>				
		<td class="right">#:kendo.toString(amount, "c", locale)#</td>
		<td class="right">
			<input data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: pay_amount, events: {change : change}" 
					style="width: 120px;">
			<i class="icon-trash" data-bind="events: { click: remove "></i>						
		</td>				
    </tr>   
</script>
<script id="cashier-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="7" style="font-size:30px;">
            Total: #:total()#
        </td>
    </tr>
</script>

<script id="reconcile" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">	
				<div id="example" class="k-content">						
					
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>							

					<div align="center">
						<h4>Reconcile & Transfer</h4>							
						<span data-bind="text: str_date()"></span>
						<br>
						by
						<span data-bind="text: cashier_name"></span>
					</div>
					<br>
					<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Cash</th>	            				
	            				<th>Dollar Qty</th>
	            				<th>Riel Qty</th>
	            				<th>Dollar Amt</th>
	            				<th>Riel Amt</th>	            				
	            				<th>Dollar Qty Transfer</th>
	            				<th>Riel Qty Transfer</th>
	            				<th>Dollar Amt Transfer</th>
	            				<th>Riel Amt Transfer</th>		            				
	            			</tr>
	            		</thead>
	            		<tbody id="lvReconcileItem" data-role="listview"
	            				data-auto-bind="false"			            			
				                data-template="denominationRowTemplate"
				                data-bind="source: reconcileItemDS">
				        </tbody>
	            	</table>

					<br>

					<div class="row-fluid">
						<!-- //Reconcile -->
						<div class="span6" style="padding-left: 0;">
							<h4 class="heading">Reconcile</h4>

							<table class="table table-condensed">
								<tr>
									<td>Total Paid Today</td>
									<td></td>											
									<td class="right"><span class="count" data-bind="text: obj.received_amount"></span> ៛</td>												
								</tr>
								<tr>
									<td>Remain</td>
									<td></td>											
									<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.previous_amount"></span> ៛</td>												
								</tr>
								<tr>
									<td>Cash (A)</td>
									<td></td>												
									<td class="right"><span class="count" data-bind="text: obj.total_cash1"></span> ៛</td>
								</tr>

								<!-- Reconcile -->
								<tr>
									<td>Dollar</td>
									<td>
										$ <span class="count" data-bind="text: obj.usd_amount"></span> x
										<input data-role="numerictextbox" data-format="c0" data-culture="km-KH" data-min="0" data-bind="value: obj.rate, events:{change:change}"  style="width:90px;">
									</td>
									<td class="right"><span class="count" data-bind="text: obj.usd2khr_amount"></span> ៛</td>												
								</tr>
								<tr>
									<td>Riel</td>
									<td></td>
									<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.total_cash2"></span> ៛</td>												
								</tr>
								<tr>
									<td>Actual Cash (B)</td>
									<td></td>												
									<td class="right"><span class="count" data-bind="text: obj.reconciled_amount"></span> ៛</td>
								</tr>
								<tr id="reconcileAmount">
									<td>Reconcile(A-B)</td>
									<td></td>												
									<td class="right"><span class="count" data-bind="text: obj.reconciled_amount"></span> ៛</td>
								</tr>																				
							</table>
						</div>

						<!-- //Transfer -->
						<div class="span6" style="padding-right: 0;">								
							<h4 class="heading">Cash Transfer</h4>								
							
							<table class="table table-condensed">
								<tr>
									<td>Dollar Transfer</td>
									<td>
										$ <span class="count" data-bind="text: obj.transfer_usd"></span> x
										<input data-role="numerictextbox" data-format="c0" data-culture="km-KH" data-min="0" data-bind="value: obj.rate, events:{change:change}"  style="width:90px;">												
									</td>
									<td class="right"><span class="count" data-bind="text: obj.usd2khr_transfer_amount"></span> ៛</td>												
								</tr>
								<tr>
									<td>Riel Transfer</td>
									<td></td>
									<td class="right" style="border-bottom: 1px solid black;"><span class="count" data-bind="text: obj.transfer_khr"></span> ៛</td>												
								</tr>
								<tr>
									<td>Total Transfer</td>
									<td></td>												
									<td class="right"><span class="count" data-bind="text: obj.transfered_amount"></span> ៛</td>
								</tr>
								<tr>
									<td>Balance</td>
									<td></td>												
									<td class="right"><span class="count" data-bind="text: obj.balance"></span> ៛</td>
								</tr>
								<tr>
									<td>Transfer Account</td>
									<td>
										<input id="ddlCashAccount" name="ddlCashAccount" 
												data-bind="value: obj.transfer_account_id" 
												required data-required-msg="required" />
									</td>
									<td>
										<!-- Class here -->
					              	</td>
								</tr>
								<tr class="top">
									<td>Memo:</td>
									<td colspan="2">
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%; resize: none;" data-bind="value: obj.memo"></textarea>
									</td>										
								</tr>								
							</table>																																			
						</div>									
					</div>
					<div class="box-generic bg-action-button">
						<!-- Form actions -->
						<div align="right" data-bind="invisible: isExisting">
							<span id="notification"></span>

							<span class="btn btn-icon btn-success glyphicons share" data-bind="click: transferAll"><i></i>Transfer All</span>
							<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>							
							<span style="color: #fff;" class="btn btn-warning btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
						</div>
						<!-- // Form actions END -->
					</div>
				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->
	</div>
</script>
<script id="denominationRowTemplate" type="text/x-kendo-tmpl">		
	<tr>				
		<td class="right">#=denomination#</td>
		<td>
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: usd_qty, events: {change : change}" #: denomination>100 ? disabled="disabled" : "" # >
		</td>
		<td>
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: khr_qty, events: {change : change}" #: denomination<100 ? disabled="disabled" : "" # >
		</td>
		<td class="right">#:kendo.toString(usd_amount,'c')#</td>
		<td class="right">#:kendo.toString(khr_amount,'c0','km-KH')#</td>

		<td bgcolor="silver">
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: usd_transfer, events: {change : change}" #: denomination>100 ? disabled="disabled" : "" # >
		</td>
		<td bgcolor="silver">
			<input data-role="numerictextbox" data-format="n0" data-min="0" style="width:90px;"
				data-bind="value: khr_transfer, events: {change : change}" #: denomination<100 ? disabled="disabled" : "" # >
		</td>
		<td bgcolor="silver" class="right">#:kendo.toString(usd_transfer_amount,'c')#</td>
		<td bgcolor="silver" class="right">#:kendo.toString(khr_transfer_amount,'c0','km-KH')#</td>					
    </tr>   
</script>

<script id="cashTransaction" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 span data-bind="text: lang.lang.c_transaction"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 150px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.type"></span></td>
										<td>
											<input id="ddlType" name="ddlType"
												   data-role="dropdownlist"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.type,
								                              source: types,
								                              events:{ change: typeChanges }"							                   
								                   data-option-label="(--- Select ---)"
								                   required data-required-msg="required" 
								                   style="width: 100%;" />
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.currency"></span></td>
										<td>
											<input id="ddlCurrency" name="ddlCurrency"							            	 
					              				data-role="dropdownlist"
					              				data-template="currency-list-tmpl"
					              				data-value-primitive="true"
							            		data-text-field="code"
				           						data-value-field="locale"			           						 
							            		data-bind="source: currencyDS, 
							            					value: obj.locale,
							            					events:{change:setRate}"
							            		data-option-label="(--- Select ---)"						            		
							            		required data-required-msg="required" style="width: 100%;" />											
										</td>
									</tr>															
								</table>
							</div>
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							            <li class="span1 glyphicons pencil active"><a href="#tab1-3" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab2-3" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons history"><a href="#tab3-3" data-toggle="tab"><i></i></a>
							            </li>								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							        <!-- Memo Tab content -->
							        <div class="tab-pane active" id="tab1-3">
							        	<textarea id="memo2" cols="0" rows="4" class="k-textbox" 
							        		data-bind="value: obj.memo2" style="width:100%;" 
							        		placeholder="Please enter transaction purpose here ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab2-3">

							        	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							       
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th data-bind="text: lang.lang.file_name"></th>
									                <th data-bind="text: lang.lang.description"></th>
									                <th data-bind="text: lang.lang.date"></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->

							        <!-- Recuring Tab content -->
							        <div class="tab-pane" id="tab3-3">							            	
							            
							            <div class="span5">

								        	<input data-role="combobox"
							                   data-placeholder="Select existing recuring ..."
							                   data-value-primitive="true"
							                   data-auto-bind="false"
							                   data-text-field="recurring_name"
							                   data-value-field="id"
							                   data-bind="value: obj.recurring_id,
							                              source: recurringDS,
							                              events:{ change:applyRecurring }"
							                   style="width: 100%" />

							                <br><br>

							                <div align="right">
								                <span id="saveRecurring" class="btn btn-icon btn-default glyphicons history"><i></i> <span data-bind="text: lang.lang.save_recurring"></span></span>						                
								            </div>

							            </div>

							            <div class="span7">

								            <table style="width: 100%">
								            	<tr align="right">
								            		<td>
								            			<span data-bind="text: lang.lang.name"></span>
								            		</td>
								            		<td>
								            			<input class="k-textbox" data-bind="value: obj.recurring_name" 
								            					placeholder="Recurring name.." 
								            					style="width: 40%;" />
								            			<span data-bind="text: lang.lang.start"></span>
										                <input data-role="datepicker"
																data-format="dd-MM-yyyy"
																data-parse-formats="yyyy-MM-dd"
																data-bind="value: obj.start_date"
																style="width: 40%;" />
								            		</td>
								            	</tr>
								            	<tr align="right">
								            		<td>
									            		<span data-bind="text: lang.lang.every"></span>
									            	</td>
								            		<td>
									            		<input data-role="numerictextbox"
										                   data-format="n0"
										                   data-min="0"								                   
										                   data-bind="value: obj.interval"
										                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.frequency,
											                              source: frequencyList,
											                              events: { change: frequencyChanges }"
											                   style="width: 45%;" />
									            	</td>
								            	</tr>
									            <tr align="right">
									            	<td>
									            		<span data-bind="text: lang.lang.on"></span>
									            	</td>							            	
									            	<td>

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month,
											                   			  visible: showMonth,
											                              source: monthList"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.month_option,
											                   			  visible: showMonthOption,
											                              source: monthOptionList,
											                              events: { change: monthOptionChanges }"										                   
											                   style="width: 45%;" />

									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.week,
											                   			  visible: showWeek,
											                              source: weekDayList"										                  
											                   style="width: 45%;" />										            
											        
									            		<input data-role="dropdownlist"									                   
											                   data-value-primitive="true"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: obj.day,
											                   			  visible: showDay,
											                              source: dayList"										                   
											                   style="width: 45%;" />

									            	</td>
									            </tr>
								            </table>

								        </div>									     
							            
							        </div>
							        <!-- // Recuring Tab content END -->								        

							    </div>
							</div>

					    </div>
					</div>

					<h4 data-bind="text: fromToTop"></h4>				
					<table class="table table-borderless table-condensed cart_total">						
						<tr>
							<td style="width: 10%"><span data-bind="text: lang.lang.account"></span></td>
							<td style="width: 40%">
								<input id="cbbAccount" name="cbbAccount"
									   data-role="combobox"                   
					                   data-value-primitive="true"
					                   data-header-template="account-header-tmpl"                 
					                   data-template="account-list-tmpl"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.account_id,
					                              source: accountDS"
					                   data-placeholder="Add Account.."					                                      
					                   required data-required-msg="required" style="width: 100%" />
							</td>
							<td style="width: 10%"><span data-bind="text: lang.lang.segments"></span></td>
							<td style="width: 40%">
								<select data-role="multiselect"
									   data-value-primitive="true"
									   data-header-template="segment-header-tmpl"							   
									   data-item-template="segment-list-tmpl"				    
									   data-value-field="id" 
									   data-text-field="code"
									   data-bind="value: obj.segments, 
									   			source: segmentItemDS,
									   			events:{ change: transactionSegmentChanges }"
									   data-placeholder="Add Segment.."				   
									   style="width: 100%" /></select>
							</td>							
						</tr>									
					</table>				

					<h4 data-bind="text: fromToBottom"></h4>
					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.account"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.method"></span></th>
				                <th data-bind="text: lang.lang.description"></th>
				                <th data-bind="visible: showRef" style="width: 7%;"><span data-bind="text: lang.lang.reference"></span></th>
				                <th data-bind="visible: showName" style="width: 15%;"><span data-bind="text: lang.lang.name"></span></th>
				                <th data-bind="visible: showSegment" style="width: 15%;"><span data-bind="text: lang.lang.segment"></span></th>
				                <th style="width: 15%;"><span data-bind="text: lang.lang.amount"></span></th>			                			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="cashTransaction-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span6 hidden-print">
							
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" data-bind="checked: showRef" /> <span data-bind="text: lang.lang.reference"></span>
									</li>
									<li>
										<input type="checkbox" data-bind="checked: showName" /> <span data-bind="text: lang.lang.name"></span>
									</li>
									<li>
										<input type="checkbox" data-bind="checked: showSegment" /> <span data-bind="text: lang.lang.segment"></span>
									</li>								
								</ul>
							</div>						
							
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span6">
							<table class="table table-borderless table-condensed cart_total">
								<tbody>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total"></span>:</td>
										<td class="right strong"><span data-bind="text: total"></span></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>
		           
		            <br>
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="cashTransaction-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td class="center">
			<i class="icon-trash" data-bind="events: { click: remove }"></i>
			#:banhji.cashTransaction.lineDS.indexOf(data)+1#			
		</td>	
		<td>
			<input id="cbbAccounts" name="cbbAccounts"
				   data-role="combobox"                   
                   data-value-primitive="true"  
                   data-header-template="account-header-tmpl"                 
                   data-template="account-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: account_id,
                              source: accountDS"
                   data-placeholder="Add Account.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>
		<td>
			<input id="ddlPaymentMethod" name="ddlPaymentMethod"
				   data-role="dropdownlist"                   
                   data-value-primitive="true"                   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: payment_method_id,
                              source: paymentMethodDS"
                   data-option-label="Select method.."
                   data-list-width="400"                    
                   required data-required-msg="required" style="width: 100%" />	
		</td>		
		<td>
			<input name="description" 
					type="text" class="k-textbox" 
					data-bind="value: description"					
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td data-bind="visible: showRef">
			<input type="text" class="k-textbox" 
					data-bind="value: reference_no"				
					style="width: 100%; margin-bottom: 0;" />		
		</td>					
		<td data-bind="visible: showName">
			<input data-role="combobox" id="showName"                  
                   data-value-primitive="true"
                   data-template="contact-list-tmpl"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: contact_id,
                              source: contactDS"
                   data-placeholder="Add Name.."                    
                   style="width: 100%" />
		</td>		
		<td data-bind="visible: showSegment">
			<select data-role="multiselect" id="showSegment"
				   data-value-primitive="true"				   
				   data-item-template="segment-list-tmpl"				    
				   data-value-field="id" 
				   data-text-field="code"
				   data-bind="value: segments, 
				   			source: segmentItemDS,
				   			events:{ change: segmentChanges }"
				   data-placeholder="Add Segment.."				   
				   style="width: 100%" /></select>					
		</td>
		<td class="right">
			<input id="txtAmount" name="txtAmount" 
					data-role="numerictextbox" 
					data-format="n0"
					data-spinners="false"
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" /> 						
		</td>			
    </tr>   
</script>

<script id="cashReceipt" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.cash_receipt"></h2>			    		   

				    <br>				   				
						
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="widget widget-heading-simple widget-body-primary widget-employees">		
								<div class="widget-body padding-none">			
									<div class="row-fluid row-merge">
										<div class="listWrapper">
											<div class="innerAll" style="padding: 15px 15px 19px;">							
												<form autocomplete="off" class="form-inline">
													<div class="widget-search separator bottom">
														<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
														<div class="overflow-hidden">
															<input type="search" placeholder="Invoice Number..." data-bind="value: searchText, events:{change: enterSearch}">
														</div>
													</div>
													<div class="select2-container" style="width: 100%;">								
														<input id="cbbContact" name="cbbContact"
															   data-role="combobox"
															   data-auto-bind="false"    
											                   data-value-primitive="true"
											                   data-header-template="contact-header-tmpl"
											                   data-template="contact-list-tmpl"
											                   data-text-field="name"
											                   data-value-field="id"
											                   data-bind="value: contact_id,
											                              source: contactDS,
											                              events:{ change: contactChanges }"
											                   data-placeholder="Customer..."                    
											                   style="width: 100%; height: 29px;" />									
													</div>
												</form>					
											</div>
										</div>
									</div>
								</div>
							</div>
							
							<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
								data-bind="style: { backgroundColor: amtDueColor}">
								<div align="left"><span data-bind="text: lang.lang.amount_received"></span></div>
								<h2 data-bind="text: total" align="right"></h2>
							</div>												
						</div>					   

						<div class="span8">

							<div class="box-generic-noborder" >

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-1" data-toggle="tab"><i></i> </a>
							            </li>
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-1">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">
							            	<tr>
												<td><span data-bind="text: lang.lang.date"></span></td>
												<td class="right">
													<input id="issuedDate" name="issuedDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.issued_date, 
																		events:{ change : issuedDateChanges }" 
															required data-required-msg="required"
															style="width:100%;" />
												</td>
											</tr>							            
											<tr>
								            	<td>
								            		<span data-bind="text: lang.lang.payment_term"></span>
								            	</td>				
												<td>
													<input id="ddlPaymentMethod" name="ddlPaymentMethod"
															data-role="dropdownlist"								
															data-header-template="customer-payment-method-header-tmpl"
								              				data-value-primitive="true"
															data-text-field="name" 
								              				data-value-field="id"
								              				data-bind="value: obj.payment_method_id,
								              							source: paymentMethodDS"
								              				data-option-label="Select Method..."
								              				required data-required-msg="required" 
								              				style="width: 100%" />
												</td>
											</tr>
											<tr>
								            	<td><span data-bind="text: lang.lang.cash_account"></span></td>							            	
							            		<td>
													<input id="ddlCashAccount" name="ddlCashAccount" 
														data-role="dropdownlist"
														data-header-template="account-header-tmpl"
														data-template="account-list-tmpl"
							              				data-value-primitive="true"
														data-text-field="name" 
							              				data-value-field="id"
							              				data-bind="value: obj.account_id,
							              							source: accountDS"
							              				data-option-label="Select Account..."
							              				required data-required-msg="required" 
							              				style="width: 100%" />
												</td>							            	
								            </tr>							            
								            <tr>
												<td><span data-bind="text: lang.lang.segment"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>											
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							    </div>
							</div>

					    </div>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
				                <th><span data-bind="text: lang.lang.date"></span></th>
				                <th><span data-bind="text: lang.lang.name"></span></th>
				                <th><span data-bind="text: lang.lang.invoice"></span></th>
				                <th data-bind="visible: showCheckNo" style="width: 10%"><span data-bind="text: lang.lang.check_number"></span></th>
				                <th style="width: 15%"><span data-bind="text: lang.lang.amount"></span></th>			                
				                <th style="width: 15%"><span data-bind="text: lang.lang.discount"></span></th>
				                <th style="width: 15%"><span data-bind="text: lang.lang.pay"></span></th>
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="cashReceipt-template" 
				        		data-auto-bind="false"
				        		data-bind="source: dataSource"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span5">
							
							<div class="btn-group">
								<div class="leadcontainer">
									
								</div>
								<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
								<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
									<li>
										<input type="checkbox" id="chbCheckNo" class="k-checkbox" data-bind="checked: showCheckNo">
	  									<label class="k-checkbox-label" for="chbCheckNo"><span data-bind="text: lang.lang.check_number"></span></label>
									</li>															
								</ul>
							</div>

							<br>
							<div class="well" style="overflow: hidden;">
								<textarea cols="0" rows="2" class="k-textbox" style="width:100% !important;" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>												
								<textarea cols="0" rows="2" class="k-textbox" style="width:100% !important;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
							</div>
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span7">
							<table class="table table-condensed table-striped table-white">
								<tbody>
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total_received"></span>:</td>
										<td class="right strong"><span data-bind="text: pay"></span></td>
										<td class="right"><span data-bind="text: lang.lang.subtotal"></span>:</td>
										<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
									</tr>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.remaining"></span>:</td>
										<td class="right strong"><span data-bind="text: remain"></span></td>
										<td class="right"><span data-bind="text: lang.lang.total_discount"></span>:</td>
										<td class="right strong">
											<span data-bind="text: discount"></span>
	                   					</td>
									</tr>																
									<tr>
										<td></td>
										<td></td>
										<td class="right"><h4><span data-bind="text: lang.lang.total_due"></span>:</h4></td>
										<td class="right strong"><h4 data-bind="text: total"></h4></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>	           
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i><span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>				
							</div>
						</div>
					</div>
					<!-- // Form actions END -->								

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="cashReceipt-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.cashReceipt.dataSource.indexOf(data)+1#			
		</td>		
		<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
		<td>#=contact[0].name#</td>		
		<td>#=reference.length>0?reference[0].number:""#</td>
		<td data-bind="visible: showCheckNo">
			<input type="text" class="k-textbox" 
					data-bind="value: check_no"
					style="width: 100%; margin-bottom: 0;" />
		</td>		
		<td class="center">
			#=reference.length>0 ? kendo.toString(reference[0].amount - (amount_paid + reference[0].deposit), "c", locale) : 0#			
		</td>		
		<td class="center">
			<input data-role="numerictextbox"
				   data-spinners="false"
				   data-culture="#:locale#"
                   data-format="c0"
                   data-min="0"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>
		<td class="center">
			<input data-role="numerictextbox"
				   data-spinners="false"
				   data-culture="#:locale#"
                   data-format="c0"
                   data-min="0"                   
                   data-bind="value: amount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>
    </tr>   
</script>

<script id="cashPayment" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
			<div id="example" class="k-content">					
			    
		    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

		        <h2 data-bind="text: lang.lang.cash_payment"></h2>			    		   

			    <br>				   				
					
				<!-- Upper Part -->
				<div class="row-fluid">
					<div class="span4">
						<div class="widget widget-heading-simple widget-body-primary widget-employees">		
							<div class="widget-body padding-none">			
								<div class="row-fluid row-merge">
									<div class="listWrapper">
										<div class="innerAll"  style="padding: 15px 15px 19px;"">							
											<form autocomplete="off" class="form-inline">
												<div class="widget-search separator bottom">
													<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
													<div class="overflow-hidden">
														<input type="search" placeholder="Bill Number..." data-bind="value: searchText, events:{change: enterSearch}">
													</div>
												</div>
												<div class="select2-container" style="width: 100%;">								
													<input id="cbbContact" name="cbbContact"
														   data-role="combobox"
														   data-auto-bind="false"
														   data-header-template="vendor-header-tmpl"										                    
										                   data-value-primitive="true"
										                   data-template="contact-list-tmpl"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: contact_id,
										                              source: contactDS,
										                              events:{ change: contactChanges }"
										                   data-placeholder="Supplier..."                    
										                   style="width: 100%; height: 29px;" />									
												</div>
											</form>					
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
							data-bind="style: { backgroundColor: amtDueColor}">
							<div align="left"><span data-bind="text: lang.lang.c_amount_paid"></span></div>
							<h2 data-bind="text: total" align="right"></h2>
						</div>												
					</div>					   

					<div class="span8">

						<div class="box-generic-noborder">

						    <!-- Tabs Heading -->
						    <div class="tabsbar tabsbar-2">
						        <ul class="row-fluid row-merge">
						        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-1" data-toggle="tab"><i></i> </a>
						            </li>		            								            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						    	<!-- Options Tab content -->
						        <div class="tab-pane active" id="tab1-1">						            
						            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">
						            	<tr>
											<td><span data-bind="text: lang.lang.date"></span></td>
											<td class="right">
												<input id="issuedDate" name="issuedDate" 
														data-role="datepicker"
														data-format="dd-MM-yyyy"
														data-parse-formats="yyyy-MM-dd" 
														data-bind="value: obj.issued_date, 
																	events:{ change : issuedDateChanges }" 
														required data-required-msg="required"
														style="width:100%;" />
											</td>
										</tr>							            
										<tr>
							            	<td>
							            		<span data-bind="text: lang.lang.payment_method"></span>					            						            		
							            	</td>				
											<td>
												<input id="ddlPaymentMethod" name="ddlPaymentMethod"
														data-role="dropdownlist"
														data-header-template="vendor-payment-method-header-tmpl"														
							              				data-value-primitive="true"
														data-text-field="name" 
							              				data-value-field="id"						              				 
							              				data-bind="value: obj.payment_method_id,
							              							source: paymentMethodDS"
							              				data-option-label="Select Method..."
							              				required data-required-msg="required" 
							              				style="width: 100%" />
											</td>
										</tr>
										<tr>
							            	<td><span data-bind="text: lang.lang.cash_account"></span></td>							            	
						            		<td>
												<input id="ddlCashAccount" name="ddlCashAccount" 
													data-role="dropdownlist"
													data-header-template="account-header-tmpl"
													data-template="account-list-tmpl"														
						              				data-value-primitive="true"
													data-text-field="name" 
						              				data-value-field="id"						              				 
						              				data-bind="value: obj.account_id,
						              							source: accountDS"
						              				data-option-label="Select Account..."
						              				required data-required-msg="required" 
						              				style="width: 100%" />
											</td>							            	
							            </tr>							            
							            <tr>
											<td><span data-bind="text: lang.lang.segment"></span></td>
											<td>
												<select data-role="multiselect"
													   data-value-primitive="true"	
													   data-header-template="segment-header-tmpl"							   
													   data-item-template="segment-list-tmpl"				    
													   data-value-field="id" 
													   data-text-field="code"
													   data-bind="value: obj.segments, 
													   			source: segmentItemDS,
													   			events:{ change: segmentChanges }"
													   data-placeholder="Add Segment.."				   
													   style="width: 100%" /></select>
											</td>
										</tr>											
						            </table>						            
						        </div>
						        <!-- // Options Tab content END -->					        								        

						    </div>
						</div>

				    </div>
				</div>

				<!-- Item List -->
				<table class="table table-bordered table-primary table-striped table-vertical-center">
			        <thead>
			            <tr>
			                <th class="center" style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>			                
			                <th data-bind="text: lang.lang.date"></th>
			                <th data-bind="text: lang.lang.name"></th>
			                <th data-bind="text: lang.lang.bill_number"></th>
			                <th data-bind="visible: showCheckNo" style="width: 10%"><span data-bind="text: lang.lang.check_number"></span></th>			                		                
			                <th style="width: 15%"><span data-bind="text: lang.lang.amount"></span></th>
			                <th style="width: 15%"><span data-bind="text: lang.lang.discount"></span></th>         
			                <th style="width: 15%"><span data-bind="text: lang.lang.pay"></span></th>			                			                			                
			            </tr> 
			        </thead>
			        <tbody data-role="listview" 
			        		data-template="cashPayment-template" 
			        		data-auto-bind="false"
			        		data-bind="source: dataSource"></tbody>			        
			    </table>			    
								
	            <!-- Bottom part -->
	            <div class="row-fluid">
		
					<!-- Column -->
					<div class="span4">
						
						<div class="btn-group">
							<div class="leadcontainer">
								
							</div>
							<a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-list"></i> </a>
							<ul class="dropdown-menu" style="padding: 5px; border-radius:0;">
								<li>
									<input type="checkbox" id="chbCheckNo" class="k-checkbox" data-bind="checked: showCheckNo">
  									<label class="k-checkbox-label" for="chbCheckNo"><span data-bind="text: lang.lang.check_number"></span></label>
								</li>															
							</ul>
						</div>

						<br>
						
						<div class="well" style="margin-top:10px; overflow:hidden;">
							<textarea cols="0" rows="2" class="k-textbox" style="width:100% !important;" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>												
							<textarea cols="0" rows="2" class="k-textbox" style="width:100% !important;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
						</div>
					</div>
					<!-- Column END -->

					
					<!-- Column -->
					<div class="span8">
						<table class="table table-condensed table-striped table-white">
							<tbody>
								<tr>
									<td class="right"><span data-bind="text: lang.lang.total_received"></span></td>
									<td class="right strong"><span data-bind="text: pay"></span></td>
									<td class="right"><span data-bind="text: lang.lang.subtotal"></span></td>
									<td class="right strong" width="40%"><span data-bind="text: sub_total"></span></td>
								</tr>								
								<tr>
									<td class="right"><span data-bind="text: lang.lang.remaining"></span>:</td>
									<td class="right strong"><span data-bind="text: remain"></span></td>
									<td class="right"><span data-bind="text: lang.lang.total_discount"></span></td>
									<td class="right strong">
										<span data-bind="text: discount"></span>
                   					</td>
								</tr>																
								<tr>
									<td></td>
									<td></td>
									<td class="right"><h4><span data-bind="text: lang.lang.total"></span></h4></td>
									<td class="right strong"><h4 data-bind="text: total"></h4></td>
								</tr>								
							</tbody>
						</table>
					</div>
					<!-- // Column END -->
					
				</div>	           
				
				<!-- Form actions -->
				<div class="box-generic bg-action-button">
					<div id="ntf1" data-role="notification"></div>

					<div class="row">
						<div class="span3">
							<input data-role="dropdownlist"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: obj.transaction_template_id,
				                              source: txnTemplateDS"
				                   data-option-label="Select Template..." />
						</div>
						<div class="span9" align="right">
							<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
							<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
							<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
							<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
						</div>
					</div>
				</div>
				<!-- // Form actions END -->								

			</div>							
			</div>
		</div>
	</div>
</script>
<script id="cashPayment-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.cashPayment.dataSource.indexOf(data)+1#			
		</td>		
		<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
		<td>#=contact[0].name#</td>		
		<td>#=reference.length>0?reference[0].number:""#</td>
		<td data-bind="visible: showCheckNo">
			<input type="text" class="k-textbox" 
					data-bind="value: check_no"
					style="width: 100%; margin-bottom: 0;" />
		</td>		
		<td class="center">
			#=reference.length>0 ? kendo.toString(reference[0].amount - (amount_paid + reference[0].deposit), "c", locale) : 0#			
		</td>
		<td class="center">
			<input data-role="numerictextbox"
				   data-spinners="false"
				   data-culture="#:locale#"
                   data-format="c0"
                   data-min="0"                   
                   data-bind="value: discount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>		
		<td class="center">
			<input data-role="numerictextbox"
				   data-spinners="false"
				   data-culture="#:locale#"
                   data-format="c0"
                   data-min="0"                   
                   data-bind="value: amount,
                              events: { change: changes }"
                   style="width: 100%;">			
		</td>
    </tr>   
</script>



<!-- ***************************
*	Document Section      	  *
**************************** -->
<script id="documents" type="text/x-kendo-template">
	
							
	<div  class="row-fluid saleSummaryCustomer">

        <h2 data-bind="text: lang.lang.attached_documents"></h2>

	    <br>
			
		<div class="row-fluid">
			<div class="span4">
				<p style="text-align: center; text-transform: uppercase;font-size:17px;font-weight: 600;">
					<span data-bind="text: lang.lang.transaction"></span>
				</p>
				<div class="total-customer" style="background: #d9edf7; color: #333;"> 
					<span class="number" data-bind="text:transactionSize" style="font-size: 30px; font-weight: 600;"></span>GB
					<p>of <span data-bind="text: transactionNu"></span> <span data-bind="text: lang.lang.transaction"></span></p>
					
					
				</div>
			</div>

			<div class="span4">
				<p style="text-align: center; text-transform: uppercase;font-size:17px;font-weight: 600;"><span data-bind="text: lang.lang.contact_items"></span></p>
				<div class="total-customer" style="color: #333;">
					<span class="number" data-bind="text: contactSize" style="font-size: 30px; font-weight: 600;"></span>GB
					<p>of <span data-bind="text: contactNu"></span> <span data-bind="text: lang.lang.contact_items"></span></p>
				</div>
			</div>

			<div class="span4" style="padding-left: 15px;">
				<p style="text-align: center; text-transform: uppercase;font-size:17px;font-weight: 600;"><span data-bind="text: lang.lang.total_attachment"></span></p>
				<div class="total-customer" style="background: #496cad; color: #fff;min-height: 112px;">
					<span class="number" data-bind="text: totalSize" style="font-size: 30px; font-weight: 600;"></span>GB
					<p><span data-bind="text: lang.lang.use_of"></span> 1GB</p>
				</div>
			</div>
		</div>

		<div class="row-fluid" style="background: #fff; padding: 15px;">

			<table class="table table-borderless table-condensed " style="color: #000;">
				<thead>
					<tr>
						<th data-bind="text: lang.lang.file_name"></th>
						<th data-bind="text: lang.lang.description"></th>
						<th data-bind="text: lang.lang.size"></th>
						<th data-bind="text: lang.lang.attach"></th>
						<th data-bind="text: lang.lang.date"></th>
						<th data-bind="text: lang.lang.action"></th>								
					</tr>
				</thead>
				<tbody data-role="listview" data-bind="source: dataSource" data-template="document-list-template">
				</tbody>
			</table>								
		</div>
	
	</div>
</script>
<script id="document-list-template" type="text/x-kendo-template"> <tr>
		<td><a href="#=url#">#=name#</a></td>
		<td>#=description#</td>
		<td>#=kendo.toString(size, 'n4')# mb</td>
		<td>
			# if(attachedTo.type == "contact") {#
				<a href="\#/customer_center/#=attachedTo.id#">#=attachedTo.name#</a>
			#} else if(attachedTo.type == "transaction") {#
				# var link = attachedTo.go; #
				# var lowcase = link.toLowerCase(); #
				<a href="\#/#=lowcase#/#=attachedTo.id#">#=attachedTo.name#</a>
			#} else {#
				<a href="\#/item_center/#=attachedTo.id#">#=attachedTo.name#</a>
			#}#
		</td>
		<td>#=created_at#</td>
		<td align="center"><a href="\#" data-bind="click: remove">Delete</a></td>
	</tr>
</script>

<!-- ***************************
*	Inventory Section      	  *
**************************** -->

<script id="itemDashBoard" type="text/x-kendo-template">
	<div class="row-fluid">

		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<h2 data-bind="text: lang.lang.products_services"></h2>
			        	<p>
			        		<span data-bind="text: lang.lang.P_S_inhere"></span>
			        	</p>
			        	<div class="supplier-icon">
						    <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/non_inventory_part" class="center">
						       		<img title="Add Non Inventory Parts" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/non_inventory_parts.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/txn_item" class="center">
						       		<img title="Add Txn Item"  src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/add_txn_item.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/fixed_assets" class="center">
						       		<img title="Add Txn Item"  src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/add_fixed_assets.ico" />
						       	</a>
						    </div>
						</div>
			        </td>
			 	</tr>
			</table>
			<table class="table table-borderless table-condensed table-vertical-center ">
				<tr>
					<td class="center">
						<a href="#/grn">
							<img title="Add Received Note" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/received_note.png" width="110" height="200" />
							<span data-bind="text: lang.lang.goods_received_note" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>
					<td class="center">
						<a href="#/gdn">
							<img title="Add Delivery Address Note" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/delivery_note.png" width="110" height="200" />
							<span data-bind="text: lang.lang.goods_delivery_note" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center">
						<a href="#/item_adjustment">
							<img title="Add Adjustment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/adjustment.png" width="110" height="200" />
							<span data-bind="text: lang.lang.adjustment" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>						
					</td>					
				</tr>
				<tr>
					<td class="center">
						<a href="#/internal_usage">
							<img title="Add Internal Usage" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/internal_usage.png" width="110" height="200" />
							<span data-bind="text: lang.lang.internal_usage" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center">
						<a href="#/item_assembly">
							<img title="Add Build Assembly" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/build_assembly.png" width="110" height="200" />
							<span data-bind="text: lang.lang.build_assembly" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
					<td class="center" style="vertical-align: top;">
						<a href="#/item_catalog">
							<img title="Add Catalog" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/catalog.png" width="110" height="200" />
							<span data-bind="text: lang.lang.catalog" style="margin-top: 7px; display: inline-block; text-transform: uppercase;"></span>
						</a>
					</td>
				</tr>				
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8">

			<!-- Summary -->
			<div class="row-fluid">
				

				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span data-bind="text: lang.lang.qoh"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/inventory_position_summary"><div class="widget-body alert alert-primary" style="min-height: 148px;">
							
							<div align="center" class="text-large strong" data-bind="text: onHand"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span ></span>
									</td>
									<td>
										<span data-bind="text: purchaseSupplierCount"></span>
										<br>
										<span data-bind="text: lang.lang.supplier"></span>
									</td>
									<td>
										<span data-bind="text: purchaseProductCount"></span>
										<br>
										<span data-bind="text: lang.lang.product"></span>
									</td>
									<td>
										<span data-bind="text: purchase_order"></span>
										<br>
										<span data-bind="text: lang.lang.order"></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>

				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span data-bind="text: lang.lang.gross_profit_margin"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/inventory_sale_item_analysis"><div class="widget-body alert-info" style="min-height: 148px;">
							
							<div align="center" class="text-large strong" data-bind="text: grossProfitMargin"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: product"></span>
										<br>
										<span data-bind="text: lang.lang.product"></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>

				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span data-bind="text: lang.lang.turnover_days"></span></h4>
						</div>
						<!-- // Widget heading END -->
						
						<a href="#/inventory_turn_over_list"><div class="widget-body alert-info3" style="background-color: LightGray; min-height:148px;">
							
							<div align="center" class="text-large strong"  data-bind="text: inventoryTurnOver"></div>
							<table width="100%">
								<tr align="center">
									<td>
										<span data-bind="text: product"></span>
										<br>
										<span data-bind="text: lang.lang.turnover"></span>
									</td>
								</tr>
							</table>
						</div></a>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				
				
			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">									
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th colspan="2" class="center"><span data-bind="text: lang.lang.top_5_purchased_products"></span></th>				                			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="itemDashboard-top-customer-template"
			                 data-bind="source: topPurchase"></tbody>			        
				    </table>			
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th colspan="2" class="center"><span data-bind="text: lang.lang.top_5_suppliers"></span></th>		                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                  
			                 data-template="itemDashboard-top-ar-template"
			                 data-bind="source: topCustomerDS"></tbody>			        
				    </table>
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center" style="font-size: 12px;">
				        <thead>
				            <tr>
				                <th colspan="2" class="center"><span data-bind="text: lang.lang.top_5_best_selling_products"></span></th>			                		                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"                
			                 data-template="itemDashboard-top-product-template"
			                 data-bind="source: topProductDS"></tbody>			        
				    </table>
				</div>		
			</div>

			<!-- Graph -->
			<div class="home-chart" >
				<div data-role="chart"
	                 data-legend="{ position: 'top' }"
	                 data-series-defaults="{ type: 'column' }"
	                 data-tooltip='{
	                    visible: true,
	                    format: "{0}%",
	                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
	                 }'                 
	                 data-series="[
	                                { field: 'purchase', name: 'Monthly Purchase', categoryField:'month', color: '#236DA4' },
	                                { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#A6C9E3' }
	                            ]"
	                 data-auto-bind="false"	                             
	                 data-bind="source: graphDS"
	                 style="height: 250px;" ></div>            
            </div>
            <!-- End Graph -->

		</div>
	</div>	
</script>
<script id="itemDashboard-top-customer-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.itemDashBoard.topPurchase.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(quantity, "n0")#</span>
		</td>
	</tr>
</script>
<script id="itemDashboard-top-ar-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.itemDashBoard.topCustomerDS.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>
	</tr>
</script>
<script id="itemDashboard-top-product-template" type="text/x-kendo-tmpl">
	<tr>
		<!-- <td style="width: 1%">#:banhji.itemDashBoard.topProductDS.indexOf(data)+1#</td> -->		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(quantity, "n0")#</span>
		</td>
	</tr>
</script>

<script id="itemCenter" type="text/x-kendo-template"> 
	<div class="widget widget-heading-simple widget-body-gray widget-employees">
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Number or Name ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>

							<div class="select2-container" style="width: 100%; margin-bottom: 10px;">								
								<input data-role="dropdownlist"
					                   data-option-label="Select Category..."
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: category_id,
					                              source: categoryDS"
					                   style="width: 100%; " />									
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: itemDS.total()"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: itemDS"
						 data-row-template="itemCenter-item-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							            <li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons circle_info active"><span data-toggle="tab" data-target="#tab1-3"><i></i></span>
							            </li>
							            <li class="glyphicons coins"><span data-bind="click: pricing"><i></i></span>
							            </li>
							            <li class="glyphicons paperclip"><span data-toggle="tab" data-target="#tab3-3"><i></i></span>
							            </li>								            						            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Info Tab content -->
							            <div id="tab1-3" class="tab-pane active box-generic">
							            	
											<div class="row-fluid">
							            		<div class="accounCetner-textedit">
									            	<table width="100%">
														<tr>
															<td width="40%"><span data-bind="text: lang.lang.categories"></span>:</td>
															<td width="60%">
																<span class="strong" data-bind="text: obj.category"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.weighted_avg_cost"></span></td>
															<td>
																<span class="strong" data-format="n" data-bind="text: obj.cost"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.average_price"></span></td>
															<td>
																<span class="strong" data-format="n" data-bind="text: obj.price"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.uom"></span></td>
															<td>
																<span data-bind="text: uom"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.currency"></span></td>
															<td>										
																<span data-bind="text: currencyCode"></span>
															</td>
														</tr>
													</table>

													<span class="btn btn-primary btn-icon glyphicons edit pull-right" data-bind="click: edit"><i></i><span data-bind="text: lang.lang.view_all_info_edit"></span></span>
												</div>
											</div>
											
							            </div>
							            <!-- // Info Tab content END -->

							             <!-- Attach Tab content -->
								        <div class="tab-pane" id="tab3-3">							            	
								            
								            <p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
								            <input id="files" name="files"
								                   type="file"
								                   data-role="upload"
								                   data-show-file-list="false"
								                   data-bind="events: { 
						                   				select: onSelect
								                   }">

								            <table class="table table-bordered">
										        <thead>
										            <tr>			                
										                <th data-bind="text: lang.lang.file_name"></th>
										                <th data-bind="text: lang.lang.description"></th>
										                <th data-bind="text: lang.lang.date"></th>
										                <th style="width: 13%;"></th>                			                
										            </tr> 
										        </thead>
										        <tbody data-role="listview" 
										        		data-template="attachment-list-tmpl" 
										        		data-auto-bind="false"
										        		data-bind="source: attachmentDS"></tbody>			        
										    </table>

										    <span class="btn btn-icon btn-success glyphicons ok_2" data-bind="click: uploadFile"><i></i> <span data-bind="text: lang.lang.save"></span></span>

								        </div>
								        <!-- // Attach Tab content END -->						            
							           
							        </div>
							    </div>
							</div>
						</div>

						<div class="span6 account-center" style="margin-bottom: 10px;">
							<div class="row-fluid">
								<div class="span12" style="padding-right:0;">
									<div class="widget-body alert alert-primary" style="margin-bottom: 10px; background:#424242;">							
										<div align="center" class="text-large strong" data-bind="text: total_value"></div>
										<table width="100%">
											<tr align="center">
												<td>										
													<span data-format="n0" data-bind="text: obj.on_hand"></span>
													<br>
													<span data-bind="text: lang.lang.qoh"></span>
												</td>
												<td>
													<span data-format="n0" data-bind="text: obj.on_po"></span>
													<br>
													<span data-bind="text: lang.lang.on_po"></span>
												</td>
												<td>
													<span data-format="n0" data-bind="text: obj.on_so"></span>
													<br>
													<span data-bind="text: lang.lang.on_so"></span>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadPO">
										<span class="glyphicons adjust_alt"><i></i></span>
										<span class="txt" style="width: 70%; margin-top: -16px;"><span data-bind="text: itemType" style="    font-size: 22px;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadSO">
										<span class="glyphicons random"><i></i></span>
										<span class="txt"><span data-bind="text: transactionDS.total()"></span><span data-bind="text: lang.lang.transaction"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >

					  	<button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type2"></span></th>								
								<th style="text-align: center;" ><span data-bind="text: lang.lang.reference_no"></span></th>
								<th style="text-align: center;" ><span data-bind="text: lang.lang.qty"></span></th>
								<th style="text-align: right;" ><span data-bind="text: lang.lang.cost"></span></th>
								<th style="text-align: right;" ><span data-bind="text: lang.lang.price"></span></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="itemCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="itemCenter-item-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=abbr##=number# #=name#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="itemCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(invoice[0].issued_date), "dd-MM-yyyy")#</td>
    	<td>#=invoice[0].type#</td>
        <td align="center">		
			#if(invoice[0].type=="Cash_Purchase" || invoice[0].type=="Credit_Purchase"){#
				<a href="\#/purchase/#=id#">#=invoice[0].number#</a>
			#}else{#
				<a href="\#/#=invoice[0].type.toLowerCase()#/#=id#">#=invoice[0].number#</a>
			#}#
        </td>
    	<td align="center">#=kendo.toString(quantity, "n0")#</td>
    	<td align="right">
    		#if(cost>0){#
    			#=kendo.toString(cost, "c", locale)#
    		#}#
    	</td>
    	<td align="right">
    		#if(price>0){#
    			#=kendo.toString(price, "c", locale)#
    		#}#
    	</td>
    </tr>
</script>

<script id="item" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.inventory_for_sale"></h2>		    		   

				    <br>					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row">
								<div class="span6" style="padding-right: 0;">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlCategory"><span data-bind="text: lang.lang.category"></span> <span style="color:red">*</span></label>										
										<input id="ddlCategory" id="ddlCategory"
											   data-role="dropdownlist"
											   data-option-label="Select Category..."
											   data-header-template="item-category-header-tmpl"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.category_id,
							                   			  disabled: obj.is_pattern, 
							                              source: categoryDS,
							                              events: {change: categoryChanges}"
							                   required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlItemGroup"><span data-bind="text: lang.lang.group"></span> </label>										
										<input id="ddlItemGroup" id="ddlItemGroup"
											   data-role="dropdownlist"
											   data-header-template="item-group-header-tmpl"
											   data-option-label="Select Group..."
											   data-cascade-from="ddlCategory"
											   data-cascade-from-field="category_id"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.item_group_id,							                   			  
							                              source: itemGroupDS"
							                   style="width: 100%;" />
									</div>
									<!-- // Group END -->												
								</div>
							</div>
							
							<div class="row">
								<div class="span6" style="padding-right: 0;">										
									<!-- Group -->
									<div class="control-group">							
										<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" style="width: 55px;" />
				              			-
				              			<input id="txtNumber" name="txtNumber" class="k-textbox"
					              				data-bind="value: obj.number, 
					              							disabled: obj.is_pattern,
					              							events:{change: checkExistingNumber}" 
					              				placeholder="e.g. 0001" 
					              				required data-required-msg="required"
					              				style="width: 157px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name, disabled: obj.is_pattern" 
							              		placeholder="Item name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							</div>

							<div class="row">
								<div class="span6" style="padding-right: 0;">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlCurrency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>							            
							            <input id="ddlCurrency" name="ddlCurrency"							            	 
				              				data-role="dropdownlist"
				              				data-option-label="(--- Select ---)"
				              				data-template="currency-list-tmpl"
				              				data-value-primitive="true"
						            		data-text-field="code"
			           						data-value-field="locale"			           						 
						            		data-bind="source: currencyDS, value: obj.locale"						            		
						            		required data-required-msg="required" style="width: 100%;" />						            		
									</div>																		
									<!-- // Group END -->								
								</div>

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>							
						</div>
						<div class="span6">

							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlMeasurement"><span data-bind="text: lang.lang.unit_measure"></span> <span style="color:red">*</span></label>
										<input id="ddlMeasurement" name="ddlMeasurement"
										   data-option-label="(--- Select ---)" 
										   data-header-template="item-measurement-header-tmpl"
										   data-role="dropdownlist"						                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.measurement_id,
						                              source: measurementDS"
						                   required data-required-msg="required"
						                   style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6" style="padding: 0; ">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtCost"><span data-bind="text: lang.lang.cost"></span></label>
							            <input id="txtCost" name="txtCost" 
							               data-role="numerictextbox"
							               data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.cost"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->			
								</div>
							</div>

							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtOrderPoint"><span data-bind="text: lang.lang.reorder_point"></span></label>
										<input data-role="numerictextbox"
										   data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.order_point"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6" style="padding: 0; ">	
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPrice"><span data-bind="text: lang.lang.price"></span></label>
							            <input id="txtPrice" name="txtPrice" 
							               data-role="numerictextbox"
							               data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.price"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->											
								</div>
							</div>

							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
							            <textarea id="txtPurchaseDescription" class="k-textbox" 
											data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6" style="padding: 0; ">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
							            <textarea id="txtSaleDescription" class="k-textbox" 
											data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
							</div>

						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">
						        	<li class="span2 glyphicons circle_info active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
						            </li>						            
						            <li class="span2 glyphicons usd">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.accounting"></span></span></a>
						            </li>						            
						            <li class="span2 glyphicons barcode">
						            	<a href="#tab3" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.supplier_customer_codes"></span></a>
						            </li>					            					            						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">
						    	<!-- //INFO -->
						        <div class="tab-pane active" id="tab1">

						        	<div class="row-fluid">
										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtSerialNumber"><span data-bind="text: lang.lang.model"></span></label>
						              			<input data-role="dropdownlist"
						              			   data-option-label="(--- Select ---)"
						              			   data-header-template="item-brand-header-tmpl"           
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.brand_id,
								                              source: brandDS"
								                   style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtMeasurement"><span data-bind="text: lang.lang.measurement"></span></label>
						              			<input id="txtMeasurement" name="txtMeasurement" class="k-textbox"
							              				data-bind="value: obj.measurements" 
							              				placeholder="e.g. 4x6mn"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtColorCode"><span data-bind="text: lang.lang.color_code"></span></label>
						              			<input id="txtColorCode" name="txtColorCode" class="k-textbox"
							              				data-bind="value: obj.color_code" 
							              				placeholder="e.g. #FF0000"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>										
							        
										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtInternationalCode"><span data-bind="text: lang.lang.international_code"></span></label>
						              			<input id="txtInternationalCode" name="txtInternationalCode" class="k-textbox"
							              				data-bind="value: obj.international_code" 
							              				placeholder="e.g. INT0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>
																						
							        </div>

							        <div class="row-fluid">
							        	<div class="span3">
											<!-- Group -->
											<div class="control-group">
									            <input type="checkbox" data-bind="checked: obj.favorite" />	<span data-bind="text: lang.lang.favorite"></span>
											</div>																		
											<!-- // Group END -->
										</div>
							        </div>							       

					        	</div>
						        <!-- //INFO END -->

						        <!-- //ACCOUNTING -->
						        <div class="tab-pane" id="tab2">
						        	<div class="row-fluid">						            	
										<div class="span4">
											<label for="ddlIncome"><span data-bind="text: lang.lang.income_account"></span><span style="color:red">*</span></label>											
											<input id="ddlIncome" name="ddlIncome"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.income_account_id,
								                              source: incomeAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>
										<div class="span4">
											<label for="ddlCogs"><span data-bind="text: lang.lang.cost_of_good_sold_account"></span><span style="color:red">*</span></label>
											<input id="ddlCogs" name="ddlCogs"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.cogs_account_id,
								                              source: cogsAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />											
										</div>
										<div class="span4">
											<label for="ddlInventory"><span data-bind="text: lang.lang.inventory_account"></span><span style="color:red">*</span></label>
											<input id="ddlInventory" name="ddlInventory"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.inventory_account_id,
								                              source: inventoryAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>												
							        </div>							        
					        	</div>
						        <!-- //ACCOUNTING END -->						        

						        <!-- //VENDOR/CUSTOMER CODE -->
						        <div class="tab-pane" id="tab3">

						        	<div class="row">
						        		<div class="span6">
						        			<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemVendor"><i></i> <span data-bind="text: lang.lang.new_vendor_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.code"></span></th>								                
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"					        						        		 
										        		data-template="item-vendor-row-tmpl" 
										        		data-bind="source: itemVendorDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        		<div class="span6">
						        			<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemCustomer"><i></i> <span data-bind="text: lang.lang.new_customer_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.code"></span></th>								                
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="item-customer-row-tmpl" 
										        		data-bind="source: itemCustomerDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        	</div>

					        	</div>
						        <!-- //VENDOR/CUSTOMER CODE END -->
						    </div>
						</div>
					</div>					

					<br>											
							
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>				
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="item-vendor-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbVendor" name="cbbVendor" 
			   data-role="combobox"
			   data-header-template="vendor-header-tmpl"
			   data-template="contact-list-tmpl"
               data-placeholder="vendor ..."
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: vendorDS"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemVendor"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="item-customer-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbCustomer" name="cbbCustomer" 
			   data-role="combobox"
			   data-header-template="contact-header-tmpl"
			   data-template="contact-list-tmpl"
               data-placeholder="customer ..."
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: customerDS"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemCustomer"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="itemCatalog" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background" style="overflow: hidden;">
			<div class="container-960">					
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.catalog"></h2>
			        <br>

			        <!-- Upper Part -->
					<div class="row">
						<div class="span6">
							<div class="box-generic well" style="height: 190px;">				
								<div class="row">
									<div class="span6">	
								
										<!-- Group -->
										<div class="control-group">							
											<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
					              			<br>
					              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
						              				data-bind="value: obj.abbr, 
						              						   disabled: obj.is_pattern" 
						              				placeholder="eg. AB" style="width: 55px;" />
					              			-
					              			<input id="txtNumber" name="txtNumber" class="k-textbox"
						              				data-bind="value: obj.number, 
						              							disabled: obj.is_pattern,
						              							events:{change: checkExistingNumber}" 
						              				placeholder="e.g. 0001" 
						              				required data-required-msg="required"
						              				style="width: 128px;" />
						              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
										</div>
										<!-- // Group END -->


									
									</div>

									<div class="span6" >									
										<div class="control-group">
											<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
						              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name" 
								              		placeholder="Items Name..." required data-required-msg="required"
								              		style="width: 100%;" />
										</div>									
									</div>								
								</div>

								<div class="row">
									<div class="span6"  style="margin-top: 25px;">
										<input type="checkbox" data-bind="checked: obj.favorite" /> <span data-bind="text: lang.lang.favorite"></span>

										<!-- Group -->
										<div class="control-group" style=" margin-top: 17px;">								
											<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
								            <textarea id="txtPurchaseDescription" class="k-textbox" 
												data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:60px;"></textarea>
										</div>																		
										<!-- // Group END -->

									</div>
									<div class="span6">								
										<div class="control-group">								
											<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span><span style="color:red">*</span></label>
								            <input id="ddlStatus" name="ddlStatus" 
					              				data-role="dropdownlist"
							            		data-text-field="name"
				           						data-value-field="id"
				           						data-value-primitive="true" 
							            		data-bind="source: statusList, value: obj.status"
							            		data-option-label="(--- Select ---)"
							            		required data-required-msg="required" style="width: 100%;" />
										</div>
										<!-- Group -->
										<div class="control-group" style=" margin-top: 10px;">								
											<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
								            <textarea id="txtSaleDescription" class="k-textbox" 
												data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:60px;"></textarea>
										</div>																		
										<!-- // Group END -->																	
									</div>																								
								</div>

							</div>						
						</div>					   

						<div class="span6" style="padding-left: 0;">
							<div class="row-fluid">
								<div class="span12">
									<label ><span data-bind="text: lang.lang.select_item_to_include_into_this_catalog"></span></label>
									<select data-role="multiselect"
						                   data-placeholder="Select..."
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.catalogs,
						                              source: itemDS"
						                   style="width: 100%"
						            ></select>
								</div>
							</div>
					    </div>					   
					</div>

				    <!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>				
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="itemAssembly" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.build_assembly"></h2>
			        <br>

			        <!-- Upper Part -->
					<div class="row">
						<div class="span6">
							<div class="box-generic well" style="height: 190px;">				
								<div class="row">
									<div class="span6">	
								
										<!-- Group -->
										<div class="control-group">							
											<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
					              			<br>
					              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
						              				data-bind="value: obj.abbr, 
						              						   disabled: obj.is_pattern" 
						              				placeholder="eg. AB" style="width: 55px;" />
					              			-
					              			<input id="txtNumber" name="txtNumber" class="k-textbox"
						              				data-bind="value: obj.number, 
						              							disabled: obj.is_pattern,
						              							events:{change: checkExistingNumber}" 
						              				placeholder="e.g. 0001" 
						              				required data-required-msg="required"
						              				style="width: 128px;" />
						              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
										</div>
										<!-- // Group END -->
									
									</div>

									<div class="span6">									
										<div class="control-group">
											<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
						              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name" 
								              		placeholder="Items Name..." required data-required-msg="required"
								              		style="width: 100%;" />
										</div>									
									</div>								
								</div>

								<div class="row">
									<div class="span6"  style="margin-top: 25px;">
										<input type="checkbox" data-bind="checked: obj.favorite" /> <span data-bind="text: lang.lang.favorite"></span>
									</div>
									<div class="span6">								
										<div class="control-group">								
											<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span><span style="color:red">*</span></label>
								            <input id="ddlStatus" name="ddlStatus" 
					              				data-role="dropdownlist"
							            		data-text-field="name"
				           						data-value-field="id"
				           						data-value-primitive="true" 
							            		data-bind="source: statusList, value: obj.status"
							            		data-option-label="(--- Select ---)"
							            		required data-required-msg="required" style="width: 100%;" />
										</div>																	
									</div>																								
								</div>

							</div>						
						</div>					   

						<div class="span6" style="padding-left:0;">
							<div class="row-fluid">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlCurrency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>							            
							            <input id="ddlCurrency" name="ddlCurrency"							            	 
				              				data-role="dropdownlist"
				              				data-option-label="(--- Select ---)"
				              				data-template="currency-list-tmpl"
				              				data-value-primitive="true"
						            		data-text-field="code"
			           						data-value-field="locale"			           						 
						            		data-bind="source: currencyDS, value: obj.locale"						            		
						            		required data-required-msg="required" style="width: 100%;" />						            		
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPrice"><span data-bind="text: lang.lang.price"></span></label>
							            <input id="txtPrice" name="txtPrice" 
							               data-role="numerictextbox"
							               data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.price"
						                   required data-required-msg="required" style="width: 100%">
									</div>																		
									<!-- // Group END -->
								</div>
							</div>
							<div class="row-fluid">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
							            <textarea id="txtPurchaseDescription" class="k-textbox" 
											data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
							            <textarea id="txtSaleDescription" class="k-textbox" 
											data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
							</div>
					    </div>					   
					</div>

					<div class="row">
						<div class="span12">
							<table class="table table-bordered table-primary table-striped table-vertical-center">
						        <thead>
						            <tr>
						            	<th width="1%"><span data-bind="text: lang.lang.no_"></span></th>				                
						                <th width="20%"><span data-bind="text: lang.lang.items"></span></th>
						                <th width="20%"><span data-bind="text: lang.lang.quantity"></span></th>
						                <th width="15%"><span data-bind="text: lang.lang.cost"></span></th>
						                <th width="15%"><span data-bind="text: lang.lang.amount"></span></th>
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false" 
						        		data-template="itemAssembly-row-template"				        		
						        		data-bind="source: lineDS"></tbody>				        
						    </table>					    				    

						    <button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>
						    
						    <!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
						  				 				
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->

						    <div class="strong" align="right" style="font-size: large;">
						    	<span data-bind="text: lang.lang.total"></span> <span data-bind="text: total"></span>
						    </div>
					    </div>
				    </div>

				    <!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="itemAssembly-row-template" type="text/x-kendo-tmpl">
	<tr data-uid="#: uid #">
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.itemAssembly.lineDS.indexOf(data)+1#
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{change: itemChanges}"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox"
					data-spinners="false" 
					data-format="n0" data-min="0"					
					data-bind="value: quantity,
                   				events:{change: onChanges}"
					required data-required-msg="required" style="width: 48%;" />

			<input data-role="dropdownlist"
				   data-option-label="UM"
                   data-auto-bind="false"
                   data-value-primitive="true"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="source: measurementDS, 
                   			value: measurement_id"
                   style="width: 50%;" />
		</td>
		<td class="right">
			<span data-format="n" data-bind="text: price"></span> 						
		</td>
		<td class="right">
			<span data-format="n" data-bind="text: amount"></span> 						
		</td>	
	</tr>
</script>

<script id="itemService" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.service_items"></h2>
				    <br>					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row">
								<div class="span6" style="padding-right: 0;">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlCategory"><span data-bind="text: lang.lang.category"></span> <span style="color:red">*</span></label>										
										<input id="ddlCategory" id="ddlCategory"
											   data-option-label="Select Category..."
											   data-role="dropdownlist"
											   data-header-template="item-category-header-tmpl"
											   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.category_id,
							                   			  disabled: obj.is_pattern, 
							                              source: categoryDS,
							                              events: {change: loadPattern}"
							                   required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlItemGroup"><span data-bind="text: lang.lang.group"></span> </label>										
										<input id="ddlItemGroup" id="ddlItemGroup"											   
											   data-role="dropdownlist"
											   data-header-template="item-group-header-tmpl"
											   data-option-label="Select Group..."
											   data-cascade-from="ddlCategory"
											   data-cascade-from-field="category_id"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.item_group_id,							                   			  
							                              source: itemGroupDS"
							                   style="width: 100%;" />
									</div>
									<!-- // Group END -->												
								</div>
							</div>
							
							<div class="row">
								<div class="span6" style="padding-right: 0">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" style="width: 55px;" />
				              			-
				              			<input id="txtNumber" name="txtNumber" class="k-textbox"
					              				data-bind="value: obj.number, 
					              							disabled: obj.is_pattern,
					              							events:{change: checkExistingNumber}" 
					              				placeholder="e.g. 0001" 
					              				required data-required-msg="required"
					              				style="width: 157px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name, disabled: obj.is_pattern" 
							              		placeholder="Name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							</div>

							<div class="row">
								<div class="span6">																					
									<!-- Group -->
									<div class="control-group">										
										<input type="checkbox" id="chbFavorite" class="k-checkbox" data-bind="checked: obj.favorite">
	  									<label class="k-checkbox-label" for="chbFavorite"><span data-bind="text: lang.lang.favorite"></span></label>							            
									</div>																		
									<!-- // Group END -->														
								</div>

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>							
						</div>
						<div class="span6">
						
							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlMeasurement"><span data-bind="text: lang.lang.unit_measure"></span> <span style="color:red">*</span></label>
										<input id="ddlMeasurement" name="ddlMeasurement"
										   data-option-label="(--- Select ---)" 
										   data-header-template="item-measurement-header-tmpl"
										   data-role="dropdownlist"						                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.measurement_id,
						                              source: measurementDS"
						                   required data-required-msg="required"
						                   style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6"  style="padding: 0;">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtCost"><span data-bind="text: lang.lang.cost"></span></label>
							            <input id="txtCost" name="txtCost" 
							               data-role="numerictextbox"
							               data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.cost"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->			
								</div>
							</div>

							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlCurrency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>							            
							            <input id="ddlCurrency" name="ddlCurrency"							            	 
				              				data-role="dropdownlist"
				              				data-option-label="(--- Select ---)"
				              				data-template="currency-list-tmpl"
				              				data-value-primitive="true"
						            		data-text-field="code"
			           						data-value-field="locale"			           						 
						            		data-bind="source: currencyDS, value: obj.locale"						            		
						            		required data-required-msg="required" style="width: 100%;" />						            		
									</div>																		
									<!-- // Group END -->
								</div>

								<div class="span6"  style="padding: 0;">	
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPrice"><span data-bind="text: lang.lang.price"></span></label>
							            <input id="txtPrice" name="txtPrice" 
							               data-role="numerictextbox"
							               data-spinners="false"
						                   data-format="n"
						                   data-min="0"						                   
						                   data-bind="value: obj.price"
						                   style="width: 100%">
									</div>																		
									<!-- // Group END -->											
								</div>
							</div>

							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
							            <textarea id="txtPurchaseDescription" class="k-textbox" 
											data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6" style="padding: 0;">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
							            <textarea id="txtSaleDescription" class="k-textbox" 
											data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
							</div>

						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						            
						            <li class="span2 glyphicons usd active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.accounting"></span></span></a>
						            </li>						            
						            <li class="span2 glyphicons barcode">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.supplier_customer_codes"></span></a>
						            </li>
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">
						        <!-- //ACCOUNTING -->
						        <div class="tab-pane active" id="tab1">
						        	<div class="row-fluid">						            	
										<div class="span6">
											<label for="ddlIncome"><span data-bind="text: lang.lang.income_account"></span><span style="color:red">*</span></label>											
											<input id="ddlIncome" name="ddlIncome"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.income_account_id,
								                              source: incomeAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>
										<div class="span6">
											<label for="ddlCogs"><span data-bind="text: lang.lang.cost_of_good_sold_account"></span><span data-bind="text: lang.lang.only_for_subcontact"></span><span style="color:red">*</span></label>
											<input id="ddlCogs" name="ddlCogs"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.cogs_account_id,
								                              source: cogsAccountDS"
								                   data-option-label="Select Account..." style="width: 100%;" />											
										</div>																					
							        </div>							        
					        	</div>
						        <!-- //ACCOUNTING END -->						        

						        <!-- //VENDOR/CUSTOMER CODE -->
						        <div class="tab-pane" id="tab2">

						        	<div class="row">
						        		<div class="span6">
						        			<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemVendor"><i></i> <span data-bind="text: lang.lang.new_vendor_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th data-bind="text: lang.lang.code"></th>	
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"					        						        		 
										        		data-template="item-vendor-row-tmpl" 
										        		data-bind="source: itemVendorDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        		<div class="span6">
						        			<span style="margin-bottom: 15px;" class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemCustomer"><i></i> <span data-bind="text: lang.lang.new_customer_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th data-bind="text: lang.lang.code"></th>								                
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="item-customer-row-tmpl" 
										        		data-bind="source: itemCustomerDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        	</div>

					        	</div>
						        <!-- //VENDOR/CUSTOMER CODE END -->
						    </div>
						</div>
					</div>					

					<br>											
							
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="itemService-vendor-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbVendor" name="cbbVendor" 
			   data-role="combobox"
			   data-header-template="vendor-header-tmpl"
			   data-template="contact-list-tmpl"
               data-placeholder="vendor ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: vendorList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemVendor"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="itemService-customer-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbCustomer" name="cbbCustomer" 
			  data-role="combobox"
			   data-header-template="contact-header-tmpl"
			   data-template="contact-list-tmpl"
               data-placeholder="customer ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: customerList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemCustomer"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="nonInventoryPart" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.other_inventory"></h2>			    		   

				    <br>					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row">
								<div class="span6" style="padding-right: 0;">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlCategory"><span data-bind="text: lang.lang.category"></span> <span style="color:red">*</span></label>										
										<input id="ddlCategory" id="ddlCategory"
											   data-option-label="Select Category..."
											   data-header-template="item-category-header-tmpl"
											   data-role="dropdownlist"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.category_id,
							                   			  disabled: obj.is_pattern, 
							                              source: categoryDS,
							                              events: {change: categoryChanges}"
							                   required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6">	
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlItemGroup"><span data-bind="text: lang.lang.group"></span> </label>										
										<input id="ddlItemGroup" id="ddlItemGroup"											   
											   data-role="dropdownlist"
											   data-option-label="Select Group..."
											   data-header-template="item-group-header-tmpl"
											   data-cascade-from="ddlCategory"
											   data-cascade-from-field="category_id"							                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.item_group_id,							                   			  
							                              source: itemGroupDS"
							                   style="width: 100%;" />
									</div>
									<!-- // Group END -->												
								</div>
							</div>
							
							<div class="row">
								<div class="span6" style="padding-right: 0;">	
									<!-- Group -->
									<div class="control-group">							
										<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" style="width: 55px;" />
				              			-
				              			<input id="txtNumber" name="txtNumber" class="k-textbox"
					              				data-bind="value: obj.number, 
					              							disabled: obj.is_pattern,
					              							events:{change: checkExistingNumber}" 
					              				placeholder="e.g. 0001" 
					              				required data-required-msg="required"
					              				style="width: 157px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red; resize: none;">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-header-template="item-group-header-tmpl" data-bind="value: obj.name, disabled: obj.is_pattern" 
							              		placeholder="item name..." required data-required-msg="required"
							              		style="width: 100%; resize: none;" />
									</div>
									<!-- // Group END -->	
								</div>								
							</div>

							<div class="row">
								<div class="span6" style="padding-right: 0;">																					
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlMeasurement"><span data-bind="text: lang.lang.unit_measure"></span> <span style="color:red">*</span></label>
										<input id="ddlMeasurement" name="ddlMeasurement"
										   data-option-label="(--- Select ---)" 
										   data-role="dropdownlist"
										   data-header-template="item-measurement-header-tmpl"					                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.measurement_id,
						                              source: measurementDS"
						                   required data-required-msg="required"
						                   style="width: 100%;" />
									</div>																		
									<!-- // Group END -->															
								</div>

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>							
						</div>
						<div class="span6" style="padding-right: 0;">	

							<div class="row-fluid">

								<!-- Group -->
								<div class="control-group" style="padding: 0; margin-bottom: 9px;">								
									<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
						            <textarea id="txtPurchaseDescription" cols="0" rows="3" class="k-textbox" 
										data-bind="value: obj.purchase_description" style="width: 100%; resize: none;"></textarea>
								</div>																		
								<!-- // Group END -->

								

								<!-- Group -->
								<div class="control-group" style="padding: 0;">								
									<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
						            <textarea id="txtSaleDescription" cols="0" rows="3" class="k-textbox" 
										data-bind="value: obj.sale_description" style="width: 100%;resize: none;"></textarea>
								</div>																		
								<!-- // Group END -->

							</div>

						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						            
						            <li class="span2 glyphicons circle_info active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
						            </li>
						            <li class="span2 glyphicons usd">
						            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.accounting"></span></span></a>
						            </li>						            
						            <li class="span2 glyphicons barcode">						            	
						            	<a href="#tab3" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.supplier_customer_codes"></span></a>
						            </li>						            					            						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						    	<!-- //INFO -->
						        <div class="tab-pane active" id="tab1">

						        	<div class="row-fluid">
										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtSerialNumber"><span data-bind="text: lang.lang.model"></span></label>
						              			<input data-role="dropdownlist"
						              			   data-option-label="(--- Select ---)"
						              			   data-header-template="item-brand-header-tmpl"           
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.brand_id,
								                              source: brandDS"
								                   style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtMeasurement"><span data-bind="text: lang.lang.measurement"></span></label>
						              			<input id="txtMeasurement" name="txtMeasurement" class="k-textbox"
							              				data-bind="value: obj.measurements" 
							              				placeholder="e.g. 4x6mn"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>

										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtColorCode"><span data-bind="text: lang.lang.color_code"></span></label>
						              			<input id="txtColorCode" name="txtColorCode" class="k-textbox"
							              				data-bind="value: obj.color_code" 
							              				placeholder="e.g. #FF0000"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>										
							        
										<div class="span3">														
											<!-- Group -->
											<div class="control-group">							
												<label for="txtInternationalCode"><span data-bind="text: lang.lang.international_code"></span></label>
						              			<input id="txtInternationalCode" name="txtInternationalCode" class="k-textbox"
							              				data-bind="value: obj.international_code" 
							              				placeholder="e.g. INT0001"
							              				style="width: 100%;" />					              		
											</div>
											<!-- // Group END -->
										</div>
																						
							        </div>

							        <div class="row-fluid">
							        	<div class="span3">
											<!-- Group -->
											<div class="control-group">
									            <input type="checkbox" data-bind="checked: obj.favorite" />	<span data-bind="text: lang.lang.favorite"></span>
											</div>																		
											<!-- // Group END -->
										</div>
							        </div>							       

					        	</div>
						        <!-- //INFO END -->

						        <!-- //ACCOUNTING -->
						        <div class="tab-pane" id="tab2">
						        	<div class="row-fluid">										
										<div class="span12">
											<label for="ddlInventory"><span data-bind="text: lang.lang.inventory_account"></span><span style="color:red">*</span></label>
											<input id="ddlInventory" name="ddlInventory"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"								                   
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.inventory_account_id,
								                              source: inventoryAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>												
							        </div>							        
					        	</div>
						        <!-- //ACCOUNTING END -->						        

						        <!-- //VENDOR/CUSTOMER CODE -->
						        <div class="tab-pane" id="tab3">

						        	<div class="row">
						        		<div class="span6">
						        			<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemVendor"><i></i> <span data-bind="text: lang.lang.new_vendor_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th data-bind="text: lang.lang.code"></th>						                
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"					        						        		 
										        		data-template="item-vendor-row-tmpl" 
										        		data-bind="source: itemVendorDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        		<div class="span6">
						        			<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyItemCustomer"><i></i> <span data-bind="text: lang.lang.new_customer_item"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th data-bind="text: lang.lang.code"></th>								                
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="item-customer-row-tmpl" 
										        		data-bind="source: itemCustomerDS">
										        </tbody>										        						        
										    </table>
						        		</div>
						        	</div>

					        	</div>
						        <!-- //VENDOR/CUSTOMER CODE END -->

						    </div>
						</div>
					</div>					

					<br>											
							
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>			
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="nonInventoryPart-vendor-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbVendor" name="cbbVendor" 
			   data-role="combobox"
               data-placeholder="vendor ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"
               data-header-template="vendor-header-tmpl"						                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: vendorList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemVendor"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="nonInventoryPart-customer-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="cbbVendor" name="cbbVendor" 
			   data-role="combobox"
			   data-header-template="vendor-header-tmpl"
			   data-template="contact-list-tmpl"
               data-placeholder="vendor ..."
               data-auto-bind="false"
               data-value-primitive="true"
               data-filter="startswith"							                   
               data-min-length="3"							                   
               data-text-field="name"
               data-value-field="id"										                   
               data-bind="value: contact_id,
                          source: vendorList"
               style="width: 100%" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: code" placeholder="item code ..." style="width: 100%;" />
		</td>			
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteItemCustomer"><i></i></span>									
		</td>		
	</tr>
</script>
<script id="fixedAssets" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.fixed_assets"></h2>			    		   

				    <br>					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">									
							<div class="row-fluid">
								<div class="span6" style="padding-right: 0;">														
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlCategory"><span data-bind="text: lang.lang.category"></span> <span style="color:red">*</span></label>										
										<input id="ddlCategory" id="ddlCategory"
											   data-role="dropdownlist"
											   data-option-label="Select Category..."
											   data-header-template="item-category-header-tmpl"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.category_id,
							                   			  disabled: obj.is_pattern, 
							                              source: categoryDS,
							                              events: {change: categoryChanges}"
							                   required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->
								</div>

								<div class="span6" >	
									<!-- Group -->
									<div class="control-group">										
										<label for="ddlItemGroup"><span data-bind="text: lang.lang.group"></span> </label>										
										<input id="ddlItemGroup" id="ddlItemGroup"
											   data-role="dropdownlist"
											   data-header-template="item-group-header-tmpl"
											   data-option-label="Select Group..."
											   data-cascade-from="ddlCategory"
											   data-cascade-from-field="category_id"
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.item_group_id,							                   			  
							                              source: itemGroupDS"
							                   style="width: 100%;" />
									</div>
									<!-- // Group END -->												
								</div>
							</div>
							
							<div class="row-fluid">
								<div class="span6" style="padding-right: 0;">										
									<!-- Group -->
									<div class="control-group">							
										<label for="txtNumber"><span data-bind="text: lang.lang.no_"></span><span style="color:red">*</span></label>
				              			<br>
				              			<input id="txtAbbr" name="txtAbbr" class="k-textbox"
					              				data-bind="value: obj.abbr, 
					              						   disabled: obj.is_pattern" 
					              				placeholder="eg. AB" style="width: 55px;" />
				              			-
				              			<input id="txtNumber" name="txtNumber" class="k-textbox"
					              				data-bind="value: obj.number, 
					              							disabled: obj.is_pattern,
					              							events:{change: checkExistingNumber}" 
					              				placeholder="e.g. 0001" 
					              				required data-required-msg="required"
					              				style="width: 142px;" />
					              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
									</div>
									<!-- // Group END -->		
								</div>

								<div class="span6">						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" class="k-textbox" data-bind="value: obj.name, disabled: obj.is_pattern" 
							              		placeholder="Item name..." required data-required-msg="required"
							              		style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							</div>					
						</div>

						<div class="span6">
							<div class="row-fluid">

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->								
								</div>

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlMeasurement"><span data-bind="text: lang.lang.unit_measure"></span> <span style="color:red">*</span></label>
										<input id="ddlMeasurement" name="ddlMeasurement"
										   data-option-label="(--- Select ---)" 
										   data-header-template="item-measurement-header-tmpl"
										   data-role="dropdownlist"						                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.measurement_id,
						                              source: measurementDS"
						                   required data-required-msg="required"
						                   style="width: 100%;" />
									</div>																		
									<!-- // Group END -->
								</div>

							</div>

							<div class="row-fluid">

								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
							            <textarea id="txtPurchaseDescription" class="k-textbox" 
											data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
							            <textarea id="txtSaleDescription" class="k-textbox" 
											data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:60px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>

							</div>

						</div>
					</div>								
							
					<!-- // Inner Tabs -->
					<div class="row-fluid">								
						<div class="box-generic">
						    <!-- //Tabs Heading -->
						    <div class="tabsbar tabsbar-1">
						        <ul class="row-fluid row-merge">						        							            
						            <li class="span2 glyphicons usd active">
						            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.accounting"></span></span></a>
						            </li>						            
						            					            					            						            					            
						        </ul>
						    </div>
						    <!-- // Tabs Heading END -->

						    <div class="tab-content">

						        <!-- //ACCOUNTING -->
						        <div class="tab-pane active" id="tab1">
						        	<div class="row-fluid">						            	
										<div class="span4">
											<label for="ddlFixedAssetAccount"><span data-bind="text: lang.lang.fixed_assets_account"></span><span style="color:red">*</span></label>							
											<input id="ddlFixedAssetAccount" name="ddlFixedAssetAccount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.inventory_account_id,
								                              source: fixedAssetAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>
										<div class="span4">
											<label for="ddlAccumulatedAccount"><span data-bind="text: lang.lang.accumulated_account"></span><span style="color:red">*</span></label>
											<input id="ddlAccumulatedAccount" name="ddlAccumulatedAccount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.cogs_account_id,
								                              source: accumulatedAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />											
										</div>
										<div class="span4" style="padding-left: 15px;">
											<label for="ddlDeposalAccount"><span data-bind="text: lang.lang.deposal_account"></span><span style="color:red">*</span></label>
											<input id="ddlDeposalAccount" name="ddlDeposalAccount"
												   data-role="dropdownlist"
												   data-header-template="account-header-tmpl"
												   data-template="account-list-tmpl"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.income_account_id,
								                              source: deposalAccountDS"
								                   data-option-label="Select Account..."
								                   required data-required-msg="required" style="width: 100%;" />
										</div>												
							        </div>							        
					        	</div>
						        <!-- //ACCOUNTING END -->						        

						     
						    </div>
						</div>
					</div>					

					<br>											
							
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete"><span data-bind="text: lang.lang.yes"></span></button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm"><span data-bind="text: lang.lang.no"></span></button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>
<script id="txnItem" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
			    
			    	<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.transaction_item"></h2>			    		   

				    <br>					
					
			    	<div class="row-fluid">
			    		<div class="span6 well">							
							<div class="row">
								<div class="span6" >						
									<!-- Group -->
									<div class="control-group">
										<label for="txtName"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
					              		<input id="txtName" name="txtName" 
					              				class="k-textbox" 
					              				data-bind="value: obj.name,
					              							events:{change:checkExistingName}" 
							              		placeholder="Item name..." 
							              		required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlStatus"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
							            <input id="ddlStatus" name="ddlStatus" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true" 
						            		data-bind="source: statusList, value: obj.status"
						            		data-option-label="(--- Select ---)"
						            		required data-required-msg="required" style="width: 100%;" />
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>
							<div class="row">
								<div class="span6" style="padding-left: 15px;">						
									<!-- Group -->
									<div class="control-group">
										<label for="ddlAccount"><span data-bind="text: lang.lang.account"></span> <span style="color:red">*</span></label>
							            <input id="ddlAccount" name="ddlAccount"
							            	data-header-template="account-header-tmpl"
							            	data-template="account-list-tmpl" 
				              				data-role="dropdownlist"
						            		data-text-field="name"
			           						data-value-field="id"
			           						data-value-primitive="true"			           								           						
						            		data-bind="source: accountDS, value: obj.account_id"
						            		data-option-label="Select Account..."
						            		required data-required-msg="required" style="width: 100%;" />
									</div>
									<!-- // Group END -->	
								</div>								
							
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="ddlCurrency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>							            
							            <input id="ddlCurrency" name="ddlCurrency"							            	 
				              				data-role="dropdownlist"
				              				data-option-label="(--- Select ---)"
				              				data-template="currency-list-tmpl"
				              				data-value-primitive="true"
						            		data-text-field="code"
			           						data-value-field="locale"			           						 
						            		data-bind="source: currencyDS, value: obj.locale"						            		
						            		required data-required-msg="required" style="width: 100%;" />						            		
									</div>																		
									<!-- // Group END -->										
								</div>								
							</div>							
						</div>
						<div class="span6">
							<div class="row">
								<div class="span6">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtPurchaseDescription"><span data-bind="text: lang.lang.purchase_description"></span></label>
							            <textarea id="txtPurchaseDescription" class="k-textbox" 
											data-bind="value: obj.purchase_description" style="resize:none; width: 100%;height:110px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
								<div class="span6" style="padding-left: 0; padding-right: 0;">
									<!-- Group -->
									<div class="control-group">								
										<label for="txtSaleDescription"><span data-bind="text: lang.lang.sale_description"></span></label>
							            <textarea id="txtSaleDescription" class="k-textbox" 
											data-bind="value: obj.sale_description" style="resize:none; width: 100%;height:110px;"></textarea>
									</div>																		
									<!-- // Group END -->
								</div>
							</div>
						</div>
					</div>									

					<br>											
			
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>					
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>
			</div>
		</div>
	</div>
</script>


<script id="itemPrice" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background" style="overflow: hidden;">
			<div class="container-960">					
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.item_prices"></h2>
			        <br>

			        <div class="widget-body">

				    	<div class="widget widget-heading-simple widget-body-simple">

			
							<div class="widget-head" style="font-size: large; font-weight: bold;">
								<span data-bind="text: obj.number"></span>
								-
								<span data-bind="text: obj.name"></span>
							</div>
						
										
							<div class="widget-body">


								<div class="row-fluid">
									<div class="span3" style="padding-left:0;">
									
								
										<a href="" class="widget-stats widget-stats-gray widget-stats-1">
											<span class="glyphicons cart_in"><i></i><span class="txt"><span data-bind="text: lang.lang.weighted_avg_cost"></span></span></span>
											<div class="clearfix"></div>
											<span class="count"><span data-format="n" data-bind="text: obj.cost" style="font-size: xx-large;"></span></span>
										</a>
								
										
									</div>
									<div class="span3">
									
								
										<a href="" class="widget-stats widget-stats-1">
											<span class="glyphicons cart_out"><i></i><span class="txt"><span data-bind="text: lang.lang.avg_price"></span></span></span>
											<div class="clearfix"></div>
											<span class="count"><span data-format="n" data-bind="text: obj.price" style="font-size: xx-large;"></span></span>
										</a>
								
										
									</div>
									<div class="span2">
									
		
										<a href="" class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count"><span data-format="n0" data-bind="text: obj.on_hand"></span></span>
											<span class="txt"><span data-bind="text: lang.lang.qty_on_hand"></span></span>
										</a>
								
										
									</div>
									<div class="span2">
									
							
										<a href="" class="widget-stats widget-stats-2">
											<span class="count"><span data-format="n0" data-bind="text: on_po"></span></span>
											<span class="txt"><span data-bind="text: lang.lang.on_po"></span></span>
										</a>
					
										
									</div>
									<div class="span2">
									
						
										<a href="" class="widget-stats widget-stats-gray widget-stats-2">
											<span class="count"><span data-format="n0" data-bind="text: on_so"></span></span>
											<span class="txt"><span data-bind="text: lang.lang.on_so"></span></span>
										</a>
									
										
									</div>
									
								</div>
					
															
							</div>
						</div>

						<div id="priceList-window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
							<table>
								<tr>
									<td><span data-bind="text: lang.lang.price"></span></td>
									<td style="padding: 0 0 10px;">
										<input data-role="numerictextbox"		                   
						                   data-min="0"		                   
						                   data-bind="value: priceList.price" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.currency"></span></td>
									<td style="padding: 0 0 10px;">
										<input data-role="dropdownlist"
											   data-option-label="(--- Select ---)"
											   data-template="currency-list-tmpl"			                   
							                   data-value-primitive="true"
							                   data-text-field="code"
							                   data-value-field="locale"
							                   data-bind="value: priceList.locale,
							                              source: currencyDS" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.unit_price"></span></td>
									<td style="padding: 0 0 10px;">
										<input data-role="numerictextbox"		                   
						                   data-min="0"		                   
						                   data-bind="value: priceList.unit_value" />
									</td>
								</tr>
								<tr>
									<td><span data-bind="text: lang.lang.unit"></span></td>
									<td style="padding: 0 0 10px;">
										<input data-role="dropdownlist"
											   data-option-label="(--- Select ---)"			                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: priceList.measurement_id,
							                              source: unitDS" />
									</td>
								</tr>
							</table>

							<br>

							<span class="btn btn-success btn-icon glyphicons ok_2" data-bind="click: save"><i></i><span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i><span data-bind="text: lang.lang.close"></span></span>  
						</div>				

						<button class="btn btn-inverse" data-bind="click: openWindow"><i class="icon-plus icon-white"></i></button>
						<span data-bind="text: lang.lang.set_new_price"></span>
						</br>
						</br>
						<table class="table table-bordered table-primary table-striped table-vertical-center">
					        <thead>
					            <tr>	            	
					            	<th data-bind="text: lang.lang.price"></th>			            		             
					                <th data-bind="text: lang.lang.unit_value"></th>
					                <th data-bind="text: lang.lang.unit_measure"></th>			                
					                <th></th>	                
					            </tr>
					        </thead>
					        <tbody data-template="itemPrice-template"
					        	data-auto-bind="false"			        	
					        	data-bind="source: dataSource"></tbody>
					    </table>

						<br>

						<table class="table table-bordered table-primary table-striped table-vertical-center">
					        <thead>
					            <tr>	            	
					            	<th data-bind="text: lang.lang.date"></th>
					            	<th data-bind="text: lang.lang.type"></th>	                
					                <th data-bind="text: lang.lang.reference"></th>				               
					                <th data-bind="text: lang.lang.quantity"></th>
					                <th data-bind="text: lang.lang.cost"></th>
					                <th data-bind="text: lang.lang.price"></th>			                	             
					            </tr>
					        </thead>
					        <tbody data-template="itemPrice-movement-tmpl"
					        	data-auto-bind="false"
					        	data-pageable="true" 
					        	data-bind="source: recordDS"></tbody>
					    </table>
					    <div id="pager" class="k-pager-wrap"
				             data-role="pager"
				             data-auto-bind="false" 
				             data-bind="source: recordDS"></div>					

					</div>

			    </div>
			</div>
		</div>
	</div>
</script>
<script id="itemPrice-template" type="text/x-kendo-template">
    <tr>
    	<td>#=kendo.toString(price, "c", locale)#</td>    	
    	<td>#=unit_value#</td>
    	<td>#=measurement#</td>    	
    	<td>
    		<span data-bind="click: edit"><i class="icon-edit"></i> <span data-bind="text: lang.lang.edit"></span></span>
    		|
    		<span data-bind="click: delete"><i class="icon-remove"></i> <span data-bind="text: lang.lang.delete"></span></span>
    	</td>
    </tr>
</script>
<script id="itemPrice-movement-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(invoice[0].issued_date), "dd-MM-yyyy")#</td>
    	<td>#=invoice[0].type#</td>
        <td>#=invoice[0].number#</td>
    	<td>#=kendo.toString(quantity, "n0")#</td>
    	<td>#=kendo.toString(cost, "c", "locale")#</td>
    	<td>#=kendo.toString(price, "c", "locale")#</td>  	
    </tr>
</script>
<script id="itemAdjustment" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background" style="overflow: hidden;">
			<div class="container-960">					
				<div id="example" class="k-content">

					<span class="glyphicons no-js remove_2 pull-right" 
		    				onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>

			        <h2 data-bind="text: lang.lang.item_adjustment"></h2>
			        <br>

			        <!-- Upper Part -->
					<div class="row">
						<div class="span4" style="padding-left: 15px;">							
							<div class="box-generic well" style="height: 190px;">
								<div class="widget widget-heading-simple widget-body-primary widget-employees">		
									<div class="widget-body padding-none">			
										<div class="row-fluid row-merge">
											<div class="listWrapper">
												<div class="innerAll" style="padding: 15px 15px 19px;">							
													<form autocomplete="off" class="form-inline">
														<div class="widget-search separator bottom">
															<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
															<div class="overflow-hidden">
																<input type="search" placeholder="Item Number..." data-bind="value: searchText, events:{change: enterSearch}">
															</div>
														</div>
														<div class="select2-container" style="width: 100%;">								
															<input id="ddlCategory" name="ddlCategory"
																   data-option-label="Select Category..."
																   data-role="dropdownlist"
																   data-auto-bind="false"    
												                   data-value-primitive="true"
												                   data-text-field="name"
												                   data-value-field="id"
												                   data-bind="value: category_id,
												                              source: categoryDS"                    
												                   style="width: 100%; height: 29px;" />									
														</div>
													</form>					
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>					   

						<div class="span8" style="padding-left:0;">							
							<div class=" box-generic-noborder">
							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons cogwheels active"><a href="#tab1-4" data-toggle="tab"><i></i> </a>
							            </li>						            
							            <li class="span1 glyphicons pen"><a href="#tab2-4" data-toggle="tab"><i></i></a>
							            </li>
							            <li class="span1 glyphicons circle_info"><a href="#tab3-4" data-toggle="tab"><i></i></a>
								        </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab4-4" data-toggle="tab"><i></i></a>
							            </li>			            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-4">						            
							            <table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">
							            	<tr>
												<td><span data-bind="text: lang.lang.date"></span></td>
												<td class="right">
													<input id="issuedDate" name="issuedDate" 
															data-role="datepicker"
															data-format="dd-MM-yyyy"
															data-parse-formats="yyyy-MM-dd" 
															data-bind="value: obj.issued_date, 
																		events:{ change : setRate }" 
															required data-required-msg="required"
															style="width:100%;" />
												</td>
											</tr>											
								            <tr>
												<td>
													<span data-bind="text: lang.lang.staff"></span>
												</td>
												<td>
													<input id="cbbReader" name="cbbReader" 
									    				   data-role="combobox"
										                   data-placeholder="Select ..."
										                   data-auto-bind="false"
										                   data-value-primitive="true"
										                   data-filter="startswith"							                   
										                   data-min-length="3"							                   
										                   data-text-field="name"
										                   data-value-field="id"							                   
										                   data-bind="value: obj.contact_id,
										                              source: contactDS"
										                   style="width: 100%" />
												</td>
											</tr>										
								            <tr>
								            	<td><span data-bind="text: lang.lang.adjustment_account"></span></td>
								            	<td>
								            		<input id="ddlAccount" name="ddlAccount"
								            			   data-role="dropdownlist"
														   data-option-label="Select Account..."
														   data-header-template="account-header-tmpl"							                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"									                   
										                   data-bind="value: obj.account_id,
										                              source: accountDS"
										                   required data-required-msg="required" style="width: 100%;" />
								            	</td>
								            </tr>
							            </table>						            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Memo Tab content -->
							        <div class="tab-pane" id="tab2-4">
							        	<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>
										<br>						
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.memo" placeholder="memo for external ..."></textarea>
							        </div>
							        <!-- // Memo Tab content END -->

							        <!-- Info Tab content -->
							        <div class="tab-pane" id="tab3-4">
							        	
										<table class="table table-borderless table-condensed cart_total">							            					            	
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"								   
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"									                   				   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Add job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>
												
							        </div>
							        <!-- // Info Tab content END -->
							        
							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab4-4">
							         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th data-bind="text: lang.lang.file_name"></th>
									                <th data-bind="text: lang.lang.description"></th>
									                <th data-bind="text: lang.lang.date"></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->							        

							    </div>							
							</div>
					    </div>					   
					</div>

					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				            	<th width="5%"><span data-bind="text: lang.lang.no_"></span></th>				                
				                <th data-bind="text: lang.lang.item"></th>
				                <th data-bind="text: lang.lang.qoh"></th>
				                <th data-bind="text: lang.lang.quantity_count"></th>
				                <th data-bind="text: lang.lang.different"></th>
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"
			                 data-template="itemAdjustment-row-template"
			                 data-bind="source: lineDS"></tbody>				        
				    </table>

					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>						

						<div class="row">
							<div class="span3">
								
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>								
							</div>
						</div>
					</div>
					<!-- // Form actions END -->
				
				</div>				
			</div>			
		</div>
	</div>
</script>
<script id="itemAdjustment-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #"> 
    	<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.itemAdjustment.lineDS.indexOf(data)+1#			
		</td>
    	<td>#=description#</td>
    	<td align="right">#=kendo.toString(on_hand, "n")#</td>
    	<td align="right">
    		<input class="txt#=uid#"
    			   data-role="numerictextbox"
                   data-format="n0"
                   data-min="0"
                   data-spinners="false"                   
                   data-bind="value: quantity_adjusted,
                   			  events:{ change: onChange }"
                   style="width: 100px;">    		
    	</td>
    	<td align="right">
    		<span data-format="n0" data-bind="text: quantity"></span>
    	</td>
    </tr>
</script>
<script id="internalUsage" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">					
				    
			    	<div class="hidden-print pull-right">
			    		<span class="glyphicons no-js remove_2" onclick="javascript:window.history.back()"
							data-bind="click: cancel"><i></i></span>						
					</div>

			        <h2 data-bind="text: lang.lang.internal_usage"></h2>			    		   

				    <br>				   				
					
					<!-- Upper Part -->
					<div class="row-fluid">
						<div class="span4">
							<div class="box-generic well" style="height: 150px;">				
								<table class="table table-borderless table-condensed cart_total">									
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.no_"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" /></td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td class="right">
											<input id="issuedDate" name="issuedDate" 
													data-role="datepicker"
													data-format="dd-MM-yyyy"
													data-parse-formats="yyyy-MM-dd" 
													data-bind="value: obj.issued_date, 
																events:{ change : setRate }" 
													required data-required-msg="required"
													style="width:100%;" />
										</td>
									</tr>
								</table>

								<div class="strong" style="margin-bottom:0; width: 100%; padding: 10px;" align="center"
									data-bind="style: { backgroundColor: amtDueColor}">
									<div align="left"><span data-bind="text: lang.lang.total_usage"></span></div>
									<h2 data-bind="text: total" align="right"></h2>
								</div>

							</div>
						</div>					   

						<div class="span8">
							<div class="box-generic-noborder" style="min-height: 110px;">

							    <!-- Tabs Heading -->
							    <div class="tabsbar tabsbar-2">
							        <ul class="row-fluid row-merge">
							        	<li class="span1 glyphicons circle_info active"><a href="#tab1-3" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons adress_book"><a href="#tab2-3" data-toggle="tab"><i></i> </a>
							            </li>
							            <li class="span1 glyphicons paperclip"><a href="#tab3-3" data-toggle="tab"><i></i></a>
							            </li>					            								            
							        </ul>
							    </div>
							    <!-- // Tabs Heading END -->

							    <div class="tab-content">

							    	<!-- Options Tab content -->
							        <div class="tab-pane active" id="tab1-3">						            
							           	<table style="margin-bottom: 0;" class="table table-borderless table-condensed cart_total">											
											<tr>
												<td><span data-bind="text: lang.lang.segments"></span></td>
												<td>
													<select data-role="multiselect"
														   data-value-primitive="true"
														   data-header-template="segment-header-tmpl"
														   data-item-template="segment-list-tmpl"				    
														   data-value-field="id" 
														   data-text-field="code"
														   data-bind="value: obj.segments, 
														   			source: segmentItemDS,
														   			events:{ change: segmentChanges }"
														   data-placeholder="Add Segment.."				   
														   style="width: 100%" /></select>
												</td>
											</tr>
											<tr>
												<td><span data-bind="text: lang.lang.job"></span></td>
												<td>
													<input id="ddlJob" name="ddlJob"
														   data-role="dropdownlist"
														   data-header-template="job-header-tmpl"
														   data-template="job-list-tmpl"
														   data-auto-bind="false"				                
										                   data-value-primitive="true"		   
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.job_id, 
										                   			source: jobDS"
										                   data-option-label="Select job..." 
										                   style="width: 100%" />										
												</td>
											</tr>											
							            </table>	            
							        </div>
							        <!-- // Options Tab content END -->

							        <!-- Address Tab content -->
							        <div class="tab-pane" id="tab2-3">
							        	<span data-bind="text: lang.lang.from"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.bill_to" placeholder="Billing to ..."></textarea>								
										
										<span data-bind="text: lang.lang.to"></span>
										<textarea cols="0" rows="2" class="k-textbox" style="width:100%" data-bind="value: obj.ship_to" placeholder="Shipping to ..."></textarea>	
												
							        </div>
							        <!-- // Address Tab content END -->

							        <!-- Attach Tab content -->
							        <div class="tab-pane" id="tab3-3">
							         	<p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>							            	
							            
							            <input id="files" name="files"
						                   type="file"
						                   data-role="upload"
						                   data-show-file-list="false"
						                   data-bind="events: { 
				                   				select: onSelect
						                   }">

							            <table class="table table-bordered">
									        <thead>
									            <tr>			                
									                <th data-bind="text: lang.lang.file_name"></th>
									                <th data-bind="text: lang.lang.description"></th>
									                <th data-bind="text: lang.lang.date"></th>
									                <th style="width: 13%;"></th>                			                
									            </tr> 
									        </thead>
									        <tbody data-role="listview" 
									        		data-template="attachment-list-tmpl" 
									        		data-auto-bind="false"
									        		data-bind="source: attachmentDS"></tbody>			        
									    </table>

							        </div>
							        <!-- // Attach Tab content END -->							        					        								        

							    </div>
							</div>
					    </div>
					</div>
					
					<div class="row-fluid">
						<p>To:

						<input id="cbbItem" name="cbbItem"
							   data-role="combobox"                   
			                   data-value-primitive="true"
			                   data-template="item-list-tmpl"
			                   data-auto-bind="false",
                        	   data-min-length="3",
			                   data-filter="contains"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: obj.item_id,
			                              source: itemDS"
			                   placeholder="Select Item..."					                                      
			                   required data-required-msg="required" style="width: 95%; margin-left: 20px; display: inline-block;" />									
			            </p>
						<h4 data-bind="text: lang.lang.from"></h4>
					</div>

					<!-- Item List -->
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th style="width: 1%;"><span data-bind="text: lang.lang.no_"></span></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.item"></span></th>
				                <th data-bind="text: lang.lang.description"></th>
				                <th style="width: 20%;"><span data-bind="text: lang.lang.qty"></span></th>               			                
				            </tr> 
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="internalUsage-template" 
				        		data-auto-bind="false"
				        		data-bind="source: lineDS"></tbody>			        
				    </table>			    
									
		            <!-- Bottom part -->
		            <div class="row-fluid">
			
						<!-- Column -->
						<div class="span6 hidden-print">
							
							<button class="btn btn-inverse" data-bind="click: addRow"><i class="icon-plus icon-white"></i></button>												

							<!-- Add New Item -->
							<ul class="topnav addNew">
								<li role="presentation" class="dropdown ">
							  		<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							  			<span data-bind="text: lang.lang.add_new_item"></span>
				    					<span class="caret"></span>
							  		</a>
						  			<ul class="dropdown-menu addNewItem">  				  				
						  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
						  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
						  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
						  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
						  				<li><a href='#/txn_item'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  				
						  				 				
						  			</ul>
							  	</li>				
							</ul>
							<!--End Add New Item -->						
							
						</div>
						<!-- Column END -->
						
						<!-- Column -->
						<div class="span6">
							<table class="table table-borderless table-condensed cart_total">
								<tbody>								
									<tr>
										<td class="right"><span data-bind="text: lang.lang.total"></span></td>
										<td class="right strong"><span data-bind="text: total"></span></td>
									</tr>								
								</tbody>
							</table>
						</div>
						<!-- // Column END -->
						
					</div>
		           
		            <br>
					
					<!-- Form actions -->
					<div class="box-generic bg-action-button">
						<div id="ntf1" data-role="notification"></div>

						<!-- Delete Confirmation -->
						<div data-role="window"
			                 data-title="Delete Confirmation"
			                 data-width="350"
			                 data-height="200"
			                 data-iframe="true"
			                 data-modal="true"
			                 data-visible="false"
			                 data-position="{top:'40%',left:'35%'}"
			                 data-actions="{}"
			                 data-resizable="false"
			                 data-bind="visible: showConfirm"
			                 style="text-align:center;">
			                <p style="font-size:25px; margin: 15px 0 25px;" class="delete-message" data-bind="text: confirmMessage"></p>
						    <button style="font-size:14px; border:none; background:#496cad; color:#fff; padding:5px 25px;" data-bind="click:delete">Yes</button> 
						    <button style="font-size:14px; border:none; background:red; color:#fff; padding:5px 25px;" data-bind="click:closeConfirm">No</button>
			            </div>
			            <!-- // Delete Confirmation -->

						<div class="row">
							<div class="span3">
								<input data-role="dropdownlist"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: obj.transaction_template_id,
					                              source: txnTemplateDS"
					                   data-option-label="Select Template..." />
							</div>
							<div class="span9" align="right">
								<span id="saveNew" class="btn btn-icon btn-primary glyphicons ok_2" data-bind="invisible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_new"></span></span>
								<span id="saveClose" class="btn btn-icon btn-success glyphicons power" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_close"></span></span>																	
								<span id="savePrint" class="btn btn-icon btn-default glyphicons print" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.save_print"></span></span>
								<span class="btn btn-icon btn-warning glyphicons remove_2" onclick="javascript:window.history.back()" data-bind="click: cancel" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-danger btn-icon glyphicons bin" data-bind="click: openConfirm, visible: isEdit" style="width: 80px;"><i></i> <span data-bind="text: lang.lang.delete"></span></span>				
							</div>
						</div>
					</div>
					<!-- // Form actions END -->

				</div>							
			</div>
		</div>
	</div>
</script>
<script id="internalUsage-template" type="text/x-kendo-tmpl">		
	<tr data-uid="#: uid #">		
		<td>
			<i class="icon-trash" data-bind="events: { click: removeRow }"></i>
			#:banhji.internalUsage.lineDS.indexOf(data)+1#			
		</td>		
		<td>
			<input id="ccbItem" name="ccbItem-#:uid#"
				   data-role="combobox"
				   data-template="item-list-tmpl"                   			   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, 
                   			  source: itemDS,
                   			  events:{ change: itemChanges }"
                   placeholder="Add Item..." 
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>
			<input id="txtQuantity-#:uid#" name="txtQuantity-#:uid#" 
					data-role="numerictextbox" 
					data-format="n0" data-min="0"
					data-spinners="false"
					data-bind="value: quantity, events: {change : changes}"
					required data-required-msg="required" style="width: 40%;" />

			<input id="ddlMesurement" 
				   data-role="dropdownlist"
				   data-header-template="item-measurement-header-tmpl"                  
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: measurement_id,
                   			  source: measurementDS"
                   data-option-label="UM"
                   style="width: 57%;" />
		</td>
    </tr>   
</script>
<script id="itemSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2 data-bind="text: lang.lang.products_services_setting"></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons bookmark" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.category"></span></span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons tag" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.group"></span></span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons ruller" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.measurement"></span></span></a>
	            </li>
	            <li><a href="#tab4-1" class="glyphicons certificate" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.brand"></span></span></a>
	            </li>
	                       
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">	            

	            <!-- Tab Category content -->
	            <div class="tab-pane active" id="tab1-1">	            	
		            <div class="input-append">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Category Name..." data-bind="value: category_name">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Category Abbr..." data-bind="value: category_abbr">					    
					    <input class="span2" id="appendedInputButtons"
					    	   data-role="dropdownlist"					    	   
			                   data-value-primitive="true"
			                   data-auto-bind="false"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: category_item_type_id,
			                              source: itemTypeDS" />
					    <button class="btn btn-default" type="button" data-bind="click: addCategory"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_new_category"></span></button>					  
					</div>
		            
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>	
	            				<th data-bind="text: lang.lang.name"></th>	
	            				<th data-bind="text: lang.lang.abbr"></th>
	            				<th data-bind="text: lang.lang.type"></th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-category-template"
				                data-template="itemSetting-category-template"
				                data-bind="source: categoryDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Category Type content END -->	            

	            <!-- Tab Item Group content -->
	            <div class="tab-pane" id="tab2-1">
		            <div class="input-append">
		            	<input id="appendedInputButtons" class="span4"
		            	   data-role="dropdownlist"
            			   data-option-label="(--- Select Category ---)"            			   			                   
		                   data-value-primitive="true"
		                   data-auto-bind="false"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: item_group_category_id,
		                              source: categoryDS"/>	
					    	
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="New Group Name..." data-bind="value: item_group_name">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Group Abbr..." data-bind="value: item_group_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addItemGroup"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_new_group"></span></button>					  
					</div>
		            
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th data-bind="text: lang.lang.name"></th>	
	            				<th data-bind="text: lang.lang.abbr"></th>
	            				<th data-bind="text: lang.lang.category"></th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-item-group-template"
				                data-template="itemSetting-item-group-template"
				                data-bind="source: itemGroupDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Item Group Type content END -->

	            <!-- Tab Measurement content -->
	            <div class="tab-pane" id="tab3-1">
                	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Measurement..." data-bind="value: measurement_name">					    
					    <button class="btn btn-default" type="button" data-bind="click: addMeasurement"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_measurement"></span></button>		
					</div>
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th data-bind="text: lang.lang.measurement"></th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-measurement-template"
				                data-template="itemSetting-measurement-template"
				                data-bind="source: measurementDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Measurement content END -->

	            <!-- Tab Brand content -->
	            <div class="tab-pane" id="tab4-1">
		            <div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: brand_code">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="New Brand..." data-bind="value: brand_name">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: brand_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addBrand"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_brand"></span></button>					  
					</div>
		            
	            	<table class="table table-bordered table-condensed table-striped table-primary table-vertical-center checkboxs">
	            		<thead>
	            			<tr>
	            				<th data-bind="text: lang.lang.code"></th>
	            				<th data-bind="text: lang.lang.name"></th>
	            				<th data-bind="text: lang.lang.abbr"></th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-brand-template"
				                data-template="itemSetting-brand-template"
				                data-bind="source: brandDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Brand Type content END -->

	                       

	        </div>
	    </div>

	</div>
</script>
<script id="itemSetting-category-template" type="text/x-kendo-tmpl">                    
    <tr>
   		<td>
    		#:name#
   		</td>
   		<td align="center">
    		#:abbr#
   		</td>
   		<td align="center">
    		#:item_type.length>0 ? item_type[0].name : ""#
   		</td>   		
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#
		        <span class="k-button" data-bind="click: goPattern"><span data-bind="text: lang.lang.pattern"></span></span>
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-category-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>
            <dd>
            <input data-role="dropdownlist"
                   data-value-primitive="true"
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_type_id,
                              source: itemTypeDS" />
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-item-group-template" type="text/x-kendo-tmpl">                    
    <tr>   		
   		<td>
    		#:name#
   		</td>
   		<td align="center">
    		#:abbr#
   		</td>
   		<td align="center">
    		#:category[0].name#
   		</td>   		
   		<td align="center">	        
        	<div class="edit-buttons">
	        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
	        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
        	</div>	        	   	
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-item-group-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-auto-bind="false"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: category_id,
	                              source: categoryDS"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-measurement-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#:name#
   		</td>
   		<td align="center">   			
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        #if(is_system=="0"){#
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>				        
		        #}#
		   	</div>		   	
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-measurement-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="name" required="required" validationMessage="required" />
                <span data-for="name" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="itemSetting-brand-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:code#
   		</td>
   		<td align="center">
    		 #:name#
   		</td>
   		<td align="center">
    		 #:abbr#
   		</td>
   		<td align="center">
   			<div class="edit-buttons">		        
	        	<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
	        	<a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>		        
		   	</div>		   
   		</td>
   	</tr>
</script>
<script id="itemSetting-edit-brand-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"	                   
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: sub_of,
	                              source: subBrandDS"/>
            </dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="name" required="required" validationMessage="required" />
                <span data-for="name" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" name="abbr" required="required" validationMessage="required" />
                <span data-for="abbr" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>

<script id="serviceSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2 data-bind="text: lang.lang.general_service_setting"></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons bookmark" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.category"></span></span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons tag" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.group"></span></span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons ruller" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.measurement"></span></span></a>
	            </li>	            	            
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">	            

	            <!-- Tab Category content -->
	            <div class="tab-pane active" id="tab1-1">	            	
		            <div class="input-append">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: category_code">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="New..." data-bind="value: category_name">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: category_abbr">					    
					    <input class="span2" id="appendedInputButtons"
					    	   data-role="dropdownlist"					    	   
			                   data-value-primitive="true"
			                   data-auto-bind="false"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: category_item_type_id,
			                              source: itemTypeDS" />
					    <button class="btn btn-default" type="button" data-bind="click: addCategory"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_new_category"></span></button>					  
					</div>
		            
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>	            				            				
	            				<th data-bind="text: lang.lang.code"></th>	
	            				<th data-bind="text: lang.lang.name"></th>	
	            				<th data-bind="text: lang.lang.abbr"></th>
	            				<th data-bind="text: lang.lang.type"></th>            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            				
		            			data-edit-template="itemSetting-edit-category-template"
				                data-template="itemSetting-category-template"
				                data-bind="source: categoryDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Category Type content END -->	            

	            <!-- Tab Item Group content -->
	            <div class="tab-pane" id="tab2-1">
		            <div class="input-append">
		            	<input id="appendedInputButtons" class="span2"
		            	   data-role="dropdownlist"
            			   data-option-label="(--- Select Category ---)"
            			   data-auto-bind="false"            			   			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: item_group_category_id,
		                              source: categoryDS"/>	
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="Code..." data-bind="value: item_group_code">	
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="New Name..." data-bind="value: item_group_name">
					    <input class="span3" id="appendedInputButtons" type="text" placeholder="abbr..." data-bind="value: item_group_abbr">					    
					    <button class="btn btn-default" type="button" data-bind="click: addItemGroup"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_new_group"></span></button>					  
					</div>
		            
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>	            					            				
	            				<th data-bind="text: lang.lang.code"></th>	
	            				<th data-bind="text: lang.lang.name"></th>	
	            				<th data-bind="text: lang.lang.abbr"></th>
	            				<th data-bind="text: lang.lang.type"></th> 	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            				
		            			data-edit-template="itemSetting-edit-item-group-template"
				                data-template="itemSetting-item-group-template"
				                data-bind="source: itemGroupDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Item Group Type content END -->

	            <!-- Tab Measurement content -->
	            <div class="tab-pane" id="tab3-1">
                	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="Measurement..." data-bind="value: measurement_name">					    
					    <button class="btn btn-default" type="button" data-bind="click: addMeasurement"><i class="icon-plus"></i> <span data-bind="text: lang.lang.add_measurement"></span></button>			
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th data-bind="text: lang.lang.measurement"></th>	            				
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="itemSetting-edit-measurement-template"
				                data-template="itemSetting-measurement-template"
				                data-bind="source: measurementDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Measurement content END -->	                     

	        </div>
	    </div>

	</div>
</script>

<script id="itemReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>INVENTORY POSITION</h2>
				<p>
					The following reports provide summary and detailed reports on the position of inventory. 
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/inventory_position_summary">Inventory Position Summary</a></h3>
							</td>
							<td >
								<h3><a href="#/inventory_sale_item_analysis">Inventory Sale by Item Analysis</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Summarizes each inventory balance by quantity on hand, on purchase order and sale order. In addition, it also includes average cost and price.  

								</p>
								
							</td>
							<td >
								<p>
									Lists of all transactions related to and grouped by each inventory with analysis of average gross profit margin.

								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/inventory_position_detail">Inventory Position Detail</a></h3>
							</td>
							<!-- <td >
								<h3><a href="#/inventory_turnover_list">Inventory Turnover List</a></h3>
							</td> -->
							<td>
								
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual inventory movement transactions by date for each inventory within a period of time.

								</p>
							</td>
							<td></td>
							<!-- <td >
								<p>
									Provides analysis of inventory turnover days by each inventory.

								</p>
							</td> -->
						</tr>
					</table>
				</div>
			</div>

			<div class="row-fluid recevable-report">
				<h2>INVENTORY MOVEMENT REPORTS</h2>
				<p>
					The following reports provide summary and detailed reports on the movement of the inventories
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/inventory_movement_summary">Inventory Movement Summary</a></h3>
							</td>
							<!-- <td >
								<h3><a href="#/inventory_movement_detail">Inventory Movement Detail</a></h3>								
							</td>	 -->
							<td >
								<h3><a href="#/purchase_summary_product_services">Purchase by Supplier Summary</a></h3>
							</td>					
						</tr>
						<tr>
							<td >
								<p>
									Shows the movement of each inventory by opening balance, sale, purchase and adjustment. 
								</p>
								
							</td>
							<!-- <td >
								<p>
									Lists of all detailed transactions related to and grouped by each inventory
								</p>
							</td> -->
							<td >
								<p>
									Lists all inventory purchases from each suppliers
								</p>
							</td>
						</tr>
						<tr>
							
							<td >
								<h3><a href="#/purchase_detail_product_services">Purchase by Supplier Detail</a></h3>
							</td>
							<td >
								<h3><a href="#/sale_summary_customer">Sale by Customer Summary</a></h3>
							</td>
						</tr>
						<tr>
							
							<td >
								<p>
									Lists of detailed inventory purchase transactions from each suppliers
								</p>
							</td>
							<td >
								<p>
									Lists all inventory sold to each customer
								</p>
							</td>
						</tr>

						<tr>
							
							<td >
								<h3><a href="#/sale_detail_customer">Sale by Customer Detail</a></h3>
							</td>
						</tr>
						<tr>
							
							<td >
								<p>
									Lists of detailed inventory sale transactions to each customer
								</p>
							</td>
						</tr>
						
					</table>
				</div>
			</div>
			<!-- <div class="row-fluid recevable-report">
				<h2>OTHER REPORTS/ LISTS</h2>
				<p>
					The following reports provide summary and detailed reports on the movement of the inventories
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td style="width: 55%; padding-right: 8px !important;">
								<h3><a href="#/inventory_list">Inventory List</a></h3>
							</td>
							<td >
								<h3><a href="#/">Recurring Inventory Template List</a></h3>								
							</td>						
						</tr>
						<tr>
							<td style="width: 55%; padding-right: 8px !important;">
								<p>
									Lists the products you purchase and sold. The following information is included: name, description, cost, sales price, and quantity on hand.
								</p>								
							</td>
							<td >								
							</td>
							
						</tr>
						
					</table>
				</div>
			</div> -->
		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart">
				<div class="widget-body alert alert-primary sale-overview">
					<h2>Inventory Balance</h2>
					<div align="center" class="text-large strong" data-bind="text: inventoryBalance"></div>
					<table width="100%">
						<tr align="center">
							<td>
								<span data-bind="text: grossProfitMargin"></span>
								<br>
								<span>Average Margin</span>
							</td>
							<td>
								<span data-bind="text: inventoryTurnOver"></span>
								<br>
								<span>Turnover Days</span>
							</td>
						</tr>
					</table>
				</div>
				<div class="home-chart" >
				<div data-role="chart"
	                 data-legend="{ position: 'top' }"
	                 data-series-defaults="{ type: 'column' }"
	                 data-tooltip='{
	                    visible: true,
	                    format: "{0}%",
	                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
	                 }'                 
	                 data-series="[
	                                { field: 'purchase', name: 'Monthly Purchase', categoryField:'month', color: '#236DA4' },
	                                { field: 'sale', name: 'Monthly Sale', categoryField:'month', color: '#A6C9E3' }
	                            ]"	                             
	                 data-bind="source: graphDS"
	                 style="height: 250px;" ></div>            
           		</div>

			</div>
		</div>
	</div>
</script>
<script id="inventoryPositionSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: inventoryPositionSummary.search"><i class="icon-search"></i></button>							
									    </div>
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Inventory Position Summary</h2>
							<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<p>Product Items</p>
									<span data-bind="text: count"></span>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Product Items on hand</p>
									<span data-bind="text: onHand"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Item Name</span></th>
									<th><span>QOH</span></th>
									<th><span>On Purchase Order</span></th>
									<th><span>On Sale Order</span></th>
									<th><span>Average Cost</span></th>
									<th><span>Average Price</span></th>
								
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="inventory-position-summary-row-template"
					                data-bind="source: inventoryPositionSummary.dataSource" >
					        </tbody>
		            	</table>
		            </div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-position-summary-row-template" type="text/x-kendo-tmpl">
	<tr>
	    <td>#=item#</td>
	    <td align="center">#=onHand#</td>
	    <td align="center">#=po#</td>
	    <td align="center">#=so#</td>
	    <td align="center">#=kendo.toString(cost, 'c2')#</td>
	    <td style="text-align: right;">#=kendo.toString(price, 'c2')#</td>
	</tr>
</script>
<script id="inventorySaleItemAnalysis" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: inventorySaleDB.search"><i class="icon-search"></i></button>							
									    </div>
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Inventory Sale by Item Analysis</h2>
							<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span12">
										<p>Sale</p>
										<span data-bind="text: sale"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Gross profit Margin</p>
									<span data-bind="text: grossProfitMargin"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th><span>Number</span></th>
									<th><span>QTY</span></th>
									<th><span>Price</span></th>
									<th><span>Amount</span></th>
									<th><span>Cost</span></th>
								
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="inventory-sale-item-analysis-template"
					                data-bind="source: inventorySaleDB.dataSource" >
					        </tbody>
		            	</table>
		            </div>	
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-sale-item-analysis-template" type="text/x-kendo-tmpl">
	<tr style="font-weight: bold">
		<td>#=item#</td>
		<td></td>
		<td></td>		
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	# if (transactions.length) {#
		#for(var i= 0; i <transactions.length; i++) {#
			<tr>
				<td>&nbsp;&nbsp;#=transactions[i].type#</td>			
				<td>
					<a href="\#/#=transactions[i].type.toLowerCase()#/#=transactions[i].id#">#=transactions[i].number#</a>
				</td>
				<td>#=transactions[i].qty#</td>	
				<td style="text-align: right;">#=kendo.toString(transactions[i].price, 'c2')#</td>	
				<td style="text-align: right;">#=kendo.toString(transactions[i].amount, 'c2')#</td>	
				<td style="text-align: right;">#=kendo.toString(transactions[i].cost, 'c2')#</td>
				<td style="text-align: right;">#=kendo.toString(transactions[i].gpm, 'p0')#</td>
			</tr>
		#}#
	#}#
</script>
<script id="inventoryPositionDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: inventoryPositionDetail.search"><i class="icon-search"></i></button>							
									    </div>
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Inventory Position Detail</h2>
							<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Product Items</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Product Items on hand</p>
										<span data-bind="text: totalOnhand"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Total </p>
									<span data-bind="text: total"></span>
							</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Type</span></th>
									<th align="center"><span>Date</span></th>								
									<th align="center"><span>REF</span></th>
									<th><span>QTY</span></th>
									<th><span>Cost</span></th>
									<th><span>On Hand</span></th>
									<th align="center"><span>AVG Cost</span></th>
									<th><span>Price</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="inventory-position-detail-row-template"
					                data-bind="source: inventoryPositionDetail.dataSource" >
					        </tbody>
		            	</table>
		            </div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-position-detail-row-template" type="text/x-kendo-tmpl">
	<tr>
	    <td style="font-weight: bold">#=item#</td>
	    <td></td>
	    <td></td>
	    <td></td>	   
	    <td></td>
	    <td ></td>
	    <td ></td>
		<td></td>
	</tr>
	# if(transactions.length>0){#
		# for(var i = 0; i < transactions.length; i++ ) {#
		<tr>
			<td>#=transactions[i].type#</td>
		    <td>#=transactions[i].date#</td>
		    <td>
		   		<a href="\#/#=transactions[i].type.toLowerCase()#/#=transactions[i].id#">#=transactions[i].ref#</a>
		   	</td>
		    <td>#=transactions[i].qty#</td>
		    <td align="center">#=transactions[i].cost#</td>
		    <td align="center">#=onHand#</td>
		    <td align="center">#=kendo.toString(avg_cost, 'c2')#</td>
			<td align="right">#=kendo.toString(price, 'c2')#</td>
		</tr>
		#}#
	#}#	
</script>
<script id="inventoryTurnoverList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: inventoryTurnoverList.search"><i class="icon-search"></i></button>							
									    </div>
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">
						<div class="block-title">
							<h3 data-bind="text: company.name"></h3>
							<h2>Inventory Turnover List</h2>
							<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
						</div>

						<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Product Items</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Turnover</p>
										<span data-bind="text: turnover"></span>
									</div>	
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Product Items on hand</p>
									<span data-bind="text: onHand"></span>
								</div>
							</div>
						</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>Product/Service</span></th>						
									<th><span>Cogs</span></th>
									<th><span>On Hand</span></th>
									<th><span>Turn Over</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="inventory-turnover-list-row-template"
					                data-bind="source: inventoryTurnoverList.dataSource" >
					        </tbody>
		            	</table>
		            </div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-turnover-list-row-template" type="text/x-kendo-tmpl">  
	<tr>  
	    <td>#=name#</td>
	    <td align="right">#=kendo.toString(cogs, 'c2')#</td>
	    <td align="right">#=onHand#</td>
	    <td align="right">#=kendo.toString(turnover, 'n0')#</td>
	 </tr>
</script>

<script id="inventoryMovementSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab" data-bind="click: printGrid"><i></i>Print/Export</a></li
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList,
									                      events: {change: dateChange}" />

									        <input id="sdate" name="sdate"
									        	   data-role="datepicker"
										           data-bind="value: startDate, events: {change: dateMax}"
										           placeholder="From ..." />

									       	<input id="edate" name="edate"
									       		   data-role="datepicker"
										           data-bind="value: endDate, events: {change: dateMin}"
										           placeholder="To ..." />

										  	 <button type="button" data-role="button" data-bind="click: inventoryMovementSummary.search"><i class="icon-search"></i></button>							
									    </div>									        							       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>
					<div id="invFormContent">

					<div class="block-title">

						<h3 data-bind="text: institute.name"></h3>
						<h2>Inventory Movement Summary</h2>
						<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
					</div>

					<div class="row-fluid">
							<div class="span5">
								<div class="total-customer">
									<div class="span6">
										<p>Purcahse In</p>
										<span data-bind="text: count"></span>
									</div>
									<div class="span6">
										<p>Product Items on hand</p>
										<span data-bind="text: onHand"></span>
									</div>
								</div>
							</div>
							<div class="span7">
								<div class="total-customer">
									<p>Sale</p>
									<span data-bind="text: sale"></span>
								</div>
							</div>
					</div>

						<table class="table table-borderless table-condensed ">
							<thead>
								<tr>
									<th><span>ITEM</span></th>
									<th><span>PURCHASE</span></th>
									<th><span>SALE</span></th>
									<th><span>ON HAND</span></th>
									<th><span>ADJUSTMENT</span></th>
									<th><span>BALANCE</span></th>
								</tr>
							</thead>
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="inventory-movement-summary-row-template"
					                data-bind="source: inventoryMovementSummary.dataSource" >
					        </tbody>
		            	</table>
	            	</div>
				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-summary-row-template" type="text/x-kendo-tmpl"> 
	<tr>   
	    <td>#=name#</td>          
	    <td>#=purchase#</td>
	    <td>#=sale#</td>
	    <td>#=onHand#</td>
	    <td>#=adjustment#</td>
	    <td align="right">#=balance#</td>
	</tr>
</script>
<script id="inventoryMovementDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3 data-bind="text: institute.name"></h3>
						<h2>Inventory Movement Detail</h2>
						<p><span data-bind="text: startDate"></span>to<span data-bind="text: endDate"></p>
					</div>

					<div class="row-fluid">
						<div class="span5">
							<div class="total-customer">
								<div class="span6">
									<p>Purcahse In</p>
									<span data-bind="text: count"></span>
								</div>
								<div class="span6">
									<p>Total</p>
									<span>-</span>
								</div>	
							</div>
						</div>
						<div class="span7">
							<div class="total-customer">
								<div class="span6">
									<p>Product Items on hand</p>
									<span>-</span>
								</div>
								<div class="span6">
									<p>Gross Profit Margin</p>
									<span data-bind="text: gpm"></span>
								</div>
							</div>
						</div>
					</div>

					<table class="table table-borderless table-condensed ">
						<thead>
							<tr>
								<th><span>Date</span></th>
								<th><span>Type</span></th>
								<th><span>Name</span></th>
								<th><span>Opening</span></th>
								<th><span>Dr</span></th>
								<th><span>Cr</span></th>
								<th><span>Adjustment</span></th>
							</tr>
						</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
				                data-template="inventory-movement-detail-row-template"
				                data-bind="source: inventoryMovementDetail.dataSource" >
				        </tbody>
	            	</table>

				</div>		
			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-detail-row-template" type="text/x-kendo-tmpl">  
	<tr>  
	    <td>#=date#</td>          
	    <td>#=type#</td>
	    <td>#=name.name#</td>
	    <td>#=opening#</td>
	    <td>#=dr#</td>
	    <td>#=cr#</td>
	    <td>#=adjustment#</td>
	</tr>
</script>
<script id="inventoryList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">
				<div id="example" class="k-content saleSummaryCustomer">		
			    	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
					<br>
					<br>

					<div class="row-fluid">
					    <!-- Tabs -->
						<div class="relativeWrap" data-toggle="source-code">
							<div class="widget widget-tabs widget-tabs-gray report-tab">
							
								<!-- Tabs Heading -->
								<div class="widget-head">
									<ul>
										<li class="active"><a class="glyphicons calendar" href="#tab-1" data-toggle="tab"><i></i>Date</a></li>										
										<li><a class="glyphicons print" href="#tab-2" data-toggle="tab"><i></i>Print/Export</a></li>
									</ul>
								</div>
								<!-- // Tabs Heading END -->								
								<div class="widget-body">
									<div class="tab-content">
								        <div class="tab-pane active" id="tab-1">									        	
											<input id="sorter" name="sorter"
									    	   data-role="dropdownlist"                   
									           data-value-primitive="true"
									           data-text-field="text"
									           data-value-field="value"
									           data-bind="value: sorter,
									                      source: sortList" />
									                                   
									        <input id="sdate" name="sdate"						           
										           data-bind="value: sdate"
										           placeholder="From ..." />
									        
									       	<input id="edate" name="edate"						           
										           data-bind="value: edate"
										           placeholder="To ..." />

								            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
							
							        	</div>								        
								        <div class="tab-pane" id="tab-2">								        	
								        	<span id="savePrint" class="btn btn-icon btn-default glyphicons print print1" data-bind="click: cancel" style="width: 80px;"><i></i> Print</span>
								        	<span id="" class="btn btn-icon btn-default pdf" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-pdf-o"></i>
								        		Print as PDF
								        	</span>
								        	<span id="" class="btn btn-icon btn-default execl" data-bind="click: cancel" style="width: 80px;">
								        		<i class="fa fa-file-excel-o"></i>
								        		Export to Excel
								        	</span>
							        	</div>								       
								    </div>
								</div>
							</div>
						</div>
						<!-- // Tabs END -->						
					</div>

					<div class="block-title">
						<h3>ABC Co., Ltd</h3>
						<h2>Inventory List</h2>
						<p>From 1 June 2016 to 30 June 2016</p>
					</div>

					<div class="row-fluid">
						<div class="span5">
							<div class="total-customer">
								<div class="span6">
									<p>Qty on S O</p>
									<span>-</span>
								</div>
								<div class="span6">
									<p>Qty on P O</p>
									<span>-</span>
								</div>	
							</div>
						</div>
						<div class="span7">
							<div class="total-customer">
								<div class="span6">
									<p>Qty on Hand</p>
									<span>-</span>
								</div>
								<div class="span6">
									<p>Gross profit magine</p>
									<span>-</span>
								</div>
							</div>
						</div>
					</div>

					<table class="table table-borderless table-condensed ">
						<tr>
							<th>Item</th>
							<th>Description</th>
							<th>Type</th>
							<th>Cost</th>
							<th>Price</th>							
							<th>VAT</th>
							<th>Qty on hand</th>
							<th>Qty on P O</th>
							<th>Reorder P</th>
							<th>Qty on S O</th>
							<th>Preferred Vendor</th>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</table>
				</div>		
			</div>
		</div>
	</div>
</script>

<script id="inventory-position-summary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=number#</td>
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>        
        <td align="right">#=kendo.toString(on_hand, "n0")#</td>
        <td align="right">#=kendo.toString(on_po, "n0")#</td>
        <td align="right">#=kendo.toString(on_so, "n0")#</td>
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(on_hand*cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(price_avg, "c", banhji.institute.locale)#</td>
   </tr>
</script>
<script id="inventory-position-detail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=kendo.toString(invoice.length>0?invoice[0].issued_date:"", "dd-MM-yyyy")#</td>
        <td><a href="\#/#=invoice.length>0?invoice[0].type:''#/#=id#"><i></i> #=invoice.length>0?invoice[0].number:''#</a></td>        
        <td>#=item[0].number# #=item[0].name#</td>               
        <td align="right">#=unit#</td>
        <td align="right">#=kendo.toString(price, "c", banhji.institute.locale)#</td>
        <td align="right">#=on_hand#</td>         
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(on_hand * cost, "c", banhji.institute.locale)#</td>        
   </tr>
</script>
<script id="inventorySaleByItem" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <br><br>

	            <div align="center">
					<h3>Inventory Sale By Item Analysis</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"					 
					 data-row-template="inventory-sale-by-item-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_sale_by_item_analysis.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                    { 'title': 'number' },
	                    { 'title': 'Item' },	                    
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id','title': 'Category' },
	                    { 'title': 'Qty Sold' },	                    	                    
	                    { 'title': 'W.Avg Price' },	                    	                    
	                    { 'title': 'Sale Revenue' },
	                    { 'title': 'W.Avg Cost' },
	                    { 'title': 'Gross Profit' },
	                    { 'title': 'Margin%' }	                    
	                 ]"></div>
			</div>
		</div>
	</div>
</script>
<script id="inventory-sale-by-item-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">
        <td>#=number#</td>          
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>       
        <td align="right">#=kendo.toString(qty, "n0", banhji.institute.locale)#</td>         
        <td align="right">#=kendo.toString(price, "c", banhji.institute.locale)#</td>
        <td align="right">
        	#amount = qty * price#
        	#=kendo.toString(amount, "c", banhji.institute.locale)#
        </td>
        <td align="right">#=kendo.toString(cost, "c", banhji.institute.locale)#</td>
        <td align="right">
        	#margin = (price-cost)*qty#
        	#=kendo.toString(margin, "c", banhji.institute.locale)#
        </td>
        <td align="right">#=kendo.toString(margin/amount, "p")#</td>        
   </tr>
</script>
<script id="inventoryList" type="text/x-kendo-template">
	<div class="container-fluid">
		<br>
		<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back();"><i></i></span>

		<h3>Inventory</h3>

		<div class="box-generic">
		    <!-- //Tabs Heading -->
		    <div class="tabsbar">
		        <ul>
		            <li class="glyphicons star active"><a href="#tab1" data-toggle="tab" data-bind="click: searchFavorite"><i></i> Favorite </a>
		            </li>
		            <li class="glyphicons list"><a href="#tab2" data-toggle="tab"><i></i> Category </a>
		            </li>
		            <li class="glyphicons building"><a href="#tab3" data-toggle="tab"><i></i> Vendor </a>
		            </li>		            		            	            
		        </ul>
		    </div>
		    <!-- // Tabs Heading END -->

		    <div class="tab-content">
		        <!-- // FavoriteTab content -->
		        <div class="tab-pane active" id="tab1">
		        		
		        </div>
		        <!-- // Favorite Tab content END -->

		        <!-- // Category Tab content -->
		        <div class="tab-pane" id="tab2">		            
	                <input id="categories" data-bind="value: category_id" />	                
	                <input id="itemGroups" data-bind="value: item_group_id" disabled="disabled" />
            	</div>
		        <!-- // Category Tab content END -->

		        <!-- // Vendor Tab content -->
		        <div class="tab-pane" id="tab3">
		            <div data-role="listview"
		            	 data-auto-bind="false"
		            	 data-selectable="true"			                 
		                 data-template="inventoryList-vendor-template"
		                 data-bind="source: vendorDS, events:{ change: vendorChanges}"></div>
		        </div>
		        <!-- // Vendor Tab content END -->		        
		    </div>

		    <br>

		    <div class="input-append">
			    <input class="col-md-2" id="appendedInputButtons" 
			    	type="text" placeholder="Items ..." 
			    	data-bind="value: searchField, events:{ change: search }">

			    <button class="btn btn-default" data-bind="click: search"><i class="icon-search"></i> Search</button>				    
			</div>
		</div>
		
		<br>

		<table class="table table-bordered">
	        <thead>
	            <tr>
	                <th>number</th>
	                <th>Items</th>
	                <th>Description</th>
	                <th>Qty</th>	                
	                <th>Price</th>	                
	            </tr>
	        </thead>
	        <tbody data-template="inventoryList-template"
	        	data-pageable="true" 
	        	data-bind="source: dataSource"></tbody>
	    </table>
	    <div id="pager" class="k-pager-wrap"
	    	 data-auto-bind="false"
             data-role="pager" data-bind="source: dataSource"></div>        

	</div>
</script>
<script id="inventoryList-template" type="text/x-kendo-template">
    <tr>
    	<td>#=number#</td>
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>
    		#if(on_hand<=order_point){#    		
    			<span class="badge badge-danger">#=kendo.toString(on_hand, "n0")#</span>
    		#}else{#
    			<span class="badge badge-info">#=kendo.toString(on_hand, "n0")#</span>
    		#}#

    		#=measurement==null?"":measurement#
    	</td>    	
    	<td>
    		#for(var i=0; i<item_prices.length; i++) {#
    			#if(item_prices[i].price>0){#
    				<span class="badge badge-inverse"> #=kendo.toString(item_prices[i].price, "c", item_prices[i].currency[0].locale)# </span> / #=item_prices[i].measurement# 
    			#}else{#
    				<span class="badge badge-danger"> #=kendo.toString(item_prices[i].price, "c", item_prices[i].currency[0].locale)# </span> / #=item_prices[i].measurement#
    			#}#
    			<br>    			    						 
			#}#
    	</td>    		
    </tr>
</script>
<script id="inventoryList-vendor-template" type="text/x-kendo-template">
    <div class="product-tmpl">
        <img src="#=image_url#" alt="#: company # image" />
        <h3>#:company#</h3>        
    </div>    
</script>
<style>
    #listView {
        padding: 10px 5px;
        margin-bottom: -1px;
        min-height: 510px;
    }
    .product-tmpl {
        float: left;
        position: relative;
        width: 111px;
        height: 170px;
        margin: 0 5px;
        padding: 0;
    }
    .product-tmpl img {
        width: 110px;
        height: 110px;
    }
    .product-tmpl h3 {
        margin: 0;
        padding: 3px 5px 0 0;
        max-width: 96px;
        overflow: hidden;
        line-height: 1.1em;
        font-size: .9em;
        font-weight: normal;
        text-transform: uppercase;
        color: #999;
    }
    .product-tmpl p {
        visibility: hidden;
    }
    .product-tmpl:hover p {
        visibility: visible;
        position: absolute;
        width: 110px;
        height: 110px;
        top: 0;
        margin: 0;
        padding: 0;
        line-height: 110px;
        vertical-align: middle;
        text-align: center;
        color: #fff;
        background-color: rgba(0,0,0,0.75);
        transition: background .2s linear, color .2s linear;
        -moz-transition: background .2s linear, color .2s linear;
        -webkit-transition: background .2s linear, color .2s linear;
        -o-transition: background .2s linear, color .2s linear;
    }
    .k-listview:after {
        content: ".";
        display: block;
        height: 0;
        clear: both;
        visibility: hidden;
    }
</style>
<script id="inventoryMovementSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>	            

	            <div align="center">
					<h3>Inventory Movement Summary</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"
					 data-sortable="true"					 
					 data-row-template="inventory-movement-summary-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_summary.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'number', 'title': 'number' },	                    
	                    { 'field': 'name', 'title': 'Item' },
	                    { 'field': 'item_group_id', 'title': 'Group' },
	                    { 'field': 'category_id', 'title': 'Category' },
	                    { 'field': 'begining', 'title': 'Begining' },
	                    { 'field': 'purchase', 'title': 'Purchase' },	                    
	                    { 'field': 'sale', 'title': 'Sale' },
	                    { 'field': 'adjustment', 'title': 'Adjustment' },	                    
	                    { 'field': 'balance', 'title': 'Balance' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-summary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=number#</td>        
        <td>#=name#</td>
        <td>#=item_group.length>0?item_group[0].name:''#</td>
        <td>#=category.length>0?category[0].name:''#</td>         
        <td align="right">#=kendo.toString(begining, "n0")#</td>         
        <td align="right">#=kendo.toString(purchase, "n0")#</td>
        <td align="right">#=kendo.toString(sale, "n0")#</td>
        <td align="right">#=kendo.toString(adjustment, "n0")#</td>
        <td align="right">#=kendo.toString(((begining + purchase) - sale) + adjustment, "n0")#</td>        
   </tr>
</script>
<script id="inventoryMovementDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>

	            <div align="center">
					<h3>Inventory Movement Detail</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"
					 data-groupable="true"
					 data-sortable="true"					 
					 data-row-template="inventory-movement-detail-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'invoice[0].issued_date', 'title': 'Date' },
	                 	{ 'field': 'invoice[0].type', 'title': 'Type' },
	                 	{ 'field': 'invoice[0].number', 'title': 'Reference' },	                 	                 
	                    { 'field': 'item[0].number', 'title': 'Item' },	                    	                                  
	                    { 'field': 'unit', 'title': 'Quantity' },
	                    { 'field': 'cost', 'title': 'Cost' },
	                    { 'field': 'price', 'title': 'Price' },              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventory-movement-detail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=kendo.toString(invoice.length>0?new Date(invoice[0].issued_date):'', "dd-MM-yyyy")#</td>
        <td>#=invoice.length>0?invoice[0].type:''#</td>        
        <td><a href="\#/#=invoice.length>0?invoice[0].type:''#/#=id#"><i></i> #=invoice.length>0?invoice[0].number:''#</a></td>        
        <td>#=item[0].number# #=item[0].name#</td>             
        <td align="right">#=kendo.toString(unit * movement, "n0")#</td>
        <td align="right">
        	#if(invoice.length>0){#	        	
	        	#if(invoice[0].type==='Purchase'){#
	        		#=kendo.toString(price, "c", banhji.institute.locale)#
	        	#}else if(invoice[0].type==='Invoice' || invoice[0].type==='Receipt'){#
	        		#=kendo.toString(cost, "c", banhji.institute.locale)#
	        	#}#
	        #}#
        </td>
        <td align="right">
        	#if(invoice.length>0){#
	        	#if(invoice[0].type==='Invoice'){#
	        		#=kendo.toString(price, "c", banhji.institute.locale)#
	        	#}#
        	#}#
        </td>                
   </tr>
</script>
<script id="inventoryPurchaseByVendorSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>
	            
	            <div align="center">
					<h3>Purchase By Supplier Summary</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"					 
					 data-sortable="true"					 
					 data-row-template="inventoryPurchaseByVendorSummary-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[	                 	            
	                    { 'field': 'name', 'title': 'Supplier' },	                                                     
	                    { 'field': 'unit', 'title': 'Quantity' },
	                    { 'field': 'amount', 'title': 'Amount' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventoryPurchaseByVendorSummary-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=name#</td>        
        <td align="right">#=kendo.toString(unit, "n0")#</td>
        <td align="right">#=kendo.toString(amount, "c", banhji.institute.locale)#</td>        
   </tr>
</script>
<script id="inventoryPurchaseByVendorDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">

				<div class="box-generic hidden-print">
	            	<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

	            	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
	                <input data-role="datepicker"	                       
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: sdate"
	                   placeholder="from ..." />
	                
	               	<input data-role="datepicker"
	                   data-format="dd-MM-yyyy"
	                   data-parse-formats="yyyy-MM-dd"
	                   data-bind="value: edate"
	                   placeholder="to ..." />	                    	            	
	          		
	          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
	          		|
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
	            </div>
	            
	            <div align="center">
					<h3>Purchase By Supplier Detail</h3>
					
					<span data-bind="text: strDate"></span>														
				</div>

				<br>				

				<div data-role="grid"
					 data-column-menu="true"					 
					 data-sortable="true"					 
					 data-row-template="inventoryPurchaseByVendorDetail-row-template"
		             data-bind="source: dataSource"
					 data-toolbar="['excel']"
					 data-excel="{
		                fileName: 'inventory_movement_detail.xlsx'
		             }"		             		             	                 	                 
	                 data-columns="[
	                 	{ 'field': 'issued_date', 'title': 'Date' },
	                 	{ 'field': 'name', 'title': 'Supplier' },
	                 	{ 'field': 'number', 'title': 'Number' },	                 	             	            
	                   	{ 'field': 'item_id', 'title': 'Item' },
	                   	{ 'field': 'unit', 'title': 'Qty' },
	                   	{ 'field': 'price', 'title': 'Price' },                                                    
	                    { 'field': 'amount', 'title': 'Amount' }              
	                 ]"></div>

			</div>
		</div>
	</div>
</script>
<script id="inventoryPurchaseByVendorDetail-row-template" type="text/x-kendo-tmpl">
    <tr data-uid="#: uid #">        
        <td>#=kendo.toString(issued_date, "dd-MM-yyyy")#</td>
        <td>#=name#</td>
        <td><a href="\#/#=type#/#=id#"><i></i> #=number#</a></td>
        <td>#=item[0].name#</td>        
        <td align="right">#=kendo.toString(unit, "n0", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(price, "c0", banhji.institute.locale)#</td>
        <td align="right">#=kendo.toString(amount, "c0", banhji.institute.locale)#</td>        
   </tr>
</script>

<script id="itemRecurring" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="customer-background">
			<div class="container-960">					
				<div id="example" class="k-content">

					<div class="hidden-print">
				    	<div class="pull-right">

				    		<span class="glyphicons no-js remove_2 pull-right" 
	    				onclick="javascript:window.history.back()"
						data-bind="click: cancel"><i></i></span>						
						</div>

				        <h2>Products/Services Recurring</h2>				        				        				        	
				    </div>			   

				    <br>

				    <div data-role="window"
		                 data-title="Job"		                 
		                 data-width="600"
		                 data-actions="{}"
		                 data-position="{top: '30%', left: '30%'}"
		                 data-height="300"
		                 data-bind="visible: isVisible">

						<table class="table table-bordered table-primary table-striped table-vertical-center">							
							<tr>
								<td>Name</td>
								<td>
									<input class="k-textbox" placeholder="type name ..." data-bind="value: obj.name" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Description</td>
								<td>
									<input class="k-textbox" placeholder="type description ..." data-bind="value: obj.description" style="width: 100%;">
								</td>
							</tr>
							<tr>
								<td>Customer</td>
								<td>
									<input data-role="combobox"
										   data-template="contact-list-tmpl"				            			               			   		                   
						                   data-value-primitive="true"
						                   data-text-field="name"
						                   data-value-field="id"
						                   data-bind="value: obj.contact_id,
						                              source: contactDS"
						                   style="width: 100%;" />
								</td>
							</tr>							
						</table>

						<br>

						<div align="center">
							<span class="btn btn-icon btn-primary glyphicons ok_2" data-bind="click: save" style="width: 80px;"><i></i> Save</span>
							<span class="btn btn-icon btn-danger glyphicons remove_2" data-bind="click: closeWindow" style="width: 80px;"><i></i> Close</span>						
						</div>
					</div>
					
					                           					
	            	<table class="table table-bordered table-primary table-striped table-vertical-center">
	            		<thead style="background-color: blue; color: #fff; font-weight: bold">
	            			<th style="width: 1%;">No.</th>
			                <th>TEMPLATE NAME</th>
			                <th>NAME</th>
			                <th class="center" style="width: 10%">TYPE</th>
			                <th class="center">START DATE</th>
			                <th class="center">FREQUENCY</th>
			                <th></th>
	            		</thead>
	            		<tbody ></tbody>
	            	</table>
	            </div>	            						
			</div>
		</div>
	</div>
</script>

<!-- ***************************
*	Cash Management  -> Pich             *
**************************** -->
<script id="cashDashboard" type="text/x-kendo-template" >
	<div class="row-fluid">
		<!-- Left Side -->
		<div class="span4">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<h2>CASH MODULE</h2>
			        	<p>
			        		In here, you can manage your cash information, transactions and reports. Cashflow forecast and other treasury management is coming soon..
			        	</p>
			        	<!-- <div class="supplier-icon">
					       	<div class="span4">
						       	<a href="#/employee" class="center">
						       		<img title="Add Employee" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/employees.ico" />
						       	</a>
						       </div>
						    <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
						       	</a>
						    </div>
						</div> -->
			        </td>
			 	</tr>
			</table>
			<table class="table table-borderless table-condensed table-vertical-center ">
				<tr>
					<td class="center">
						<a href="#/cash_transaction">
							<img title="Add Cash Transaction" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_transaction.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">C.Transaction</span>
						</a>						
					</td>
					<td class="center">
						<a href="#/cash_receipt">
							<img title="Add Cash Receipt" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_receipt.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">C.Receipt</span>
						</a>
					</td>
					<td class="center">
						<a href="#/cash_payment">
							<img title="Add Cash Payment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_payment.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">C.Payment</span>
						</a>						
					</td>					
				</tr>
				<tr>
					<td class="center">
						<a href="#/cash_advance">
							<img title="Add Cash Advance" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/cash_advance.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">C.Advance</span>
						</a>
					</td>
					<td class="center">						
						<a href="#/expense">
							<img title="Add Expense" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/expense.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">Expense</span>
						</a>						
					</td>
					<td class="center">						
						<a href="#/currency_rate">
							<img title="Add Exchange Rate Record" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/currency_record.png" width="110" height="200" />
							<span style="margin-top: 7px; display: inline-block; text-transform: uppercase;">Ex.Rate Record</span>
						</a>						
					</td>										
				</tr>							
			</table>

		</div>

		<!-- Right Side -->
		<div class="span8">

			<!-- Summary -->
			<div class="row-fluid ">
	
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading">Cash Balance</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert alert-primary">	
							<div align="center" class="text-large strong" style="font-size: 22pt;" data-bind="text: balance"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: cashACNumber"></span>
										<br>
										<span>Accounts</span>
									</td>									
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading">Advance</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info">
							
							<div align="center" class="text-large strong" style="font-size: 22pt;" data-bind="text: totalAdvance"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: open"></span>
										<br>
										<span>Open</span>
									</td>
									<td>
										<span data-bind="text: overDue"></span>
										<br>
										<span>Overdue</span>
									</td>									
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span4">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading">Cash Position</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info3" style="background-color: LightGray">
							
							<div align="center" class="text-large strong" style="font-size: 22pt;" data-bind="text: ar"></div>
							<table width="100%">
								<tr align="center">
									<td>										
										<span data-bind="text: ar_open"></span>
										<br>
										<span>To be Received</span>
									</td>
									<td>
										<span data-bind="text: ar_customer"></span>
										<br>
										<span>To be Paid</span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">				
					<table class="table table-bordered table-primary table-striped table-vertical-center text-table">
				        <thead>
				            <tr>
				                <th colspan="2" style="text-align: center;">Top 5 Cash Balance</th>			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="cashDashBoard-top-customer-template"
			                 data-bind="source: topCashDS"></tbody>			        
				    </table>			
				</div>
				<div class="span4">
					<table class="table table-bordered table-primary table-striped table-vertical-center text-table">
				        <thead>
				            <tr>
				                <th colspan="2" style="text-align: center;">Top 5 Cash Advance</th>		                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                  
			                 data-template="cashDashBoard-top-ar-template"
			                 data-bind="source: topAdvaDS"></tbody>			        
				    </table>
				</div>
				<div class="span4">
					<table class="table table-bordered table-primary table-striped table-vertical-center text-table">
				        <thead>
				            <tr>
				                <th colspan="2" style="text-align: center;">Top 5 Expense Account</span></th>			                		                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="true"                
			                 data-template="cashDashBoard-top-product-template"
			                 data-bind="source: topExpsDS"></tbody>			        
				    </table>
				</div>		
			</div>

			<!-- Graph -->
			<div class="home-chart">
				<!-- Graph -->
				<div data-role="chart"
					 data-auto-bind="false"
	                 data-legend="{ position: 'top' }"
	                 data-series-defaults="{ type: 'column' }"
	                 data-tooltip='{
	                    visible: true,
	                    format: "{0}%",
	                    template: "#= series.name #: #= kendo.toString(value, &#39;c&#39;, banhji.locale) #"
	                 }'                 
	                 data-series="[
	                                 { field: 'cash_in', name: 'Cash In', categoryField:'month', color: '#236DA4' },
	                                 { field: 'cash_out', name: 'Cash Out', categoryField:'month', color: '#A6C9E3' }
	                             ]"	                             
	                 data-bind="source: graphDS"
	                 style="height: 250px;" ></div>
	            <!-- End Graph -->      
			</div>
		
		</div>
	</div>
</script>
<script id="cashDashBoard-top-customer-template" type="text/x-kendo-tmpl">	
	<tr data-uid="#: uid #">
		<td>#:banhji.cashDashboard.topCashDS.indexOf(data)+1#</td>		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>		
	</tr>
</script>
<script id="cashDashBoard-top-ar-template" type="text/x-kendo-tmpl">
	<tr>
		<td>#:banhji.cashDashboard.topAdvaDS.indexOf(data)+1#</td>		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>
	</tr>
</script>
<script id="cashDashBoard-top-product-template" type="text/x-kendo-tmpl">
	<tr data-uid="#: uid #">
		<td>#:banhji.cashDashboard.topExpsDS.indexOf(data)+1#</td>		
		<td>
			<span>
				#if(name.length>15){#
					#=name.substring(0, 15)#...
				#}else{#
					#=name#
				#}#
			</span>
			<span class="pull-right">#=kendo.toString(amount, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale)#</span>
		</td>		
	</tr>
</script>

<script id="cashCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="account ..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>
							<div class="select2-container" style="width: 100%; ">								
																
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid" 
						 data-bind="source: dataStore"
						 data-auto-bind="true" 
						 data-row-template="cashCenter-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							        	<li style="font-size: large; color: black; font-weight: bold;">
							            	<span data-bind="text: obj.number"></span>
							            	-
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons text_bigger active"><span data-toggle="tab" data-target="#tab1-7"><i></i></span>
							            </li>							            							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Transactions Tab content -->
							            <div id="tab1-7" class="tab-pane active box-generic">
							            	<table class="table table-borderless table-condensed cart_total cash-table">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashTransaction">Cash Transaction</span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashReceipt">Cash Receipt</span>								            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashPayment">Cash Payment</span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goCashAdvance">Cash Advance</span>								            											            			
								            		</td>
								            	</tr>
								            	<tr>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goExpense">Expense</span>
								            		</td>
								            		<td>
								            			<span class="btn btn-block btn-primary" data-bind="click: goExchange">Exchange Rate Record</span>								            											            			
								            		</td>
								            	</tr>
								            	
							            	</table>
							            	<button data-bind="click: goEdit">Edit</button>
							            </div>
							            <!-- // Transactions Tab content END -->
							        </div>
							    </div>
							</div>
						</div>

						<div class="span6">
							<div class="row-fluid" >
								<div class="span12" style="margin-bottom: 10px;">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadTransaction" style=" width: 425px; height:114px; background:#424242; margin-left:0;">
										<span class="glyphicons coins"><i></i></span>										
										<span class="txt">
											Balance as of today
											<span data-bind="text: balance"></span>
										</span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5">
										<span class="glyphicons adjust_alt"><i></i></span>
										<span class="txt">
											<span data-bind="text: nature"></span>
											Nature Balance
										</span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadTransaction">
										<span class="glyphicons random"><i></i></span>										
										<span class="txt">
											<span data-bind="text: totalTxn"></span>
											Transactions											
										</span>										
										<div class="clearfix"></div>
									</div>
								</div>
							</div>																					
						</div>											          	
		          	</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >
					    
					    <button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th>Date</th>
								<th>Type</th>								
								<th>Reference No</th>
								<th>Dr.</th>
								<th>Cr.</th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="cashCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="cashCenter-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				#if(sub_of_id>0){#
					&nbsp;&nbsp;
					<span>
						#=number#				
					</span>
					-
					<span>
						#if(name.length>25){#
							#=name.substring(0, 25)#...
						#}else{#
							#=name#
						#}#
					</span>
				#}else{#
					<span class="strong">
						#=number#				
					</span>
					-
					<span class="strong">
						#if(name.length>25){#
							#=name.substring(0, 25)#...
						#}else{#
							#=name#
						#}#
					</span>
				#}#				
			</div>
		</td>
	</tr>
</script>
<script id="cashCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <td>
        	#if(type=="Invoice" || type=="Cash_Sale" || type=="Quote" || type=="Sale_Order" || type=="GDN" || type=="Sale_Return"){#
				<a href="\#/#=type.toLowerCase()#/#=id#"><i></i> #=number#</a>						
			#}else{#
				#=number#
			#}#        	
        </td>
    	<td class="right">
    		#=dr/rate#
    	</td>
    	<td>        	
        	#=cr/rate#		
		</td>   	
    </tr>
</script>
<script id="cashCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body">
				<span class="strong">
					#=number# #=name#				
				</span>
			</div>
		</td>
	</tr>
</script>
<script id="cashCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="cash" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons circle_info"><i></i> Customer</h4>							        	
					    </div>
					    <div class="widget-body">

					    	<div class="row-fluid">
					    		<div class="span6 well">									
									<div class="row-fluid">
										<div class="span6">														
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlCustomerType"><span data-bind="text: lang.lang.customer_type"></span> <span style="color:red">*</span></label>
												<input id="ddlCustomerType" name="ddlCustomerType"
														   data-role="dropdownlist"														   										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.contact_type_id,
										                              source: contactTypeDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />																				            
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">							
												<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
						              			<input id="number" name="number" class="k-textbox"
							              				data-bind="value: obj.number, events:{change: checkExistingNumber}" 
							              				placeholder="e.g. ID0001" required data-required-msg="required"
							              				style="width: 100%;" />
							              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
											</div>
											<!-- // Group END -->											
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">						
											<!-- Group -->
											<div class="control-group">
												<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
							              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname" 
									              		placeholder="surname ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">								
												<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
									            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name" 
									              		placeholder="name ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>																		
											<!-- // Group END -->
										</div>
									</div>
									
									<div class="row-fluid" data-bind="visible: isCompany">
										<div class="span6">
											<!-- Group -->
											<div class="control-group">
												<label for="companyName"><span data-bind="text: lang.lang.organization_name"></span> <span style="color:red">*</span></label>
												<input id="companyName" name="companyName" class="k-textbox" data-bind="enabled: isCompany, value: obj.company"									
														placeholder="e.g. PCG & Partner"
														style="width: 100%;" />	
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
												<label for="vatNo"><span data-bind="text: lang.lang.vat_no"></span></label>								
							            		<input id="vatNo" name="vatNo" class="k-textbox" data-bind="enabled: isCompany, value: obj.vat_no" 
														placeholder="e.g. 01234567897"
														style="width: 100%;" />												
											</div>					
											<!-- // Group END -->
										</div>
									</div>																
								</div>
								<div class="span6">
									<div class="row-fluid">	
										<!-- Map -->
										<div id="map" class="span12" style="height: 130px;"></div>
									</div>

									<div class="separator line bottom"></div>

									<div class="row-fluid">	
										<div class="span6">									
											<!-- Group -->
											<div class="control-group">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>									
											<!-- // Group END -->
										</div>	
										
										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>										
											</div>
											<!-- // Group END -->
										</div>										
									</div>
								</div>
							</div>								
									
							<!-- // Inner Tabs -->
							<div class="row-fluid">								
								<div class="box-generic">
								    <!-- //Tabs Heading -->
								    <div class="tabsbar tabsbar-1">
								        <ul class="row-fluid row-merge">						            
								            <li class="span2 glyphicons usd active">
								            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.account"></span></span></a>
								            </li>								            
								            <li class="span2 glyphicons nameplate_alt">
								            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
								            </li>
								            <li class="span2 glyphicons parents">
								            	<a href="#tab3" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.agents"></span></span></a>
								            </li>						            					            
								        </ul>
								    </div>
								    <!-- // Tabs Heading END -->

								    <div class="tab-content">
								        <!-- //ACCOUNTING INFO -->
								        <div class="tab-pane active" id="tab1">
								        	
								        	<div class="row-fluid">								        		
								            	<div class="span3">
													<label for="ddlAR"><span data-bind="text: lang.lang.account_receiveable"></span> <span style="color:red">*</span></label>
													<input id="ddlAR" name="ddlAR"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.account_id,
										                              source: arDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />													
												</div>
												<div class="span3">
													<label for="ddlRA"><span data-bind="text: lang.lang.revenue_account"></span> <span style="color:red">*</span></label>
													<input id="ddlRA" name="ddlRA"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.ra_id,
										                              source: raDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />													
												</div>
												<div class="span3">
													<label for="ddlDepositAccount">Deposit Acccount <span style="color:red">*</span></label>
													<input id="ddlDepositAccount" name="ddlDepositAccount"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.deposit_account_id,
										                              source: depositDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />													
												</div>
												<div class="span3">
													<label for="ddlTradeDiscount">Trade Discount <span style="color:red">*</span></label>
													<input id="ddlTradeDiscount" name="ddlTradeDiscount"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.trade_discount_id,
										                              source: tradeDiscountDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />														
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">
								        		<div class="span3">						
										            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
										            <input id="currency" name="currency" 
										            	data-role="dropdownlist"
										            	data-template="currency-list-tmpl"
										            	data-value-primitive="true"
										                data-text-field="code"
										                data-value-field="id"
														data-bind="value: obj.currency_id, source: currencyDS"
														data-option-label="(--- Select ---)" 
														required data-required-msg="required" style="width: 100%;" />
										        </div>
								            	<div class="span3">
													<label for="ddlPaymentTerm"><span data-bind="text: lang.lang.payment_term"></span></label>
													<input id="ddlPaymentTerm" name="ddlPaymentTerm"
														data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_term_id, source: paymentTermDS" 
														data-option-label="(--- Select ---)"
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlPaymentMethod"><span data-bind="text: lang.lang.payment_method"></span></label>
													<input id="ddlPaymentMethod" name="ddlPaymentMethod"
														data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_method_id, source: paymentMethodDS"
														data-option-label="(--- Select ---)" 
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlSettlementDiscount">Settlement Discount <span style="color:red">*</span></label>
													<input id="ddlSettlementDiscount" name="ddlSettlementDiscount"
														   data-role="dropdownlist"
														   data-template="account-list-tmpl"										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.settlement_discount_id,
										                              source: settlementDiscountDS"
										                   data-option-label="(--- Select ---)"
										                   required data-required-msg="required" style="width: 100%;" />														
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">
									        	<div class="span3">
													<label for="ddlTaxItem">Tax </label>
													<input id="ddlTaxItem" name="ddlTaxItem"
														   data-role="dropdownlist"														   										                   
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.tax_item_id,
										                              source: taxItemDS"
										                   data-option-label="(--- Select ---)"
										                   style="width: 100%;" />
												</div>	
										        <div class="span3">
													<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
										            <input data-role="numerictextbox"
										                   data-format="n"
										                   data-min="0"										                   
										                   data-bind="value: obj.credit_limit"										                  
										                   style="width: 100%;">
												</div>																							
											</div>
							        	</div>
								        <!-- //ACCOUNTING INFO END -->								        							       

								        <!-- //GENERAL INFO -->
								        <div class="tab-pane" id="tab2">
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>
									                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="customerStatus" name="customerStatus" 
									              				data-role="dropdownlist"
											            		data-text-field="name"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: statusList, value: obj.status"
											            		data-option-label="(--- Select ---)"
											            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
									              	</td>							              	
									            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="registered_date" name="registered_date" 
										            		data-role="datepicker"			            		
							            					data-bind="value: obj.registered_date" 
							            					data-format="dd-MM-yyyy"
							            					data-parse-formats="yyyy-MM-dd" 
							            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
									              	</td>
									            </tr>
									            <tr>
									                <td><span data-bind="text: lang.lang.gender"></span></td>
									              	<td><select data-role="dropdownlist" data-bind="source: genders, value: obj.gender"></select></td>							              	
									            	<td><span data-bind="text: lang.lang.phone"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.address"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
									            	<td><span data-bind="text: lang.lang.email"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" />
									            </tr>									            
									            <tr>
									            	<td>
									            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />
									            	</td>
									            	<td>
									            		<span data-bind="text: lang.lang.ship_to"></span>										            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." />
									            	</td>
									            </tr>
									            <tr>									            								              	
									            	<td><span data-bind="text: lang.lang.memo"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
									              	<td></td>
									              	<td></td>
									            </tr>							            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //CONTACT PERSON -->
								        <div class="tab-pane" id="tab3">
								        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.department"></span></th>						                
										                <th><span data-bind="text: lang.lang.phone"></span></th>
										                <th><span data-bind="text: lang.lang.email"></span></th>
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="contact-person-row-tmpl" 
										        		data-bind="source: contactPersonDS">
										        </tbody>										        						        
										    </table>
							        	</div>
								        <!-- //CONTACT PERSON END -->
								    </div>
								</div>
							</div>

							<br>											
							
							<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
							<!-- // Form actions END -->

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="cashSetting" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2>General Setting</h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong">Customer Type</span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons credit_card" data-toggle="tab"><i></i><span class="strong">Payment Method</span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons clock" data-toggle="tab"><i></i><span class="strong">Payment Term</span></a>
	            </li>	                        
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Branch content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="type name ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Type</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="customerSetting-edit-contact-type-template"
				                data-template="customerSetting-contact-type-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Branch content END -->

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span12" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentMethodName">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentMethod"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-method-template"
				                data-template="customerSetting-payment-method-template"
				                data-bind="source: paymentMethodDS"></tbody>
	            	</table>			            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Block content -->
	            <div class="tab-pane" id="tab3-1">
            		<div class="input-append">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="name ..." data-bind="value: paymentTermName">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="term ..." data-bind="value: paymentTerm">
					    <input class="span4" id="appendedInputButtons" type="text" placeholder="% ..." data-bind="value: paymentTermPercentage">
					    <button class="btn btn-default" type="button" data-bind="click: addPaymentTerm"><i class="icon-plus"></i></button>
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th>Name</th>
	            				<th>Term</th>
	            				<th>%</th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            				
		            			data-edit-template="customerSetting-edit-payment-term-template"
				                data-template="customerSetting-payment-term-template"
				                data-bind="source: paymentTermDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Block content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="cashSetting-contact-type-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="cashSetting-edit-contact-type-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="cashSetting-payment-method-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="cashSetting-edit-payment-method-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="cashSetting-payment-term-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
    		 #:term#
   		</td>
   		<td>
    		 #:discount_percentage#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
		</td>
   	</tr>
</script>
<script id="cashSetting-edit-payment-term-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:net_due" name="term" required="required" validationMessage="required" />
                <span data-for="term" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:discount_percentage" name="percentage" required="required" validationMessage="required" />
                <span data-for="percentage" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>

<script id="cashList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input data-role="dropdownlist"
							   data-option-label="(--- TYPE ---)"
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: contact_type_id,
			                              source: contactTypeDS" />

							<button id="search" type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>		
						</div>

						<h3 align="center"><span data-bind="text: lang.lang.customer_list"></span></h3>
				
						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>

<script id="cashReportCenter" type="text/x-kendo-template">
	<div class="row-fluid customer-report-center">
		<div class="span7">
			<div class="row-fluid sale-report">
				<h2>CASH POSITION</h2>
				<p>
					The following reports provide summary and detailed reports on employee related transactions.  
				</p>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/">Cash Position Report</a></h3>
							</td>
							<td >
								<h3><a href="#/">Cash Payment Report</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									Summarizes each inventory balance by quantity on hand, on purchase order and sale order. In addition, it also includes average cost and price.  


								</p>
								
							</td>
							<td >
								<p>
									Lists of all transactions related to and grouped by each inventory with analysis of average gross profit margin.


								</p>
							</td>
							
						</tr>
						<tr>
							<td >
								<h3><a href="#/">Cash Receipt Report</a></h3>
							</td>
							<td >
								<h3><a href="#/">Reconciliation Report</a></h3>
							</td>
						</tr>
						<tr>
							<td >
								<p>
									Lists individual inventory movement transactions by date for each inventory within a period of time.


								</p>
							</td>
							<td >
								<p>
									List of all cash related reconciliation reports.
								</p>
							</td>
						</tr>
					</table>					
				</div>
			</div>
			<div class="row-fluid recevable-report">
				<h2>OTHER REPORTS</h2>
				<div class="row-fluid">
					<table class="table table-borderless table-condensed">
						<tr>
							<td>
								<h3><a href="#/">Realized Exchange Gains & Losses</a></h3>
							</td>
							<td width="50%">
								<h3><a href="#/">Unrealized Exchange Gains & Losses</a></h3>								
							</td>						
						</tr>
						<tr>
							<td >
								<p>
									This detailed report lists foreign transactions that are closed (referred to as realized gains and losses) and totals the gains and losses due to changes in exchange rates.


								</p>
								
							</td>
							<td >
								<p>
									This summary report lists your foreign accounts and calculates the potential gain or loss for each account.


								</p>
							</td>							
						</tr>
					</table>
				</div>
			</div>
		</div>
		<div class="span5">
			<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>
			<br>
			<br>
			<div class="report-chart">
				<div class="widget-body alert alert-primary sale-overview">
					<h2>Cash Balance</h2>
					<div align="center" class="text-large strong">$183,690,640</div>
					<table width="100%">
						<tr align="center">
							<td>										
								<span>0.5</span>
								<br>
								<span>Cash Ratio</span>
							</td>
							<td>
								<span>1.5</span>
								<br>
								<span>Quick Ratio</span>
							</td>
							<td>
								<span>2.1</span>
								<br>
								<span>Current Ratio</span>
							</td>
							<td>
								<span>20 days</span>
								<br>
								<span>Cash Conversion Cycle</span>
							</td>
						</tr>
					</table>
				</div>
				<div id="sale-report-chart">Chart</div>
			</div>
		</div>
	</div>
</script>


<!-- ***************************
*	Report Section       *
**************************** -->
<script id="reportDashboard" type="text/x-kendo-template" >
	<div class="row-fluid">
		<div class="span12">
			<div class="span4 report-module">
				<h2 style="font-family: 'Open Sans', sans-serif;margin: 0 0 5px;font-weight: 400; color: #4d4d4d; font-size: 26px;">REPORTS</h2>
				<p style="margin: 0 0 10px; line-height: normal;">					
					This module consolidates different modules report into one place. In addition, ratio analysis is also included in this module
					
				</p>
			</div>
			<div class="span8">				
			</div>
		</div>

		<div class="span12">
			<div class="span4">
				<div class="widget widget-3 customer-border">
					<div class="widget-head header-custome">
						<h4 class="heading">
							How efficient is your working capital management?
						</h4>
					</div>					
					<div class="widget-body alert alert-primary" style="min-height: 178px;">
						<div align="center" class="text-large strong" style="font-size: 50px;">
							<span data-bind="text: ccc"></span>
							<br>
							<p style="font-size: 14px">Cash Conversion Cycle</p>
						</div>
						<table width="100%">
							<tbody>
								<tr align="center">
									<td width="33%">										
										<span style="font-size: 25px;" data-bind="text: arCollectionPeriod"></span>
										<br>
										<span style="font-size: 12px;">Receivable Collection Days</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: apPaymentPeriod"></span>
										<br>
										<span style="font-size: 12px;">Payable Payment Days</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: inventoryTurnOver"></span>
										<br>
										<span style="font-size: 12px;">Inventory Turnover Days </span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>									
				</div>				
			</div>
			<div class="span4">				
				<div class="widget widget-3 customer-border">
					<div class="widget-head header-custome">
						<h4 class="heading">
							WHAT IS YOUR ABILITY TO MEET YOUR PRESENT OBLIGATIONS?
						</h4>
					</div>					
					<div class="widget-body alert-info" style="min-height: 178px;">
						<div align="center" class="text-large strong" style="font-size: 50px;">
							<span data-bind="text: currentRatio"></span>
							<br>
							<p style="font-size: 14px">Current Ratio</p>
						</div>
						<table width="100%">
							<tbody>
								<tr align="center">
									<td width="33%">										
										<span style="font-size: 25px;" data-bind="text: quickRatio"></span>
										<br>
										<span style="font-size: 12px;">Quick Ratio</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: cashRatio"></span>
										<br>
										<span style="font-size: 12px;">Cash Ratio</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: wcSale"></span>
										<br>
										<span style="font-size: 12px;">Working Capital To Sale Ratio</span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>										
				</div>				
			</div>
			<div class="span4">	
				<div class="widget widget-3 customer-border">
					<div class="widget-head header-custome">
						<h4 class="heading">
							How profitable is your business?
						</h4>
					</div>					
					<div class="widget-body alert-info3" style="min-height: 178px;background-color: LightGray">
						<div align="center" class="text-large strong" style="font-size: 50px;">
							<span data-bind="text: roce"></span>
							<br>
							<p style="font-size: 14px">Return on Capital Employed</p>
						</div>						
						<table width="100%">
							<tbody>
								<tr align="center">
									<td width="33%">										
										<span style="font-size: 25px;" data-bind="text: grossProfitMargin"></span>
										<br>
										<span style="font-size: 12px;">Gross Margin</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: profitMargin"></span>
										<br>
										<span style="font-size: 12px;">Earning Before interest & Tax</span>
									</td>
									<td width="33%">
										<span style="font-size: 25px;" data-bind="text: returnOnAsset"></span>
										<br>
										<span style="font-size: 12px;">Return on Asset </span>
									</td>
								</tr>
							</tbody>
						</table>
					</div>									
				</div>				
			</div>
		</div>

		<div class="span12" style="margin-top: 20px;">		
			<div class="relativeWrap" data-toggle="source-code">
				<div class="widget widget-tabs widget-tabs-gray report-tab" style="padding-bottom: 20px; background: #fff; overflow: hidden;">
					<div class="widget-head head-custom" style="height: 50px;">
						<ul>
							<li class="active"><a href="#tab-1" data-toggle="tab"><i></i><span data-bind="text: lang.lang.customer"></span></a></li>
							<li><a href="#tab-2" data-toggle="tab"><i></i><span data-bind="text: lang.lang.supplier"></span></a></li>
							<li><a href="#tab-3" data-toggle="tab"><i></i><span data-bind="text: lang.lang.products_services"></span></a></li>
							<li><a href="#tab-4" data-toggle="tab"><i></i><span data-bind="text: lang.lang.cash"></span></a></li>
							<li><a href="#tab-5" data-toggle="tab"><i></i><span data-bind="text: lang.lang.period_end"></span></a></li>
							<li><a href="#tab-6" data-toggle="tab"><i></i><span data-bind="text: lang.lang.financial_statements"></span></a></li>
							<li><a href="#tab-7" data-toggle="tab"><i></i><span data-bind="text: lang.lang.statement_reporting"></span></a></li>
							<li><a href="#tab-8" data-toggle="tab"><i></i><span data-bind="text: lang.lang.job_tracking"></span></a></li>
						</ul>
					</div>

					<div class="widget-body">
						<div class="tab-content">
					        <div class="tab-pane active" id="tab-1">									        	
								<div class="row-fluid">
									<div class="row-fluid sale-report">				
										<h2>SALE MANAGEMENT REPORTS</h2>
										<p>
											The following reports provide summary and detailed reports in 
											different ways to help analyze your revenue performance.
										</p>
										<div class="row-fluid">
											<table class="span12" style="margin-top: 10px;">
												<tr>
													<td class="span4" ><h3><a href="#/deposit_detail_customer">Deposit Detail by Customer</a></h3></td>
													<td class="span4" ><h3><a href="#/customer_transaction_list">Customer Transaction List</a></h3></td>
													<td class="span4" ><h3><a href="#/sale_detail_customer">Sale Detail by Customer</a></h3></td>
												</tr>												
												<tr>
													<td class="span4" >Provides detailed information about customer deposit for specific order, prepayment, or credit.</td>													
													<td class="span4" >List of all transactions related to and grouped by each customer, including invoice, cash sale</td>
													<td class="span4" >Lists individual sale transactions by date for each customer with a period of time.</td>
												</tr>

												<tr>													
													<td class="span4" ><h3><a href="#/sale_summary_customer">Sale Summary by Customer</a></h3></td>
													<td class="span4" ><h3><a href="#/sale_summary_product">Sale Summary by Product/ Services</a></h3></td>
													<td class="span4" ><h3><a href="#/sale_detail_product">Sale Detail by Product/ Services</a></h3></td>
												</tr>												
												<tr>
													<td class="span4" >Summarizes total sales for each customer within a period of time so you can see which ones generate the most revenue for you.</td>
													<td class="span4" >Summarizes total sales for each product/ service within a period of time. In addition, it also includes gross profit margin, quantity, amount, cost, and average prices.</td>
													<td class="span4" >Lists individual sale transactions by date for each product/ service with a period of time.</td>
												</tr>

												<tr>
													<td class="span4" ><h3><a href="#/sale_job_engagement">Sale by Job/Engagement</a></h3></td>
													<td class="span4" ><h3><a href="#/sale_order_list">Sale Order List</a></h3></td>
												</tr>												
											</table>
										</div>
									</div>

									<div class="row-fluid recevable-report" style="margin-top: 15px; display: inline-block;">
										<h2>RECEIVABLE MANAGEMENT REPORTS</h2>
										<p>
											The following reports provide summary and detailed reports.
										</p>
										<div class="row-fluid">
											<table class="span12" >
												<tr>
													<td class="span4" >
														<h3><a href="#/receivable_aging_detail">Receivable Aging Detail</a></h3>
													</td>
													<td class="span4" >
														<h3><a href="#/collect_report">Collection Report</a></h3>
													</td>													
													<td class="span4" >
														<h3><a href="#/receivable_aging_summary">Receivable Aging Summary</a></h3>
													</td>						
												</tr>
												<tr>
													<td class="span4" >
														Lists individual unpaid invoices, grouped by customer. This includes due date, outstanding days (aging days), and amount.
													</td>
													<td class="span4" >
														Lists of collected invoices for the select period of time, group by method of payment.														
													</td>
													
													<td class="span4" >
														Lists all unpaid invoices for the current period, 30, 60, 90, 
														and more than 90 days, grouped by individual customers.
													</td>
													
												</tr>
												<tr>
													<td class="span4" >
														<h3><a href="#/invoice_list">Invoice List</a></h3>
													</td>
													
													<td class="span4" >
														<h3><a href="#/customer_balance_detail">Customer Balance Detail</a></h3>								
													</td>													
													<td class="span4" >
														<h3><a href="#/list_invoices_collect">List of invoices to be collected</a></h3>
													</td>
													
												</tr>
												<tr>
													<td class="span4" >
														Shows a chronological list of all your invoices for a selected date range.													
													</td>													
													<td class="span4" >
														Lists all unpaid invoices, grouped by Due today and Overdue.
													</td>
													<td class="span4" >
														Lists individual unpaid invoices for each customer
													</td>
												</tr>

												<tr>
													<td class="span4" >
														<h3><a href="#/customer_balance_summary">Customer Balance Summary</a></h3>
													</td>
													<td class="span4" >
														<h3><a href="#/customer_list">Customer List</a></h3>
													</td>
												</tr>
												<tr>													
													<td class="span4" >
														Show each customer’s total outstanding balances.
													</td>
													<td class="span4" >													
														List of all active customers													
													</td>
												</tr>

											</table>
										</div>
									</div>
									
									<div class=" span12  recevable-report" style="margin-top: 15px; display: inline-block; padding-left: 0;">
										<h2>OTHER REPORTS/ LISTS</h2>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4" >
														<h3><a href="#/customer_recurring">Recurring Customer Template List</a></h3>
													</td>
													<td class="span4" >
														<h3><a href="#/customer_setting">Payment Method & Term List</a></h3>								
													</td>
													<td class="span4"></td>						
												</tr>
												<tr>
													<td class="span4">																				
													</td>
													<td class="span4" >
															List the types of payments and the term that determine due date for payment from customers.
														
													</td>
													<td class="span4"></td>															
												</tr>
											</table>
										</div>
									</div>
								</div>
				        	</div>

				        	<div class="tab-pane" id="tab-2">								        	
					        	<div class="row-fluid">
					        		<div class="row-fluid sale-report">
										<h2>EXPENSE/PURCHASE MANAGEMENT REPORTS</h2>
										<p>
											The following reports provide summary and detailed reports in different ways to help analyze what 
											you spent and their impact on your cash flow and performance. 
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/expenses_purchase_summary_supplier">Expenses/ Purchase Summary by Supplier</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/suppliers_transaction_list">Suppliers Transaction List</a></h3>								
													</td>
													<td class="span4">
														<h3><a href="#/expenses_purchase_detail_supplier">Expenses/Purchase Detail by Supplier</a></h3>
													</td>						
												</tr>
												<tr>
													<td class="span4">
														Summarizes total expenses/ purchase for each suppliers within a period of time.
																												
													</td>
													<td class="span4">
														Lists of all transactions related to and grouped by each suppliers														
													</td>
													<td class="span4">
														Lists individual expenses/ purchase transactions by date for each supplier within a period of time.
														
													</td>													
												</tr>

												<tr>
													<td class="span4">
														<h3><a href="#/deposit_detail_supplier">Deposit Detail by Supplier</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/purchase_summary_product_services">Purchase Summary by Product/ Services</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/open_purchase_order">Open Purchase Order</a></h3>
													</td>
												</tr>
												<tr>
													<td class="span4">
															Summarizes total expenses/ purchase for each product/ service within a period of time. 
														
													</td>
													<td class="span4">
														Lists all the open purchase order grouped by suppliers including the original amount as well.
														
													</td>
													<td class="span4">
														Provides detailed information about supplier deposit for specific order, prepayment, or credit.
														
													</td>
												</tr>
												<tr>
													<td class="span4">
														<h3><a href="#/purchase_detail_product_services">Purchase Detail by Product/ Services</a></h3>
													</td>
													<td class="span4"></td>
													<td class="span4"></td>
												</tr>
												<tr>
													<td class="span4">
														Lists individual sale transactions by date for each product/ service with a period of time.
														
													</td>
													<td class="span4"></td>
													<td class="span4"></td>
												</tr>

											</table>
										</div>
									</div>

									<div class="row-fluid recevable-report" style="margin-top: 15px; display: inline-block;">
										<h2>PAYABLES MANAGEMENT REPORTS</h2>
										<p>
											The following reports provide summary and detailed reports.
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/suppliers_balance_summary">Suppliers Balance Summary</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/suppliers_balance_detail">Suppliers Balance Detail</a></h3>								
													</td>
													<td class="span4">
														<h3><a href="#/payables_aging_summary">Payables Aging Summary</a></h3>
													</td>						
												</tr>
												<tr>
													<td class="span4">
														Show each supplier’s total outstanding balances.														
													</td>
													<td class="span4">
														Lists individual unpaid bill for each supplier														
													</td>
													<td class="span4">
														Lists all unpaid bills for the current period, 30, 60, 90, and more than 90 days, grouped by individual suppliers. 
														
													</td>													
												</tr>
												
												<tr>
													<td class="span4">
														<h3><a href="#/payables_aging_detail">Payables Aging Detail</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/list_bills_paid">List of bills to be paid</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/bill_payment_list">Bill Payment List</a></h3>
													</td>
												</tr>
												<tr>
													<td class="span4">
														Lists all unpaid invoices, grouped by Due today and Overdue.
													</td>
													<td class="span4">
														Lists of paid bills for the select period of time, group by method of payments.
													
													</td>
													<td class="span4">
														Lists individual unpaid bills, grouped by suppliers. This includes due date, outstanding days (aging days), and amount.
														
													</td>
												</tr>						

											</table>
										</div>
									</div>

									<div class="row-fluid recevable-report">
										<h2>OTHER REPORTS/ LISTS</h2>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<!-- <td class="span4">
														<h3><a href="#/product_service_list">Product/ Service List</a></h3>
													</td> -->
													<td class="span4">
														<h3><a href="#/supplier_list">Supplier List</a></h3>								
													</td>
													<td class="span4">
														<h3><a href="#/customer_recurring">Recurring Supplier Template List</a></h3>								
													</td>
													<td class="span4">
													</td>						
												</tr>
												<tr>
													<!-- <td class="span4">
														Lists the products and services you purchase. The following information is included: name, 
															description, cost, sales price, and quantity on hand.
													</td> -->
													<td class="span4">
														Lists of all active suppliers
													</td>
													<td class="span4">
													</td>
													<td class="span4">
													</td>						
												</tr>												
											</table>
										</div>
									</div>
					        	</div>
				        	</div>

				        	<div class="tab-pane" id="tab-3">								        	
					        	<div class="row-fluid">
					        		<div class="row-fluid sale-report">
										<h2>INVENTORY POSITION</h2>
										<p>
											The following reports provide summary and detailed reports on the position of inventory. 
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/inventory_position_summary">Inventory Position Summary</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/inventory_sale_item_analysis">Inventory Sale by Item Analysis</a></h3>								
													</td>
													<td class="span4">
														<h3><a href="#/inventory_position_detail">Inventory Position Detail</a></h3>
													</td>						
												</tr>
												<tr>
													<td class="span4">
														Summarizes each inventory balance by quantity on hand, on purchase order and sale order. In addition, it also includes average cost and price. 
													</td>
													<td class="span4">
														Lists of all transactions related to and grouped by each inventory with analysis of average gross profit margin.
													</td>
													<td class="span4">
														Lists individual inventory movement transactions by date for each inventory within a period of time.
													</td>
												</tr>
												<!-- <tr>													
													<td class="span4">
														<h3><a href="#/inventory_turnover_list">Inventory Turnover List</a></h3>
													</td>
												</tr>
												<tr>													
													<td class="span4">
														Provides analysis of inventory turnover days by each inventory.
													</td>
												</tr> -->
											</table>
										</div>
									</div>

									<div class="row-fluid recevable-report" style="margin-top: 15px; display: inline-block;">
										<h2>INVENTORY MOVEMENT REPORTS</h2>
										<p>
											The following reports provide summary and detailed reports on the movement of the inventories
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/inventory_movement_summary">Inventory Movement Summary</a></h3>
													</td>
													<!-- <td class="span4">
														<h3><a href="#/inventory_movement_detail">Inventory Movement Detail</a></h3>								
													</td> -->
													<td class="span4">
														<h3><a href="#/purchase_summary_product_services">Purchase by Supplier Summary</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/purchase_detail_product_services">Purchase by Supplier Detail</a></h3>
													</td>					
												</tr>
												<tr>
													<td class="span4">
														Shows the movement of each inventory by opening balance, sale, purchase and adjustment. 
													</td>
													<!-- <td class="span4">
														Lists of all detailed transactions related to and grouped by each inventory
													</td> -->
													<td class="span4">
														Lists all inventory purchases from each suppliers
													</td>
													<td class="span4">
														Lists all inventory sold to each customer
													</td>
												</tr>
												
												<tr>
													<!-- <td class="span4">
														<h3><a href="#/purchase_detail_product_services">Purchase by Supplier Detail</a></h3>
													</td> -->
													<td class="span4">
														<h3><a href="#/sale_summary_customer">Sale by Customer Summary</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/sale_detail_customer">Sale by Customer Detail</a></h3>
													</td>
												</tr>
												<tr>
													<!-- <td class="span4">
														Lists all inventory sold to each customer
													</td> -->
													<td class="span4">
														Lists of detailed inventory sale transactions to each customer
													</td>
													<td class="span4">
														Lists of detailed inventory purchase transactions from each suppliers
													</td>
												</tr>
												
											</table>
										</div>
									</div>
									<!-- <div class="span12 recevable-report" style="margin-top: 15px; display: inline-block; padding-left: 0;">
										<h2>OTHER REPORTS/ LISTS</h2>
										<p>
											The following reports provide summary and detailed reports on the movement of the inventories
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/inventory_list">Inventory List</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/">Recurring Inventory Template List</a></h3>
													</td>
													<td class="span4">								
													</td>						
												</tr>
												<tr>
													<td class="span4">
														Lists the products you purchase and sold. The following information is included: name, description, cost, sales price, and quantity on hand.		
													</td>
													<td class="span4">								
													</td>
													<td class="span4">								
													</td>
												</tr>
												
											</table>
										</div>
									</div> -->
					        	</div>
				        	</div>

				        	<div class="tab-pane" id="tab-4">	
				        		<div align="center" style="min-height: 150px;">
				        			<h1 style="font-style: 30px; margin-top: 20px;">Coming Soon</h1>
				        		</div>							        	
					        	<!-- <div class="row-fluid">
									<div class="row-fluid sale-report" style="margin-top: 15px;">
										<h2>CASH POSITION</h2>
										<p>
											The following reports provide summary and detailed reports on employee related transactions.  
										</p>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/">Cash Position Report</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/">Cash Payment Report</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/">Cash Receipt Report</a></h3>
													</td>
												</tr>
												<tr>
													<td class="span4">
														Summarizes each inventory balance by quantity on hand, on purchase order and sale order. In addition, it also includes average cost and price. 
													</td>
													<td class="span4">
														Lists of all transactions related to and grouped by each inventory with analysis of average gross profit margin.
													</td>
													<td class="span4">
														Lists individual inventory movement transactions by date for each inventory within a period of time.
													</td>
												</tr>
												< <tr>													
													<td class="span4">
														<h3><a href="#/">Reconciliation Report</a></h3>
													</td>
												</tr>
												<tr>													
													<td class="span4">
														List of all cash related reconciliation reports.
													</td>
												</tr> >
											</table>					
										</div>
									</div>									
					        	</div> -->
				        	</div>

				        	<div class="tab-pane" id="tab-5">								        	
					        	<div class="row-fluid">
					        		<div class="row-fluid sale-report">
										<h2>PERIOD-END CLOSING REPORTS</h2>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/journal_report">Journal Entry Report</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/general_ledger">General Ledger</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/trial_balance">Trial Balance</a></h3>
													</td>					
												</tr>
												<tr>
													<td class="span4">
														Lists all accounting transactions within a period of time into debits and credits and displays them chronologically.
													</td>
													<td class="span4">
														Groups all accounting transactions by each account in your chart of accounts within a period of time into debits, credits, and balances.
													</td>
													<td class="span4">
														Summarizes each account balance on your chart of accounts in the format of debit and credit within a period of time
													</td>
												</tr>

												<!-- <tr>
													<td class="span4">
														<h3><a href="#/transaction_list_date">Transaction List by Date</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/recent_transactions_list">Recent Transactions List</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/">Period-End Closing Checklist</a></h3>
													</td>
												</tr>
												<tr>
													<td class="span4">
														This is similar with journal entry; however, it does not include debit and credit. In addition, it includes not financial transactions, such as sale order or purchase order.
													</td>
													<td class="span4">
														Lists all transaction recorded or edited within the last five days.
													</td>
													<td class="span4">
														
													</td>
												</tr> -->
											</table>
										</div>
									</div>									
					        	</div>

					        	<div class="span12 recevable-report" style="margin-top: 15px; display: inline-block; padding-left: 0;">
										<h2>OTHER REPORTS/ LISTS</h2>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/chart_of_account">Chart of Account </a></h3>
													</td>
													<td class="span4"></td>
													<td class="span4"></td>
													<!-- <td class="span4">
														<h3><a href="#/audit_trial_report">Audit Trial Report</a></h3>								
													</td>
													<td class="span4">
														<h3><a href="#/recurring_journal_list">Recurring Journal List</a></h3>							
													</td>	 -->					
												</tr>
												<tr>
													<td class="span4">
														Lists of all accounts with name, type, and balance.
													</td>
													<td class="span4"></td>
													<td class="span4"></td>
												</tr>
												<!-- <tr>
													<td class="span4">
														<h3><a href="#/">Realized Exchange Gains & Losses</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/">Unrealized Exchange Gains & Losses</a></h3>							
													</td>						
												</tr>
												<tr>
													<td class="span4">
														This detailed report lists foreign transactions that are closed (referred to as realized gains and losses) and totals the gains and losses due to changes in exchange rates.
													</td>
													<td class="span4">
														This summary report lists your foreign accounts and calculates the potential gain or loss for each account.
													</td>							
												</tr>			 -->									
											</table>
										</div>
									</div>

				        	</div>

				        	<div class="tab-pane" id="tab-6">								        	
					        	<div class="row-fluid">

									<div class="row-fluid recevable-report" style="margin-top: 15px;">
										<h2>FINANCIAL STATEMENTS</h2>
										<div class="row-fluid">
											<table class="span12">
												<tr>
													<td class="span4">
														<h3><a href="#/statement_profit_loss">Statement of Profit or Loss</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/statement_financial_position">Statement of Financial Position</a></h3>								
													</td>
													<td class="span4">
														<!-- <h3><a href="#/statement_profit_loss_comparison">Statement of Profit or Loss Comparison</a></h3> -->
													</td>					
												</tr>
												<tr>
													<td class="span4">
														Provides the progress of your company’s financial performance, summarized in a record of income generated and expenses incurred over a given period.
													</td>
													<td class="span4">
														Provides the snapshot of your company’s financial position on value and ownership. It is the relationship of the company’s assets, liabilities and equities as of a specific date.
													</td>
													<td class="span4">
														<!-- Shows a year-over-year comparison of your financial performance. -->
													</td>													
												</tr>
												<!-- <tr>
													<td class="span4">
														<h3><a href="#/statement_financial_position_comparison">Statement of Financial Position Comparison</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/statement_cash_flow">Statement of Cash Flow</a></h3>
													</td>
													<td class="span4">
														<h3><a href="#/statement_changes_equity">Statement of Changes in Equity</a></h3>
													</td>
												</tr>
												<tr>
													<td class="span4">
														Shows cash generated by your company operating activities, cash spent on investing in your company assets long term asset, and cash in or out from your own share or financial institutions.
													</td>
													<td class="span4">
														Shows the movement of your paid-up capital, dividends, the effects of changes in accounting policies and corrections of errors recognized in the period, and the profit or loss for a reporting period
													</td>
													<td class="span4">
														Shows a year-over-year comparison of your financial position.
													</td>
												</tr> -->

											</table>
										</div>
									</div>

									

									
					        	</div>
				        	</div>

				        	<div class="tab-pane" id="tab-7">
				        		<div align="center" style="min-height: 150px;">
				        			<h1 style="font-style: 30px; margin-top: 20px;">Coming Soon</h1>
				        		</div>
				        	</div>

				        	<div class="tab-pane" id="tab-8">
				        		<div align="center" style="min-height: 150px;">
				        			<h1 style="font-style: 30px;margin-top: 20px;">Coming Soon</h1>
				        		</div>
				        	</div>

					    </div>
					</div>
				</div>
			</div>		
		</div>
	</div>
</script>


<!-- ***************************
*	Template List Section     *
**************************** -->
<script id="contact-list-tmpl" type="text/x-kendo-tmpl">
	<span>#=abbr##=number#</span>	
	<span>#=name#</span>	
</script>
<script id="contact-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/customer">+ Add New Customer</a></li>
    </strong>
</script>
<script id="currency-list-tmpl" type="text/x-kendo-tmpl">
	<span>
		#=code# - #=country#
	</span>
</script>
<script id="segment-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/segment">+ Add New Segment</a>
    </strong>
</script>
<script id="segment-list-tmpl" type="text/x-kendo-tmpl">
	<span>#=code#</span> <span>#=name#</span>
</script>
<script id="job-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/job">+ Add New Job</a>
    </strong>
</script>
<script id="job-list-tmpl" type="text/x-kendo-tmpl">
	<span>
		#=number# #=name#
	</span>
</script>

<script id="customer-type-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/customer_setting">+ Add New Customer Type</a>
    </strong>
</script>
<script id="customer-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/customer">+ Add New Customer</a>
    </strong>
</script>
<script id="customer-payment-method-header-tmpl" type="text/x-kendo-tmpl">
	<strong>
    	<a href="\#/customer_setting">+ Add New Payment Method</a>
    </strong>	
</script>
<script id="customer-term-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/customer_setting">+ Add New Term</a>
    </strong>
</script>

<script id="employee-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/employee">+ Add New Employee</a>
    </strong>
</script>

<script id="item-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/item">+ Add New Item</a> &nbsp;&nbsp;
    	<a href="\#/item_service">+ Add New Service</a>
    </strong>
</script>
<script id="item-list-tmpl" type="text/x-kendo-tmpl">
	<span style="width:45%; float: left">
		#if(name.length>20){#
			#=abbr##=number# #=name.substring(0, 20)#...
		#}else{#
			#=abbr##=number# #=name#
		#}#
	</span>
	<span style="width:35%; text-align: center;">#=category#</span>
	<span style="width:20%; text-align: right;" class="pull-right">#=on_hand#</span> 	
</script>
<script id="item-group-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/item_setting">+ Add New Group</a>
    </strong>
</script>
<script id="item-category-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/item_setting">+ Add New Category</a>
    </strong>
</script>
<script id="item-brand-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/item_setting">+ Add New Brand</a>
    </strong>
</script>
<script id="item-measurement-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/item_setting">+ Add New Measurement</a>
    </strong>
</script>

<script id="vendor-type-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/vendor_setting">+ Add New Supplier Type</a>
    </strong>
</script>
<script id="vendor-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/vendor">+ Add New Supplier</a>
    </strong>
</script>
<script id="vendor-payment-method-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/vendor_setting">+ Add New Payment Method</a>
    </strong>
</script>
<script id="vendor-payment-term-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/vendor_setting">+ Add New Payment Term</a>
    </strong>
</script>

<script id="cash-payment-method-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/cash_seting">+ Add New Payment Method</a>
    </strong>
</script>
<script id="cash-payment-term-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/cash_seting">+ Add New Payment Term</a>
    </strong>
</script>

<script id="account-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/account">+ Add New Account</a>
    </strong>
</script>
<script id="account-list-tmpl" type="text/x-kendo-tmpl">	
	<span>
		#=number#				
	</span>
	-
	<span>
		#if(name.length>25){#
			#=name.substring(0, 25)#..
		#}else{#
			#=name#
		#}#
	</span>
</script>
<script id="account-type-header-tmpl" type="text/x-kendo-tmpl">
    <strong>
    	<a href="\#/customer_setting">+ Add New Customer Type</a>
    </strong>
</script>
<script id="account-type-list-tmpl" type="text/x-kendo-tmpl">	
	<span>
		#=number#				
	</span>
	-
	<span>#=name#</span>
</script>

<script id="tax-header-tmpl" type="text/x-kendo-tmpl">
	<strong>
    	<a href="\#/sale_tax">+ Add New Tax</a>
    </strong>	
</script>

<script id="reference-list-tmpl" type="text/x-kendo-tmpl">
	<span>
		#=number# :
		#if(type=="GDN" || type=="GRN"){# 
			#=kendo.toString(amount, "n")#
		#}else{#
			#=kendo.toString(amount, "c", locale)#
		#}#
	</span>
	<span class="pull-right">
		#if(type=="GDN" || type=="GRN"){# 
			#if(status==1){#
				Used			
			#}else{#
				Open
			#}#
		#}else{#
			#if(status==1){#
				Paid
			#}else if(status==2){#
				Partially Paid
			#}else{#
				Open
			#}#
		#}#		
	</span>
</script>
<script id="attachment-rith-list-tmpl" type="text/x-kendo-tmpl">
	<tr>
		<td>
			<input id="txtName-#:uid#" name="txtName-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: name" />
		</td>
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>#=kendo.toString(created_at, "dd-MM-yyyy")#</td>
		<td>
			#if(id){#
				<a href="#=url#" target="_blank" class="btn-action glyphicons download btn-default"><i></i></a>
			#}#
			<span class="btn-action glyphicons remove_2 btn-danger" data-bind="click: onRemove"><i></i></span>			
		</td>
	</tr>
</script>
<script id="attachment-list-tmpl" type="text/x-kendo-tmpl">
	<tr>
		<td>
			<input id="txtName-#:uid#" name="txtName-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: name" />
		</td>
		<td>
			<input id="txtDescription-#:uid#" name="txtDescription-#:uid#" 
					type="text" class="k-textbox" 
					data-bind="value: description"
					style="width: 100%; margin-bottom: 0;" />
		</td>
		<td>#=kendo.toString(created_at, "dd-MM-yyyy")#</td>
		<td>
			#if(id){#
				<a href="#=url#" target="_blank" class="btn-action glyphicons download btn-default"><i></i></a>
			#}#
			<span class="btn-action glyphicons remove_2 btn-danger" data-bind="click: removeFile"><i></i></span>			
		</td>
	</tr>
</script>
<script id="errorTemplate" type="text/x-kendo-template">
    <div class="wrong-pass">
        <img style="float: left; cursor: pointer;" src="http://demos.telerik.com/kendo-ui/content/web/notification/error-icon.png" />        
        <h3>#= message #</h3>
    </div>
</script>
<script id="successTemplate" type="text/x-kendo-template">
    <div class="upload-success">
        <img src="http://demos.telerik.com/kendo-ui/content/web/notification/success-icon.png" />
        <h3>#= message #</h3>
    </div>
</script>


<!-- ***************************
*	Water Section      	  *
**************************** -->
<script id="wDashBoard" type="text/x-kendo-template">
	<!-- <div class="container-fluid menu-hidden sidebar-hidden-phone fluid menu-left">
		 
		<img src="uploads/pictures/Water_Bill.png" width="300" height="100" />	
		
		<div class="row row-merge">
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_balance" class="widget-stats widget-stats-primary widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.balance"></span></span>
						<span class="count" style="font-size: 35px;" data-bind="text: balance"></span>
						<span class="glyphicons coins"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_deposit" class="widget-stats widget-stats-inverse widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.deposit"></span></span>
						<span class="count" style="font-size: 35px;" data-bind="text: deposit"></span>
						<span class="glyphicons briefcase"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
			<div class="span4">
				<div class="innerAll padding-bottom-none-phone">
					<a href="#/wCustomer_list" class="widget-stats widget-stats-gray widget-stats-4">
						<span class="txt"><span data-bind="text: lang.lang.active_customer"></span></span>
						<span class="count"​><span data-bind="text: activeCustomer"></span></span> 
						<span class="glyphicons user"><i></i></span>
						<div class="clearfix"></div>
						<i class="icon-play-circle"></i>
					</a>
				</div>
			</div>			
		</div>

		<div class="row">			
			<div class="span8">
				<div class="heading-buttons">
					<h2 class="heading pull-left"><i class="icon-bar-chart icon-fixed-width text-primary"></i> <span data-bind="text: lang.lang.monthly_sale"></span></h2>
					
					<div class="clearfix"></div>
				</div>

				<div class="innerLR innerT">			
					<div id="wsale-graph" style="height: 200px;"></div>
				</div>
			</div>

			<div class="span4">
				<div class="widget widget-body-white">
					<div class="widget-head"><h4 class="heading strong text-uppercase"><span data-bind="text: lang.lang.customer_status"></span></h4></div>
					<div class="widget-body padding-none">
						<table class="table table-striped table-vertical-center table-condensed margin-none">
							<tbody>
								<tr>									
									<td class="text-primary border-none"><span data-bind="text: lang.lang.inactive"></span></td>
									<td class="text-right strong">
										<span class="badge badge-warning" data-bind="text: voidCustomer"></span>										
									</td>
								</tr>
								<tr>									
									<td class="text-primary"><span data-bind="text: lang.lang.void"></span></td>
									<td class="text-right strong">
										<span class="badge badge-important" data-bind="text: inactiveCustomer"></span>										
									</td>
								</tr>
								<tr>									
									<td class="text-primary"><span data-bind="text: lang.lang.total"></span></td>
									<td class="text-right strong">
										<span class="badge badge-inverse" data-bind="text: totalCustomer"></span>										
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<div class="widget widget-heading-simple widget-body-white">
					<div class="widget-body padding-none">
						<div class="row-fluid row-merge">
							<div class="span6">
								<div class="innerAll center">
									<h5 class="strong muted text-uppercase"><i class="icon-money text-faded"></i> <span data-bind="text: lang.lang.open"></span></h5>
									<a href="#/wAging_summary" class="text-xlarge strong text-primary" data-bind="text: totalUnpaid"></a>									
								</div>
							</div>
							<div class="span6">
								<div class="innerAll center muted">
									<h5 class="strong muted text-uppercase"><i class="icon-dashboard text-faded"></i> <span data-bind="text: lang.lang.no_meter"></span></h5>
									<a href="#/wCustomer_no_meter" class="text-xlarge strong" data-bind="text: totalNoMeter"></a>									
								</div>
							</div>
						</div>
					</div>
				</div>								
			</div>			
		</div>	

		<div class="row-fluid">
	        <form id="employeeForm" data-role="validator" novalidate="novalidate">
                <div id="fieldlist">
                	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />
	                                           
                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
                    <span data-for='sdate' class='k-invalid-msg'></span>

                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
                    		data-greaterdate-field="sdate" data-greaterdate-msg='Invalid' />
                    <span data-for='edate' class='k-invalid-msg'></span>
               
                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>                           
                </div>
            </form>

            <table class="table table-bordered table-vertical-center table-pricing table-pricing-2">
        		<thead>
        			<tr>
        				<th width="45" class="center"><span data-bind="text: lang.lang.no"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.license"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.total_license"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.active_customer"></span></th>
        				<th class="center"><span data-bind="text: lang.lang.void_customer"></span></th></th>	            				
        				<th class="center"><span data-bind="text: lang.lang.deposit"></span></th></th>	            				
        				<th class="center"><span data-bind="html: lang.lang.m"></span><sup>3</sup></th>
        				<th class="center"><span data-bind="text: lang.lang.amount"></span></th>        				
        				<th class="center"><span data-bind="text: lang.lang.balance"></span></th>	            					            				
        			</tr>
        		</thead>
        		<tbody data-role="listview"
        				data-auto-bind="false"	            					            			
		                data-template="wsale-by-branch-row-template"
		                data-bind="source: saleByBranchDS"></tbody>
        	</table>            

			<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>

			<table class="table table-bordered table-striped table-white">
        		<thead>
        			<tr>
        				<th width="45"><span data-bind="text: lang.lang.no"></span></th>
        				<th><span data-bind="text: lang.lang.license"></span></th>
        				<th><span data-bind="text: lang.lang.location"></span></th>
        				<th><span data-bind="text: lang.lang.active_customer"></span></th>
        				<th><span data-bind="text: lang.lang.void_customer"></span></th>	            				
        				<th><span data-bind="text: lang.lang.deposit"></span></th>	            				
        				<th><span data-bind="html: lang.lang.m"></span><sup>3</sup></th>
        				<th><span data-bind="text: lang.lang.amount"></span></th>        				
        				<th><span data-bind="text: lang.lang.balance"></span></th>	            					            				
        			</tr>
        		</thead>
        		<tbody data-role="listview"
        				data-auto-bind="false"	            					            			
		                data-template="wsale-by-location-row-template"
		                data-bind="source: saleByLocationDS"></tbody>
        	</table> 

    	</div>
    </div> -->
    <div class="row-fluid">
		<!-- Left Side -->
		<div class="span6">

			<!-- Logo of the page -->
			<table width="100%" cellpadding="10">
				<tr>
			        <td valign="top">
			        	<img src="<?php echo base_url();?>/assets/water_bill.png" width="300" height="100">
			        	<div class="supplier-icon" style="margin-top: 15px;">
					       	<div class="span4">
						       	<a href="#/wNew_customer" class="center">
						       		<img title="Add Customer" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/customers.ico" />
						       	</a>
						       </div>
						   <!--  <div class="span4">
						       	<a href="#/item" class="center">
						       		<img title="Add Inventory" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/inventories.ico" />
						       	</a>
						    </div>
						    <div class="span4">
						       	<a href="#/item_service" class="center">
						       		<img title="Add Service" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/services.ico" />
						       	</a>
						    </div> -->
						</div>
			        </td>
			 	</tr>
			</table>

			<table class="table table-borderless table-condensed table-vertical-center ">
				<tr>
					<td class="center ">
						<a href="#/wReading">
							<img title="Add Reading" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/ir_reader.png" width="110" height="200" />
							Reading
						</a>						
					</td>
					<td class="center ">
						<a href="#/wIR_reader">
							<img title="Add IR Reader" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/ir_reader.png" width="110" height="200" />
							IR Reader
						</a>
					</td>
					<td class="center ">
						<a href="#/wReading_book">
							<img title="Add Reading Book" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/reading_book.png" width="110" height="200" />
							R. Book
						</a>						
					</td>
					<td class="center ">
						<a href="#/wInvoice">
							<img title="Add Create Invoice" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/create_invoice.png" width="110" height="200" />
							W. Invoice
						</a>
					</td>					
				</tr>
				<tr>					
					<td class="center ">						
						<a href="#/wPrint_center">
							<img title="Add Print Invoice" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/print_invoice.png" width="110" height="200" />
							Print
						</a>						
					</td>
					<td class="center ">						
						<a href="#/currency_rate">
							<img title="Receive Water Bill Payment" src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/function_logo/receive_payment.png" width="110" height="200" />
							Receipt
						</a>						
					</td>
					<td class="center ">
					</td>
					<td class="center ">
					</td>									
				</tr>							
			</table>                

		</div>

		<!-- Right Side -->
		<div class="span6">

			<div class="board-chart" style="margin-bottom: 15px;">
				<div class="span12">
					<h4>PCG & Partners</h4>
					<h2 style="color: #113051; margin-bottom: 11px; display: inline-block; width: 100%;" >Financial Snapshot</h2>
					<span style="color: #000000;">As of: Tue Oct 18 2016 15:18:08 GMT+0700 (ICT)</span><br/>
				</div>
			</div>

			<!-- Summary -->
			<div class="row">
	
				<!-- Column -->
				<div class="span6" style="padding-right: 0;">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons coins"><i></i></span>Sale</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert alert-primary">
							
							<div align="center" class="text-large strong">0</div>
							<table width="100%">
								<tr align="center">
									<td width="50%">										
										<span >0</span>
										<br>
										<span>Customer</span>
									</td>
									<td width="50%">
										<span >0</span>
										<br>
										<span>Meter</span>
									</td>									
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span6" >
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons cart_in"><i></i></span>Active Customer</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info">
							
							<div align="center" class="text-large strong">0</div>
							<table width="100%">
								<tr align="center">
									<td width="33%">										
										<span>0</span>
										<br>
										<span>Active</span>
									</td>
									<td width="33%">
										<span>0</span>
										<br>
										<span>Inactive</span>
									</td>
									<td width="33%">
										<span>0</span>
										<br>
										<span>Voice</span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				
			</div>

			<!-- Summary -->
			<div class="row">
				<!-- Column -->
				<div class="span6" style="padding-right: 0;">
				
					<!-- Widget -->
					<div class="widget widget-3 customer-border">
					
						<!-- Widget heading -->
						<div class="widget-head">
							<h4 class="heading"><span class="glyphicons cart_in"><i></i></span>Active Customer</h4>
						</div>
						<!-- // Widget heading END -->
						
						<div class="widget-body alert-info">
							
							<div align="center" class="text-large strong">0</div>
							<table width="100%">
								<tr align="center">
									<td width="33%">										
										<span>0</span>
										<br>
										<span>Active</span>
									</td>
									<td width="33%">
										<span>0</span>
										<br>
										<span>Inactive</span>
									</td>
									<td width="33%">
										<span>0</span>
										<br>
										<span>Voice</span>
									</td>
								</tr>
							</table>
						</div>
						<!-- // Widget footer END -->
						
					</div>
					<!-- // Widget END -->
					
				</div>
				<!-- // Column END -->
				
				<!-- Column -->
				<div class="span6">
				</div>
				<!-- // Column END -->

			</div>

			<!-- Top 5 -->
			<div class="row-fluid">
				<div class="span4">								
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>
				            <tr>
				                <th class="center" colspan="2">Top 5 Customers</th>				                			                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                 
			                 data-template="customerDashBoard-top-customer-template"
			                 data-bind="source: topCustomerDS"></tbody>			        
				    </table>			
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>				           
				            <tr>
				                <th class="center" colspan="2">Top 5 A/R Balance</th>				                			                
				            </tr>					        
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"				        	                  
			                 data-template="customerDashBoard-top-ar-template"
			                 data-bind="source: topARDS"></tbody>			        
				    </table>
				</div>
				<div class="span4">					
					<table class="table table-bordered table-primary table-striped table-vertical-center">
				        <thead>				           
				            <tr>
				                <th class="center" colspan="2">Top 5 Products</th>				                			                
				            </tr>					        
				        </thead>
				        <tbody data-role="listview"
				        	 data-auto-bind="false"                
			                 data-template="customerDashBoard-top-product-template"
			                 data-bind="source: topProductDS"></tbody>			        
				    </table>
				</div>		
			</div>

			<!-- Graph -->
		    <div class="innerLR innerT">			
				<div id="esale-graph" style="height: 150px;"></div>
			</div>
		</div>

		<div class="row-fluid">		
	        <div>
	        	<input data-role="dropdownlist"                   
	                   data-value-primitive="true"
	                   data-text-field="text"
	                   data-value-field="value"
	                   data-bind="value: sorter,
	                              source: sortList,                              
	                              events: { change: sorterChanges }" />

	        	<input data-role="datepicker"
	        		   data-format="dd-MM-yyyy"
	                   data-bind="value: sdate,
	                              events: { change: dateChanges }" >

	            <input data-role="datepicker"
	            	   data-format="dd-MM-yyyy"
	                   data-bind="value: edate,
	                              events: { change: dateChanges }" >
	            
	            <button type="button" data-role="button" data-icon="search" data-bind="click: search"></button>
	        </div>
        	
            <div data-role="grid" 
					data-bind="source: saleByLocationDS"
				    data-auto-bind="false"	        
				    data-row-template="esale-by-location-row-template"						                           
				    data-columns='[
				    	{ title: "No.", width: 45 },				       	
				        { title: "Location" },	                     
				        { title: "អតិថិជនកំពុងប្រើប្រាស់" },
				        { title: "អតិថិជនឈប់ប្រើប្រាស់" },
				        { title: "Deposit" },
				        { title: "បរិមាណលក់ភ្លើង" },	            
				        { title: "Amount" },
				        { title: "ជំពាក់" },
				        { title: "Balance" }				                           	                    
				    ]'></div>

    	</div>


	</div>
</script>
<script id="wsale-by-branch-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td class="sno">1</td>
		<td>#=name#</td>
		<td>#=location#</td>		
		<td align="right">#=kendo.toString(active_customer, "n0")#</td>
		<td align="right">#=kendo.toString(inactive_customer, "n0")#​</td>				
		<td align="right">#=kendo.toString(deposit, "c0", banhji.institute.locale)#</td>
		<td align="right">#=kendo.toString(usage, "n0")# m<sup>3</sup></td>		
		<td align="right">#=kendo.toString(sale, "c0", banhji.institute.locale)#</td>
		<td align="right">#=kendo.toString(unpaid, "c0", banhji.institute.locale)#</td>					
    </tr>   
</script>
<script id="wsale-by-location-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td class="snoo">1</td>
		<td>#=branch_name#</td>
		<td>#=location_name#</td>		
		<td align="right">#=kendo.toString(active_customer, "n0")# </td>
		<td align="right">#=kendo.toString(inactive_customer, "n0")#​ </td>				
		<td align="right">#=kendo.toString(deposit, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(usage, "n0")# m<sup>3</sup></td>		
		<td align="right">#=kendo.toString(sale, "c0", banhji.eDashBoard.locale)#</td>
		<td align="right">#=kendo.toString(unpaid, "c0", banhji.eDashBoard.locale)#</td>						
    </tr>   
</script>

<script id="waterCenter" type="text/x-kendo-template">	
	<div class="widget widget-heading-simple widget-body-gray widget-employees">		
		<div class="widget-body padding-none">			
			<div class="row-fluid row-merge">
				<div class="span3 listWrapper" >
					<div class="innerAll">							
						<form autocomplete="off" class="form-inline">
							
							<div class="widget-search separator bottom">
								<button type="button" class="btn btn-default pull-right" data-bind="click: search"><i class="icon-search"></i></button>
								<div class="overflow-hidden">
									<input type="search" placeholder="Number or Name..." data-bind="value: searchText, events:{change: enterSearch}">
								</div>
							</div>						
							<div class="select2-container" style="width: 100%;  margin-bottom: 10px;">
								<input data-role="dropdownlist"
					                   data-option-label="Select Type..."
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: contact_type_id,
					                              source: contactTypeDS"
					                   style="width: 100%;" />							
							</div>
						</form>					
					</div>
					
					<span class="results"><span data-bind="text: contactDS.total"></span> <span data-bind="text: lang.lang.found_search"></span></span>

					<div class="table table-condensed" style="height: 580px;"						 
						 data-role="grid"						 
						 data-bind="source: contactDS"
						 data-row-template="waterCenter-customer-list-tmpl"
						 data-columns="[{title: ''}]"
						 data-selectable=true
						 data-height="600"						 
						 data-scrollable="{virtual: true}"></div>									
				</div>
				<div class="span9 detailsWrapper">
					<div class="row-fluid">					
						<div class="span6">
							<div class="widget widget-4 widget-tabs-icons-only margin-bottom-none">

							    <!-- Widget Heading -->
							    <div class="widget-head">

							        <!-- Tabs -->
							        <ul class="pull-right">
							        	<li style="font-size: large; color: black; font-weight: bold;">							            	
							            	<span data-bind="text: obj.name"></span>
							            </li>
							            <li class="glyphicons text_bigger active"><span data-toggle="tab" data-target="#tab1-4"><i></i></span>
							            </li>							            							            
							            <li class="glyphicons circle_info"><span data-toggle="tab" data-target="#tab2-4"><i></i></span>
							            </li>							            
							            <li class="glyphicons pen"><span data-toggle="tab" data-target="#tab3-4"><i></i></span>
							            </li>
							            <li class="glyphicons paperclip"><span data-toggle="tab" data-target="#tab4-4"><i></i></span>
							            </li>							            							            
							        </ul>
							        <div class="clearfix"></div>
							        <!-- // Tabs END -->

							    </div>
							    <!-- Widget Heading END -->

							    <div class="widget-body">
							        <div class="tab-content">

							            <!-- Transactions Tab content -->
							            <div id="tab1-4" class="tab-pane active box-generic">
							            	<table class="table table-borderless table-condensed cart_total cash-table">
								            	<tr>
								            		<td width="50%">
								            			<span class="btn btn-block btn-inverse" data-bind="click: goQuote"><span>METER</span>
								            		</td>
								            		<td width="50%">
								            			<span class="btn btn-block btn-primary" data-bind="click: goDeposit"><span><span data-bind="text: lang.lang.c_deposit"></span></span>								            			
								            		</td>
								            	</tr>
							            	</table>
							            </div>
							            <!-- // Transactions Tab content END -->							           					            

							            <!-- INFO Tab content -->
							            <div id="tab2-4" class="tab-pane box-generic">
							            	<div class="row-fluid">
							            		<div class="accounCetner-textedit">
									            	<table width="100%">
														<tr>
															<td width="40%"><span data-bind="text: lang.lang.customer_type"></span></td>
															<td width="60%">
																<span class="strong" data-bind="text: obj.contact_type"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.number"></span></td>
															<td>
																<span class="strong" data-bind="text: obj.abbr"></span>
																<span class="strong" data-bind="text: obj.number"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.name"></span></td>
															<td>
																<span data-bind="text: obj.name"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.billed_address"></span></td>
															<td>
																<span data-bind="text: obj.address"></span>
															</td>
														</tr>								
														<tr>
															<td><span data-bind="text: lang.lang.phone"></span></td>
															<td>
																<span data-bind="text: obj.phone"></span>
															</td>
														</tr>
														<tr>
															<td><span data-bind="text: lang.lang.currency"></span></td>
															<td>										
																<span data-bind="text: currencyCode"></span>
															</td>
														</tr>
													</table>

													<span class="btn btn-primary btn-icon glyphicons edit pull-right" data-bind="click: goEdit"><i></i><span data-bind="text: lang.lang.view_edit_profile"></span></span>
												</div>
											</div>
							            </div>
							            <!-- // INFO Tab content END -->

							            <!-- NOTE Tab content -->
							            <div id="tab3-4" class="tab-pane">

										    <div>
												<input type="text" class="k-textbox" 
														data-bind="value: note, events:{change:saveNoteEnter}" 
														placeholder="Add memo ..." 
														style="width: 366px;" />
												<span class="btn btn-primary" data-bind="click: saveNote"><span data-bind="text: lang.lang.add"></span></span>
											</div>

											<br>

											<div class="table table-condensed" style="height: 100;"						 
												 data-role="grid"
												 data-auto-bind="false"						 
												 data-bind="source: noteDS"
												 data-row-template="waterCenter-note-tmpl"
												 data-columns="[{title: ''}]"
												 data-height="100"						 
												 data-scrollable="{virtual: true}"></div>
											
							            </div>
							            <!-- // NOTE Tab content END -->

							            <!-- Attach Tab content -->
								        <div id="tab4-4" class="tab-pane">							            	
								            <p><span data-bind="text: lang.lang.file_type"></span> [PDF, JPG, JPEG, TIFF, PNG, GIF]</p>
								            <input id="files" name="files"
							                   type="file"
							                   data-role="upload"
							                   data-show-file-list="false"
							                   data-bind="events: { 
					                   				select: onSelect
							                   }">

								            <table class="table table-bordered">
										        <thead>
										            <tr>			                
										                <th><span data-bind="text: lang.lang.file_name"></span></th>
										                <th><span data-bind="text: lang.lang.description"></span></th>
										                <th><span data-bind="text: lang.lang.date"></span></th>
										                <th style="width: 13%;"></th>                			                
										            </tr> 
										        </thead>
										        <tbody data-role="listview" 
										        		data-template="attachment-list-tmpl" 
										        		data-auto-bind="false"
										        		data-bind="source: attachmentDS"></tbody>			        
										    </table>

										    <span class="btn btn-icon btn-success glyphicons ok_2" data-bind="click: uploadFile" style="color: #fff; padding: 5px 38px; text-align: left; width: 98px !important; display: inline-block; margin-top: 10px;"><i></i> <span data-bind="text: lang.lang.save"></span></span>

								        </div>
								        <!-- // Attach Tab content END -->							            								            

							        </div>
							    </div>
							</div>
						</div>

						<div class="span6" style="margin-bottom: 10px;">
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-primary widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons coins"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.balance"></span><span data-bind="text: balance" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-inverse widget-stats-5" data-bind="click: loadDeposit">
										<span class="glyphicons briefcase"><i></i></span>
										<span class="txt"><span data-bind="text: lang.lang.deposit"></span><span data-bind="text: deposit" style="font-size:medium;"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>							
							
							<div class="row-fluid">
								<div class="span6">
									<div class="widget-stats widget-stats-info widget-stats-5" data-bind="click: loadBalance">
										<span class="glyphicons circle_exclamation_mark"><i></i></span>
										<span class="txt"><span data-bind="text: outInvoice"></span> <span data-bind="text: lang.lang.open_invoice"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
								<div class="span6">
									<div class="widget-stats widget-stats-default widget-stats-5" data-bind="click: loadOverInvoice">
										<span class="glyphicons turtle"><i></i></span>
										<span class="txt"><span data-bind="text: overInvoice"></span> <span data-bind="text: lang.lang.over_due"></span></span>
										<div class="clearfix"></div>
									</div>
								</div>
							</div>														
						</div>
					</div>
					
					<div>
						<input data-role="dropdownlist"
							   class="sorter"                  
					           data-value-primitive="true"
					           data-text-field="text"
					           data-value-field="value"
					           data-bind="value: sorter,
					                      source: sortList,                              
					                      events: { change: sorterChanges }" />

						<input data-role="datepicker"
							   class="sdate"
							   data-format="dd-MM-yyyy"
					           data-bind="value: sdate,
					           			  max: edate"
					           placeholder="From ..." >

					    <input data-role="datepicker"
					    	   class="edate"
					    	   data-format="dd-MM-yyyy"
					           data-bind="value: edate,
					                      min: sdate"
					           placeholder="To ..." >

					  	<button type="button" data-role="button" data-bind="click: searchTransaction"><i class="icon-search"></i></button>
					</div>

					<table class="table table-bordered table-striped table-white">
						<thead>
							<tr>
								<th><span data-bind="text: lang.lang.date"></span></th>
								<th><span data-bind="text: lang.lang.type"></span></th>								
								<th><span data-bind="text: lang.lang.reference_no"></span></th>
								<th><span data-bind="text: lang.lang.amount"></span></th>
								<th><span data-bind="text: lang.lang.status"></span></th>
								<th><span data-bind="text: lang.lang.action"></span></th>
							</tr>
						</thead>	            		
	            		<tbody data-role="listview"
	            				data-auto-bind="false"	            					            					            					            			
				                data-template="waterCenter-transaction-tmpl"
				                data-bind="source: transactionDS" >
				        </tbody>
	            	</table>

	            	<div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: transactionDS"></div>	            	
				</div>
			</div>			
		</div>
	</div>		
</script>
<script id="waterCenter-transaction-tmpl" type="text/x-kendo-tmpl">
    <tr>    	  	
    	<td>#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
    	<td>#=type#</td>
        <!-- Reference -->
        <td>
        	#if(type=="Customer_Deposit" && amount<0){#			
				<a href="\#/#=reference[0].type.toLowerCase()#/#=reference[0].id#"><i></i> #=number#</a>			
			#}else{#
				<a href="\#/#=type.toLowerCase()#/#=id#"><i></i> #=number#</a>
			#}#        	
        </td>
        <!-- Amount -->
    	<td class="right">
    		#if(type=="GDN"){#
    			#=kendo.toString(amount, "n0")#
    		#}else{#
    			#=kendo.toString(amount-deposit, locale=="km-KH"?"c0":"c", locale)#
    		#}#
    	</td>
    	<!-- Status -->
    	<td align="center">
    		#if(type==="Quote"){#       		
				#if(status==="0"){#
        			Open
        		#}else{#
        			Used        			
        		#}#
        	#}else if(type==="Sale_Order"){#
        		#if(status==="0"){#
        			Open
        		#}else{#
        			Done        			
        		#}#
        	#}else if(type==="GDN"){#
        		Delivered
        	#}else if(type==="Invoice"){#
        		#if(status==="0" || status==="2") {#
        			# var date = new Date(), dueDate = new Date(due_date).getTime(), toDay = new Date(date).getTime(); #
					#if(dueDate < toDay) {#
						Over Due #:Math.floor((toDay - dueDate)/(1000*60*60*24))# days
					#} else {#
						#:Math.floor((dueDate - toDay)/(1000*60*60*24))# days to pay
					#}#
				#} else {#
					Paid
				#}#        	
        	#}#        				
		</td>
		<!-- Actions -->
    	<td align="center">
			#if(type==="Invoice"){#
				#if(status==="0" || status==="2") {#
        			<a data-bind="click: payInvoice"><i></i> <span data-bind="text: lang.lang.receive_payment"></span></a>
        		#}#
        	#}#
		</td>     	
    </tr>
</script>
<script id="waterCenter-customer-list-tmpl" type="text/x-kendo-tmpl">
	<tr data-bind="click: selectedRow">
		<td>
			<div class="media-body strong">				
				<span>#=abbr##=number#</span>
				<span>#=name#</span>
			</div>
		</td>
	</tr>
</script>
<script id="waterCenter-note-tmpl" type="text/x-kendo-template">
	<tr>
		<td>			
			<blockquote>
				<small class="author">
					<span class="strong">#=creator#</span> :
					<cite>#=kendo.toString(new Date(noted_date), "g")#</cite>
				</small>					
				<p>#=note#</p>
			</blockquote>				
		</td>
	</tr>	
</script>

<script id="wNewCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">			

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons user_add"><i></i><span data-bind="text: lang.lang.new_water_customer"></span></h4>							        	
				    </div>
				    <div class="widget-body">												
												
						<table class="table table-bordered table-primary table-striped table-vertical-center">
							<thead>
								<tr>
									<th style="width: 5%;" class="center"><span data-bind="text: lang.lang.no"></span></th>
									<th><span data-bind="text: lang.lang.number"></span></th>								
									<th><span data-bind="text: lang.lang.name"></span></th>
									<th></th>
								</tr>
							</thead>	            		
		            		<tbody data-role="listview"
		            				data-auto-bind="false"
					                data-template="wNewCustomer-customer-list-tmpl"
					                data-bind="source: dataSource">
					        </tbody>
		            	</table>						

		            	<!-- Window Pop-Up -->
						<div id="window" data-role="window" data-visible="false" data-modal="true" data-resizable="false" data-iframe="true">				    	
							<div id="example" class="k-content">
								<br>
								<table class="table table-borderless table-condensed cart_total">						            	
				            		<tr>
						                <td><span data-bind="text: lang.lang.license"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="ddlBranch" name="ddlBranch"
												data-bind="value: obj.wbranch_id" 
												required data-required-msg="required" style="width: 100%;" />
						              	</td>							              	
						            	<td><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="ddlLocation" name="ddlLocation"
												data-bind="value: obj.wlocation_id, events:{change:locationChanges}" disabled="disabled"
												required data-required-msg="required" style="width: 100%;" />
						              	</td>
						            </tr>
						            <tr>
						                <td><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></td>
						              	<td>
						              		<input id="numberHead" name="numberHead" class="k-textbox"
						              				data-bind="value: obj.wnumber_head" 
						              				placeholder="e.g. ID" required data-required-msg="required"
						              				style="width: 30%;" />
						              		<input id="number" name="number" class="k-textbox"
						              				data-bind="value: obj.wnumber, events:{change:checkExistingNumber}" 
						              				placeholder="e.g. 0001" required data-required-msg="required"
						              				style="width: 68%;" />
						              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
						              	</td>							              	
						            	<td><span data-bind="text: lang.lang.id_card_number"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.id_number" placeholder="e.g. 123456789" /></td>
						            </tr>					            
						            <tr>
						            	<td><span data-bind="text: lang.lang.family_member"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.family_member" placeholder="e.g. 3" /></td>							            	
						            	<td><span data-bind="text: lang.lang.job"></span></td>
						              	<td><input class="k-textbox" data-bind="value: obj.job" placeholder="e.g. teacher" /></td>
						            </tr>					            						            							            								            								            			            
						        </table>							

								<div align="center">
									<span id="save" class="btn btn-success btn-icon glyphicons ok_2"><i></i>Save</span>
									<span class="btn btn-danger btn-icon glyphicons remove_2" data-bind="click: closeWindow"><i></i>Close</span> 
								</div>
							</div> 
						</div>

						<span id="notification"></span>								

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wNewCustomer-customer-list-tmpl" type="text/x-kendo-template">
	<tr>
		<td>#:banhji.wNewCustomer.dataSource.indexOf(data)+1#</td>
		<td>#=number#</td>
		<td>#=fullname#</td>
		<td class="center">
			<span class="btn btn-icon btn-success glyphicons circle_plus" data-bind="click: openWindow"><i></i> Use Water</span>
		</td>
	</tr>	
</script>

<script id="wCustomer" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons circle_info"><i></i> Customer</h4>					        							        	
					    </div>
					    <div class="widget-body">
					    	<!-- Upper part -->
					    	<div class="row-fluid">
					    		<div class="span6 well">									
									<div class="row-fluid">
										<div class="span6">														
											<!-- Group -->
											<div class="control-group">										
												<label for="ddlContactType"><span data-bind="text: lang.lang.customer_type"></span> <span style="color:red">*</span></label>
												<input id="ddlContactType" name="ddlContactType"
													data-bind="value: obj.contact_type_id" 
													required data-required-msg="required" style="width: 100%;" />																					            
											</div>
											<!-- // Group END -->
										</div>
										
										<div class="span2">	
											<!-- Group -->
											<div class="control-group">							
												<label for="numberHead">អក្សរកូដ <span style="color:red">*</span></label>
						              			<input id="numberHead" name="numberHead" class="k-textbox"
							              				data-bind="value: obj.number_head" 
							              				placeholder="e.g. ID" required data-required-msg="required"
							              				style="width: 100%;" />
											</div>
											<!-- // Group END -->											
										</div>

										<div class="span4">	
											<!-- Group -->
											<div class="control-group">							
												<label for="number"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
						              			<input id="number" name="number" class="k-textbox"
							              				data-bind="value: obj.number, events:{change: checkExistingNumber}" 
							              				placeholder="e.g. 0001" required data-required-msg="required"
							              				style="width: 75%;" />
							              		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
							              		<button type="button" data-role="button" data-bind="click: setNumber"><i class="icon-refresh"></i></button>
											</div>
											<!-- // Group END -->											
										</div>
									</div>
									
									<div class="row-fluid">
										<div class="span6">						
											<!-- Group -->
											<div class="control-group">
												<label for="surname"><span data-bind="text: lang.lang.surname"></span> <span style="color:red">*</span></label>
							              		<input id="surname" name="surname" class="k-textbox" data-bind="value: obj.surname" 
									              		placeholder="surname ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">								
												<label for="name"><span data-bind="text: lang.lang.name"></span> <span style="color:red">*</span></label>
									            <input id="name" name="name" class="k-textbox" data-bind="value: obj.name" 
									              		placeholder="name ..." required data-required-msg="required"
									              		style="width: 100%;" />
											</div>																		
											<!-- // Group END -->
										</div>
									</div>
									
									<div class="row-fluid" data-bind="visible: isCompany">
										<div class="span6">
											<!-- Group -->
											<div class="control-group">
												<label for="companyName"><span data-bind="text: lang.lang.organization_name"></span> <span style="color:red">*</span></label>
												<input id="companyName" name="companyName" class="k-textbox" data-bind="enabled: isCompany, value: obj.company"									
														placeholder="e.g. PCG & Partner"
														style="width: 100%;" />	
											</div>
											<!-- // Group END -->
										</div>

										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
												<label for="vatNo">VAT Number</label>								
							            		<input id="vatNo" name="vatNo" class="k-textbox" data-bind="enabled: isCompany, value: obj.vat_no" 
														placeholder="e.g. 01234567897"
														style="width: 100%;" />												
											</div>					
											<!-- // Group END -->
										</div>
									</div>
																
								</div>
								<div class="span6">
									<div class="row-fluid">	
										<!-- Map -->
										<div id="map" class="span12" style="height: 130px;"></div>
									</div>

									<div class="separator line bottom"></div>

									<div class="row-fluid">	
										<div class="span6">									
											<!-- Group -->
											<div class="control-group">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>									
											<!-- // Group END -->
										</div>	
										
										<div class="span6">	
											<!-- Group -->
											<div class="control-group">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>										
											</div>
											<!-- // Group END -->
										</div>										
									</div>
								</div>
							</div>								
									
							<!-- // Inner Tabs -->
							<div class="row-fluid">								
								<div class="box-generic">
								    <!-- //Tabs Heading -->
								    <div class="tabsbar tabsbar-1">
								        <ul class="row-fluid row-merge">								            								            
								            <li class="span2 glyphicons tint active">
								            	<a href="#tab1" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.water"></span></span></a>
								            </li>
								            <li class="span2 glyphicons usd">
								            	<a href="#tab2" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.account"></span></span></a>
								            </li>
								            <li class="span2 glyphicons nameplate_alt">
								            	<a href="#tab3" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.info"></span></span></a>
								            </li>
								            <li class="span2 glyphicons parents">
								            	<a href="#tab4" data-toggle="tab"><i></i> <span><span data-bind="text: lang.lang.agents"></span></span></a>
								            </li>						            					            
								        </ul>
								    </div>
								    <!-- // Tabs Heading END -->

								    <div class="tab-content">

								    	<!-- //WATER INFO -->
								        <div class="tab-pane active" id="tab1">
							            	<div class="row-fluid">

							            		<div class="span3">
								            		<!-- Group -->
													<div class="control-group">											
														<label for="ddlBranch"><span data-bind="text: lang.lang.license"></span> <span style="color:red">*</span></label>
														<input id="ddlBranch" name="ddlBranch"
															data-bind="value: obj.wbranch_id" 
															required data-required-msg="required" style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
								            		<!-- Group -->
													<div class="control-group">											
														<label for="ddlLocation"><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></label>
														<input id="ddlLocation" name="ddlLocation"
															data-bind="value: obj.wlocation_id, events:{change: locationChanges}" disabled="disabled" style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
													<!-- Group -->
													<div class="control-group">							
														<label for="wnumberHead">អក្សរកូដ <span style="color:red">*</span></label>
								              			<input id="wnumberHead" name="wnumberHead" class="k-textbox"
									              				data-bind="value: obj.wnumber_head" 
									              				placeholder="e.g. ID" required data-required-msg="required"
									              				style="width: 100%;" />
													</div>
													<!-- // Group END -->
												</div>

												<div class="span3">
													<!-- Group -->
													<div class="control-group">							
														<label for="wnumber"><span data-bind="text: lang.lang.number"></span> <span style="color:red">*</span></label>
								              			<input id="wnumber" name="wnumber" class="k-textbox"
									              				data-bind="value: obj.wnumber, events:{change: checkExistingWNumber}" 
									              				placeholder="e.g. 0001" required data-required-msg="required"
									              				style="width: 100%;" />
									              		<span data-bind="visible: isDuplicateWNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
													</div>
													<!-- // Group END -->
												</div>

							            	</div>
							        	</div>
								        <!-- //WATER INFO END -->

								        <!-- //ACCOUNTING INFO -->
								        <div class="tab-pane" id="tab2">
								        	<div class="row-fluid">								        		
								            	<div class="span3">
													<label for="ddlAR"><span data-bind="text: lang.lang.account_receiveable"></span> <span style="color:red">*</span></label>
													<input id="ddlAR" name="ddlAR"
														data-bind="value: obj.contact_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlRA"><span data-bind="text: lang.lang.revenue_account"></span> <span style="color:red">*</span></label>
													<input id="ddlRA" name="ddlRA"
														data-bind="value: obj.ra_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDepositAccount"><span data-bind="text: lang.lang.deposit_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDepositAccount" name="ddlDepositAccount"
														data-bind="value: obj.deposit_account_id" 
														required data-required-msg="required" style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlDiscountAccount"><span data-bind="text: lang.lang.discount_account"></span> <span style="color:red">*</span></label>
													<input id="ddlDiscountAccount" name="ddlDiscountAccount"
														data-bind="value: obj.discount_account_id" 
														required data-required-msg="required" style="width: 100%;" />	
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">
								        		<div class="span3">						
										            <label for="currency"><span data-bind="text: lang.lang.currency"></span> <span style="color:red">*</span></label>
										            <input id="currency" name="currency" 
										            	data-role="dropdownlist"
										            	data-value-primitive="true"
										                data-text-field="code"
										                data-value-field="id"
														data-bind="value: obj.currency_id, source: currencyDS"
														data-option-label="(--- Select ---)" 
														required data-required-msg="required" style="width: 100%;" />
										        </div>
								            	<div class="span3">
													<label for="ddlPaymentTerm"><span data-bind="text: lang.lang.payment_term"></span></label>
													<input id="ddlPaymentTerm" name="ddlPaymentTerm"
														data-role="dropdownlist"
														data-option-label="(--- Select ---)"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_term_id, source: paymentTermDS"														
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlPaymentMethod"><span data-bind="text: lang.lang.payment_method"></span></label>
													<input id="ddlPaymentMethod" name="ddlPaymentMethod"
														data-role="dropdownlist"
														data-option-label="(--- Select ---)"
										            	data-value-primitive="true"
										                data-text-field="name"
										                data-value-field="id"
														data-bind="value: obj.payment_method_id, source: paymentMethodDS"														
														style="width: 100%;" />
												</div>
												<div class="span3">
													<label for="ddlTaxItem"><span data-bind="text: lang.lang.vat"></span> </label>
													<input id="ddlTaxItem" name="ddlTaxItem"
														   data-role="dropdownlist"
														   data-option-label="(--- Select ---)"
										                   data-auto-bind="false"
										                   data-value-primitive="true"
										                   data-text-field="name"
										                   data-value-field="id"
										                   data-bind="value: obj.tax_item_id,
										                              source: taxDS"
										                   required data-required-msg="required"
										                   style="width: 100%;" />													
												</div>												
									        </div>

									        <div class="separator line bottom"></div>

									        <div class="row-fluid">	
										        <div class="span3">
													<label for="txtCreditLimit"><span data-bind="text: lang.lang.credit_limit"></span> </label>								              		
										            <input data-role="numerictextbox"
										                   data-format="n"
										                   data-min="0"										                   
										                   data-bind="value: obj.credit_limit"										                  
										                   style="width: 100%;">
												</div>
											</div>
							        	</div>
								        <!-- //ACCOUNTING INFO END -->

								        <!-- //GENERAL INFO -->
								        <div class="tab-pane" id="tab3">
							            	<table class="table table-borderless table-condensed cart_total">						            	
							            		<tr>
									                <td><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="customerStatus" name="customerStatus" 
									              				data-role="dropdownlist"
											            		data-text-field="name"
								           						data-value-field="id"
								           						data-value-primitive="true" 
											            		data-bind="source: statusList, value: obj.status"
											            		data-option-label="(--- Select ---)"
											            		required data-required-msg="ត្រូវការ ស្ថានភាព" />
									              	</td>							              	
									            	<td><span data-bind="text: lang.lang.register_date"></span> <span style="color:red">*</span></td>
									              	<td>
									              		<input id="registered_date" name="registered_date" 
										            		data-role="datepicker"			            		
							            					data-bind="value: obj.registered_date" 
							            					data-format="dd-MM-yyyy"
							            					data-parse-formats="yyyy-MM-dd" 
							            					placeholder="dd-MM-yyyy" required data-required-msg="required" />
									              	</td>
									            </tr>
									            <tr>
									                <td><span data-bind="text: lang.lang.gender"></span></td>
									              	<td><select data-role="dropdownlist" data-bind="source: genders, value: obj.gender"></select></td>							              	
									            	<td><span data-bind="text: lang.lang.phone"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.phone" placeholder="e.g. 012 333 444" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.family_member"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.family_member" placeholder="e.g. 3" /></td>							              	
									            	<td><span data-bind="text: lang.lang.email"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.email" placeholder="e.g. me@email.com" />
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.job"></span></td>
									                <td><input class="k-textbox" data-bind="value: obj.job" placeholder="e.g. teacher" /></td>							            	
									            	<td><span data-bind="text: lang.lang.id_card_number"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.id_number" placeholder="e.g. 123456789" /></td>
									            </tr>
									            <tr>
									            	<td><span data-bind="text: lang.lang.address"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.address" placeholder="where you live ..." />							              	
									            	<td><span data-bind="text: lang.lang.memo"></span></td>
									              	<td><input class="k-textbox" data-bind="value: obj.memo" placeholder="memo ..." /></td>
									            </tr>
									            <tr>
									            	<td>
									            		<label for="txtBillTo" data-bind="click: copyBillTo"><span data-bind="text: lang.lang.bill_to"></span> <i class="icon-share"></i></label>											            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.bill_to" placeholder="bill to ..." />
									            	</td>
									            	<td>
									            		<span data-bind="text: lang.lang.ship_to"></span>										            
									            	</td>
									            	<td>
									            		<input class="k-textbox" data-bind="value: obj.ship_to" placeholder="ship to ..." />
									            	</td>
									            </tr>									            							            							            								            								            			            
									        </table>
							        	</div>
								        <!-- //GENERAL INFO END -->

								        <!-- //CONTACT PERSON -->
								        <div class="tab-pane" id="tab4">
								        	<span class="btn btn-primary btn-icon glyphicons circle_plus" data-bind="click: addEmptyContactPerson"><i></i> <span data-bind="text: lang.lang.new_agent"></span></span>
								        	
								        	<table class="table table-bordered table-white">
										        <thead>
										            <tr>
										                <th><span data-bind="text: lang.lang.name"></span></th>
										                <th><span data-bind="text: lang.lang.department"></span></th>						                
										                <th><span data-bind="text: lang.lang.phone"></span></th>
										                <th><span data-bind="text: lang.lang.email"></span></th>
										                <th width="20px"></th>										               
										            </tr>
										        </thead>
										        <tbody data-role="listview"										        		
										        		data-auto-bind="false"										        						        		 
										        		data-template="contact-person-row-tmpl" 
										        		data-bind="source: contactPersonDS">
										        </tbody>										        						        
										    </table>
							        	</div>
								        <!-- //CONTACT PERSON END -->
								    </div>
								</div>
							</div>

							<br>											
							
							<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
							</div>
							<!-- // Form actions END -->

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wCustomer-contact-person-row-tmpl" type="text/x-kendo-tmpl">
	<tr>		
		<td>
			<input id="name" name="name" 
					type="text" class="k-textbox" 
					data-bind="value: name"
					placeholder="eg: Mr. John" 
					required="required" validationMessage="required" style="width: 190px;" />
            <span data-for="name" class="k-invalid-msg"></span>
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: department" placeholder="eg: Accounting" style="width: 190px;" />
		</td>		
		<td>
			<input type="text" class="k-textbox" data-bind="value: phone" placeholder="eg: 012 333 444" style="width: 190px;" />
		</td>
		<td>
			<input type="text" class="k-textbox" data-bind="value: email" placeholder="eg: john@email.com" style="width: 190px;" />
		</td>		
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: deleteContactPerson"><i></i></span>									
		</td>		
	</tr>
</script>

<script id="wCustomerOrder" type="text/x-kendo-template">
	<div class="container-960">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
					</div>
					
					<br>

					<h3 align="center"><span data-bind="text: lang.lang.reorder_customer"></span></h3>
					<p align="center"><span data-bind="text: lang.lang.note1"></span></p>
										
					<br>
				
					<div id="grid"></div>

					<br>

					<div class="hidden-print" align="center">
						<div data-role="notification" id="ntf1" data-width="300" data-height="50"></div>
						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok" data-bind="click: save"><i></i><span data-bind="text: lang.lang.save"></span></span>
					</div>					

				</div>
			</div>
		</div>
	</div>
</script>
<style>
    .k-grid tbody tr {
        cursor: move;
    }
</style>

<script id="wInstallment" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i><span data-bind="text: lang.lang.deprisiation"></span></h4>							        	
					    </div>
					    <div class="widget-body">
						    
			    			<input id="cbbCustomer" name="cbbCustomer" 
			    				   data-role="combobox"
				                   data-placeholder="Customer..."
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-filter="search"							                   
				                   data-min-length="3"							                   
				                   data-text-field="fullname"
				                   data-value-field="id"
				                   data-template="wInstallment-contact-combobox-template"
				                   data-bind="value: obj.contact_id,
				                              source: contactDS"
				                   required data-required-msg="ត្រូវការ Customer"
				                   style="width: 130px;" />						    			

							<br>

							<table class="table table-bordered table-condensed table-white">
								<thead>
									<tr>
										<th><span data-bind="text: lang.lang.month_of"></span></th>
										<th><span data-bind="text: lang.lang.reading"></span></th>								
										<th><span data-bind="text: lang.lang.usage"></span></th>
										<th><span data-bind="text: lang.lang.amount"></span></th>
										<th><span data-bind="text: lang.lang.reader"></span></th>
										<th><span data-bind="text: lang.lang.memo"></span></th>
										<th></th>
									</tr>
								</thead>	            		
			            		<tbody data-role="listview"
			            				data-auto-bind="false"	            					            					            					            			
						                data-template="wReading-center-tmpl"
						                data-bind="source: dataSource">
						        </tbody>
			            	</table>						   

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wInstallment-row-template" type="text/x-kendo-template">	
	<tr>		
		<td>#=kendo.toString("month", "MM-yyyy")#</td>
		<td>#=amount#</td>		
		<td>#=balance#</td>			
	</tr>
</script>
<script id="wInstallment-contact-combobox-template" type="text/x-kendo-template">	
	#=wnumber# #=fullname#
</script>

<script id="wDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i><span data-bind="text: lang.lang.deposit_receipt"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='receipt-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>																	           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>
									<tr>
						                <td><span data-bind="text: lang.lang.cheque"></span></td>						              	
						              	<td><input class="k-textbox" data-bind="value: obj.check_no" style="width:100%;" /></td>
						            </tr>
									<tr>
										<td><span data-bind="text: lang.lang.payment_method"></span></td>
										<td>
											<input id="ddlPaymentMethod" name="ddlPaymentMethod"
													data-bind="value: obj.payment_method_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>									
									<tr>
										<td><span data-bind="text: lang.lang.deposit_account"></span></td>
										<td>
											<input id="ddlDepositAccount" name="ddlDepositAccount"
													data-bind="value: obj.deposit_account_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.cash_account"></span></td>
										<td>
											<input id="ddlCashAccount" name="ddlCashAccount"
													data-bind="value: obj.account_id"
													required data-required-msg="required"  
													style="width: 100%" />										
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>

						<br>

						<!-- Item List -->
						<table class="table table-bordered table-vertical-center table-pricing table-pricing-2">
							<thead>
								<tr>									
									<th class="center"><span data-bind="text: lang.lang.item"></span></th>								
									<th class="center"><span data-bind="text: lang.lang.description"></span></th>									
									<th class="center"><span data-bind="text: lang.lang.amount"></span></th>									
								</tr>
							</thead>	            		
		            		<tbody id="lvInvoice" data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="wDeposit-row-template"
					                data-bind="source: lineDS">
					        </tbody>
		            	</table>						
						
						<!-- Lower Part -->
						<div class="row-fluid">							
							<span data-bind="text: lang.lang.memo"></span>:
							<br>
							<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:49%;" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
							<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:49%;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>																									
						</div>

						<br>						

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center" class="hidden-print">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> <span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wDeposit-row-template" type="text/x-kendo-tmpl">		
	<tr>				
		<td>
			<input id="ccbItem" name="ccbItem"
				   data-role="combobox"
				   data-auto-bind="false"                   
                   data-value-primitive="true"				   
                   data-text-field="name"
                   data-value-field="id"
                   data-bind="value: item_id, source: itemList, events: {change : itemChanges}"
                   required data-required-msg="required" style="width: 100%" />			
		</td>		
		<td>
			<input id="description" name="description" type="text"
					class="k-textbox" 
					data-bind="value: description"					 
					required data-required-msg="required"
					style="width: 100%; margin-bottom: 0;" />
		</td>			
		<td class="right">
			<input id="amount" name="amount" 
					data-role="numerictextbox" 
					data-format="c" data-culture=#:locale#
					data-bind="value: amount, events: {change : changes}" 
					required data-required-msg="required" style="width: 100%;" />						
		</td>				
    </tr>   
</script>
<script id="wDeposit-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="wDepositWitdraw" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-960">					
			<div id="example" class="k-content">

				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons notes"><i></i>
						<span data-bind="text: lang.lang.witdraw_Deposit_Receipt"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
						
						<!-- Upper Part -->
						<div class="row-fluid">
							<div class="span4">				
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.customer"></span></td>
										<td>
											<input id="cbbCustomer" name="cbbCustomer" 
							    				   data-role="combobox"
								                   data-placeholder="customer ..."
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-filter="search"							                   
								                   data-min-length="3"							                   
								                   data-text-field="fullname"
								                   data-value-field="id"
								                   data-template='receipt-contact-combobox-template'
								                   data-bind="value: obj.contact_id,
								                              source: contactDS,
								                              events:{change:contactChanges}"
								                   required data-required-msg="required"
								                   style="width: 100%" />
										</td>
									</tr>					          
									<tr data-bind="visible: isEdit">				
										<td><span data-bind="text: lang.lang.number"></span></td>
										<td><input class="k-textbox" data-bind="value: obj.number" style="width:100%;" readonly /></td>
									</tr>																	           
									<tr>
										<td colspan="2">
											<span data-bind="text: lang.lang.address"></span>
											<br>
											<textarea id="address" cols="0" rows="2" class="k-textbox" style="width: 100%;" data-bind="value: obj.bill_to"></textarea>
										</td>
									</tr>
								</table>
							</div>

						    <div class="span4">
						    	<div align="center">
						    		<span class="glyphicons standard circle_ok" data-bind="visible: paid"><i></i> <span data-bind="text: lang.lang.paid"></span></span>				    	
						    	</div>
						    </div>

							<div class="span4">
								<table class="table table-borderless table-condensed cart_total">
									<tr>
										<td><span data-bind="text: lang.lang.date"></span></td>
										<td>
											<input id="issuedDate" name="issuedDate" data-role="datepicker" 
													data-bind="value: obj.issued_date" data-format="dd-MM-yyyy" 
													required data-required-msg="required" />											
										</td>
									</tr>																									
									<tr>
										<td><span data-bind="text: lang.lang.deposit_account"></span></td>
										<td>
											<input id="ddlDepositAccount" name="ddlDepositAccount"
													data-bind="value: obj.deposit_account_id"
													required data-required-msg="required"  
													style="width: 100%" />											
										</td>
									</tr>
									<tr>
										<td><span data-bind="text: lang.lang.cash_account"></span></td>
										<td>
											<input id="ddlCashAccount" name="ddlCashAccount"
													data-bind="value: obj.account_id"
													required data-required-msg="required"  
													style="width: 100%" />										
										</td>
									</tr>						            								
								</table>           		          	
						    </div>
						</div>

						<br>

						<div class="row-fluid">
	
							<!-- Column -->
							<div class="span6">
							
								<!-- Widget -->
								<div class="widget widget-3">
								
									<!-- Widget heading -->
									<div class="widget-head">
										<h4 class="heading"><span class="glyphicons coins"><i></i></span>Witdraw Amount</h4>
									</div>
									<!-- // Widget heading END -->
									
									<div class="widget-body large">
										<span data-bind="text: total"></span>
									</div>
									
									<!-- Widget footer -->
									<div class="widget-footer align-right">
										
									</div>
									<!-- // Widget footer END -->
									
								</div>
								<!-- // Widget END -->
								
							</div>
							<!-- // Column END -->
							
							<!-- Column -->
							<div class="span6">
							
								<!-- Widget -->
								<div class="widget widget-3">
								
									<!-- Widget heading -->
									<div class="widget-head">
										<h4 class="heading"><span class="glyphicons pencil"><i></i></span><span data-bind="text: lang.lang.memo"></span></h4>
									</div>
									<!-- // Widget heading END -->
									
									<div class="widget-body">
										<textarea id="memo" cols="0" rows="2" class="k-textbox" style="width:95%;" data-bind="value: obj.memo" placeholder="memo for customer ..."></textarea>
										<textarea id="memo2" cols="0" rows="2" class="k-textbox" style="width:95%;" data-bind="value: obj.memo2" placeholder="memo for internal ..."></textarea>	
									</div>
									
								</div>
								<!-- // Widget END -->
								
							</div>
							<!-- // Column -->							
							
						</div>						

						<br>						

						<!-- Buttons -->
						<div class="row-fluid">
				          	<!-- Form actions -->
							<div align="center">
								<span id="notification"></span>

								<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
								<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
								<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								<span class="btn btn-primary btn-icon glyphicons print" data-bind="click: linkPrint, visible: isEdit"><i></i> <span data-bind="text: lang.lang.print"></span></span>
							</div>
							<!-- // Form actions END -->
						</div>						

					</div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->

			</div>							
		</div>
	</div>
</script>
<script id="wDepositWitdraw-contact-combobox-template" type="text/x-kendo-template">	
	#=number# #=fullname#
</script>

<script id="wMeter" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i>
							<span data-bind="text: lang.lang.meter"></span></h4>							        	
					    </div>
					    <div class="widget-body">

						    <div class="row-fluid">
						    		<div class="span6">
						    			<h5 class="heading-arrow" style="font-size: small;"><span data-bind="text: lang.lang.number1"></span> <span data-bind="text: obj.number"></span> </h5>
						    			
						    			<input id="cbbCustomer" name="cbbCustomer" 
						    				   data-role="combobox"
							                   data-placeholder="customer ..."
							                   data-auto-bind="false"
							                   data-value-primitive="true"
							                   data-filter="search"							                   
							                   data-min-length="3"							                   
							                   data-text-field="fullname"
							                   data-value-field="id"
							                   data-template="wMeter-contact-combobox-template"
							                   data-bind="value: obj.contact_id,
							                              source: contactDS, events:{change: contactChanges}"
							                   required data-required-msg="ត្រូវការ Customer"
							                   style="width: 100%" />
						    			
						    			<br><br>

						    			<div class="row-fluid">
						    				<div class="span6">
								    			<label><span data-bind="text: lang.lang.deposit"></span> </label>
												<a data-bind="attr:{ href: deposit_link }"><span data-bind="text: obj.deposit[0].number"></span></a>
								    			|
								    			<span data-bind="text: deposit_amount"></span>
											</div>
											<div class="span6">
								    			<label><span data-bind="text: lang.lang.service2"></span> </label>
								    			<a data-bind="attr:{ href: invoice_link }"><span data-bind="text: obj.invoice[0].number"></span></a>
								    			|
								    			<span data-bind="text: invoice_amount"></span>
											</div>
										</div>

										<br>

						    			<div class="row-fluid">
						    				<div class="span6">
								    			<label for="latitute"><span data-bind="text: lang.lang.latitute"></span> </label>
												<div class="input-prepend">
													<span class="add-on glyphicons direction"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.latitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>
											<div class="span6">
								    			<label for="longtitute"><span data-bind="text: lang.lang.longtitute"></span> </label>
								    			<div class="input-prepend">
													<span class="add-on glyphicons google_maps"><i></i></span>
													<input type="text" class="input-large span12" data-bind="value: obj.longtitute, events:{change: loadMap}" placeholder="012345.67897">
												</div>
											</div>
										</div>

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.memo"></span></label>
											<div class="controls">
												<input class="k-textbox" 
						                  				data-bind="value: obj.memo"
						                  				style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->
										
										<div id="map" style="width: 450px; height: 250px;"></div>
						    		</div>

							    	<!-- Right Span -->
							    	<div class="span6">

							    		<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.location"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="ddlLocation" name="ddlLocation"
													   data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="true"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.location_id, source: locationDS"
									                   required data-required-msg="required"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.type1"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterType" name="meterType"
													   data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.item_id, source: itemDS"
									                   required data-required-msg="required"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->										

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.number2"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterNo" name="meterNo" class="k-textbox" 
						                  				data-bind="value: obj.number, events:{change:checkExistingNumber}" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />
						                  		<span data-bind="visible: isDuplicateNumber" style="color: red;"><span data-bind="text: lang.lang.duplicate_number"></span></span>
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.startup_reading"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="txtStarupReading" name="txtStarupReading" class="k-textbox" 
						                  				data-bind="value: obj.startup_reading" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />						                  		
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.number_of_digits"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="maxNo" name="maxNo" 
						                  				data-role="numerictextbox" 
						                  				data-bind="value: obj.max_number" 
						                  				data-format="n0" min="0" 
						                  				placeholder="ឧ.10,000/100,000" 
						                  				required data-required-msg="required"
						                  				style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.status"></span> <span style="color:red">*</span></label>
											<div class="controls">
												<input id="meterStatus" name="meterStatus"
						                  				data-role="dropdownlist"
						                  				data-value-primitive="true"													
						                  				data-text-field="name" 
						                  				data-value-field="id"				                  						                  				
						                  				data-bind="source: statusList, value: obj.status"
						                  				data-option-label="(--- Select ---)"
														required data-required-msg="required"
														style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->									
										
										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.tariff"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"				                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.tariff_id, source: tariffList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.exemption"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"			                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.exemption_id, source: exemptionList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

										<!-- Group -->
										<div class="control-group">
											<label class="control-label"><span data-bind="text: lang.lang.maintenance"></span> </label>
											<div class="controls">
												<input data-role="dropdownlist"
						                  			   data-option-label="(--- Select ---)"			                  			   
									                   data-auto-bind="false"
									                   data-value-primitive="true"
									                   data-text-field="name"
									                   data-value-field="id"
									                   data-bind="value: obj.maintenance_id, source: maintenanceList"
									                   style="width: 100%;" />
											</div>
										</div>
										<!-- // Group END -->

									</div>
									<!-- End Right Span -->

							</div>

							<br>

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wMeter-row-template" type="text/x-kendo-template">	
	<tr>		
		<td>#=number#</td>
		<td>#=item_name#</td>		
		<td>			
			<div>#=tariffs.name!==undefined?tariffs.name:""#</div>
			<div>#=exemptions.name!==undefined?exemptions.name:""#</div>
			<div>#=maintenances.name!==undefined?maintenances.name:""#</div>
		</td>
		<td>
			#if(reactive_of>0){#
				REACTIVE
			#}else if(backup_of>0){#
				BACKUP
			#}else{#
				
			#}#
		</td>
		<td>#:status==1 ? "Active" : "Inactive"#</td>
		<td align="center">            
			<span class="glyphicons no-js delete" data-bind="click: delete"><i></i></span>
			<span class="glyphicons no-js edit" data-bind="click: edit"><i></i></span>						
		</td>		
	</tr>
</script>
<script id="wMeter-contact-combobox-template" type="text/x-kendo-template">	
	#=wnumber# #=fullname#
</script>

<script id="wReadingCenter" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid"> 				
				
				<!-- Collapsible Widget -->			
				<div class="widget">
				    <div class="widget-head">
				    	<span class="btn btn-primary pull-right" 
								onclick="javascript:window.history.back()">X</span>
				        
				        <h4 class="heading glyphicons dashboard"><i></i><span data-bind="text: lang.lang.meter_reading"></span></h4>							        	
				    </div>
				    <div class="widget-body">					
				
			            <div class="hidden-print">	            							            	
			            	<input data-role="combobox"
				                   data-placeholder="number..."
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-filter="contains"							                   
				                   data-min-length="3"							                   
				                   data-text-field="number"
				                   data-value-field="id"
				                   data-bind="value: meter_id,
				                              source: meterDS"
				                   style="width: 300px;" />

				            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
			            </div>

			            <br>

			            <table class="table table-bordered table-condensed table-white">
							<thead>
								<tr>
									<th><span data-bind="text: lang.lang.month"></span></th>
									<th><span data-bind="text: lang.lang.reading"></span></th>								
									<th><span data-bind="text: lang.lang.usage"></span></th>
									<th><span data-bind="text: lang.lang.amount"></span></th>
									<th><span data-bind="text: lang.lang.reader"></span></th>
									<th><span data-bind="text: lang.lang.memo"></span></th>
									<th></th>
								</tr>
							</thead>	            		
		            		<tbody data-role="listview"
		            				data-auto-bind="false"	            					            					            					            			
					                data-template="wReading-center-tmpl"
					                data-bind="source: dataSource">
					        </tbody>
		            	</table>			    

					    <div data-role="pager" 
					    	data-auto-bind="false"
				            data-bind="source: dataSource"></div>

				    </div> <!-- End Widget-Body List -->
				</div>
				<!-- // Collapsible Widget END -->			   		        
				          
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wReading-center-tmpl" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=kendo.toString(new Date(month_of), "MM-yyyy")#</td>		
		<td class="right">#=current#</td>
		<td class="right">#=usage#</td>
		<td></td>		
		<td></td>		
		<td>#=memo#</td>
		<td class="center">
			#var i = banhji.wReadingCenter.dataSource.indexOf(data);#			
			#if(i==0){#														
				<a href="\#/wEdit_reading/#=id#" class="btn-action glyphicons pencil btn-success"><i></i></a>
			#}#			
		</td>	
    </tr>
</script>
<script id="wEditReading" type="text/x-kendo-template">
	<div class="container-960">	
		<div class="row-fluid">		    
			<div class="span12">			
				<div id="example" class="k-content">					

					<!-- Collapsible Widget -->			
					<div class="widget">
					    <div class="widget-head">
					    	<span class="btn btn-primary pull-right" 
									onclick="javascript:window.history.back()">X</span>
					        
					        <h4 class="heading glyphicons dashboard"><i></i>Edit Reading</h4>							        	
					    </div>
					    <div class="widget-body">

					    	<div class="box-generic">					    	

						    	<div class="row-fluid">
									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="registered_date">Date <span style="color:red">*</span></label>
					              			<input id="registered_date" name="registered_date" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.month_of" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtFromDate">From <span style="color:red">*</span></label>
					              			<input id="txtFromDate" name="txtFromDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.from_date" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="from ..." style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtToDate">To <span style="color:red">*</span></label>
					              			<input id="txtToDate" name="txtToDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: obj.to_date" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" required data-required-msg="required" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="strPrevious">Previouse</label>
					              			<span id="strPrevious" name="strPrevious" data-bind="text: obj.previous"></span>
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtCurrent">Current <span style="color:red">*</span></label>
					              			<input id="txtCurrent" name="txtCurrent" 
					              				   data-role="numerictextbox"
								                   data-format="n0"								                   
								                   data-bind="value: obj.current, events:{change: readingChanges}"
								                   required data-required-msg="required" style="width: 100%;">
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span2">	
										<!-- Group -->
										<div class="control-group">							
											<label for="strUsage">Usage</label>
					              			<span id="strUsage" name="strUsage" data-bind="text: obj.usage"></span>
										</div>
										<!-- // Group END -->											
									</div>
								</div>

								<div class="row-fluid">
									<div class="span4">	
										<!-- Group -->
										<div class="control-group">							
											<label for="ddlReader">Reader <span style="color:red">*</span></label>
					              			<input id="ddlReader" name="ddlReader"
					              				   data-role="dropdownlist"
								                   data-auto-bind="false"
								                   data-value-primitive="true"
								                   data-text-field="name"
								                   data-value-field="id"
								                   data-bind="value: obj.read_by, source: readerDS"
								                   data-option-label="(--- Select ---)"	style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>

									<div class="span8">	
										<!-- Group -->
										<div class="control-group">							
											<label for="txtMemo">Memo </label>
					              			<input id="txtMemo" class="k-textbox" data-bind="value: obj.memo" style="width: 100%;" />
										</div>
										<!-- // Group END -->											
									</div>
								</div>

					    	</div>

					    	<div class="well" data-bind="visible: hasInvoice">
								<table class="table table-invoice">
									<tbody>
										<tr>
											<td>Number</td>
											<td class="right">
												<input id="txtNumber" name="txtNumber"
												   type="text" class="k-textbox" 					              				  					                   
								                   data-bind="value: invoice.number, enabled: hasInvoice"
								                   required data-required-msg="required" style="width: 170px;" />
											</td>
											<td width="30%"></td>
											<td>Billing Date</td>
											<td class="right">												
												<input id="txtIssuedDate" name="txtIssuedDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.issued_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>											
										</tr>
										<tr>
											<td>Month Of</td>
											<td class="right">												
												<input id="txtMonthOf" name="txtMonthOf" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.month_of, enabled: hasInvoice" 
					            					data-format="MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="MM-yyyy" 
					            					required data-required-msg="required" />
											</td>
											<td width="30%"></td>
											<td>Payment Date</td>
											<td class="right">												
												<input id="txtPaymentDate" name="txtPaymentDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.payment_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>											
										</tr>
										<tr>
											<td></td>
											<td></td>
											<td width="30%"></td>
											<td>Due Date</td>
											<td class="right">												
												<input id="txtDueDate" name="txtDueDate" 
								            		data-role="datepicker"			            		
					            					data-bind="value: invoice.due_date, enabled: hasInvoice" 
					            					data-format="dd-MM-yyyy"
					            					data-parse-formats="yyyy-MM-dd" 
					            					placeholder="dd-MM-yyyy" 
					            					required data-required-msg="required" />
											</td>
										</tr>										
									</tbody>
								</table>

								<table class="table table-bordered table-condensed table-white">
									<thead>
										<tr>
											<th>Description</th>
											<th>Qty</th>								
											<th>Price</th>
											<th>Amount</th>											
										</tr>
									</thead>	            		
				            		<tbody data-role="listview"
				            				data-auto-bind="false"	            					            					            					            			
							                data-template="wInvoice-line-wEdit-reading-center-tmpl"
							                data-bind="source: invoiceLineDS">
							        </tbody>					        		
				            	</table>

							</div>

							<br>

							<div class="row-fluid">
					          	<!-- Form actions -->
								<div align="center">
									<span id="notification"></span>

									<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i>Save</span>
									<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i>Delete</span>
									<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i>Cancel</span>
								</div>
								<!-- // Form actions END -->
							</div>

						</div> <!-- End Widget-Body List -->
					</div>
					<!-- // Collapsible Widget END -->				          					                
			    											
				</div> <!-- // End div example-->  
			</div> <!-- // End div span12-->
		</div> <!-- // End div row-fluid-->	
	</div> 	
</script>
<script id="wInvoice-line-wEdit-reading-center-tmpl" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=description#</td>				
		<td class="right">
			#if(type=="tariff"){#
				#=unit#
			#}#
		</td>
		<td class="right">
			#if(type=="tariff"){#
				#=kendo.toString(price, "c0", locale)#
			#}#
		</td>				
		<td class="right">
			#if(type=="tariff"){#
				#=kendo.toString(amount, "c0", locale)#
			#}#
		</td>			
    </tr>
</script>

<script id="wReading" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.reading1"></span></h3>					
					
		            <div class="box-generic">
		            	<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="MM-yyyy" />						
										
						<input id="ddlBranch" data-bind="value: branch_id" />						                
			            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
		            	|						            	
		            	<input data-role="combobox"
			                   data-placeholder="number ..."
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-filter="contains"							                   
			                   data-min-length="3"							                   
			                   data-text-field="number"
			                   data-value-field="id"
			                   data-bind="value: meter_id,
			                              source: meterDS" />
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> 		          								          		
		            </div>						        

			        <div align="center">
			        	<h3 data-bind="text: strMonthOf"</h3>
			        	<h4 data-bind="text: strTransformer"></h4>
			        </div>
			        
			        <div class="demo-section">			        
					    <table class="table table-bordered table-striped table-white">
					        <thead>
					            <tr>
					                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
					                <th><span data-bind="text: lang.lang.meter2"></span></th>					                
					                <th><span data-bind="text: lang.lang.new_round"></span></th>
					                <th><span data-bind="text: lang.lang.previouse"></span></th>
					                <th><span data-bind="text: lang.lang.current"></span></th>					                
					                <th class="right"><span data-bind="text: lang.lang.total"></span></th>
					            </tr>
					        </thead>
					        <tbody data-role="listview"
					        		data-auto-bind="false"					        		 
					        		data-template="wReading-row-template" 
					        		data-bind="source: dataSource"></tbody>
					        <tfoot data-template="wReading-footer-template" 
					        		data-bind="source: this"></tfoot>						        
					    </table>

					    <div id="pager" class="k-pager-wrap"
					    	 data-auto-bind="false"
				             data-role="pager" data-bind="source: dataSource"></div>
					    
				    </div>				       
			        
					<br>					

			        <div>			        	
						<span data-bind="text: lang.lang.month"></span>
			        	<input id="monthOf" name="monthOf" data-role="datepicker" 
				            			data-bind="value: month_of" 
				            			data-start="year" data-depth="year" data-format="MM-yyyy"
				            			required data-required-msg="required"
				            			placeholder="MM-yyyy" />				    	
				    	
						<span data-bind="text: lang.lang.from"></span>
                        <input type="text" data-role='datepicker' 
                        		id="fromDate" name="fromDate"
                        		data-bind="value: from_date"	            				
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="required"  />			            
			            
						<span data-bind="text: lang.lang.to"></span>
                        <input type="text" data-role='datepicker' 
                        		id ="toDate" name="toDate"
                        		data-bind="value: to_date"	            				 
                        		data-type="date" data-format="dd-MM-yyyy"
                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
                        		required data-required-msg="ដល់ថ្ងៃណា?" 
                        		data-greaterdate-field="fromDate" 
                        		data-greaterdate-msg='ត្រូវថ្មីជាង ថ្ងៃអានចាប់ពី' />                        
			            			        	
						<span data-bind="text: lang.lang.reader"></span>
			          	<input data-role="dropdownlist"
			                   data-option-label="(--- Select ---)"
			                   data-value-primitive="true"
			                   data-text-field="fullname"
			                   data-value-field="id"
			                   data-bind="value: read_by, source: readerDS"
			                   required data-required-msg="required" />            
			        </div>
			        
			        <br>

			        <!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>						
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->

				</div> <!-- //End div example-->
			</div> <!-- //End div row-fluid-->
		</div>
	</div>
</script>
<script id="wReading-row-template" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=fullname#</td>		
		<td>#=number#</td>		
		<td align="center">
			<input type="checkbox" data-bind="checked: new_round, events:{ change: onChange }" />
		</td>		
		<td>
			<input data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: previous, events:{ change: onChange }"
                   style="width: 100px" #=previous>0?disabled='disabled':''# />
		</td>
		<td>
			<input class="txt#=index#" data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: current, events:{ change: onChange }"                   
                   style="width: 100px" />            
			<span class="label label-important" data-bind="invisible: isValid"><strong>Invalid!</strong></span>			
		</td>		
		<td class="right" data-bind="text: usage"></td>	
    </tr>
</script>
<script id="wReading-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">            
			<span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wIRReader" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
					<div id="example" class="k-content">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<h3><span data-bind="text: lang.lang.ir_reader"></span></h3>				    
					   
			            <div class="box-generic">
			            	<input id="myFile" type="file" accept="text/csv">
			            	<button type="button" class="k-button btn-info" data-bind="click: readFile">
							<span data-bind="text: lang.lang.upload"></span></button>		            	
			            	<br>
							<span data-bind="text: uploadStatus"></span>
			            </div>			        
				        
				        <div class="demo-section">			        
						    <table class="table table-bordered table-striped table-white">
						        <thead>
						            <tr>
						                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
						                <th><span data-bind="text: lang.lang.meter2"></span></th>					                
						                <th><span data-bind="text: lang.lang.new_round"></span></th>
						                <th><span data-bind="text: lang.lang.previouse"></span></th>
						                <th><span data-bind="text: lang.lang.current"></span></th>					                
						                <th class="right"><span data-bind="text: lang.lang.total"></span></th>
						            </tr>
						        </thead>
						        <tbody data-role="listview"
						        		data-auto-bind="false"					        		 
						        		data-template="wIRReader-row-template" 
						        		data-bind="source: dataSource"></tbody>
						        <tfoot data-template="wIRReader-footer-template" 
						        		data-bind="source: this"></tfoot>						        
						    </table>

						    <div id="pager" class="k-pager-wrap"
						    	 data-auto-bind="false"
					             data-role="pager" data-bind="source: dataSource"></div>
						    
					    </div>				       
				        
						<br>					

				        <div>			        	
							<span data-bind="text: lang.lang.month"></span>
				        	<input id="monthOf" name="monthOf" data-role="datepicker" 
			            			data-bind="value: month_of" 
			            			data-start="year" data-depth="year" data-format="MM-yyyy"
			            			required data-required-msg="ត្រូវការ Month Of"
			            			placeholder="ខែ-ឆ្នាំ" />					    	
					    	
							<span data-bind="text: lang.lang.from"></span>
	                        <input type="text" data-role='datepicker' 
	                        		id="fromDate" name="fromDate"
	                        		data-bind="value: from_date"	            				
	                        		data-type="date" data-format="dd-MM-yyyy"
	                        		placeholder="ថ្ងៃ-ខែ-ឆ្នាំ"
	                        		required data-required-msg="ត្រូវការ ថ្ងៃអានចាប់ពី"  />                        	    				        
				            
				            
							<span data-bind="text: lang.lang.to"></span>
	                        <input type="text" data-role='datepicker' 
	                        		id ="toDate" name="toDate"
	                        		data-bind="value: to_date"	            				 
	                        		data-type="date" data-format="dd-MM-yyyy"
	                        		placeholder="dd-MM-yyyy"
	                        		required data-required-msg="required" 
	                        		data-greaterdate-field="fromDate" 
	                        		data-greaterdate-msg="required" />			            			        
				        	
							<span data-bind="text: lang.lang.reader"></span>
				          	<input data-role="dropdownlist"
				                   data-option-label="(--- Select ---)"
				                   data-value-primitive="true"
				                   data-text-field="fullname"
				                   data-value-field="id"
				                   data-bind="value: read_by, source: readerDS"
				                   required data-required-msg="required" />            
				        </div>
				        
				        <br>

				        <!-- Form actions -->
						<div align="center">
							<span id="notification"></span>

							<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>						
							<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
						</div>
						<!-- // Form actions END -->

					</div> <!-- //End div example-->            
				</div> <!-- //End div span12-->		
			</div> <!-- //End div row-fluid-->
		</div>
	</div>
</script>
<script id="wIRReader-row-template" type="text/x-kendo-tmpl">
	<tr>					
		<td>#=fullname#</td>		
		<td>#=number#</td>		
		<td align="center">
			<input type="checkbox" data-bind="checked: new_round, events:{ change: onChange }" />
		</td>		
		<td>
			<input data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: previous, events:{ change: onChange }"
                   style="width: 100px" #=previous>0?disabled='disabled':''# />
		</td>
		<td>
			<input class="txt#=index#" data-role="numerictextbox"
				   data-min="0"
				   data-format="n0"                                      
                   data-bind="value: current, events:{ change: onChange }"                   
                   style="width: 100px" />            
			<span class="label label-important" data-bind="invisible: isValid"><strong>invalid!</strong></span>			
		</td>		
		<td class="right" data-bind="text: usage"></td>	
    </tr>
</script>
<script id="wIRReader-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">            
			<span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wReadingBook" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
					<div id="example" class="k-content">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<h3><span data-bind="text: lang.lang.reading_book"></span></h3>					
						
			            <div class="box-generic">										
							<input id="ddlBranch" data-bind="value: branch_id" />						                
				            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />		            	
			          		
			          		<button id="search" type="button" data-role="button"><i class="icon-search"></i></button>						          		
			            </div>			        
				        
				        <div id="grid"></div>
				        
					</div> <!-- //End div example-->            
				</div> <!-- //End div span12-->		
			</div> <!-- //End div row-fluid-->
		</div>
	</div>
</script>

<script id="wInvoice" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3><span data-bind="text: lang.lang.invoice"></span></h3>

					<br>
					
					<div class="hidden-print">
						<input data-role="datepicker" 
		            			data-bind="value: monthOfSearch" 
		            			data-start="year" data-depth="year" 
		            			data-format="MM-yyyy" placeHolder="Month Of" />						
										
						<input id="ddlBranch" data-bind="value: branch_id" />						                
			            <input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
		            	|						            	
		            	<input data-role="combobox"
			                   data-placeholder="number ..."
			                   data-auto-bind="false"
			                   data-value-primitive="true"
			                   data-filter="contains"							                   
			                   data-min-length="3"							                   
			                   data-text-field="number"
			                   data-value-field="id"
			                   data-bind="value: meter_id,
			                              source: meterDS" />
		          					          					          			          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>								
					</div>											

					<br>
					
					<table class="table table-bordered table-striped table-white">
				        <thead>
				            <tr>
				                <th><input type="checkbox" data-bind="checked: chkAll, events: {change : checkAll}" /></th>				                				                
				                <th><span data-bind="text: lang.lang.customer"></span></th>					                
				                <th><span data-bind="text: lang.lang.meter"></span></th>				                			                
				                <th><span data-bind="text: lang.lang.previouse"></span></th>
				                <th><span data-bind="text: lang.lang.current"></span></th>
				                <th><span data-bind="text: lang.lang.total"></span></th>	                    
				            </tr>
				        </thead>
				        <tbody data-role="listview" 
				        		data-template="wInvoice-row-template" 
				        		data-auto-bind="false" 
				        		data-bind="source: readingDS"></tbody>
				        <tfoot data-template="wInvoice-footer-template" 
					        		data-bind="source: this"></tfoot>	            
				    </table>
				    
				    <div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: readingDS"></div>

				    <br>
				    
				    <div>
						<span data-bind="text: lang.lang.month"></span>
						<input id="monthOf" name="monthOf" data-role="datepicker" 
		            			data-bind="value: month_of"	data-start="year" 
		            			data-depth="year" data-format="MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.billing_date"></span>
				        <input id="issuedDate" name="issuedDate" data-role="datepicker" 
		            			data-bind="value: issued_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.payment_date"></span>
				        <input id="paymentDate" name="paymentDate" data-role="datepicker" 
		            			data-bind="value: payment_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />
				        <span data-bind="text: lang.lang.due_date"></span>
				        <input id="dueDate" name="dueDate" data-role="datepicker" 
		            			data-bind="value: due_date" data-format="dd-MM-yyyy"
		            			required data-required-msg="required" />			           	          	
				    </div>
				         
				    <br />				    
				    
		          	<!-- Form actions -->
					<div align="center">
						<span id="notification"></span>

						<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>							
						<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
					</div>
					<!-- // Form actions END -->					

				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->
	</div>	
</script>
<script id="wInvoice-row-template" type="text/x-kendo-tmpl">
	<tr>
		<td align="center">
		   <input type="checkbox" data-bind="checked: isCheck" />
		</td>						
		<td>#=customer[0].surname# #=customer[0].name#</td>		
		<td><a href="\#/wReading_center/#=meter_id#"><i></i> #=meter[0].number#</a></td>								
		<td class="right">#=previous#</td>
		<td class="right">#=current#</td>		
		<td class="right">#=usage# m<sup>3</sup></td>		
    </tr>
</script>
<script id="wInvoice-footer-template" type="text/x-kendo-template">
    <tr>    	
        <td class="right" colspan="8" style="font-size:30px;">
            <span data-bind="text: lang.lang.total"></span>: #:total()# m<sup>3</sup>
        </td>
    </tr>
</script>

<script id="wPrintCenter" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
				<div id="example" class="k-content">
					<span class="pull-right glyphicons no-js remove_2 hidden-print" 
						onclick="javascript:window.history.back()"><i></i></span>

					<h3 class="hidden-print"><span data-bind="text: lang.lang.print1"></span></h3>
					
					<br>
					
					<table>
						<tr>
							<td>								
								<input data-role="datepicker" 
			            			data-bind="value: monthOfSearch" 
			            			data-start="year" data-depth="year" 
			            			data-format="MM-yyyy" placeHolder="MM-yyyy" />						
								
								<input data-role="dropdownlist"
								   data-option-label="(--- License ---)"
				                   data-auto-bind="false"
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: branch_id,
				                              source: branchDS,			                              
				                              events: {
				                                change: branchChanges
				                              }"/>
				            </td>
				            <td>
				                <select data-role="multiselect"
						           data-placeholder="Location..."
						           data-value-primitive="true"
						           data-text-field="name"
						           data-value-field="id"
						           data-bind="value: selectedLocations,
						                      source: locationDS,
						                      enabled: isBranchSelected"
						           style="width: 200px;" 
						    	></select>
						    </td>
						    <td>							
				            	|						            	
				            	<input data-role="combobox"
					                   data-placeholder="number ..."
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-filter="startswith"							                   
					                   data-min-length="3"							                   
					                   data-text-field="number"
					                   data-value-field="id"
					                   data-bind="value: invoice_id,
					                              source: invoiceDS" />

					            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
								<button type="button" data-role="button" data-bind="click: print"><i class="icon-print"></i></button>
							</td>
						</tr>
					</table>

		            <br>

		            <div class="row-fluid">							
						<div class="span2">
						
							<!-- Stats Widget -->
							<span class="widget-stats widget-stats-gray widget-stats-2">
								<span class="count"><a data-bind="text: obj.totalInvoice"></a></span>
								<span class="txt"><span data-bind="text: lang.lang.total_invoice"></span></span>
							</span>
							<!-- // Stats Widget END -->
							
						</div>
						<div class="span2">
						
							<!-- Stats Widget -->
							<span class="widget-stats widget-stats-2">
								<span class="count"><a data-bind="text: obj.totalUnprint"></a></span>
								<span class="txt"><span data-bind="text: lang.lang.no_print"></span></span>
							</span>
							<!-- // Stats Widget END -->
							
						</div>
						<div class="span2">
						
							<!-- Stats Widget -->
							<span class="widget-stats widget-stats-gray widget-stats-2">
								<span class="count"><a data-bind="text: obj.totalUsage"></a></span>
								<span class="txt">m<sup>3</sup></span>
							</span>
							<!-- // Stats Widget END -->
							
						</div>
						<div class="span6">
						
							<!-- Stats Widget -->
							<span class="widget-stats widget-stats-2">
								<span class="count"><a data-format="c0" data-bind="text: obj.totalAmount"></a></span>
								<span class="txt"><span data-bind="text: lang.lang.amount1"></span></span>
							</span>
							<!-- // Stats Widget END -->
							
						</div>							
					</div>					

		            <br>

		            <table class="table table-bordered table-striped table-white">
				        <thead>
				            <tr>
				            	<th style="width: 5%;" class="center">
				            		<input type="checkbox" data-bind="checked: chkAll, events: {change : checkAll}" />
				            	</th>					                
				                <th><span data-bind="text: lang.lang.customer"></span></th>					                						                
				                <th><span data-bind="text: lang.lang.number"></span></th>					                
				                <th><span data-bind="text: lang.lang.amount"></span></th>
				                <th><span data-bind="text: lang.lang.status"></span></th>
				                <th><span data-bind="text: lang.lang.print_count"></span></th>					                					                
				            </tr>
				        </thead>
				        <tbody data-role="listview"
			        		data-auto-bind="false"					        		 
			        		data-template="wPrint-center-template" 
			        		data-bind="source: dataSource"></tbody>					        						        
				    </table>

		            <div data-role="pager" 
				    	data-auto-bind="false"
				    	data-page-sizes='[50, 100, 200, "All"]'					    	
			            data-bind="source: dataSource"></div>																	
		
				</div><!-- //End div example-->
			</div>
		</div>
	</div>	
</script>
<script id="wPrint-center-template" type="text/x-kendo-tmpl">
	<tr>
		<td class="center">
			<input type="checkbox" data-bind="checked: isCheck" />
		</td>		
		<td>
			#=contact[0].wnumber# 

			#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
				#=contact[0].company# 
			#}else{#
				#=contact[0].surname# #=contact[0].name#
			#}#
		</td>
		<td>
			<a href="\#/wInvoice_print/#=id#"><i></i> #=number#</a>
		</td>
		<td class="right">#=kendo.toString(amount, "c0", banhji.institute.locale)#</td>
		<td>
			#if(status==0){#
				Open
			#}else{#
				Paid
			#}#
		</td>
		<td class="center">#=print_count#</td>
	</tr>
</script>
<script id="wInvoicePrint" type="text/x-kendo-template">
	<div class="container-960">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="glyphicons no-js remove_2 pull-right" 
								onclick="javascript:window.history.back()"><i></i></span>

							<span class="btn btn-inverse btn-icon glyphicons print" data-bind="click: print"><i></i><span data-bind="text: lang.lang.print"></span></span>											          																
						</div>

						<br>					
						
						<div data-role="listview" 
							data-auto-bind="false"
							data-bind="source: dataSource" 
							data-template="wInvoice-print-row-template1"></div>						
			
					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wInvoice-print-row-template" type="text/x-kendo-tmpl">	
  	<div class="container-960">
		<table width="100%">
			<tr>
				<td valign="top">
					<img src="/banhji/#:company[0].image_url#" height="90" width="60" style="float: left">
				</td>
				<td align="center">
					<h4>#:company[0].name#</h4>					
					<h5>#:company[0].address# 
					<br>
					#:company[0].phone#</h5>					
				</td>
			</tr>
		</table>		

		<table width="100%">
			<tr>
				<td align="center" rowspan="2" width="60%">
					<h4>វិក្កយបត្រទូទាត់ថ្លៃទឹក</h4>
					<h5><span data-bind="text: lang.lang.month_of"></span> #=kendo.toString(new Date(month_of), "MM-yyyy")#</h5>
				</td>
				<td>ថ្ងៃចេញវិក្កយបត្រ</td>
				<td align="right">
					#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#					
				</td>
			</tr>
			<tr>
				<td><span data-bind="text: lang.lang.invoice_number"></span></td>
				<td align="right">					
					#=number#
				</td>				
			</tr>			
		</table>

		<table width="100%">
			<tr>
				<td width="60%">
					<span data-bind="text: lang.lang.full_names"></span> 
					<span class="strong">
						#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
							#=contact[0].company#
						#}else{#
							#=contact[0].surname# #=contact[0].name#
						#}#
					</span>
				</td>
				<td><span data-bind="text: lang.lang.customer_number"></span>:</td>
				<td align="right">#=contact[0].number#</td>				
			</tr>
			<tr>
				<td><span data-bind="text: lang.lang.address"></span> #=contact[0].address#</td>				
				<td><span data-bind="text: lang.lang.location"></span></td>
				<td align="right">#=location[0].name#</td>				
			</tr>
		</table>

		<table class="table table-bordered table-condensed">
			<thead>
				<tr>
					<th><span data-bind="text: lang.lang.meter2"></span></th>					
					<th><span data-bind="text: lang.lang.previouse"></span></th>
					<th><span data-bind="text: lang.lang.current"></span></th>
					<th>បរិមាណ</th>
					<th>តំលៃឯកត្តា</th>
					<th><span data-bind="text: lang.lang.amount"></span></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td></td>
					#for(var j=0; j<invoiceLines.length; j++) {#
						#if(invoiceLines[j].type=="tariff"){#
							<td class="center">#=kendo.toString(new Date(invoiceLines[j].record[0].from_date), "dd-MM-yyyy")#</td>
							<td class="center">#=kendo.toString(new Date(invoiceLines[j].record[0].to_date), "dd-MM-yyyy")#</td>						
						#}#
					#}#	
					<td class="right">m<sup>3</sup></td>
					<td></td>
					<td></td>
				</tr>
				#for(var i=0; i<invoiceLines.length; i++) {#
					#if(invoiceLines[i].type=="tariff"){#
						<tr>
							<td>#:invoiceLines[i].meter[0].number#</td>
							<td class="right">#:invoiceLines[i].record[0].previous#</td>
							<td class="right">#:invoiceLines[i].record[0].current#</td>						
							<td class="right">#:kendo.toString(kendo.parseInt(invoiceLines[i].unit), 'n0')#</td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].price)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
						</tr>
					#}else{#
						<tr>
							<td colspan="3"></td>							
							<td colspan="2" class="right">#:invoiceLines[i].description#</td>
							#if(invoiceLines[i].type=="exemptionUsage"){#
								<td class="right">#:invoiceLines[i].amount# ម<sup>៣</sup></td>							
							#}else{#
								<td class="right">#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
							#}#
						</tr>
					#}#
				#}#						
				<tr>
					<td colspan="3" rowspan="2" class="center strong" style="font-size: medium;">
						ថ្ងៃផុតកំណត់បង់ប្រាក់ 
						<br> 
						#=kendo.toString(new Date(due_date), "dd-MM-yyyy")#
					</td>									
					<td class="right" colspan="2">បំណុលខែមុន</td>					
					<td class="right">#:kendo.toString(balance_forward*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>										
					<td class="right strong" colspan="2">ទឹកប្រាក់ត្រូវបង់សរុប</td>					
					<td class="right strong">#:kendo.toString(total*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>
					<td class="center" colspan="2">ថ្ងៃដែលបានបង់</td>					
					<td></td>					
					<td class="right" colspan="2">ទឹកប្រាក់ដែលបានបង់</td>					
					<td></td>
				</tr>
				<tr>
					<td colspan="6" class="top" style="font-size: x-small;" height="100px">
						#=company[0].term_of_condition#
					</td>
				</tr>
			</tbody>
		</table>

		<hr>

		<table width="100%">
			<tr>
				<td rowspan="2" width="40%">
					<span id="#=contact[0].wnumber#"></span>
				</td>
				<td align="left" class="strong">
					#if(contact[0].contact_type_id==5 || contact[0].contact_type_id==6 || contact[0].contact_type_id==7){#
						#=contact[0].company#
					#}else{#
						#=contact[0].surname# #=contact[0].name#
					#}#
				</td>
				<td>ថ្ងៃចេញវិក្ក.</td>
				<td align="right">#=kendo.toString(new Date(issued_date), "dd-MM-yyyy")#</td>
			</tr>
			<tr>
				<td align="left">#=location[0].name#</td>
				<td>លេខវិក្ក.</td>
				<td align="right">#=number#</td>
			</tr>
		</table>

		<table class="table table-bordered table-condensed" style="page-break-after: always;">
			<thead>
				<tr>
					<td>បេឡាករ</td>
					<td>Date</td>
					<td>ទឹកប្រាក់ទទួលបាន</td>
					<td>ទឹកប្រាក់ត្រូវបង់</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td class="right">#=kendo.toString(total*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
			</tbody>
		</table>

	</div>
</script>

<script id="wInvoice-print-row-template1" type="text/x-kendo-tmpl">	
  	<div class="container winvoice-print" style="width: 900px;">
		<div class="span12 headerinv ">
			<!--div valign="top">
				<img src="/banhji/#:company[0].image_url#" height="90" width="60" style="float: left">
			</div-->
			<div class="span12" align="center">
				<h4>#:company[0].name#</h4>					
				<h5>#:company[0].address# 
				<br>
				#:company[0].phone#</h5>					
			</div>
		</div>		

		<div class="span12 cover-customer">
			<div class="span8">
				<span id="#=contact[0].wnumber#"></span>
				<div class="span12">
					<p>អតិថិជន​ #=contact[0].number#</p>
					<p>#:contact[0].name#</p>
					<p>#=contact[0].address#</p>
					<p style="font-size: 10px;"><i>ថ្ងៃ​ចាប់​ផ្តើម​ទទួល​ប្រាក់ #=kendo.toString(new Date(payment_date), "dd-MM-yyyy")#</i></p>
				</div>
			</div>
			<div class="span4">
				<div class="span6">
					<p>លេខ​វិក្កយ​បត្រ</p>
					<p>ថ្ងៃ​ចេញ វិក្កយ​បត្រ</p>
					<p>តំបន់</p>
					<p>លេខ​ទី​តាំង​</p>
					<p>គិត​ចាប់​ពី​ថ្ងៃ​ទី</p>
					<p>ដល់​ថ្ងៃ​ទី</p>
				</div>	
				<div class="span6">
					<p style="margin-top: 5px;">#:number#</p>
					<p style="margin-top: 10px;">#:issued_date#</p>
					<p style="margin-top: 5px;">#:location[0].name#</p>
					<p><strong>#:location[0].abbr#</strong></p>
					<p style="margin-top: 10px;">#:kendo.toString(new Date(month_of), "dd-MM-yyyy")#</p>
					<p style="margin-top: 10px;">#:kendo.toString(new Date(due_date), "dd-MM-yyyy")#</p>
				</div>		
			</div>			
		</div>
		<table class="span12 table table-bordered table-condensed" style="margin-top: 40px;border:1px solid \\#000; border-radius: 3px;margin-left: 0px;">
			<thead>
				<tr>
					<th width="180">លេខ​កុងទ័រ<br>METER</th>
					<th width="150">អំណានចាស់<br>PREVIOUS</th>
					<th width="120">អំណានថ្មី<br>CURRENT</th>
					<th width="120">បរិមាណ<br>CONSUMPTION</th>
					<th width="120">តំលៃឯកត្តា<br>RATE</th>
					<th width="180">តំលៃសរុប<br>AMOUNT</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td style="vertical-align: middle;">19-10-2015</td>
					<td colspan="4" style="text-align: right">
						ប្រាក់​ជំ​ពាក់​ពេល​មុន Balance brought forward . រ<br>
						ប្រាក់​បាន​ទទួល​ Payment Recieve - THANK YOU . រ<br>
						ជំពាក់​សរុប​នៅ​ថ្ងៃ​ធ្វើ​វិក្កយបត្រ Balance as at billing date .រ
					</td>
					<td>
						#:kendo.toString(balance_forward*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#<br>
						0<br>
						0
					</td>
				</tr>
				#for(var i=0; i<invoiceLines.length; i++) {#
					#if(invoiceLines[i].type=="tariff"){#
						<tr>
							<td>#:invoiceLines[i].meter[0].number#</td>
							<td class="right">#:invoiceLines[i].record[0].previous#</td>
							<td class="right">#:invoiceLines[i].record[0].current#</td>						
							<td class="right">#:kendo.toString(kendo.parseInt(invoiceLines[i].unit), 'n0')#</td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].price)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
							<td class="right"><span>#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</span></td>
						</tr>
					#}else{#
						<tr>						
							<td colspan="5" class="right">#:invoiceLines[i].description#</td>
							#if(invoiceLines[i].type=="exemptionUsage"){#
								<td class="right">#:invoiceLines[i].amount# ម<sup>៣</sup></td>							
							#}else{#
								<td class="right">#:kendo.toString(kendo.parseFloat(invoiceLines[i].amount)*kendo.parseFloat(rate), locale=="km-KH"?"c0":"c", locale)#</td>
							#}#
						</tr>
					#}#
				#}#	
				<tr><td colspan="6" style="height: 200px;"></td></tr>
				<tr>
					<td colspan="5" style="background: \\#355176;color: \\#fff;text-align: right;">បំណុល​សរុប TOTAL BALANCE</td><td>#:kendo.toString(kendo.parseFloat(total), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>
					<td rowspan="4" colspan="3">#=company[0].term_of_condition#</td>
					<td colspan="2" style="background: \\#ccc;">ប្រាក់​ត្រូវ​បង់ TOTAL DUE</td>
					<td><strong>#:kendo.toString(kendo.parseFloat(total), locale=="km-KH"?"c0":"c", locale)#</strong></td>
				</tr>
				<tr>
					<td colspan="2" style="background: \\#ccc;">ថ្ងៃផុតកំណត់ DUE DATE</td>
					<td>#=kendo.toString(new Date(due_date), "dd-MM-yyyy")#</td>
				</tr>
				<tr>
					<td colspan="2" style="background: \\#ccc;">ថ្ងៃបង់ប្រាក់ PAY DATE</td>
					<td></td>
				</tr>
				<tr>
					<td colspan="2" style="background: \\#ccc;">ប្រាក់បានបង់ PAY AMOUNT</td>
					<td></td>
				</tr>
			</tbody>
		</table>
		<div class="line"></div>
		<table class="span12 table table-bordered table-condensed" style="margin-top: 15px;border:1px solid \\#000; border-radius: 3px;margin-left: 0px;">
			<tbody>
				<tr>
					<th width="490" rowspan="5">
						<div class="span4">
							<p style="margin-top: 45px;">វិក្កយបត្រ</p>
							<p>អតិថិជន</p>
							<p style="margin-top: 15px;">លេខ​ទី​តាំង</p>
							<p>លេខ​កុនង​ទ័រ</p>
						</div>
						<div class="span8" style="text-align: left;">
							<span style="margin-left: -15px;" id="secondwnumber"></span>
							<p style="margin-top: 10px;">#:kendo.toString(new Date(month_of), "dd-MM-yyyy")# - #:number#</p>
							<p>#=contact[0].number# #=contact[0].name#</p>
							<p>#:location[0].name#</p>
							<p><strong>#:location[0].abbr#</strong></p>
							<p style="margin-top: 8px;">#:invoiceLines[0].meter[0].number#</p>
						</div>
					</th>
					<td width="270" style="background: \\#ccc;">ប្រាក់​ត្រូវ​បង់ TOTAL DUE</td>
					<td width="180">#:kendo.toString(kendo.parseFloat(total), locale=="km-KH"?"c0":"c", locale)#</td>
				</tr>
				<tr>
					<td style="background: \\#ccc;">ថ្ងៃបង់ប្រាក់ PAY DATE</td>
					<td></td>
				</tr>
				<tr>
					<td style="background: \\#ccc;">ប្រាក់បានបង់ PAY AMOUNT</td>
					<td></td>
				</tr>
				<tr>
					<td style="background: \\#ccc;">អ្នកទទួលប្រាក់ RECEIVER</td>
					<td></td>
				</tr>
				<tr>
					<td style="background: \\#ccc;"></td>
					<td></td>
				</tr>
			</tbody>
		</table>
	</div>
</script>

<script id="wInventoryItem" type="text/x-kendo-template">
	<div class="customer-background">
		<div class="container-960">
			<div class="row-fluid">
				<div id="example" class="k-content">
					<br>
					<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back();"><i></i></span>

					<h3><span data-bind="text: lang.lang.inventory"></span></h3>

					<div class="box-generic">
					    <!-- //Tabs Heading -->
					    <div class="tabsbar">
					        <ul>
					            <li class="glyphicons star active"><a href="#tab1" data-toggle="tab" data-bind="click: searchFavorite"><i></i> <span data-bind="text: lang.lang.favorite"></span> </a>
					            </li>
					            <li class="glyphicons list"><a href="#tab2" data-toggle="tab"><i></i> <span data-bind="text: lang.lang.category"></span> </a>
					            </li>		            	            		            	            
					        </ul>
					    </div>
					    <!-- // Tabs Heading END -->

					    <div class="tab-content">
					        <!-- // FavoriteTab content -->
					        <div class="tab-pane active" id="tab1">
					        		
					        </div>
					        <!-- // Favorite Tab content END -->

					        <!-- // Category Tab content -->
					        <div class="tab-pane" id="tab2">
					            <input id="categories" data-bind="value: category_id" />	                
				                <input id="itemGroups" data-bind="value: item_group_id" disabled="disabled" />
			            	</div>
					        <!-- // Category Tab content END -->		                
					    </div>

					    <br>

					    <div class="input-append">
						    <input class="col-md-2" id="appendedInputButtons" 
						    	type="text" placeholder="មុខទំនិញ ..." 
						    	data-bind="value: searchField, events:{ change: search }">

						    <button class="btn btn-default" data-bind="click: search"><i class="icon-search"></i> <span data-bind="text: lang.lang.search"></span></button>				    
						</div>
					</div>
					
					<br>

					<table class="table table-bordered">
				        <thead>
				            <tr>
				                <th><span data-bind="text: lang.lang.sku"></span></th>
				                <th><span data-bind="text: lang.lang.item"></span></th>
				                <th><span data-bind="text: lang.lang.description"></span></th>
				                <th><span data-bind="text: lang.lang.on_hand"></span></th>	                
				                <th><span data-bind="text: lang.lang.price"></span></th>	                
				                <th></th>
				            </tr>
				        </thead>
				        <tbody data-template="wInventory-item-template"
				        	data-pageable="true" 
				        	data-bind="source: dataSource"></tbody>
				    </table>
				    <div id="pager" class="k-pager-wrap"
				    	 data-auto-bind="false"
			             data-role="pager" data-bind="source: dataSource"></div>
			    </div>
			</div>
		</div>
	</div>
</script>
<script id="wInventory-item-template" type="text/x-kendo-template">
    <tr>
    	<td>#=sku#</td>
    	<td>#=name#</td>
    	<td>#=description#</td>
    	<td>
    		#if(on_hand<=order_point){#    		
    			<span class="badge badge-danger">#=kendo.toString(on_hand, "n0")#</span>
    		#}else{#
    			<span class="badge badge-info">#=kendo.toString(on_hand, "n0")#</span>
    		#}#

    		#=measurement==null?"":measurement#
    	</td>    	
    	<td>
    		#for(var i=0; i<price_list.length; i++) {#
    			#if(price_list[i].price>0){#
    				<span class="badge badge-inverse"> #=kendo.toString(price_list[i].price, "c", price_list[i].locale)# </span> / #=price_list[i].measurement# 
    			#}else{#
    				<span class="badge badge-danger"> #=kendo.toString(price_list[i].price, "c", price_list[i].locale)# </span> / #=price_list[i].measurement#
    			#}#
    			<br>    			    						 
			#}#
    	</td>    	
    	<td>
    		<div class="btn-group">
    			<button class="btn btn-default">ធ្វើការ</button>		  	
			  	<button class="btn dropdown-toggle" data-toggle="dropdown">
			    	<span class="caret"></span>
			  	</button>
			  	<ul class="dropdown-menu">			   		
			   		#if(is_assemble=="1"){#
			   			<li><a href="\#/item_assembly/#=id#"><i class="icon-edit"></i> Edit</a></li>			   		
			   		#}else if(is_catalog=="1"){#
			   			<li><a href="\#/item_catalog/#=id#"><i class="icon-edit"></i> Edit</a></li>			   		
			   		#}else{#
			   			<li><a href="\#/price_list/#=id#"><i class="icon-usd"></i> Set Price</a></li>			   			
			   			<li><a href="\#/item/#=id#"><i class="icon-edit"></i> Edit</a></li>
			   		#}#
			  	</ul>
			</div>
    	</td>    		
    </tr>
</script>
<script id="wInventory-item-category-template" type="text/x-kendo-template">
	<span class="btn btn-success" data-bind="click: categoryChanges">#=name#</span>  
</script>
<script id="wInventory-item-vendor-template" type="text/x-kendo-template">
    <div class="product-tmpl" data-bind="click: vendorChanges">
        <img src="#=image_url#" alt="#: company # image" />
        <h3>#:company#</h3>        
    </div>    
</script>

<script id="wBranch" type="text/x-kendo-template">
	<div class="container-960">
		<div class="row">
			<div class="span12">
				<span class="pull-right glyphicons no-js remove_2" 
						onclick="javascript:window.history.back()"><i></i></span>

				<div id="example" class="k-content">
					<h3><span data-bind="text: lang.lang.license"></span></h3>
				
					<div class="box-generic">
									
						<!-- Row -->
						<div class="row-fluid">
						
							<!-- Column -->
							<div class="span6">
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.license_number"></span></label>
									<div class="controls">
										<input id="number" name="number" 
											type="text" class="span10 k-textbox" 
											data-bind="value: obj.operation_license, events:{change:checkExisting}"
											required data-required-msg="ត្រូវការ លេខអាជ្ញាប័ណ្ណ">

										<div class="alert alert-error" data-bind="visible: isExisting" style="width: 260px;">										    
										    <i class="icon-warning-sign"></i> duplicate number !
										</div>
									</div>
								</div>
								<!-- // Group END -->
								
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.license_name"></span></label>
									<div class="controls">
										<input id="name" name="name" 
												type="text" class="span10 k-textbox" 
												data-bind="value: obj.name" 
												required data-required-msg="ត្រូវការ ឈ្មោះអាជ្ញាប័ណ្ណ">									
									</div>
								</div>
								<!-- // Group END -->
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.description"></span></label>
									<div class="controls">
										<input type="text" class="span10 k-textbox" data-bind="value: obj.description">									
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.max_customer"></span></label>
									<div class="controls">
										<input type="text" class="input-mini k-textbox" data-bind="value: obj.max_customer">									
									</div>
								</div>
								<!-- // Group END -->						

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.expire_date"></span></label>								
									<div class="controls">
										<input class="span10" data-role="datepicker"			            		
			            					data-bind="value: obj.expire_date" 
			            					data-format="dd-MM-yyyy"
			            					data-parse-formats="yyyy-MM-dd" 
			            					placeholder="dd-MM-yyyy" />		            				
									</div>								
								</div>
								<!-- // Group END -->

								<br><br>

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.address"></span></label>
									<div class="controls">
										<input type="text" class="span10 k-textbox" data-bind="value: obj.address">									
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.status"></span></label>
									<div class="controls">
										<input id="ddlStatus" name="ddlStatus"
											   data-role="dropdownlist"
					            			   data-option-label="(--- Select ---)"					            			   			                   
							                   data-value-primitive="true"
							                   data-text-field="name"
							                   data-value-field="id"
							                   data-bind="value: obj.status,
							                              source: statusList"
							                   required data-required-msg="required"/>
									</div>
								</div>
								<!-- // Group END -->
								
							</div>
							<!-- // Column END -->
							
							<!-- Column -->
							<div class="span6">
							
								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.currency"></span></label>
									<div class="controls">
										<input id="currency" name="currency"
											   class="span12" data-role="dropdownlist"
					            			   data-option-label="(--- Select ---)"					            			   			                   
							                   data-value-primitive="true"
							                   data-text-field="code"
							                   data-value-field="id"
							                   data-bind="value: obj.currency_id,
							                              source: currencyDS"
							                   required data-required-msg="required"/>
									</div>
								</div>
								<!-- // Group END -->
								
								<br><br>

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.abbr"></span></label>
									<div class="controls">
										<input id="abbr" name="abbr"
											type="text" class="input-mini k-textbox" 
											data-bind="value: obj.abbr"
											required data-required-msg="required">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.representative"></span></label>
									<div class="controls">
										<input type="text" class="span12 k-textbox" data-bind="value: obj.representative">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.tel"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons phone"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.phone" placeholder="01234567897">
									</div>								
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.phone"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons iphone"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.mobile" placeholder="01234567897">
									</div>
								</div>
								<!-- // Group END -->

								<!-- Group -->
								<div class="control-group">
									<label class="control-label"><span data-bind="text: lang.lang.email"></span></label>
									<div class="input-prepend">
										<span class="add-on glyphicons envelope"><i></i></span>
										<input type="text" class="input-large" data-bind="value: obj.email" placeholder="name@email.com">
									</div>
								</div>
								<!-- // Group END -->
								
							</div>
							<!-- // Column END -->
							
						</div>
						<!-- // Row END -->
						
						<div class="separator line bottom"></div>
						
						<!-- Group -->
						<div class="control-group row-fluid">
							<label class="control-label"><span data-bind="text: lang.lang.term_of_condition"></span></label>
							<div class="controls">
								<textarea data-role="editor"
				                      data-tools="['bold',
				                                   'italic',
				                                   'underline',
				                                   'strikethrough',
				                                   'justifyLeft',
				                                   'justifyCenter',
				                                   'justifyRight',
				                                   'justifyFull']"
				                      data-bind="value: obj.term_of_condition"
				                      style="height: 200px;"></textarea>
	                      	</div>
						</div>
						<!-- // Group END -->
						
						<!-- Form actions -->
						<div align="center">
							<span id="notification"></span>

							<span id="save" class="btn btn-icon btn-primary glyphicons circle_ok"><i></i><span data-bind="text: lang.lang.save"></span></span>
							<span class="btn btn-danger btn-icon glyphicons delete" data-bind="click: delete, visible: isEdit"><i></i><span data-bind="text: lang.lang.delete"></span></span>
							<span class="btn btn-icon btn-default glyphicons ban" data-bind="click: cancel"><i></i><span data-bind="text: lang.lang.cancel"></span></span>
						</div>
						<!-- // Form actions END -->
						
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script id="wSettings" type="text/x-kendo-template">
	<span class="pull-right glyphicons no-js remove_2" 
			onclick="javascript:window.history.back()"><i></i></span>

	<h2><span data-bind="text: lang.lang.general_setting_water"></span></h2>

	<br>

	<div class="widget widget-tabs widget-tabs-double widget-tabs-vertical row-fluid row-merge widget-tabs-gray">

	    <!-- Tabs Heading -->
	    <div class="widget-head span3">
	        <ul>
	            <li class="active"><a href="#tab1-1" class="glyphicons building" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.license"></span></span></a>
	            </li>
	            <li><a href="#tab2-1" class="glyphicons group" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.cutomer_type"></span></span></a>
	            </li>
	            <li><a href="#tab3-1" class="glyphicons google_maps" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.location1"></span></span></a>
	            </li>
	            <li><a href="#tab4-1" class="glyphicons calculator" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.tariff"></span></span></a>
	            </li>
	            <li><a href="#tab5-1" class="glyphicons gift" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.exemption"></span></span></a>
	            </li>
	            <li><a href="#tab6-1" class="glyphicons circle_ok" data-toggle="tab"><i></i><span class="strong"><span data-bind="text: lang.lang.maintenance"></span></span></a>
	            </li>	           
	        </ul>
	    </div>
	    <!-- // Tabs Heading END -->

	    <div class="widget-body span9">
	        <div class="tab-content">

	            <!-- Tab Branch content -->
	            <div class="tab-pane active" id="tab1-1">
	            	<a href="#/wBranch" class="btn btn-primary btn-icon glyphicons circle_plus"><i></i> <span data-bind="text: lang.lang.new_license"></span></a>

	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.number"></span></th>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.abbr"></span></th>
	            				<th><span data-bind="text: lang.lang.representive"></span></th>	            				
	            				<th width="70px"><span data-bind="text: lang.lang.phone"></span></th>	            				
	            				<th width="100px"><span data-bind="text: lang.lang.address"></span></th>
	            				<th><span data-bind="text: lang.lang.expire_date"></span></th>
	            				<th><span data-bind="text: lang.lang.max_connections"></span></th>
	            				<th><span data-bind="text: lang.lang.status"></span></th>	            					            				
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"	            					            			
				                data-template="branch-wSettings-template"
				                data-bind="source: branchDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Branch content END -->

	            <!-- Tab Contact Type content -->
	            <div class="tab-pane" id="tab2-1">
	            	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="type name ..." data-bind="value: contactTypeName">
					    <button class="btn btn-default" type="button" data-bind="click: addContactType"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.type2"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-contact-type-wSetting-template"
				                data-template="contact-type-wSettings-template"
				                data-bind="source: contactTypeDS"></tbody>
	            	</table>		            
	            </div>
	            <!-- // Tab Contact Type content END -->

	            <!-- Tab Block content -->
	            <div class="tab-pane" id="tab3-1">
            		<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: blockCompanyId,
		                              source: branchDS"/>

                	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="location name ..." data-bind="value: blockName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="abbr ..." data-bind="value: blockAbbr">
					    <button class="btn btn-default" type="button" data-bind="click: addBlock"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>
	            				<th><span data-bind="text: lang.lang.location1"></span></td>
	            				<th><span data-bind="text: lang.lang.abbr"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-block-wSetting-template"
				                data-template="block-wSettings-template"
				                data-bind="source: blockDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Block content END -->

	            <!-- Tab Tariff content -->
	            <div class="tab-pane" id="tab4-1">
	                <div class="row-fluid">
		                <div class="span6">
			                <input data-role="dropdownlist"
		            			   data-option-label="(--- Select ---)"
		            			   data-auto-bind="false"			                   
				                   data-value-primitive="true"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: tariffCompanyId,
				                              source: branchDS"/>

		                	<div class="input-append">
							    <input class="span6" id="appendedInputButtons" type="text" placeholder="tariff name ..." data-bind="value: tariffName">					    
							    <button class="btn btn-default" type="button" data-bind="click: addTariff"><i class="icon-plus"></i></button>					  
							</div>							
			            	<table class="table table-bordered table-white">
			            		<thead>
			            			<tr>
			            				<th><span data-bind="text: lang.lang.license"></span></th>
			            				<th><span data-bind="text: lang.lang.tariff_name"></span></th>	            				
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"
			            				data-auto-bind="false"
				            			data-edit-template="edit-tariff-wSetting-template"
						                data-template="tariff-wSettings-template"
						                data-bind="source: tariffDS"></tbody>
			            	</table>
		            	</div>
		            	<div class="span6">		                	
						    <input class="span3" type="text" placeholder="usage ..." data-bind="value: tariffUsage">
						    <input class="span3" type="text" placeholder="price ..." data-bind="value: tariffPrice">							    					    
						    <input class="span2" data-role="dropdownlist"		            			   
	            			   data-auto-bind="false"			                   
			                   data-value-primitive="true"
			                   data-text-field="name"
			                   data-value-field="id"
			                   data-bind="value: tariffFlat,
		                              source: flatList"/>
						    <button class="btn btn-default" type="button" data-bind="click: addTariffItem, enabled: selectedTariff"><i class="icon-plus"></i></button>					  
						
							<span data-bind="text: selectedTariffName"></span>							

			            	<table class="table table-bordered table-white">
			            		<thead>
			            			<tr>
			            				<th><span data-bind="text: lang.lang.usage"></span></th>
			            				<th><span data-bind="text: lang.lang.p"></span></th>
			            				<th><span data-bind="text: lang.lang.flat"></span></th>	            				
			            				<th></th>
			            			</tr>
			            		</thead>
			            		<tbody data-role="listview"
			            				data-auto-bind="false"
				            			data-edit-template="edit-tariff-item-wSetting-template"
						                data-template="tariff-item-wSettings-template"
						                data-bind="source: tariffItemDS"></tbody>
			            	</table>
		            	</div>
	            	</div>
	            </div>
	            <!-- // Tab Tariff content END -->

	            <!-- Tab Exemption content -->
	            <div class="tab-pane" id="tab5-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- License ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: exemptionCompanyId,
		                              source: branchDS"/>

	                <input data-role="dropdownlist"
            			   data-option-label="(--- Type ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: exemptionType,
		                              source: exemptionTypeList"/>

                	<div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="exemption name ..." data-bind="value: exemptionName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="price ..." data-bind="value: exemptionAmount">					    
					    <button class="btn btn-default" type="button" data-bind="click: addExemption"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.exemption_name"></span></th>
	            				<th><span data-bind="text: lang.lang.p"></span></th>
	            				<th><span data-bind="text: lang.lang.type2"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-exemption-wSetting-template"
				                data-template="exemption-wSettings-template"
				                data-bind="source: exemptionDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab Exemption content END -->

	            <!-- Tab content -->
	            <div class="tab-pane" id="tab6-1">
	            	<input data-role="dropdownlist"
            			   data-option-label="(--- Select ---)"
            			   data-auto-bind="false"			                   
		                   data-value-primitive="true"
		                   data-text-field="name"
		                   data-value-field="id"
		                   data-bind="value: maintenanceCompanyId,
		                              source: branchDS"/>

	                <div class="input-append">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="maintenance name ..." data-bind="value: maintenanceName">
					    <input class="span6" id="appendedInputButtons" type="text" placeholder="price ..." data-bind="value: maintenanceAmount">
					    <button class="btn btn-default" type="button" data-bind="click: addMaintenance"><i class="icon-plus"></i></button>					  
					</div>
	            	<table class="table table-bordered table-white">
	            		<thead>
	            			<tr>
	            				<th><span data-bind="text: lang.lang.license"></span></th>	            				
	            				<th><span data-bind="text: lang.lang.maintenance_name"></span></th>
	            				<th><span data-bind="text: lang.lang.p"></span></th>
	            				<th></th>
	            			</tr>
	            		</thead>
	            		<tbody data-role="listview"
	            				data-auto-bind="false"
		            			data-edit-template="edit-maintenance-wSetting-template"
				                data-template="maintenance-wSettings-template"
				                data-bind="source: maintenanceDS"></tbody>
	            	</table>
	            </div>
	            <!-- // Tab content END -->

	        </div>
	    </div>

	</div>
</script>
<script id="branch-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=operation_license#</td>
   		<td>
   			<a href="\#/wBranch/#=id#"><i></i>#=name#</a>
   		</td>   		
   		<td>#=abbr#</td>
   		<td>#=representative#</td>   		
   		<td>#=phone# #=mobile#</td>   		
   		<td>#=address#</td>
   		<td>#=expire_date#</td>
   		<td>#=max_customer#</td>
   		<td>
   			#if(status==1){#
				<span class="glyphicons no-js ok"><i></i></span>
			#}else{#
				<span class="glyphicons no-js ban"><i></i></span>
			#}#
   		</td>		 		
   	</tr>
</script>
<script id="contact-type-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		 #:name#
   		</td>
   		<td>
   			#if(is_system=="0"){#
	   			<div class="edit-buttons">       
			        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
			        <a class="k-button" data-bind="click: deleteContactType"><span class="k-icon k-delete"></span></a>
			   	</div>
		   	#}#
   		</td>
   	</tr>
</script>
<script id="edit-contact-type-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>               
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="block-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>
    	<td>
    		#:name#
   		</td>
   		<td>
    		#:abbr#
   		</td>
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
		   	</div>
   		</td>
   	</tr>
</script>
<script id="edit-block-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:abbr" />                
            </dd>                
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="tariff-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>
    	<td>
    		#:name#
   		</td>   		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>
            <span class="k-button" data-bind="click: loadTariffItem"><i class="icon-hand-right"></i></span>             
		</td>
   	</tr>
</script>
<script id="edit-tariff-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd>                         
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="tariff-item-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>#=usage#</td>
    	<td>#=price#</td>
    	<td>
    		#if(is_flat){#
    			ថេរ
    		#}else{#
    			អត់ថេរ
    		#}#
    	</td>   		
   		<td>
   			<div class="edit-buttons">       
		        <a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
		        <a class="k-button k-delete-button" href="\\#" onclick="return confirm('Are you sure you want to delete this item?');"><span class="k-icon k-delete"></span></a>
		   	</div>
   		</td>
   	</tr>
</script>
<script id="edit-tariff-item-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>
        	<dd>
        		<input data-role="dropdownlist"		            			   
        			   data-auto-bind="false"			                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: is_flat,
                              source: flatList"/>
        	</dd>                
            <dd>
                <input type="text" class="k-textbox" data-bind="value:usage" name="usage" required="required" validationMessage="required" />
                <span data-for="usage" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:price" name="price" required="required" validationMessage="required" />
                <span data-for="price" class="k-invalid-msg"></span>
            </dd>                         
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="exemption-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>    	
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:amount#
   		</td>
   		<td>
    		#:unit#
   		</td>    		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>                        
		</td>
   	</tr>
</script>
<script id="edit-exemption-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Type ---)"
        			   data-auto-bind="false"			                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: unit,
	                              source: exemptionTypeList"/>
            </dd>
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:amount" name="amount" required="required" validationMessage="required" />
                <span data-for="amount" class="k-invalid-msg"></span>
            </dd>                        
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>
<script id="maintenance-wSettings-template" type="text/x-kendo-tmpl">                    
    <tr>
    	<td>
    		#if(company[0]) {#
    			#=company[0].name#
    		#}#
    	</td>    	
   		<td>
    		#:name#
   		</td>
   		<td>
    		#:amount#
   		</td>    		
		<td>
			<a class="k-button k-edit-button" href="\\#"><span class="k-icon k-edit"></span></a>
            <a class="k-button k-delete-button" href="\\#"><span class="k-icon k-delete"></span></a>                        
		</td>
   	</tr>
</script>
<script id="edit-maintenance-wSetting-template" type="text/x-kendo-tmpl">
    <div class="product-view k-widget">
        <dl>                
            <dd>
                <input data-role="dropdownlist"
        			   data-option-label="(--- Select ---)"        			   		                   
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: company_id,
	                              source: branchDS"/>
            </dd>           
            <dd>
                <input type="text" class="k-textbox" data-bind="value:name" name="ProductName" required="required" validationMessage="required" />
                <span data-for="ProductName" class="k-invalid-msg"></span>
            </dd> 
            <dd>
                <input type="text" class="k-textbox" data-bind="value:amount" name="amount" required="required" validationMessage="required" />
                <span data-for="amount" class="k-invalid-msg"></span>
            </dd>                        
        </dl>
        <div class="edit-buttons">
            <a class="k-button k-update-button" href="\\#"><span class="k-icon k-update"></span></a>
            <a class="k-button k-cancel-button" href="\\#"><span class="k-icon k-cancel"></span></a>
        </div>
    </div>
</script>


<!-- Water Reports -->
<!-- Water Customers -->
<script id="wReportCenter" type="text/x-kendo-template">
	<div>
		<span class="pull-right glyphicons no-js remove_2" 
				onclick="javascript:window.history.back()"><i></i></span>

		<table>
			<tr>
				<td>
					<h2><span data-bind="text: lang.lang.key_performance_indicators"></span></h2>
				</td>
				<td>
					<input data-role="dropdownlist"
					   data-option-label="(--- Select ---)"
	                   data-auto-bind="false"
	                   data-value-primitive="true"
	                   data-text-field="name"
	                   data-value-field="id"
	                   data-bind="value: branch_id,
	                              source: branchDS,
	                              events: {
	                                change: branchChanges
	                              }"
	                   style="width: 400px;" /> 
				</td>
			</tr>
		</table>
	</div>
	
	<br>	

	<div class="box-generic">
		<div class="row-fluid">							
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-gray widget-stats-2">
					<span class="count"><a data-bind="text: obj.totalCustomer"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_no_of_customers"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="p" data-bind="text: obj.totalAllowCustomer" style="font-size: 50px;"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_customers_ratio"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span3">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-gray widget-stats-2">
					<span class="count"><a data-format="p" data-bind="text: obj.totalActiveCustomer"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.active_customers_ratio"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span5">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.totalIncome"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_water_revenue"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>							
		</div>

		<div class="row-fluid">		
			<div class="span2">
			
				<!-- Stats Widget -->			
				<span class="widget-stats widget-stats-default widget-stats-2">
					<span class="count"><a data-bind="text: obj.totalUsage"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.water_sold"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span2">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="n2" data-bind="text: obj.avgUsage"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.average_water_usage_per_connection"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span3">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-default widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.avgIncome"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.avarage_reveune_per_connection"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>
			<div class="span5">
			
				<!-- Stats Widget -->
				<span class="widget-stats widget-stats-2">
					<span class="count"><a data-format="c0" data-bind="text: obj.totalDeposit"></a></span>
					<span class="txt" style="font-size: small;"><span data-bind="text: lang.lang.total_deposit"></span></span>
				</span>
				<!-- // Stats Widget END -->
				
			</div>							
		</div>
	</div>

	<br>

	<h2><span data-bind="text: lang.lang.water_related_reports"></span></h2>
	<br>

	<div class="row-fluid">
		<div class="span3">
			<h4><span data-bind="text: lang.lang.customer_management_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.these_reports_are_useful_for_customer_information_management_meter_connections_and_usage_managements"></span>
				<br><br>
				<ul>
					<li><a href='#/wCustomer_list'><span data-bind="text: lang.lang.customer_list1"></span></a></li>
	  				<li><a href='#/wBrand_new_customer'><span data-bind="text: lang.lang.new_customer_list"></span></a></li>  				
	  				<li><a href='#/wCustomer_no_meter'><span data-bind="text: lang.lang.no_connection"></span></a></li>
	  				<br>
	  				<li><a href='#/wLow_consumption'><span data-bind="text: lang.lang.minimum_water_usage_list"></span></a></li>
	  				<li><a href='#/wDisconnect_list'><span data-bind="text: lang.lang.disconnected_list"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.receiveable_and_deposits"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.these_would_be_the_most_common_reports_that_you_will_be_using"></span>  
				<br><br>
				<ul>
					<li><a href='#/wCustomer_balance'><span data-bind="text: lang.lang.accounts_receivable_listing"></span></a></li>
	  				<li><a href='#/wCustomer_deposit'><span data-bind="text: lang.lang.customer_deposit"></span></a></li>  				  					  				  
	  				<li><a href='#/wAging_summary'><span data-bind="text: lang.lang.customer_aging_summary_list"></span></a></li> 
	  				<li><a href='#/wAging_detail'><span data-bind="text: lang.lang.customer_aging_detail_list"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.sale_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.summary_and_detail_sale_report_broken_down_by_Licenses_bloc_and_types_of_reveneues"></span>				
				<br><br>
				<ul>
					<li><a href='#/wSale_summary'><span data-bind="text: lang.lang.sale_summary_report"></span></a></li>
	  				<li><a href='#/wSale_detail'><span data-bind="text: lang.lang.sale_detail_report"></span></a></li>  				  					  				  
	  				<li><a ><span data-bind="text: lang.lang.connection_service"></span></a></li> 
	  				<li><a ><span data-bind="text: lang.lang.other_revenues"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="span3">
			<h4><span data-bind="text: lang.lang.cash_receipt_report"></span></h4>
			<div class="well margin-none" style="height: 250px;">
				<span data-bind="text: lang.lang.summary_and_detail_cash_receipt_reports_grouped_by_sources_methods_of_receipts"></span>
				<br><br>
				<ul>
					<li><a href='#/wPayment_summary'><span data-bind="text: lang.lang.cash_receipt_by_summary"></span></a></li> 
  					<li><a href='#/wPayment_detail'><span data-bind="text: lang.lang.cash_receipt_by_detail"></span></a></li>  
	  				<li><a href='#/wPayment_by_source_summary'><span data-bind="text: lang.lang.cash_receipt_by_sources"></span></a></li>
	  				<li><a href='#/wPayment_by_source_detail'><span data-bind="text: lang.lang.cash_receipt_by_sources_detail"></span></a></li> 
				</ul>
			</div>
		</div>
	</div>

	<p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
</script>
<script id="wCustomerList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">Customer List</h3>	

						<div id="grid"></div>
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomerNoMeter" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">						
						
		                <!-- <div class="hidden-print">
		                	<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back();"><i></i></span>

		                	<input data-role="dropdownlist"
				                   data-auto-bind="false"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: branch_id,
				                              source: branchDS"
				                   data-option-label="(--- License ---)" />

				            <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>   
		                </div>			           

						<br> -->
						
						<h4 align="center">Un-connected Customer List</h4>							

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Code</th>	
			        				<th>Name</th>			        					            				
			        				<th>Type</th>
			        				<th>Block</th>
			        				<th>License</th>			        				
			        				<th>Deposit</th>
			        				<th></th>		        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="true"	            					            			
					                data-template="wCustomer-no-meter-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="true"
					            data-bind="source: dataSource"></div>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomer-no-meter-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=wnumber#</td>
		<td>
			<a data-bind="click: goToNewMeter">#=fullname#</a>
		</td>
		<td>#=contact_type_name#</td>
		<td>#=wlocation_name#</td>
		<td>#=wbranch_name#</td>							
		<td align="right">#=kendo.toString(wdeposit, "c0", banhji.userManagement.getLogin().institute[0].locale)#</td>
		<td>
			<span class="btn btn-success btn-icon glyphicons circle_plus" data-bind="click: goToNewMeter"><i></i>New Connected</span>			
		</td>							
    </tr>   
</script>
<script id="wBrandNewCustomer" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">						
						
		                <form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='Check Date' />
			                    <span data-for='edate' class='k-invalid-msg'></span>

			                    <input data-role="dropdownlist"
				                   data-auto-bind="false"
				                   data-text-field="name"
				                   data-value-field="id"
				                   data-bind="value: branch_id,
				                              source: branchDS"
				                   data-option-label="(--- License ---)" />
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>     
			                </div>
			            </form>
					
						<div align="center">
							<h4>New Customer List</h4>
							
							<span data-bind="text: strDate()"></span>														
						</div>											

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Register Date</th>
			        				<th>Code</th>	
			        				<th>Name</th>			        					            				
			        				<th>Type</th>			        				
			        				<th>Block</th>
			        				<th>License</th>
			        				<th>Deposit</th>
			        				<th>Meter</th>		        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wBranch-new-customer-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="false"
					            data-bind="source: dataSource"></div>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wBranch-new-customer-row-template" type="text/x-kendo-tmpl">		
	<tr>
		<td>#=kendo.toString(new Date(registered_date), "dd-MM-yyyy")#</td>		
		<td>#=wnumber#</td>
		<td>#=fullname#</td>
		<td>#=contact_type_name#</td>		
		<td>#=wlocation_name#</td>
		<td>#=wbranch_name#</td>						
		<td align="right">#=kendo.toString(wdeposit, "c0", banhji.userManagement.getLogin().institute[0].locale)#</td>
		<td>
			#for(var i=0; i<meters.length; i++) {#
				#:meters[i].number# <br>
			#}#
		</td>							
    </tr>   
</script>
<script id="wLowConsumption" type="text/x-kendo-template">
	<div class="row-fluid">
		<div class="span12">
			<div id="example" class="k-content">
				<div class="hidden-print">
					<a href="javascript:void()" 
						class="pull-right glyphicons no-js remove_2" 
						onclick="javascript: window.history.back()"><i></i></a>

					<input id="ddlBranch" />						                
					<input id="ddlLocation" disabled="disabled" />
					<input id="monthpicker" placeholder="Monthly" />
					<input id="usage" placeHolder="Minimux Usage" />	
					<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
					<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
				</div>

				<br>
				
				<div align="center">
					<h3>Minimux Usage List</h3>					
					<span id="strDate"></span>
				</div>
				
				<div id="grid"></div>					
								
			</div><!-- //End div example-->
		</div><!-- //End div span12-->
	</div><!-- //End div row-fluid-->	
</script>
<script id="wDisconnectList" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<a href="javascript:void()" 
								class="pull-right glyphicons no-js remove_2" 
								onclick="javascript: window.history.back()"><i></i></a>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />							
							<input id="days" placeHolder="Due Date" />	
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>											
						</div>

						<br>

						<div align="center">
							<h3>Disconnected List</h3>		
						</div>
						
						<div id="grid"></div>
					</div>
				</div>
			</div>
		</div>
	</div>	
</script>

<!-- Customer Accounting -->
<script id="wCustomerBalance" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">បញ្ជីសមតុល្យអតិថិជន</h3>	

						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wCustomerDeposit" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						<div class="hidden-print">
							<span class="pull-right glyphicons no-js remove_2" 
								onclick="javascript:window.history.back()"><i></i></span>

							<input id="ddlBranch" />						                
							<input id="ddlLocation" disabled="disabled" />
							<button id="search" type="button" data-role="button"><i class="icon-search"></i></button> |
							<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						
						</div>

						<h3 align="center">បញ្ជីប្រាក់កក់អតិថិជន</h3>	

						<div id="grid"></div>					
					    					
					</div> <!-- //End div example--> 
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wAgingSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">

					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<input data-role="datepicker" data-bind="value: search_date" data-format="dd-MM-yyyy" placeHolder="Date" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>				
					</div>

					<br>
					
					<div align="center">
						<h3>បញ្ជីបំណុលអតិថិជនសង្ខេប</h3>
						គិតត្រឹម
						<span data-bind="text: strDate"></span>
					</div>

					<table class="table table-bordered table-striped table-white">
		        		<thead>
		        			<tr>
		        				<th>ឈ្មោះ</th>
		        				<th>បច្ចុប្បន្ន</th>
		        				<th>១-៣០ថ្ងៃ</th>			        				
		        				<th>៣១-៦០ថ្ងៃ</th>
		        				<th>៦១-៩០ថ្ងៃ</th>        				
		        				<th>លើសពី ៩០ថ្ងៃ</th>
		        				<th>សរុប</th>	            					            				
		        			</tr>
		        		</thead>
		        		<tbody data-role="listview"
		        				data-auto-bind="false"	            					            			
				                data-template="wAging-summary-row-template"
				                data-bind="source: dataSource"></tbody>
		        	</table>

		        	<div data-role="pager"
				    	 data-auto-bind="false"
			             data-bind="source: dataSource"></div>					
										
				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->	
	</div>	
</script>
<script id="wAging-summary-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=fullIdName#</td>		
		<td class="right">#:kendo.toString(current, 'c0', banhji.institute.locale)#</td>		
		<td class="right">#:kendo.toString(oneMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(twoMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(threeMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(overMonth, 'c0', banhji.institute.locale)#</td>
		<td class="right">#:kendo.toString(amount, 'c0', banhji.institute.locale)#</td>					
    </tr>   
</script>
<script id="wAgingDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="row-fluid">
			<div class="span12">
				<div id="example" class="k-content">
					
					<div class="hidden-print">
						<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back();"><i></i></span>

						<input id="ddlBranch" data-bind="value: branch_id" />						                
						<input id="ddlLocation" data-bind="value: location_id" disabled="disabled" />
						<input data-role="datepicker" data-bind="value: search_date" data-format="dd-MM-yyyy" placeHolder="Date" />
						<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>				
					</div>

					
					<div align="center">
						<h3>Account Received By Detail List</h3>
						To
						<span data-bind="text: strDate"></span>
					</div>

					<div id="grid"></div>		        	

				</div><!-- //End div example-->
			</div><!-- //End div span12-->
		</div><!-- //End div row-fluid-->	
	</div>	
</script>

<!-- Sale -->
<script id="wSaleSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

		            	<input data-role="dropdownlist"                   
		                   data-value-primitive="true"
		                   data-text-field="text"
		                   data-value-field="value"
		                   data-bind="value: sorter,
		                              source: sortList,                              
		                              events: { change: sorterChanges }" />
		                                           
	                    <input data-role="datepicker"	                       
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: sdate"
		                   placeholder="From" />
	                    
	                   	<input data-role="datepicker"
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: edate"
		                   placeholder="To" />	                    	            	
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
		          		|
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>Sale By Summary</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wSaleDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<table>
							<tr>
								<td>
					            	<input data-role="dropdownlist"                   
					                   data-value-primitive="true"
					                   data-text-field="text"
					                   data-value-field="value"
					                   data-bind="value: sorter,
					                              source: sortList,                              
					                              events: { change: sorterChanges }" />
					                                           
				                    <input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: sdate" />
				                    
				                   	<input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: edate" />

					                <input data-role="dropdownlist"
									   data-option-label="(--- រើស អាជ្ញាប័ណ្ណ ---)"
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: branch_id,
					                              source: branchDS,			                              
					                              events: {
					                                change: branchChanges
					                              }"/>
					            </td>
					            <td>
					            	<select data-role="multiselect"
							           data-placeholder="Block..."
							           data-value-primitive="true"
							           data-text-field="name"
							           data-value-field="id"
							           data-bind="value: selectedLocations,
							                      source: locationDS,
							                      enabled: isBranchSelected"
							           style="width: 200px;" 
							    	></select>
					            </td>	                    	            	
					          	<td>	
					          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
					          		|
									<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
								</td>
							</tr>
						</table>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>Sale By Detail</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>

			        <div data-role="pager" 
					    	data-auto-bind="false"
					    	data-page-sizes='[50, 100, 200, "All"]'					    	
				            data-bind="source: dataSource"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>

<!-- Payment -->
<script id="wPaymentSummary" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">
						
						<form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='សូមពិនិត្យមើលកាលបរិច្ឆទឡើងវិញ' />
			                    <span data-for='edate' class='k-invalid-msg'></span>
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> 
			                    |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>      
			                </div>
			            </form>

						<br>

						<div align="center">
							<h4>របាយការណ៍ទទួលប្រាក់សង្ខេប</h4>
							
							<span data-bind="text: strDate"></span>														
						</div>

						<br>						

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>
			        				<th width="45">No.</th>
			        				<th>អាជ្ញាប័ណ្ណ</th>
			        				<th>តំបន់</th>			        				
			        				<th>ទឹកប្រាក់លក់</th>
			        				<th>ទទួលប្រាក់</th>        				
			        				<th>សមតុល្យ</th>	            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wPayment-summary-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>						

					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wPayment-summary-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=banhji.wPaymentSummary.dataSource.indexOf(data)+1#</td>
		<td>#=branch_name#</td>
		<td>#=location_name#</td>		
		<td class="right">#=kendo.toString(sale, "c0", banhji.eDashBoard.locale)#</td>
		<td class="right">#=kendo.toString(paid, "c0", banhji.eDashBoard.locale)#</td>
		<td class="right">#=kendo.toString(paid, "c0", banhji.eDashBoard.locale)#</td>						
    </tr>   
</script>
<script id="wPaymentDetail" type="text/x-kendo-template">
	<div id="slide-form">
		<div class="container-fluid">
			<div class="row-fluid">
				<div class="span12">
					<div id="example" class="k-content">

						<form id="employeeForm" data-role="validator" novalidate="novalidate">
			                <div id="fieldlist" class="hidden-print">
			                	<span class="pull-right glyphicons no-js remove_2" 
									onclick="javascript:window.history.back();"><i></i></span>

			                	<input data-role="dropdownlist"                   
				                   data-value-primitive="true"
				                   data-text-field="text"
				                   data-value-field="value"
				                   data-bind="value: sorter,
				                              source: sortList,                              
				                              events: { change: sorterChanges }" />
				                                           
			                    <input type="text" data-role='datepicker' id="sdate" name="sdate" data-type="date" data-bind="value: sdate" />
			                    <span data-for='sdate' class='k-invalid-msg'></span>

			                    <input type="text" data-role='datepicker' id ="edate" data-type="date" name="edate" data-bind="value: edate" 
			                    		data-greaterdate-field="sdate" data-greaterdate-msg='សូមពិនិត្យមើលកាលបរិច្ឆទឡើងវិញ' />
			                    <span data-for='edate' class='k-invalid-msg'></span>
			               
			                    <button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button> |
								<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>      
			                </div>
			            </form>

						<br>

						<div align="center">
							<h4>របាយការណ៍ទទួលប្រាក់លំអិត</h4>
							
							<span data-bind="text: strDate"></span>														
						</div>

						<br>            			

						<table class="table table-bordered table-striped table-white">
			        		<thead>
			        			<tr>			        				
			        				<th>Date</th>
			        				<th>បេឡាករ</th>
			        				<th>លេខកូដ</th>	
			        				<th>ឈ្មោះ</th>			        					            				
			        				<th>វិក្កយបត្រ</th>
			        				<th>បង់ប្រាក់</th>			        							        					        				            					            				
			        			</tr>
			        		</thead>
			        		<tbody data-role="listview"
			        				data-auto-bind="false"	            					            			
					                data-template="wPayment-detail-row-template"
					                data-bind="source: dataSource"></tbody>
			        	</table>

			        	<div data-role="pager" 
						    	data-auto-bind="false"
					            data-bind="source: dataSource"></div>
						
					</div><!-- //End div example-->
				</div><!-- //End div span12-->
			</div><!-- //End div row-fluid-->
		</div>
	</div>	
</script>
<script id="wPayment-detail-row-template" type="text/x-kendo-tmpl">		
	<tr>		
		<td>#=kendo.toString(new Date(payment_date), "dd-MM-yyyy")#</td>
		<td>#=employee#</td>
		<td>#=contact[0].wnumber#</td>
		<td>
			#if(contact[0].contact_type_id==6 || contact[0].contact_type_id==7 || contact[0].contact_type_id==8){#
				#=contact[0].company#
			#}else{#
				#=contact[0].surname# #=contact[0].name# 
			#}#
		</td>		
		<td>#=invoice#</td>		
		<td class="right">#=kendo.toString(amount, "c0", banhji.eDashBoard.locale)#</td>										
    </tr>   
</script>

<script id="wPaymentBySourceSummary" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

		            	<input data-role="dropdownlist"                   
		                   data-value-primitive="true"
		                   data-text-field="text"
		                   data-value-field="value"
		                   data-bind="value: sorter,
		                              source: sortList,                              
		                              events: { change: sorterChanges }" />
		                                           
	                    <input data-role="datepicker"	                       
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: sdate"
		                   placeholder="ចាប់ពីថ្ងៃទី" />
	                    
	                   	<input data-role="datepicker"
	                       data-format="dd-MM-yyyy"
	                       data-parse-formats="yyyy-MM-dd"
		                   data-bind="value: edate"
		                   placeholder="ដល់ថ្ងៃទី" />	                    	            	
		          		
		          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
		          		|
						<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>របាយការណ៍ទទួលប្រាក់តាមប្រភពសង្ខេប</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<script id="wPaymentBySourceDetail" type="text/x-kendo-template">
	<div class="container-fluid">
		<div class="row-fluid">    
			<div class="span12">
				<div id="example" class="k-content">
					
		            <div class="box-generic hidden-print">
		            	<span class="pull-right glyphicons no-js remove_2" 
							onclick="javascript:window.history.back()"><i></i></span>

						<table>
							<tr>
								<td>
					            	<input data-role="dropdownlist"                   
					                   data-value-primitive="true"
					                   data-text-field="text"
					                   data-value-field="value"
					                   data-bind="value: sorter,
					                              source: sortList,                              
					                              events: { change: sorterChanges }" />
					                                           
				                    <input data-role="datepicker"	                       
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: sdate"
					                   placeholder="ចាប់ពីថ្ងៃទី" />
				                    
				                   	<input data-role="datepicker"
				                       data-format="dd-MM-yyyy"
				                       data-parse-formats="yyyy-MM-dd"
					                   data-bind="value: edate"
					                   placeholder="ដល់ថ្ងៃទី" />

					                <input data-role="dropdownlist"
									   data-option-label="(--- រើស អាជ្ញាប័ណ្ណ ---)"
					                   data-auto-bind="false"
					                   data-value-primitive="true"
					                   data-text-field="name"
					                   data-value-field="id"
					                   data-bind="value: branch_id,
					                              source: branchDS,			                              
					                              events: {
					                                change: branchChanges
					                              }"/>
					            </td>
					            <td>
					            	<select data-role="multiselect"
							           data-placeholder="តំបន់..."
							           data-value-primitive="true"
							           data-text-field="name"
							           data-value-field="id"
							           data-bind="value: selectedLocations,
							                      source: locationDS,
							                      enabled: isBranchSelected"
							           style="width: 200px;" 
							    	></select>
					            </td>	                    	            	
					          	<td>	
					          		<button type="button" data-role="button" data-bind="click: search"><i class="icon-search"></i></button>
					          		|
									<button type="button" data-role="button" onclick="javascript:window.print()"><i class="icon-print"></i></button>
								</td>
							</tr>
						</table>						          		
		            </div>

		            <br><br>

		            <div align="center">
						<h3>របាយការណ៍ទទួលប្រាក់តាមប្រភពលំអិត</h3>
						
						<span data-bind="text: strDate"></span>														
					</div>

					<br>			        
			        
			        <div id="grid"></div>

			        <div data-role="pager" 
					    	data-auto-bind="false"
					    	data-page-sizes='[50, 100, 200, "All"]'					    	
				            data-bind="source: dataSource"></div>
			        
				</div> <!-- //End div example-->            
			</div> <!-- //End div span12-->		
		</div> <!-- //End div row-fluid-->
	</div>
</script>
<!-- ***************************
*	End Water Section         *
**************************** -->



<!-- ***************************
*	Menu Section         	  *
**************************** -->
<script id="accountingMenu" type="text/x-kendo-template">
	<ul class="topnav">
		<li><a href='#/accounting' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/accounting_center'>CENTER</a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/sale_tax'><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>  	
  				<li><a href='#/account'><span data-bind="text: lang.lang.add_account"></span></a></li>
  				<li><a href='#/segment'><span data-bind="text: lang.lang.add_segment"></span></a></li> 
  				<li> <span class="li-line"></span></li>
  				<li><a href='#/journal'><span data-bind="text: lang.lang.make_journal"></span></a></li>
  				<li><a href='#/cash_transaction'><span data-bind="text: lang.lang.make_cash_transaction"></span></a></li>
  				<li><a href='#/cash_advance'><span data-bind="text: lang.lang.make_cash_advance"></span></a></li>
  				<li><a href='#/expense'><span data-bind="text: lang.lang.make_expense"></span></a></li>
  				<li> <span class="li-line"></span></li> 		
  				<li><a href='#/currency_rate'><span data-bind="text: lang.lang.set_exchange_rate"></span></a></li>
  				<li><a href='#/account_recurring'><span data-bind="text: lang.lang.accounting_recurring_list"></span></a></li> 			  				 		
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/accounting_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/accounting_setting' class='glyphicons settings'><i></i></a></li>	  				
	</ul>
</script>
<script id="employeeMenu" type="text/x-kendo-template">
	<ul class="topnav">
		<li><a href='#/employees' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/employee_center'>CENTER</a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/employee'>New Employee</a></li>  				  				
  				<li><a href='#/cash_advance'>Cash Advance</a></li>
  				<li><a href='#/expense'>Expense</a></li>  				 				 				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/employee_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/employees_setting' class='glyphicons settings'><i></i></a></li>	  	
	</ul>
</script>
<script id="vendorMenu" type="text/x-kendo-template">
	<ul class="topnav">
		<li><a href='#/vendors' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/vendor_center'>CENTER</a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/vendor'><span data-bind="text: lang.lang.add_supplier"></span></a></li>
  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory"></span></a></li>
  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>
  				<li><a href="#/txn_item"><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>
  				<li> <span class="li-line"></span></li>			  				
  				<li  style="padding-top: 10px;"><a href='#/purchase_order'><span data-bind="text: lang.lang.make_purchase_order"></span></a></li>
  				<li><a href='#/vendor_deposit'><span data-bind="text: lang.lang.make_vendor_deposit"></span></a></li>
  				<li><a href='#/grn'><span data-bind="text: lang.lang.make_goods_received_note"></span></a></li> 
  				<li><a href='#/purchase'><span data-bind="text: lang.lang.make_purchase"></span></a></li>  		
  				<li><a href='#/purchase_return'><span data-bind="text: lang.lang.make_purchase_return"></span></a></li>  		
  				<li><a href='#/cash_payment'><span data-bind="text: lang.lang.make_cash_payment"></span></a></li>
  				<li> <span class="li-line"></span></li> 		
  				<li><a href='#/vendor_recurring'><span data-bind="text: lang.lang.supplier_recurring_list"></span></a></li>  			 				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/vendor_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/vendor_setting' class='glyphicons settings'><i></i></a></li>	  	
	</ul>
</script>
<script id="customerMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/customers' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/customer_center'><span data-bind="text: lang.lang.center"></span></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/customer'><span data-bind="text: lang.lang.add_customer"></span></a></li> 
  				<li ><a href='#/job'><span data-bind="text: lang.lang.add_job"></span></a></li>
  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory"></span></a></li>
  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
  				<li ><a href="#/txn_item"><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>
  				<li> <span class="li-line"></span></li>
  				<li style="padding-top: 10px;"><a href='#/quote'><span data-bind="text: lang.lang.create_quotation"></span></a></li>  				
  				<li><a href='#/sale_order'><span data-bind="text: lang.lang.create_sale_order"></span></a></li>
  				<li><a href='#/gdn'><span data-bind="text: lang.lang.create_goods_delivery_note"></span></a></li>
  				<li><a href='#/customer_deposit'><span data-bind="text: lang.lang.create_customer_deposit"></span></a></li>
  				<li><a href='#/cash_sale'><span data-bind="text: lang.lang.create_cash_sale"></span></a></li>  
  				<li><a href='#/invoice'><span data-bind="text: lang.lang.create_invoice"></span></span></a></li>
  				<li><a href='#/cash_receipt'><span data-bind="text: lang.lang.create_cash_receipt"></span></span></a></li>
  				<li><a href='#/sale_return'><span data-bind="text: lang.lang.create_sale_return"></span></a></li>
  				<li><a href='#/statement'><span data-bind="text: lang.lang.create_statement"></span></a></li> 
  				<li> <span class="li-line"></span></li> 				
  				<li><a href='#/customer_recurring'><span data-bind="text: lang.lang.customer_recurring_list"></span></a></li>  				 				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href="#/customer_report_center">Reports</a></li>	  	
	  	<li><a href='#/customer_setting' class='glyphicons settings'><i></i></a></li>
	</ul>
</script>
<script id="cashMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/cashs' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/cash_center'>CENTER</a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				  				
  				<li><a href='#/quote'>Add Quote</a></li>  				
  				<li><a href='#/sale_order'>Add Sale Order</a></li>
  				<li><a href='#/gdn'>Add Goods Delivery Note</a></li>
  				<li><a href='#/customer_deposit'>Deposit</a></li>
  				<li><a href='#/cash_sale'>Cash Sale</a></li>  				
  				<li><a href='#/invoice'><span data-bind="text: lang.invoice"></span></a></li>
  				<li><a href='#/statement'>Statement</a></li>
  				<li><a href='#/cash_receipt'>Receive Payment</a></li>
  				<li><a href="#/customerInvoiceSent">Invoice Sent To</a></li>
  				<li><a href='#/customer'>Add <span data-bind="text: lang.new_customer"></span></a></li> 				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/cash_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/cash_setting' class='glyphicons settings'><i></i></a></li>	  		  	
	</ul>
</script>
<script id="waterMenu" type="text/x-kendo-template">
	<ul class="topnav">
	  	<li><a href='#/water' class='glyphicons home'><i></i></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.customer"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/wCustomer_center'><span data-bind="text: lang.lang.customer_center"></span></a></li>
  				<li><a href='#/wNew_customer'><span data-bind="text: lang.lang.new_customer"></span></a></li>
  				<li><a href='#/wCustomer_order'><span data-bind="text: lang.lang.reorder_customer"></span></a></li>  				
  			</ul>
	  	</li>	  	
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.reading"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'> 
  				<li><a href='#/wReading'><span data-bind="text: lang.lang.take_reading"></span></a></li>
  				<li><a href='#/wIR_reader'><span data-bind="text: lang.lang.ir_reader"></span></a></li>  				
  				<li><a href='#/wReading_book'><span data-bind="text: lang.lang.reading_book"></span></a></li>
  				<li><a href='#/wReading_center'><span data-bind="text: lang.lang.edit_reading"></span></a></li>  				 
  			</ul>
	  	</li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.invoice"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'> 
  				<li><a href='#/wInvoice'><span data-bind="text: lang.lang.invoice"></span></a></li>
  				<li><a href='#/wPrint_center'><span data-bind="text: lang.lang.print"></span></a></li>  				  								 
  			</ul>
	  	</li>	  	
	  	<li><a href='#/cashier'><span data-bind="text: lang.lang.cashier"></span></a></li>	  	
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><span data-bind="text: lang.lang.inventory"></span> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>  				
  				<li><a href='#/wInventory_item'><span data-bind="text: lang.lang.inventory_center"></span></a></li>
  				<li><a href='#/item'><span data-bind="text: lang.lang.new_item"></span></a></li>
  				<li><a href='#/item_catalog'><span data-bind="text: lang.lang.new_catalog"></span></a></li>
  				<li><a href='#/item_assembly'><span data-bind="text: lang.lang.new_assembly"></span></a></li>  				 				 				
  			</ul>
	  	</li>
	  	<li><a href='#/wReport_center'><span data-bind="text: lang.lang.report"></span></a></li>	  	
	  	<li><a href='#/wSettings' class='glyphicons settings'><i></i></a></li>
	</ul>
</script>
<script id="inventoryMenu" type="text/x-kendo-template">
	<ul class="topnav">
		<li><a href='#/inventories' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li><a href='#/item_center'>CENTER</a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>
  				<li><a href='#/item'><span data-bind="text: lang.lang.add_inventory_for_sale"></span></a></li>
  				<li><a href='#/non_inventory_part'><span data-bind="text: lang.lang.add_noninventory_for_sale"></span></a></li>
  				<li><a href='#/item_service'><span data-bind="text: lang.lang.add_services"></span></a></li>
  				<li ><a href="#/txn_item"><span data-bind="text: lang.lang.add_transaction_item"></span></a></li>
  				<li><a href='#/item_assembly'><span data-bind="text: lang.lang.build_assembly"></span></a></li>  
  				<li><a href='#/item_catalog'><span data-bind="text: lang.lang.add_new_catalog"></span></a></li>
  				<li><a href='#/fixed_assets'><span data-bind="text: lang.lang.add_fixed_assets"></span></a></li>  		
  				<li> <span class="li-line"></span></li> 
  				<li><a href='#/grn'><span data-bind="text: lang.lang.add_received_note"></span></a></li>
  				<li><a href='#/gdn'><span data-bind="text: lang.lang.add_delivery_note"></span></a></li>
  				<li><a href='#/item_adjustment'><span data-bind="text: lang.lang.create_item_adjustment"></span></a></li>  				
  				<li><a href='#/internal_usage'><span data-bind="text: lang.lang.create_internal_usage"></span></a></li>	
  				<!-- <li> <span class="li-line"></span></li>  -->	
  				<!-- <li><a href='#/item_recurring'>Inventory Recurring List</a></li>-->
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/item_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/item_setting' class='glyphicons settings'><i></i></a></li>	  	
	</ul>	
</script>
<script id="saleTaxMenu" type="text/x-kendo-template">
	<ul class="topnav">
		<li><a href='#/sale_tax' class='glyphicons show_big_thumbnails'><i></i></a></li>
	  	<li role='presentation' class='dropdown'>
	  		<a class='dropdown-toggle glyphicons text_bigger' data-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'><i></i> <span class='caret'></span></a>
  			<ul class='dropdown-menu'>				 				  				
  				<li><a href='#/journal'>Journal</a></li>  				
  				<li><a href='#/sale_tax'>Tax</a></li>  				  				 				  				 				
  			</ul>
	  	</li>	  	  	
	  	<li><a href='#/sale_tax_report_center'>REPORTS</a></li>	  	
	  	<li><a href='#/' class='glyphicons settings'><i></i></a></li>	  				
	</ul>
</script>





<script src="https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/components/js/libs/localforage.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jszip/2.4.0/jszip.js"></script>
<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
	localforage.config({
		driver: localforage.LOCALSTORAGE,
		name: 'userData'
	});	
	var banhji = banhji || {};
	var baseUrl = "<?php echo base_url(); ?>";
	var apiUrl = baseUrl + 'api/';
	banhji.s3 = "https://banhji.s3.amazonaws.com/";	
	banhji.token = null;

	// custom widget for min and max
	kendo.data.binders.widget.max = kendo.data.Binder.extend({
		init: function(widget, bindings, options) {//call the base constructor
            kendo.data.Binder.fn.init.call(this, widget.element[0], bindings, options);
        },
        refresh: function() {
            var that = this,
            value = that.bindings["max"].get(); //get the value from the View-Model
            $(that.element).data("kendoDatePicker").max(value); //update the widget
        }
    });

    kendo.data.binders.widget.min = kendo.data.Binder.extend({
        init: function(widget, bindings, options) {
            //call the base constructor
            kendo.data.Binder.fn.init.call(this, widget.element[0], bindings, options);
        },
        refresh: function() {
            var that = this,
            value = that.bindings["min"].get(); //get the value from the View-Model
            $(that.element).data("kendoDatePicker").min(value); //update the widget
        }
    });
	// end of custom widget
	banhji.fileManagement = kendo.observable({
        dataSource: new kendo.data.DataSource({
          transport: {
            read  : {
              url: baseUrl + 'api/attachments',
              type: "GET",
              dataType: 'json',
              headers: { Institute: JSON.parse(localStorage.getItem('userData/user')).institute.id }
            },
            create  : {
              url: baseUrl + 'api/attachments',
              type: "POST",
              dataType: 'json',
              headers: { Institute: JSON.parse(localStorage.getItem('userData/user')).institute.id }
            },
            update  : {
              url: baseUrl + 'api/attachments',
              type: "PUT",
              dataType: 'json',
              headers: { Institute: JSON.parse(localStorage.getItem('userData/user')).institute.id }
            },
            destroy  : {
              url: baseUrl + 'api/attachments',
              type: "DELETE",
              dataType: 'json',
              headers: { Institute: JSON.parse(localStorage.getItem('userData/user')).institute.id }
            },
            parameterMap: function(options, operation) {
              if(operation === 'read') {
                return {
                  limit: options.take,
                  page: options.page,
                  filter: options.filter
                };
              } else {
                return {models: kendo.stringify(options.models)};
              }
            }
          },
          schema  : {
            model: {
              id: 'id'
            },
            data: 'results',
            total: 'count'
          },
          batch: true,
          serverFiltering: true,
          serverPaging: true,
          pageSize: 50
        }),
        fileArray     : [],
        onRemove      : function(e) {
          banhji.fileManagement.dataSource.remove(e.data);
        },
        onSelected    : function(e) {
          var files = e.files;
          var key = 'ATTACH_' + JSON.parse(localStorage.getItem('userData/user')).institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ files[0].name;
          banhji.fileManagement.dataSource.add({
            transaction_id  : 0,
            type            : "Transaction",
            name            : files[0].name,
            contact_id      : null,
            description     : "",
            key             : key,
            url             : "https://s3-ap-southeast-1.amazonaws.com/banhji/"+key,
            created_at      : new Date(),
            file            : files[0].rawFile
          });
        },
        transactionSize: 0,
        contactSize   : 0,
        totalSize 	  : 0,
        transactionNu : 0,
        contactNu 	  : 0,
        save                : function(contact_id){
          $.each(banhji.fileManagement.dataSource.data(), function(index, value){ 
            banhji.fileManagement.dataSource.at(index).set("transaction_id", contact_id);
            if(!value.id){
              var params = { 
                Body: value.file, 
                Key: value.key
              };
              bucket.upload(params, function (err, data) {                    
                  // console.log(err, data);
                  // var url = data.Location;               
              });
            }                
          });

          banhji.fileManagement.dataSource.sync();
          var saved = false;
          banhji.fileManagement.dataSource.bind("requestEnd", function(e){
            //Delete File
            if(e.type=="destroy"){
              if(saved==false && e.response){
                saved = true;
                var response = e.response.results;
                $.each(response, function(index, value){                  
                  var params = {
                    Delete: { /* required */
                      Objects: [ /* required */
                        {
                          Key: value.data.key
                        }
                      ]
                    }
                  };
                  bucket.deleteObjects(params, function(err, data) {
                    //console.log(err, data);
                  });
                });
              }
            }
            banhji.fileManagement.dataSource.data([]);
          });
        }
    });
	banhji.pageLoaded = {};
	// Initializing AWS Cognito service
	var userPool = new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool(poolData);
	// Initializing AWS S3 Service
	var bucket = new AWS.S3({params: {Bucket: 'banhji'}});
	banhji.accessMod = new kendo.data.DataSource({
      transport: {
        read  : {
          url: baseUrl + 'api/users/access',
          type: "GET",
          dataType: 'json'
        },
        parameterMap: function(options, operation) {
          if(operation === 'read') {
            return {
              limit: options.pageSize,
              page: options.page,
              filter: options.filter
            };
          } else {
            return {models: kendo.stringify(options.models)};
          }
        }
      },
      schema  : {
        model: {
          id: 'id'
        },
        data: 'results',
        total: 'count'
      },
      batch: true,
      serverFiltering: true,
      serverPaging: true,
      filter: {field: 'username', value: userPool.getCurrentUser() == null ? '': userPool.getCurrentUser().username},
      pageSize: 1
    });
    banhji.allowed;
	function checkRole(arg) {
		var dfd = $.Deferred();
		// var roleName = $(location).attr('hash').substr(2);
		// loop through roles if this has in the role list
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
				if(banhji.accessMod.data().length > 0) {
					for(var i = 0; i < banhji.accessMod.data().length; i++) {
						if(arg == banhji.accessMod.data()[i].name.toLowerCase()) {
							dfd.resolve(true);
							break;
						}
					}
				}				
			}
		);		
	}
	banhji.companyDS = new kendo.data.DataSource({
      transport: {
        read  : {
          url: baseUrl + 'api/profiles/company',
          type: "GET",
          dataType: 'json'
        },
        update  : {
          url: baseUrl + 'api/profiles/company',
          type: "PUT",
          dataType: 'json'
        },
        parameterMap: function(options, operation) {
          if(operation === 'read') {
            return {
              limit: options.pageSize,
              page: options.page,
              filter: options.filter
            };
          } else {
            return {models: kendo.stringify(options.models)};
          }
        }
      },
      schema  : {
        model: {
          id: 'id'
        },
        data: 'results',
        total: 'count'
      },
      batch: true,
      serverFiltering: true,
      serverPaging: true,
      filter: {field: 'username', value: userPool.getCurrentUser() == null ? '': userPool.getCurrentUser().username},
      pageSize: 1
    });
	banhji.profileDS = new kendo.data.DataSource({
      transport: {
        read  : {
          url: baseUrl + 'api/profiles',
          type: "GET",
          dataType: 'json',
          headers: banhji.header,
        },
        parameterMap: function(options, operation) {
          if(operation === 'read') {
            return {
              limit: options.pageSize,
              page: options.page,
              filter: options.filter
            };
          } else {
            return {models: kendo.stringify(options.models)};
          }
        }
      },
      schema  : {
        model: {
          id: 'id'
        },
        data: 'results',
        total: 'count'
      },
      batch: true,
      serverFiltering: true,
      serverPaging: true,
      filter: {field: 'username', value: userPool.getCurrentUser() == null ? '':userPool.getCurrentUser().username},
      pageSize: 100
    });
	banhji.aws = kendo.observable({
        password: null,
        confirm: null,
        email: null,
        verificationCode: null,
        cognitoUser: null,
        newPass: null,
        oldPass: null,
        image: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/blank.png",
        getImage: function() {
          banhji.profileDS.fetch(function(e){
            banhji.aws.set('image', banhji.profileDS.data()[0].profile_photo);
          });
        },
        signUp: function() {
          // e.preventDefault();
          if(this.get('password') != this.get('confirm')) {
            alert('Passwords do not match');
          } else {
            // using cognito to sign up
            var attributeList = [];

            var dataEmail = {
                Name : 'email',
                Value : this.get('email')
            };

            var attributeEmail = new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(dataEmail);

            attributeList.push(attributeEmail);

            userPool.signUp(this.get('email'), this.get('password'), attributeList, null, function(err, result){
                if (err) {
                    alert(err);
                    return;
                }
                // update attribute
                // 2. move to admin page
                // banhji.awsCognito.set('cognitoUser', result.user);
                banhji.router.navigate('confirm');
            });
          }           
        },
        comfirmCode: function(e) {
           e.preventDefault();
            // confirm user verification code after signed up
            var userData = {
                Username : userPool.getCurrentUser().username,
                Pool : userPool
            };
            var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
            cognitoUser.confirmRegistration(this.get('verificationCode'), true, function(err, result) {
                if (err) {
                    alert(err);
                    return;
                }
                banhji.router.navigate('index');
            });
        },
        resendCode: function(e) {
          e.preventDefault();
          alert('code resent');
        },
        signIn: function() {
            var authenticationData = {
                Username : this.get('email'),
                Password : this.get('password'),
            };
            var authenticationDetails = new AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails(authenticationData);
            
            var userData = {
                Username : this.get('email'),
                Pool : userPool
            };
            var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
            cognitoUser.authenticateUser(authenticationDetails, {
                onSuccess: function (result) {
                    banhji.awsCognito.set('cognitoUser', cognitoUser);
                },

                onFailure: function(err) {
                    alert(err);
                },

            });
        },
        signOut: function(e){
          e.preventDefault();
          var userData = {
              Username : userPool.getCurrentUser().username,
              Pool : userPool
          };
          var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
          if(cognitoUser != null) {
              cognitoUser.signOut();
              localforage.clear().then(function(){
              	window.location.replace("<?php base_url(); ?>login");
              });              
          } else {
              console.log('No user');
          }
        },
        changePassword: function() {
            var userData = {
                Username : this.get('email'),
                Pool : userPool
            };
            var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
            cognitoUser.changePassword('oldPassword', 'newPassword', function(err, result) {
                if (err) {
                    alert(err);
                    return;
                }
                console.log('call result: ' + result);
            });
        },
        forgotPassword: function(e) {
            e.preventDefault();
            var userData = {
                Username : this.get('email'),
                Pool : userPool
            };
            var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
            cognitoUser.forgotPassword({
                onSuccess: function (result) {
                    console.log('call result: ' + result);
                },
                onFailure: function(err) {
                    alert(err);
                },
                inputVerificationCode() {
                    var verificationCode = prompt('Please input verification code ' ,'');
                    var newPassword = prompt('Enter new password ' ,'');
                    cognitoUser.confirmPassword(verificationCode, newPassword, this);
                }
            });
        },
        getCurrentUser: function() {
            var cognitoUser = null;
            if (userPool.getCurrentUser() != null) {
                cognitoUser = userPool.getCurrentUser();
            }
            return cognitoUser;
        }
    });
	// Check if user is logged and authenticated via cognito service
	if(userPool.getCurrentUser() == null) {
		// if not login return to login page		
	  	//window.location.replace('http://localhost/aws/login.html');
	} else {
	  	var cognitoUser = userPool.getCurrentUser();
	  	if(cognitoUser !== null) {
	    	// banhji.aws.getImage();
	    	cognitoUser.getSession(function(err, result) {
	      		if(result) {
	        		AWS.config.credentials = new AWS.CognitoIdentityCredentials({
	          			IdentityPoolId: 'us-east-1:35445541-da4c-4dbb-b83f-d1d0301a26a9',
	          			Logins: {
	            			'cognito-idp.us-east-1.amazonaws.com/us-east-1_56S0nUDS4' : result.getIdToken().getJwtToken()
	          			}
	        		});
	     		}
	    	});
	  	}
	}	
	var langVM = kendo.observable({
		lang 		: null,		
		localeCode 	: null,		
		changeToEn 	: function() {
			localforage.setItem("lang", "EN").then(function(value){
				location.reload(false);
			});
		},
		changeToKh 	: function() {
			localforage.setItem("lang", "KH").then(function(value){
				location.reload(false);
			});
		}
	});
	banhji.userData = JSON.parse(localStorage.getItem('userData/user')) ? JSON.parse(localStorage.getItem('userData/user')) : "";
	if(banhji.userData == "") {
		banhji.companyDS.fetch(function() {
			banhji.profileDS.fetch(function(){
				var data = banhji.companyDS.data();
				var id = 0;
				id = banhji.profileDS.data()[0].id;
				if(data.length > 0) {
					var user = {
						id: id,
						username: userPool.getCurrentUser().username,
						institute: data
					};
					localforage.setItem('user', user);
				}
				banhji.userData = JSON.parse(localStorage.getItem('userData/user'));
			});
		});
	}
	banhji.institute = banhji.userData ? banhji.userData.institute : "";
	banhji.locale = banhji.institute.currency.locale;
	banhji.localeReport = banhji.institute.reportCurrency.locale;
	banhji.header = { Institute: banhji.institute.id };	
	var dataStore = function(url) {
		var o = new kendo.data.DataSource({
				transport: {
					read 	: {
						url: url,
						type: "GET",
						headers: banhji.header,
						dataType: 'json'
					},
					create 	: {
						url: url,
						type: "POST",
						headers: banhji.header,
						dataType: 'json'
					},
					update 	: {
						url: url,
						type: "PUT",
						headers: banhji.header,
						dataType: 'json'
					},
					destroy 	: {
						url: url,
						type: "DELETE",
						headers: banhji.header,
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								page: options.page,
								limit: options.pageSize,								
								filter: options.filter,
								sort: options.sort
							};
						} else {
							return {models: kendo.stringify(options.models)};
						}
					}
				},
				schema 	: {
					model: {
						id: 'id'
					},
					data: 'results',
					total: 'count'
				},
				batch: true,
				serverFiltering: true,
				serverSorting: true,
				serverPaging: true,
				page: 1,
				pageSize: 100
			});
		return o;
	};	
	banhji.userManagement = kendo.observable({
		lang : langVM,
		multiTaskList 		: [],
		searchText : "",
		searchType : "contacts",
		checkRole  : function(e) {
			e.preventDefault();
		if(JSON.parse(localStorage.getItem('userData/user')).role == 1) {
            banhji.router.navigate("");
          } else {
           	window.location.replace("<?php echo base_url(); ?>admin");
          }
		},
		searchContact: function() {
			this.set("searchType", "contacts");

			$("#search-placeholder").attr('placeholder', "Search Contact");
		},
		searchTransaction: function() {
			this.set("searchType", "transactions");

			$("#search-placeholder").attr('placeholder', "Search Transaction");
		},
		searchItem: function() {
			this.set("searchType", "items");

			$("#search-placeholder").attr('placeholder', "Search Item");
		},
		search: function(e) {
			e.preventDefault();
			
			banhji.searchAdvanced.set("searchText", this.get("searchText"));
			banhji.searchAdvanced.set("searchType", this.get("searchType"));
			banhji.searchAdvanced.search();
			banhji.router.navigate('/search_advanced');
		},
		removeLink 			: function(e){
			e.preventDefault();

			var data = e.data,
			index = this.multiTaskList.indexOf(data);
			
			if(data.vm!==null){				
				data.vm.cancel();
			}			

			this.multiTaskList.splice(index, 1);
		},
		removeMultiTask		: function(url){
			var self = this;

			$.each(this.multiTaskList, function(index, value){
				if(value.url==url){
					self.multiTaskList.splice(index, 1);

					return false;
				}
			});
		},
		addMultiTask 		: function(name, url, vm){
			var isExisting = false;
			$.each(this.multiTaskList, function(index, value){
				if(value.url==url){
					isExisting = true;

					return false;
				}
			});

			if(isExisting==false){
				this.multiTaskList.push({ name:name, url:url, vm:vm });
			}
		},				
		auth : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'authentication',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + 'authentication',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + 'authentication',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + 'authentication',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),		
		inst 	 : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/company',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + 'banhji/company',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + 'banhji/company',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + 'banhji/company',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		industry : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/industry',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		countries: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/countries',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		provinces: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/provinces',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		types 	 : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/types',
					type: "GET",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		instMod 	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'admin/modules_institute',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + 'admin/modules_institute',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + 'admin/modules_institute',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + 'admin/modules_institute',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			filter: {field: 'id', value: 1}
			// pageSize: 100
		}),
		onSuccessUpload: function(e){
			var logo = e.response.results.url;
			this.get('newInst').set('logo', logo);
			this.saveIntitute();
			// console.log(logo);
		},	 
		close 		: function() {
			window.history.back(-1);
			if(this.inst.hasChanges()) {
				this.inst.cancelChanges();
			}
			if(this.auth.hasChanges()) {
				this.auth.cancelChanges();
			}
		},
		getUsername : function() {
			var x = banhji.userData.username.substring(0,2);
			return x.toUpperCase();
		},
		taxRegimes: [
			{ code: 'small', type: 'ខ្នាតតូច'},
			{ code: 'medium', type: 'ខ្នាតមធ្យម'},
			{ code: 'large', type: 'ខ្នាតធំ'}
		],
		currency : [
			{ code: 'KHR', locale: 'km-KH'},
			{ code: 'USD', locale: 'us-US'},
			{ code: 'VND', locale: 'vn-VN'}
		],
		username : null,
		password : null,
		_password: null,
		pwdDS 	 : new kendo.data.DataSource({
			transport: {
				create 	: {
					url: apiUrl + 'banhji/password',
					type: "POST",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		validateEmail: function() {
			var sQtext = '[^\\x0d\\x22\\x5c\\x80-\\xff]';
		  	var sDtext = '[^\\x0d\\x5b-\\x5d\\x80-\\xff]';
		  	var sAtom = '[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+';
		  	var sQuotedPair = '\\x5c[\\x00-\\x7f]';
		  	var sDomainLiteral = '\\x5b(' + sDtext + '|' + sQuotedPair + ')*\\x5d';
		  	var sQuotedString = '\\x22(' + sQtext + '|' + sQuotedPair + ')*\\x22';
		  	var sDomain_ref = sAtom;
		  	var sSubDomain = '(' + sDomain_ref + '|' + sDomainLiteral + ')';
		  	var sWord = '(' + sAtom + '|' + sQuotedString + ')';
		  	var sDomain = sSubDomain + '(\\x2e' + sSubDomain + ')*';
		  	var sLocalPart = sWord + '(\\x2e' + sWord + ')*';
		  	var sAddrSpec = sLocalPart + '\\x40' + sDomain; // complete RFC822 email address spec
		  	var sValidEmail = '^' + sAddrSpec + '$'; // as whole string

		  	var reValidEmail = new RegExp(sValidEmail);

		  	if(!reValidEmail.test(this.get('username'))){
		  		alert("Please enter valid address");
				this.set('passed', false);
		  	}
		  	this.set('passed', false);
		},
		loginBtn : function() {
			banhji.view.layout.showIn('#content', banhji.view.loginView);
		},
		login  	 : function() {
			this.auth.query({
				filter: [
					{field: 'username', value: banhji.userManagement.get('username')},
					{field: 'password', value: banhji.userManagement.get('password')}
				]
			}).done(function(e){
				var data = banhji.userManagement.auth.data();
				if(data.length > 0) {
					var user = banhji.userManagement.auth.data()[0];
					localforage.setItem('user', user);
					if(user.institute.length === 0) {
						banhji.router.navigate('/no-page');
					} else {
						banhji.router.navigate('/');
					}
				} else {
					console.log('bad');
				}
			});
		},
		registerBtn: function() {
			banhji.view.layout.showIn('#content', banhji.view.signupView);	
		},
		logout 		: function(e) {
			e.preventDefault();
			var userData = {
              	Username : userPool.getCurrentUser().username,
              	Pool : userPool
	        };
          	var cognitoUser = new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData);
          	if(cognitoUser != null) {
              	cognitoUser.signOut();
              	localforage.removeItem('user').then(function() {
				    // Run this code once the key has been removed.
				    console.log('Key is cleared!');
				}).catch(function(err) {
				    // This code runs if there were any errors
				    console.log(err);
				});
              	window.location.replace("<?php echo base_url(); ?>login");
          	} else {
              	console.log('No user');
          	}
		},
		setCurrent : function(current) {
			this.set('current', current);
		},
		changePwd  : function() {
			if(this.get('password') !== this.get('_password')) {
				alert("Password does not match");
			} else {
				this.pwdDS.sync();
			}
		},
		getLogin 	: function() {
			return JSON.parse(localStorage.getItem('userData/user'));
		},
		page 	 : function() {
			if(banhji.userManagement.getLogin()) {
				if(banhji.userManagement.getLogin().perm === 1) {
					return 'admin';
				}
			} else {
				return 'home';
			}
			// if(this.getLogin()) {
			// 	return '\#/page';
			// } else {
			// 	return '\#/page/';
			// }
			
		},
		createComp : function() {
			banhji.router.navigate('/create_company');
		},
		setInstitute: function(newIns) {
			this.set('newInst', newIns);
		},
		addInst    : function() {
			this.inst.insert(0, {
				name: "",
				email: "",
				address: "",
				description: "",
				industry: {id: null, name: null},
				type: {id: null, name: null},
				country: {id: null, code: null, name: null},
				province: {id: null, local: null, english: null},
				vat_no: null,
				fiscal_date: null,
				tax_regime: null,
				locale : null,
				legal_name: null,
				date_founded: null,
				logo: ""
			});
			this.setInstitute(this.inst.at(0));
		},
		cancelInst : function() {
			this.inst.cancelChanges();
		},
		saveIntitute: function() {
			if(this.get('newInst').industry.id !== null || this.get('newInst').province.id || this.get('newInst').country.id) {
				this.inst.sync();
				this.inst.bind('requestEnd', function(e){
					var type = e.type, res = e.response.results;
					if(e.response.error === false) {
						if(e.type === 'create') {
							$('#createComMessage').text("created. Please wait till site admin created database for you.");
						} else {
							localforage.removeItem('company', function(err){
								//
							});
							localforage.setItem('company', res);
							$('#createComMessage').text("Updated");
						}
					} else {
						$('#createComMessage').text("error creating company.");
					}
				});
			} else {
				alert('filling all fields');
			}
		},
		signup 	   : function() {
			this.auth.add({username: this.get('username'), password: this.get('password')});
			this.sync();
			this.auth.bind('requestEnd', function(e){
				if(e.type === 'create' && e.response.error === false) {
					alert("អ្នកបានចុះឈ្មោះរួច");
					banhji.router.route('')
				}
			});
		},
		onFileSelect: function(e) {
			console.log(e.files[0]);
		},
		sync: function() {
			this.auth.sync();
			this.auth.bind('requestEnd', function(e){
				var type = e.type;
				var result = e.response.results;
				if(type === "read" && e.error !== true) {
					// get login info
					console.log('true');
				} else if(type === "create") {
					if(e.response.error === true) {
						banhji.userManagement.auth.cancelChanges();
						alert('មានរួចហើយ');
					} else {
						var user = banhji.userManagement.auth.data()[0];
						localforage.setItem('user', user);
						if(!user.institute) {
							banhji.router.navigate('/page', false);
						} else {
							banhji.router.navigate('/app', false);
						}
					}
				}
			});
		}
	});	
	function getDB() {
		var entity = null;
		if(banhji.userManagement.getLogin()) {
			if(banhji.userManagement.getLogin().institute) {
				if(banhji.userManagement.getLogin().institute.length > 0) {
					entity = banhji.userManagement.getLogin().institute.name
				}
				
			} else {
				entity = false
			}
		}		
		return entity;
	}
	banhji.currency = kendo.observable({
		dataSource 			: dataStore(apiUrl + 'currencies'),				
		getCurrencyID 		: function(locale){
			var currency_id = 0;

			$.each(this.dataSource.data(), function(index, value){							
				if(value.locale===locale){
					currency_id = value.id;
					return false;
				}
			});

			return currency_id;
		}		
	});
	banhji.users = kendo.observable({
		dataStore	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/users',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + 'banhji/users',
					type: "POST",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + 'banhji/users',
					type: "PUT",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + 'banhji/users',
					type: "DELETE",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		roleDS 		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'banhji/roles',
					type: "GET",
					headers: {
						"Entity": getDB(),
						"User": banhji.userManagement.getLogin() === null ? '': banhji.userManagement.getLogin().id
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 100
		}),
		add 		: function() {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.addUserView);
			this.dataStore.insert(0, {username: '', password: null, permission: {id: null, name: null}});
			this.setCurrent(this.dataStore.at(0));
		},
		remove 		: function(e) {
			var user = confirm('Are you sure you want to remove this user?');
			if(user === true) {
				this.dataStore.remove(e.data);
				this.sync();
			}
		},
		editRight 	: function(e) {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.editRoleView);
			this.setCurrent(e.data);
		},
		cancelAdd 	: function() {
			banhji.view.pageAdmin.showIn('#col2', banhji.view.userListView);
			this.dataStore.cancelChanges();
		},
		setCurrent 	: function(current) {
			this.set('current', current);
		},
		sync 		: function() {
			this.dataStore.sync();
			this.dataStore.bind('requestEnd', function(e){
				var type = e.type;
				var data = e.response.results;
				if(type !== 'read') {
					console.log('data recorded');
				}
			});
		}
	});
	banhji.people = kendo.observable({
		dataSource : new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "people",
					type: "GET",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute.name:""
					},
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + "people",
					type: "POST",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute.name:""
					},
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + "people",
					type: "PUT",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institutename:""
					},
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + "people",
					type: "DELETE",
					headers: {
						"Entity": banhji.userManagement.getLogin() !== null ? banhji.userManagement.getLogin().institute.name:""
					},
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							offset: options.skip,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count',
				errors: 'error'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			pageSize: 20
		}),
		filterBy   : function() {},
		save 	   : function() {}
	});
	// end TEst offline
	var obj = function(url) {
		var o = kendo.observable({
			dataStore: new kendo.data.DataSource({
				transport: {
					read 	: {
						url: url,
						type: "GET",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					create 	: {
						url: url,
						type: "POST",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					update 	: {
						url: url,
						type: "PUT",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					destroy : {
						url: url,
						type: "DELETE",
						headers: {
							"Entity": getDB()
						},
						dataType: 'json'
					},
					parameterMap: function(options, operation) {
						if(operation === 'read') {
							return {
								limit: options.pageSize,
								offset: options.skip,
								filter: options.filter
							};
						} else {
							return {models: kendo.stringify(options.models)};
						}
					}
				},
				schema 	: {
					model: {
						id: 'id'
					},
					data: 'results',
					total: 'count',
					errors: 'error'
				},
				batch: true,
				serverFiltering: true,
				serverPaging: true,
				pageSize: 20
			}),
			findById: function(id) {},
			findBy 	: function(arr) {},
			insert 	: function(data) {},
			remove 	: function(model) {
				this.dataStore.remove(model);
				this.save();
			},
			save 	: function() {
				this.dataStore.sync();
				this.dataStore.bind('requestEnd', function(e){
					var type = e.type, res = e.response.results;
					console.log(type + " operation is successful.");
				});
			}
		});
		return o;
	}	
	banhji.Layout = kendo.observable({
		locale: "km-KH",
		menu 	: [],
		// isShown : true,
		// isAdmin : auth.isAdmin(),
		// logout 	: function(e) {
		// 	e.preventDefault();
		// 	auth.logout();
		// },
		// isLogin : function(){
		// 	if(banhji.userManagement.getLogin()) {
		// 		return true;
		// 	} else {
		// 		return false;
		// 	}
		// },
		// init: function() {
		// 	// initialize when the whole page load
		// },
		// ui: function() {
		// 	// get UI information from source base on locale
		// }
	});	
	var role = kendo.observable({
		dataStore 	: new kendo.data.DataSource({
			transport: {
				read: {
					url: apiUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				create: {
					url: apiUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				update: {
					url: apiUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				destroy: {
					url: apiUrl + 'roles',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.pageSize,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			batch: true
		}),
		roleUserDs 	: new kendo.data.DataSource({
			transport: {
				read: {
					url: apiUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'GET'
				},
				create: {
					url: apiUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'POST'
				},
				update: {
					url: apiUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'PUT'
				},
				destroy: {
					url: apiUrl + 'roles/user',
					dataType: 'json',
					headers: {
						"Entity": getDB()
					},
					type: 'DELETE'
				},
				parameterMap: function(data, operation) {
					if(operation === 'read') {
						return {
							limit: data.pageSize,
							offset: data.skip,
							filter: data.filter
						};
					}
					return {models: kendo.stringify(data.models)};
				}
			},
			schema: {
	        	model: {
	        		id: "id"
	        	},
	        	data: "results"
	        },
			pageSize: 20,
			serverPaging: true,
			serverFiltering: true,
			batch: true
		}),
		find 		: function(arg) {},
		setCurrent 	: function(currentRole) {},
		save 		: function() {}
	});
	banhji.index = kendo.observable({
		lang 				: langVM,
		dataSource			: dataStore(apiUrl+"dashboards/home"),
		summaryDS			: dataStore(apiUrl+"accounting_reports/financial_snapshot"),
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/home_graph",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),		
		companyLogo 		: '',
		modules 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + 'admin/modules',
					type: "GET",
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + 'admin/modules',
					type: "POST",
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + 'admin/modules',
					type: "PUT",
					dataType: 'json'
				},
				destroy : {
					url: apiUrl + 'admin/modules',
					type: "DELETE",
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverPaging: true,
			// pageSize: 100
		}),
		companyName 		: null,
		companyInf 			: function() {
			var company = JSON.parse(localStorage.getItem('userData/user'));
			return company;
		},		
		getLogo   			: function() {
			banhji.companyDS.fetch(function(){
				if(banhji.companyDS.data().length > 0) {
					banhji.index.set('companyLogo', banhji.companyDS.data()[0].logo);
				}
			});
		},
		today 				: new Date(),		
		ar 					: 0,
		ar_open 			: 0,
		ar_customer 		: 0,
		ar_overdue 			: 0,
		ap 					: 0,
		ap_open 			: 0,
		ap_vendor 			: 0,
		ap_overdue 			: 0,
		income 				: 0,
		expense 			: 0,
		net_income 			: 0,
		asset 				: 0,
		liability 	 		: 0,
		equity 	 			: 0,		
		pageLoad 			: function(){
			var self = this;

			this.graphDS.fetch();

			this.dataSource.query({
				filter: [],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.dataSource.view();				
				
				self.set("ar", kendo.toString(view[0].ar, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ar_open", kendo.toString(view[0].ar_open, "n0"));
				self.set("ar_customer", kendo.toString(view[0].ar_customer, "n0"));
				self.set("ar_overdue", kendo.toString(view[0].ar_overdue, "n0"));

				self.set("ap", kendo.toString(view[0].ap, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ap_open", kendo.toString(view[0].ap_open, "n0"));
				self.set("ap_vendor", kendo.toString(view[0].ap_vendor, "n0"));
				self.set("ap_overdue", kendo.toString(view[0].ap_overdue, "n0"));
			});

			this.summaryDS.query({
				filter: [],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.summaryDS.view();				
				
				self.set("income", kendo.toString(view[0].income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("expense", kendo.toString(view[0].expense, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("net_income", kendo.toString(view[0].net_income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				
				self.set("asset", kendo.toString(view[0].asset, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("liability", kendo.toString(view[0].liability, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("equity", kendo.toString(view[0].equity, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
			});										
		}
	});
	banhji.searchAdvanced =  kendo.observable({
    	lang 				: langVM,    	
    	contactDS 			: dataStore(apiUrl+"contacts"),
    	contactTypeDS 		: dataStore(apiUrl+"contacts/type"),
    	transactionDS 		: dataStore(apiUrl+"transactions"),
    	itemDS 				: dataStore(apiUrl+"items"),
    	accountDS 			: dataStore(apiUrl+"accounts"),
    	searchType 			: "",
    	searchText 			: "",
    	found 				: 0,
    	pageLoad 			: function(){			
																									
		},
		search 				: function(){
			var self = this, 
			searchText = this.get("searchText");
			this.set("found", 0);

			if(searchText){
				this.contactDS.query({
					filter:[
						{ field:"number", operator:"like", value: searchText },
						{ field:"surname", operator:"or_like", value: searchText },
						{ field:"name", operator:"or_like", value: searchText },
						{ field:"company", operator:"or_like", value: searchText }
					],
					page:1,
					pageSize: 10
				}).then(function(){				
					var found = self.get("found") + self.contactDS.total();
					self.set("found", found);
				});

				this.transactionDS.query({
					filter:[
						{ field:"number", operator:"like", value: searchText }
					],
					page:1,
					pageSize: 10
				}).then(function(){
					var found = self.get("found") + self.transactionDS.total();
					self.set("found", found);
				});

				this.itemDS.query({
					filter:[
						{ field:"number", operator:"like", value: searchText },					
						{ field:"name", operator:"or_like", value: searchText }
					],
					page:1,
					pageSize: 10
				}).then(function(){
					var found = self.get("found") + self.itemDS.total();
					self.set("found", found);
				});

				this.accountDS.query({
					filter:[
						{ field:"number", operator:"like", value: searchText },					
						{ field:"name", operator:"or_like", value: searchText }
					],
					page:1,
					pageSize: 10
				}).then(function(){
					var found = self.get("found") + self.accountDS.total();
					self.set("found", found);
				});
			}
		},
		selectedContact 	: function(e){
			e.preventDefault();

			var data = e.data, 
			type = this.contactTypeDS.get(data.contact_type_id);
			
			if(type.parent_id==1){
				banhji.customerCenter.loadContact(data.id);
				banhji.router.navigate('/customer_center', false);								
			}else{
				banhji.vendorCenter.loadContact(data.id);
				banhji.router.navigate('/vendor_center', false);
			}
		},
		selectedTransaction : function(e){
			e.preventDefault();

			var data = e.data;
			banhji.router.navigate('/'+data.type.toLowerCase()+'/'+data.id);
		},
		selectedItem 		: function(e){
			e.preventDefault();

			var data = e.data;
			banhji.router.navigate('/item_center/'+e.data.id);
		},
		selectedAccount 		: function(e){
			e.preventDefault();

			var data = e.data;
			banhji.router.navigate('/accounting_center/'+e.data.id);
		}
    });	


	//DAWINE -----------------------------------------------------------------------------------------
	banhji.source =  kendo.observable({
		lang 						: langVM,
		countryDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "countries",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}				
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},			
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Contact
		contactDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}				
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		customerDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:2 },
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierListDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:2 },
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		employeeDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", operator:"where_related", model:"contact_type", value:3 },
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		saleRepDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"contact_type_id", value:10 },
			// group: { field: "contact_type" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Contact Type
		contactTypeDS				: dataStore(apiUrl + "contacts/type"),
		customerTypeDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts/type",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + "contacts/type",
					type: "POST",
					headers: banhji.header,
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + "contacts/type",
					type: "PUT",
					headers: banhji.header,
					dataType: 'json'
				},
				destroy 	: {
					url: apiUrl + "contacts/type",
					type: "DELETE",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", value: 1 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierTypeDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts/type",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + "contacts/type",
					type: "POST",
					headers: banhji.header,
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + "contacts/type",
					type: "PUT",
					headers: banhji.header,
					dataType: 'json'
				},
				destroy 	: {
					url: apiUrl + "contacts/type",
					type: "DELETE",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"parent_id", value: 2 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Job
		jobDS						: dataStore(apiUrl + "jobs"),
		//Currency
		currencyAllDS				: dataStore(apiUrl + "currencies"),
		currencyDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "currencies",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field:"status", value: 1 },
			// group: { field: "group"},
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		currencyRateDS				: dataStore(apiUrl + "currencies/rate"),
		//Item
		itemDS						: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort:[
				{ field:"item_type_id", dir:"asc" },
				{ field:"number", dir:"asc" },
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		itemTypeDS					: dataStore(apiUrl + "item_types"),
		itemInventoryDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:{ field:"item_type_id", value:1 },
			sort:[
				{ field:"item_type_id", dir:"asc" },
				{ field:"number", dir:"asc" },
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		itemNonAssemblyDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:[
				{ field:"is_catalog", value: 0 },
				{ field:"is_assembly", value: 0 }
			],
			sort:[
				{ field:"item_type_id", dir:"asc" },
				{ field:"number", dir:"asc" },
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		itemNonCatalogDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:[
				{ field:"is_catalog", value: 0 },
				{ field:"is_assembly", value: 0 }
			],
			sort:[
				{ field:"item_type_id", dir:"asc" },
				{ field:"number", dir:"asc" },
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		inventoryCategoryDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "categories",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "item_type_id", value: 1 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		nonInventoryPartCategoryDS	: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "categories",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "item_type_id", value: 2 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		fixedAssetCategoryDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "categories",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "item_type_id", value: 3 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		serviceCategoryDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "categories",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "item_type_id", value: 4 },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Measurement
		measurementDS				: dataStore(apiUrl + "measurements"),		
		//Tax Item
		taxItemDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "tax_items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		customerTaxDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "tax_items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "tax_type_id", operator:"where_in", value:[3,9] },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierTaxDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "tax_items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "tax_type_id", operator:"where_in", value:[1,2,3,9] },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Accounting
		accountDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				create 	: {
					url: apiUrl + "accounts",
					type: "POST",
					headers: banhji.header,
					dataType: 'json'
				},
				update 	: {
					url: apiUrl + "accounts",
					type: "PUT",
					headers: banhji.header,
					dataType: 'json'
				},
				destroy 	: {
					url: apiUrl + "accounts",
					type: "DELETE",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},			
			schema 	: {
				model: {
					id: 'id'
				},				
				data: 'results',
				total: 'count'
			},
			//group:{ field: "account_type_name" },
			sort:{ field:"number", dir:"asc" },
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 1000
		}),
		subAccountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},			
			schema 	: {
				model: {
					id: 'id'
				},				
				data: 'results',
				total: 'count'
			},
			filter:{ field: "sub_of_id", value:0 },
			sort:{ field:"number", dir:"asc" },
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 1000
		}),
		accountTypeDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts/type",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},			
			schema 	: {
				model: {
					id: 'id'
				},				
				data: 'results',
				total: 'count'
			},
			filter:{ field:"number <>", value:"" },			
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 1000
		}),
		cashAccountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
				{ field:"account_type_id", value: 10 },
				{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		advAccountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
				{ field:"account_type_id", value: 11 },
				{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Item Income / Item Revenue / Customer Revenue / Service Revenue Account
		incomeAccountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", operator:"where_in", value: [35,39] },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		adjustmentAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
				{ field:"id", value: 75 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Expense
		expenseAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", operator:"where_in", value: [36,37,38,40,41,42,43] },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		ARAccountDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 12 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		APAccountDS					: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", operator:"where_in", value: [23,24] },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),		
		tradeDiscountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"id", value: 72 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		settlementDiscountDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"id", value:99 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierTradeDiscountDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 36 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		supplierSettlementDiscountDS: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"id", value:109 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		prepaidAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", operator:"where_in", value: [14,21] },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		depositAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", operator:"where_in", value: [25,30] },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),		
		cogsAccountDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 36 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		inventoryAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 13 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		fixedAssetAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 16 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		accumulatedAccountDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 18 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		deposalAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,	
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: [
					{ field:"account_type_id", value: 38 },
					{ field:"status", value: 1 }
			],
			sort: { field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		//Payment Term, Method, Segment
		paymentTermDS				: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS				: dataStore(apiUrl + "payment_methods"),
		segmentItemDS				: dataStore(apiUrl + "segments/item"),
		//Recurring
		frequencyList 				: [
			{ id: 'Daily', name: 'Day' },
			{ id: 'Weekly', name: 'Week' },
			{ id: 'Monthly', name: 'Month' },
			{ id: 'Annually', name: 'Annual' }
		],
		monthOptionList 			: [
			{ id: 'Day', name: 'Day' },
			{ id: '1st', name: '1st' },
			{ id: '2nd', name: '2nd' },
			{ id: '3rd', name: '3rd' },
			{ id: '4th', name: '4th' }
		],
		monthList 					: [
			{ id: 0, name: 'January' },
			{ id: 1, name: 'February' },
			{ id: 2, name: 'March' },
			{ id: 3, name: 'April' },
			{ id: 4, name: 'May' },
			{ id: 5, name: 'June' },
			{ id: 6, name: 'July' },
			{ id: 7, name: 'August' },
			{ id: 8, name: 'September' },
			{ id: 9, name: 'October' },
			{ id: 10, name: 'November' },
			{ id: 11, name: 'December' }
		],
		weekDayList 				: [
			{ id: 0, name: 'Sunday' },
			{ id: 1, name: 'Monday' },
			{ id: 2, name: 'Tuesday' },
			{ id: 3, name: 'Wednesday' },
			{ id: 4, name: 'Thurday' },
			{ id: 5, name: 'Friday' },
			{ id: 6, name: 'Saturday' }
		],
		dayList 					: [
			{ id: 1, name: '1st' },
			{ id: 2, name: '2nd' },
			{ id: 3, name: '3rd' },
			{ id: 4, name: '4th' },
			{ id: 5, name: '5th' },
			{ id: 6, name: '6th' },
			{ id: 7, name: '7th' },
			{ id: 8, name: '8th' },
			{ id: 9, name: '9th' },
			{ id: 10, name: '10th' },
			{ id: 11, name: '11st' },
			{ id: 12, name: '12nd' },
			{ id: 13, name: '13rd' },
			{ id: 14, name: '14th' },
			{ id: 15, name: '15th' },
			{ id: 16, name: '16th' },
			{ id: 17, name: '17th' },
			{ id: 18, name: '18th' },
			{ id: 19, name: '19th' },
			{ id: 20, name: '20th' },
			{ id: 21, name: '21st' },
			{ id: 22, name: '22nd' },
			{ id: 23, name: '23rd' },
			{ id: 24, name: '24th' },
			{ id: 25, name: '25th' },
			{ id: 26, name: '26th' },
			{ id: 27, name: '27th' },
			{ id: 28, name: '28th' },
			{ id: 0, name: 'Last' }
		],
		sortList					: [
	 		{ text:"All", value: "all" },
	 		{ text:"Today", value: "today" },
	 		{ text:"This Week", value: "week" },
	 		{ text:"This Month", value: "month" },
	 		{ text:"This Year", value: "year" }
		],
		statusList 					: [
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        customerFormList 			: [
	    	{ id: "Quote", name: "Quotation" },
			{ id: "Sale_Order", name: "Sale Order" },
			{ id: "Deposit", name: "Deposit" },
			{ id: "Cash_Sale", name: "Cash Sale" },
			{ id: "Invoice", name: "Invoice" },
			{ id: "Cash_Receipt", name: "Cash Receipt" },
			//{ id: "Sale_Return", name: "Sale Return" },
			{ id: "GDN", name: "Delivered Note" }
	    ],
	    vendorFormList 				: [
	    	{ id: "Purchase_Order", name: "Purchase Order" },
	    	{ id: "GRN", name: "GRN" },
			// { id: "Deposit", name: "Deposit" },
			// { id: "Purchase", name: "Purchase" },
			// { id: "Pur_Return", name: "Pur.Return" },
			{ id: "Cash_Payment", name: "Cash Payment" }
	    ],
	    cashFormList 				: [
	    	{ id: "Cash_Transfer", name: "Cash Transaction" },
	    	{ id: "Cash_Receipt", name: "Cash Receipt" },
			{ id: "Cash_Payment", name: "Cash Payment" },
			{ id: "Cash_Advance", name: "Cash Advance" },
			{ id: "Reimbursement", name: "Reimbursement" },
			{ id: "Advance_Settlement", name: "Advance Settlement" }
	    ],
	    cashMGTFormList				: [
	    	{ id: "Cash_Transfer", name: "Transfer" },
	    	{ id: "Deposit", name: "Deposit" },
			{ id: "Witdraw", name: "Witdraw" },
			{ id: "Cash_Advance", name: "Advance" },
			{ id: "Cash_Payment", name: "Payment" },
			{ id: "Reimbursement", name: "Reimbursement" },
			{ id: "Journal", name: "Journal" }
	    ],
		genderList					: ["M", "F"],
		typeList 					: ['Invoice','eInvoice','wInvoice','Cash_Sale','Receipt_Allocation','Sale_Order','Quote','GDN','Sale_Return','Purchase_Order','GRN','Cash_Purchase','Credit_Purchase','Purchase_Return','Payment_Allocation','Deposit','eDeposit','wDeposit','Customer_Deposit','Vendor_Deposit','Witdraw','Transfer','Journal','Adjustment','Cash_Advance','Reimbursement','Direct_Expense','Advance_Settlement','Additional_Cost','Cash_Payment','Cash_Receipt','Credit_Note','Debit_Note','Offset_Bill','Offset_Invoice','Cash_Transfer','Internal_Usage'],
		user_id						: banhji.userData.id,
		amtDueColor 				: "#D5DBDB",
		acceptedSrc					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/accepted.ico",
		approvedSrc					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/approved.ico",
		cancelSrc					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/cancel.ico",
		openSrc 					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/open.ico",
		paidSrc 					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/paid.ico",
		partialyPaidSrc 			: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/partialy_paid.ico",
		usedSrc 					: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/used.ico",
		receivedSrc 				: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/received.ico",
		deliveredSrc 				: "https://s3-ap-southeast-1.amazonaws.com/app-data-20160518/ICONs/delivered.ico",
		successMessage 				: "Saved Successful!",
		errorMessage 				: "Warning, please review it again!",
		confirmMessage 				: "Are you sure, you want to delete it?",
		loadData 					: function(){
			this.loadRate();
			this.itemTypeDS.read();
			this.measurementDS.query({
				filter:[],
				page:1,
				pageSize:1000
			});
			this.accountDS.read();
		},
		getFiscalDate 				: function(){
			var today = new Date(),	
			fDate = new Date(today.getFullYear() +"-"+ banhji.institute.fiscal_date);

			if(today < fDate){
				fDate.setFullYear(today.getFullYear()-1);				
			}		

			return fDate;
		},
		//Rate
		loadRate 					: function(){
			this.currencyRateDS.query({
				filter:[],
				sort:{ field:"date", dir:"desc"},
				page:1,
				pageSize:1000
			});
		},
		getRate						: function(locale, date){
			var rate = 0, lastRate = 1;
			$.each(this.currencyRateDS.data(), function(index, value){				
				if(value.locale == locale){
					lastRate = kendo.parseFloat(value.rate);

					if(date >= new Date(value.date)){
						rate = kendo.parseFloat(value.rate);

						return false;
					}
				}
			});

			//If no rate, use the last rate
			if(rate==0){
				rate = lastRate;
			}

			return rate;
		}
	});

	/*********************
	*  Accounting Section  *
	**********************/	
	banhji.accountingDashboard = kendo.observable({
		lang 				: langVM,
		dataSource			: dataStore(apiUrl+"accounting_reports/ratio_analysis"),
		reportCurrency 		: banhji.institute.reportCurrency.code,
		income 				: 0,
		expense 			: 0,
		net_income 			: 0,
		asset 				: 0,
		liability 	 		: 0,
		equity 	 			: 0,
		quickRatio			: 0,
		currentRatio 		: 0,
		cashRatio  			: 0,
		wcSale 				: 0,
		grossProfitMargin 	: 0,
		profitMargin 		: 0,
		returnOnAsset 		: 0,
		roce 				: 0,
		arCollectionPeriod 	: 0,
		apPaymentPeriod 	: 0,
		inventoryTurnOver 	: 0,
		ccc 				: 0,
		txnRecorded 		: 0,
		user_id 			: banhji.source.user_id,				
		pageLoad 			: function(){
			var self = this;

			this.dataSource.query({
				filter: [],								
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.dataSource.view();				
				
				self.set("income", kendo.toString(view[0].income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("expense", kendo.toString(view[0].expense, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("net_income", kendo.toString(view[0].net_income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				
				self.set("asset", kendo.toString(view[0].asset, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("liability", kendo.toString(view[0].liability, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("equity", kendo.toString(view[0].equity, banhji.locale=="km-KH"?"c0":"c", banhji.locale));

				self.set("quickRatio", kendo.toString(view[0].quickRatio, "n"));
				self.set("currentRatio", kendo.toString(view[0].currentRatio, "n"));
				self.set("cashRatio", kendo.toString(view[0].cashRatio, "n"));
				
				self.set("wcSale", kendo.toString(view[0].wcSale, "p"));
				self.set("grossProfitMargin", kendo.toString(view[0].grossProfitMargin, "p"));
				self.set("profitMargin", kendo.toString(view[0].profitMargin, "p"));
				self.set("returnOnAsset", kendo.toString(view[0].returnOnAsset, "n"));
				
				self.set("roce", kendo.toString(view[0].roce, "p"));
				self.set("arCollectionPeriod", kendo.toString(view[0].arCollectionPeriod, "n"));
				self.set("apPaymentPeriod", kendo.toString(view[0].apPaymentPeriod, "n"));
				self.set("inventoryTurnOver", kendo.toString(view[0].inventoryTurnOver, "n"));
				self.set("ccc", kendo.toString(view[0].ccc, "n"));
				
				self.set("txnRecorded", kendo.toString(view[0].txnRecorded, "n"));
			});
		}
	});
	banhji.accountingCenter = kendo.observable({
		lang 				: langVM,
		dataSource			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort:[
				{ field:"account_type_id", dir:"asc" },
				{ field:"number", dir:"asc" }
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		accountTypeDS 		: banhji.source.accountTypeDS,
		summaryDS  			: dataStore(apiUrl + 'centers/accounting_summary'),
		transactionDS  		: dataStore(apiUrl + 'centers/accounting_txn'),		
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",				
		obj 				: null,			
		searchText 			: "",
		balance 			: 0,
		totalTxn 			: 0,		
		subName 			: "",
		typeName 			: "",		
		nature 				: "",		
		user_id 			: banhji.source.user_id,				
		pageLoad 			: function(id){
			var self = this, obj = this.get("obj");

			if(id){
				this.loadObj(id);
			}
			//Refresh
			if(this.dataSource.total()>0){
				this.dataSource.fetch(function(){
					var dataItem = self.dataSource.get(obj.id);
					self.set("obj", dataItem);
				});
				this.summaryDS.fetch();
				this.searchTransaction();
			}						
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		loadObj 			: function(id){
			var self = this;

			this.dataSource.bind("requestEnd", function(e){
				if(e.type=="read"){
					var data = e.response.results;
					
					$.each(data, function(index, value){
						if(value.id==id){
							if(value.sub_of_id>0){
								self.set("subName", value.name);
							}else{
								self.set("subName", "");
							}

							self.set("obj", value);
							self.loadSummary();
							self.searchTransaction();

							return false;
						}
					});

					//Sub Account
					var obj = self.get("obj");
					if(obj.sub_of_id>0){
						$.each(data, function(index, value){
							if(value.id==obj.sub_of_id){								
								self.set("subName", value.name);								

								return false;
							}						
						});
					}else{
						self.set("subName", "");
					}

					var type = self.accountTypeDS.get(obj.account_type_id);
					self.set("typeName", type.name);
					self.set("nature", type.nature);					
				}
			});
		},						
		loadSummary 		: function(){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"account_id", value: obj.id }
			  	],
			  	page: 1,
			  	pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();				
				
				if(view.length>0){
					self.set("balance", kendo.toString(view[0].balance, view[0].locale=="km-KH"?"c0":"c", view[0].locale));					
					self.set("totalTxn", self.summaryDS.total());
				}else{
					self.set("balance", 0);
					self.set("totalTxn", 0);
				}
			});
		},								
		selectedRow			: function(e){
			var data = e.data,
			sub = this.dataSource.get(data.sub_of_id),
			type = this.accountTypeDS.get(data.account_type_id);
			
			if(obj.sub_of_id>0){
				this.set("subName", sub.name);
			}else{
				this.set("subName", "");
			}

			this.set("typeName", type.name);
			this.set("nature", type.nature);

			this.set("obj", data);
			this.loadSummary();
			this.searchTransaction();
		},		
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
			account_type_id = this.get("account_type_id"),
      		txtSearch = this.get("searchText");
      		
      		if(txtSearch){
      			para.push(      				
      				{ field: "number", operator: "like", value: txtSearch },      				
					{ field: "name", operator: "or_like", value: txtSearch }
      			);
      		}

      		if(account_type_id){
      			para.push({ field:"account_type_id", value:account_type_id });
      		}      		

      		this.dataSource.filter(para);
      		
			//Clear search filters
      		this.set("searchText", "");
      		this.set("account_type_id", "");    			  			
		},
		searchTransaction	: function(){
			var self = this,
				para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	if(obj.id){
        		para.push({ field:"account_id", value: obj.id });
        	}

        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", operator:"where_related", model:"transaction", value: start });
            	para.push({ field:"issued_date <=", operator:"where_related", model:"transaction", value: end });            	            	
            }else if(start){
            	para.push({ field:"issued_date", operator:"where_related", model:"transaction", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", operator:"where_related", model:"transaction", value: end });
            }else{
            	
            }                        

            this.transactionDS.query({
            	filter: para,            	
            	page: 1,
            	pageSize: 10
            });            
		},
		loadTransaction	 	: function(){
			var self = this,
				para = [],
				obj = this.get("obj"),
				today = new Date(),
				start = kendo.toString(banhji.source.getFiscalDate(), "yyyy-MM-dd"),
				end = kendo.toString(today, "yyyy-MM-dd");
				
        	if(obj.id){
        		para.push({ field:"account_id", value: obj.id });
        	}
    	
        	para.push({ field:"issued_date >=", operator:"where_related", model:"transaction", value: start });
        	para.push({ field:"issued_date <=", operator:"where_related", model:"transaction", value: end });            	            	
            
            this.transactionDS.query({
            	filter: para,            	
            	page: 1,
            	pageSize: 100
            });            
		},
		goEdit 				: function(){
			var obj = this.get("obj");
			banhji.router.navigate('/account/'+obj.id);
		}
	});
	banhji.account =  kendo.observable({
    	lang 					: langVM,
    	dataSource 				: banhji.source.accountDS,
    	deleteDS 				: dataStore(apiUrl + "account_lines"),
    	numberDS 				: dataStore(apiUrl + "accounts"),
    	accountTypeDS 			: banhji.source.accountTypeDS,
    	subAccountDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:{ field: "sub_of_id", value:0 },
			sort:{ field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 1000
		}),
    	currencyDS 				: banhji.source.currencyDS,
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 					: null,
    	isEdit 		 			: false,
    	isProtected 			: false,
        saveClose 				: false,
		showConfirm 			: false,
		isDuplicateNumber 		: false,
    	showBank 				: false,
    	pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj");			
			
			if(obj.number!==""){

				if(this.get("isEdit")){
					para.push({ field:"id", operator:"where_not_in", value: [obj.id] });
				}
				
				para.push({ field:"number", value: obj.number });
				para.push({ field:"account_type_id", value: obj.account_type_id });
				
				this.numberDS.query({
					filter: para,
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.numberDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"account_type_id", value:obj.account_type_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}
			});
		},
		//Obj
    	loadObj 				: function(id){
    		var self = this;

    		this.dataSource.query({
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	typeChanges 			: function(){    		
    		var obj = this.get("obj");
    		this.set("showBank", false);

    		if(obj.account_type_id){
    			if(obj.account_type_id==10){
    				this.set("showBank", true);
    			}
    			this.subAccountDS.filter({ field:"account_type_id", value:obj.account_type_id });
    			this.generateNumber();
    		}
    	},    	 	   	
      	addEmpty 				: function(){
      		this.dataSource.data([]);
      		this.set("isEdit", false);
      		this.set("obj", null);

      		this.dataSource.insert(0,{
      			account_type_id 		: 0,
      			sub_of_id 				: 0,
      			number 					: "",
      			name 					: "",
      			name_2 					: "",
      			description				: "",
      			bank_name 				: "",
      			bank_account_number 	: "",
      			locale 					: "km-KH",
      			is_taxable 				: 0,
      			status 					: 1,
      			is_system				: 0
			});      		

			var obj = this.dataSource.at(0);
			this.set("obj", obj);
      	},
	    objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");
			
			//Save Obj
			this.objSync()
			.then(function(data){ //Success

				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.dataSource.data([]);

			if(this.get("isEdit")){
				this.dataSource.filter([]);
			}

			banhji.userManagement.removeMultiTask("account");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(!obj.is_system==1){
				this.deleteDS.query({
		        	filter:[
		        		{ field:"account_id", value:obj.id },
		        	],
		        	page:1,
		        	pageSize:1
		        }).then(function(){
		        	var view = self.deleteDS.view();

		        	if(view.length>0){
		        		alert("Sorry, you can not delete it.");
		        	}else{
		        		obj.set("deleted", 1);
				        self.dataSource.sync();

				        window.history.back();
		        	}
		        });
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.journal =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),						
		lineDS  			: dataStore(apiUrl + "journal_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "journal_lines"),
		accountDS 			: banhji.source.accountDS,
		jobDS 				: banhji.source.jobDS,
		contactDS 			: banhji.source.contactDS,				
		currencyDS 			: banhji.source.currencyDS,
		segmentItemDS 		: banhji.source.segmentItemDS,
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Journal" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),					
		types 				: [
			{id: 'Journal', name: 'General Journal'},
			{id: 'Adjustment', name: 'Adjustment'},
			{id: 'Opening_Balance', name: 'Opening Balance'},
			{id: 'Closing_Entry', name: 'Closing Entry'},
			{id: 'Reclassification', name: 'Reclassification'},
			{id: 'Accrual', name: 'Accrual'},
			{id: 'Depreciation_amortization', name: 'Depreciation/Amortization'},
			{id: 'Others', name: 'Others'}
		],
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		showRef 			: true,
		showName 			: false,
		showJob 			: false,
		showSegment 		: false,
		dr 					: 0,
		cr 					: 0,
		isValid 			: true,			
		uer_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}

			this.recurringDS.filter([
				{ field:"type", value:"Journal" },
				{ field:"is_recurring", value:1 }
			]);
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);


			this.changes();						
		},
		//Segment
		segmentChanges  	: function(e) {					
			var dataArr = e.data.segments;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Obj
		loadObj 			: function(id,is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();
					       
				self.set("obj", view[0]);
				self.set("dr", kendo.toString(view[0].amount, "c0", view[0].locale));
		        self.set("cr", kendo.toString(view[0].amount, "c0", view[0].locale));

				self.lineDS.filter({ field: "transaction_id", value: id });								
			});				
		},															
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("dr", 0);
			this.set("cr", 0);				

			this.dataSource.insert(0, {
				recurring_id 		: "",
				transaction_template_id : 13,
				user_id 			: this.get("uer_id"), 	    			    		
			   	type				: "Journal", //required
			   	journal_type 		: "Journal",			   				   		   					   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.institute.locale,			   	
			   	issued_date 		: new Date(),			   	   	
			   	memo 				: "",
			   	memo2 				: "",
			   	is_journal 			: 1,
			   	//Recuring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0			
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);			

			this.addRow();
			this.addRow();

			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
				
			this.lineDS.add({					
				transaction_id 		: obj.id,
				account_id 			: "",				
				contact_id 			: "",				
				description 		: "",
				reference_no 		: "",
				job_id 				: "",
				segments 	 		: [],								
				dr 	 				: 0,
				cr 					: 0,				
				rate				: obj.rate,
				locale				: obj.locale
			});																	
		},		
		remove 				: function(e){						
			var data = e.data;
			if(this.lineDS.total()>2){				
				this.lineDS.remove(data);
	        	this.changes();
	        }		        
		},
		changes				: function(){
			var obj = this.get("obj"), dr = 0, cr = 0;
			this.set("isValid", true);								
			
			$.each(this.lineDS.data(), function(index, value) {
				value.set("rate", obj.rate);
				
				dr += kendo.parseFloat(value.dr);
				cr += kendo.parseFloat(value.cr);				
	        });

			if(dr!==cr){
				this.set("isValid", false);
			}		       	

	        this.set("dr", kendo.toString(dr, "c0", obj.locale));
	        this.set("cr", kendo.toString(cr, "c0", obj.locale));
	        
	        obj.set("amount", dr);
		},
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);

	    			$.each(this.additionalCostDS.data(), function(index, value){
	    				value.set("is_recurring", 1);
	    			});
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});
					
					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			banhji.userManagement.removeMultiTask("journal");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Recurring	
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id>0){
				var recur = this.recurringDS.get(obj.recurring_id);				
				
				obj.set("account_id", recur.account_id);
				obj.set("segments", recur.segments);
				obj.set("sub_total", recur.sub_total);
				obj.set("discount", recur.discount);
				obj.set("tax", recur.tax);
				obj.set("amount", recur.amount);
				obj.set("rate", recur.rate);
				obj.set("locale", recur.locale);					
				obj.set("memo", recur.memo);
				obj.set("memo2", recur.memo2);
				
				this.set("sub_total", kendo.toString(recur.sub_total, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("discount", kendo.toString(recur.discount, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("tax", kendo.toString(recur.tax, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("total", kendo.toString(recur.amount, recur.locale=="km-KH"?"c0":"c", recur.locale));

				//Item Line
				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var line = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(line, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							cost 				: value.cost,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});
				});

				//Account Line
				this.recurringAccountLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var accountLine = self.recurringAccountLineDS.view();
					self.accountLineDS.data([]);

					$.each(accountLine, function(index, value){
						self.accountLineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,				
							account_id 			: value.account_id,								
							description 		: value.description,
							reference_no 		: value.reference_no,
							segments 	 		: value.segments,								
							amount 	 			: value.amount,							
							rate				: value.rate,
							locale				: value.locale
						});
					});
				});

				//Additional Cost Line
				this.recurringAdditionalCostDS.query({
					filter: [
						{ field:"reference_id", value:recur.id },
						{ field:"is_recurring", value:1 },
					],
					page: 1,
					pageSize: 100
				}).then(function(){
					var additionalCostLine = self.recurringAdditionalCostDS.view();
					self.additionalCostDS.data([]);

					$.each(additionalCostLine, function(index, value){
						self.additionalCostDS.add({
							contact_id 			: value.contact_id,
							tax_item_id 		: value.tax_item_id,				
							user_id 			: value.user_id,
							reference_no 		: value.reference_no,	    		
						   	type				: value.type,
						   	sub_total 			: value.sub_total,				   		   					   				   	
						   	amount				: value.amount,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: new Date(),
						   	due_date 			: new Date(),
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0				
			    		});
			    	});
				});				
			}else{
				this.addEmpty();
			} 
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.currencyRate =  kendo.observable({
		lang 				: langVM,
		dataSource 			: banhji.source.currencyRateDS,
		currencyDS 			: banhji.source.currencyAllDS,
		obj 				: null,
		isEdit 				: false,
		baseCode 			: banhji.institute.currency.country +' - '+ banhji.institute.currency.code,
		reportCode 			: banhji.institute.reportCurrency.country +' - '+ banhji.institute.reportCurrency.code,						
		windowVisible 		: false,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(){
		},		
		openWindow			: function(){
      		this.addEmpty();

         	this.set("windowVisible", true);
      	},
      	closeWindow 		: function(){
      		this.dataSource.cancelChanges();

      		this.set("windowVisible", false);
      	},   								
		addEmpty 		 	: function(){			
			this.dataSource.insert(0, {		
				user_id 	: this.get("user_id"),
				currency_id : 0,
 	    		rate 		: 1,
 	    		locale 		: "",
			   	source		: "",
			   	method 		: "Manual",			   		   	
			   	date 		: new Date(),

			   	currency 	: []			   				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);					
		},
		save 				: function(){
			var obj = this.get("obj"),
			currency = this.currencyDS.get(obj.currency_id);
			obj.set("locale", currency.locale);

      		this.dataSource.sync();
      		
      		this.set("windowVisible", false); 		
      	},
      	edit 				: function(e){
      		var data = e.data;
      		
      		this.set("obj", data);

      		this.set("windowVisible", true);
      	},
      	cancel 				: function(){
      		banhji.userManagement.removeMultiTask("currency_rate");
      	}
	});
	banhji.recurring =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),		
		user_id				: banhji.source.user_id,
		referenceTypes 		: [
			{ id:"Estimate", name:"Estimate" },
			{ id:"SO", name:"Sale Order" },
			{ id:"GDN", name:"GDN" }
		],											
		pageLoad 			: function(){
			if(this.dataSource.total()>0){
				this.dataSource.fetch();
			}
		},
		goToTemplate 		: function(e){
			var data = e.data;			

			banhji.router.navigate('/'+data.type.toLowerCase()+"/"+data.id+"/"+true);			
		},		   	
      	delete 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();		        
	    	}	    	
	    }
	});
	banhji.journalReport =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "accounting_reports/journal"),
		summaryDS 			: dataStore(apiUrl + "accounting_reports/journal_summary"),		
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		company 			: banhji.institute,
		displayDate 		: "",
		showDescription 	: false,
		showRef 			: true,
		showName 			: false,
		showSegment 		: false,
		dr 					: 0,
		cr 					: 0,
		totalTxn 			: 0,
		pageLoad 			: function(){
			this.search();
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		search				: function(){
			var self = this, para = [], displayDate = "",
				start = this.get("sdate"),
        		end = this.get("edate");
    	
        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", value: kendo.toString(new Date(start), "yyyy-MM-dd") });
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "From " + kendo.toString(new Date(start), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else if(start){
            	para.push({ field:"issued_date", value: kendo.toString(new Date(start), "yyyy-MM-dd") });

            	displayDate = "On " + kendo.toString(new Date(start), "dd-MM-yyyy");
            }else if(end){
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "As Of " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else{
            	
            }

            this.set("displayDate", displayDate);

            this.dataSource.query({
            	filter: para,
            	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "number", dir: "desc" }
			  	],
            	page: 1,
            	pageSize: 50
            });

            this.summaryDS.query({
            	filter: para,
            	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "number", dir: "desc" }
			  	],
            	page: 1,
            	pageSize: 50
            }).then(function(){
            	var view = self.summaryDS.view();

            	self.set("dr", kendo.toString(view[0].dr, "c", banhji.locale));
            	self.set("cr", kendo.toString(view[0].cr, "c", banhji.locale));
            	self.set("totalTxn", kendo.toString(view[0].totalTxn, "n0"));
            });	                  
		},
		printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=990, height=900'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/responsive.css">' +
		            '<link href="<?php echo base_url(); ?>assets/invoice/invoice.css" rel="stylesheet" />'+
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            'html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: portrait; margin:1mm; }'+
		            	'.inv1 .main-color {' +
		            		
		            		'-webkit-print-color-adjust:exact; ' +
		            	'} ' +
		            	'.table.table-borderless.table-condensed  tr th { background-color: #1E4E78!important;' +
		            	'-webkit-print-color-adjust:exact; color:#fff!important;}' +
		            	'.inv1 .light-blue-td { ' +
		            		'background-color: #c6d9f1!important;' +
		            		'text-align: left;' +
		            		'padding-left: 5px;' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}' +
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed tr td { ' +
    						'background-color: #F2F2F2!important; -webkit-print-color-adjust:exact;' +
						'}'+
						'.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td { ' +
    						' background-color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block>.span4 * {color: #fff!important;}' +
		            	'.journal_block>.span4:first-child { ' +
    						'background-color: #bbbbbb!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block>.span4:last-child {' +
							'background-color: #496cad!important; color: #fff!important; -webkit-print-color-adjust:exact; ' +
						'}' +
						'.journal_block>.span4 {' +
							'background-color: #5cc7dd!important; color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
		            	'.pcg .mid-header {' +
		            		'background-color: #dce6f2!important; ' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}'+
		            	'.inv1 span.total-amount { ' +
		            		'color:#fff!important;' +
		            	'}</style>' +
		            '</head>' +
		            '<body><div class="saleSummaryCustomer" style="padding: 0 10px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		}
	});
	banhji.generalLedger =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "accounting_reports/general_ledger"),		
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		company 			: banhji.institute,
		displayDate 		: "",
		totalAmount 		: 0,
		totalBalance 		: 0,
		pageLoad 			: function(){
			this.search();
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		search				: function(){
			var self = this, para = [], displayDate = "",
				start = this.get("sdate"),
        		end = this.get("edate");
    	
        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", value: kendo.toString(new Date(start), "yyyy-MM-dd") });
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "From " + kendo.toString(new Date(start), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else if(start){
            	para.push({ field:"issued_date", value: kendo.toString(new Date(start), "yyyy-MM-dd") });

            	displayDate = "On " + kendo.toString(new Date(start), "dd-MM-yyyy");
            }else if(end){
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "As Of " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else{
            	
            }

            this.set("displayDate", displayDate);

            this.dataSource.filter(para);
            this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="read"){
					var response = e.response;

					self.set("totalAmount", kendo.toString(response.totalAmount, "c", banhji.locale));
					self.set("totalBalance", kendo.toString(response.totalBalance, "c", banhji.locale));
				}
			});            
		},
		printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=990, height=900'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/responsive.css">' +
		            '<link href="<?php echo base_url(); ?>assets/invoice/invoice.css" rel="stylesheet" />'+
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            'html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: portrait; margin:1mm; }'+
		            	'.inv1 .main-color {' +
		            		
		            		'-webkit-print-color-adjust:exact; ' +
		            	'} ' +
		            	'.table.table-borderless.table-condensed  tr th { background-color: #1E4E78!important;' +
		            	'-webkit-print-color-adjust:exact; color:#fff!important;}' +
		            	'.table.table-borderless.table-condensed  tr th * { color: #fff!important; -webkit-print-color-adjust:exact;}' +
		            	'.inv1 .light-blue-td { ' +
		            		'background-color: #c6d9f1!important;' +
		            		'text-align: left;' +
		            		'padding-left: 5px;' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}' +
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed tr td { ' +
    						'background-color: #F2F2F2!important; -webkit-print-color-adjust:exact;' +
						'}'+
						'.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td { ' +
    						' background-color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block1>.span2 *, .journal_block1>.span5 * {color: #fff!important;}' +
		            	'.journal_block1>.span2:first-child { ' +
    						'background-color: #bbbbbb!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block1>.span5:last-child {' +
							'background-color: #496cad!important; color: #fff!important; -webkit-print-color-adjust:exact; ' +
						'}' +
						'.journal_block1>.span5 {' +
							'background-color: #5cc7dd!important; color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed tfoot .bg-total td {' +
		            		'background-color: #1C2633!important;' +
		            		'color: #fff!important; ' + 
		            		'-webkit-print-color-adjust:exact;' +
		            	'}' +
		            	'</style>' +
		            '</head>' +
		            '<body><div class="saleSummaryCustomer" style="padding: 0 10px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		}
	});
	banhji.statementProfitLoss =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "accounting_reports/income_statement"),		
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		company 			: banhji.institute,
		displayDate 		: "",
		pageLoad 			: function(){
			this.search();
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		search				: function(){
			var self = this, para = [], displayDate = "",
				start = this.get("sdate"),
        		end = this.get("edate");
    	
        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", value: kendo.toString(new Date(start), "yyyy-MM-dd") });
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "From " + kendo.toString(new Date(start), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else if(start){
            	para.push({ field:"issued_date", value: kendo.toString(new Date(start), "yyyy-MM-dd") });

            	displayDate = "On " + kendo.toString(new Date(start), "dd-MM-yyyy");
            }else if(end){
            	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

            	displayDate = "As Of " + kendo.toString(new Date(end), "dd-MM-yyyy");
            }else{
            	
            }

            this.set("displayDate", displayDate);

            this.dataSource.filter(para);
		}
	});
	banhji.trialBalance =  kendo.observable({
		lang 				: langVM,
		dataSource			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "accounting_reports/trial_balance",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort:{ field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,			
			page:1,
			pageSize: 100
		}),
		as_of 				: new Date(),
		displayDate 		: "",
		company 			: banhji.institute,
		dr 					: 0,
		cr 					: 0,
		pageLoad 			: function(){
			this.search();
		},
		sort 				: function(e){
			var col = "",
			target = e.currentTarget.innerText;

			if(this.get("currentSort")=="asc"){
				this.set("currentSort", "desc");
			}else{
				this.set("currentSort", "asc");
			}

			switch(target) {
			    case "TYPE":
			        col = "type";
			        break;
			    case "DATE":
			        col = "issued_date";
			        break;
			    case "ACCOUNT":
			        col = "account_id";
			        break;
			    default:
			        //default code block
			}			

			this.dataSource.sort({ field:col, dir:this.get("currentSort") });
		},
		search 				: function(){
			var as_of = this.get("as_of");

			if(as_of){
				var displayDate = "As Of " + kendo.toString(as_of, "dd-MM-yyyy");
				this.set("displayDate", displayDate);

				this.dataSource.filter({ field:"issued_date", value:kendo.toString(new Date(as_of), "yyyy-MM-dd") });
			}
		},				
		totalDr 			: function() {
	        var sum = 0;

	        $.each(this.dataSource.data(), function(index, value) {
	            sum += kendo.parseFloat(value.dr);
	        });

	        this.set("dr", kendo.toString(sum, "c", banhji.locale));

	        return kendo.toString(sum, "c", banhji.locale);
	    },
	    totalCr 			: function() {
	        var sum = 0;

	        $.each(this.dataSource.data(), function(index, value) {
	            sum += kendo.parseFloat(value.cr);
	        });

	        this.set("cr", kendo.toString(sum, "c", banhji.locale));

	        return kendo.toString(sum, "c", banhji.locale);
	    },
	    printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=990, height=900'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/responsive.css">' +
		            '<link href="<?php echo base_url(); ?>assets/invoice/invoice.css" rel="stylesheet" />'+
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            'html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: portrait; margin:1mm; }'+
		            	'.inv1 .main-color {' +
		            		
		            		'-webkit-print-color-adjust:exact; ' +
		            	'} ' +
		            	'.table.table-borderless.table-condensed  tr th { background-color: #1E4E78!important;' +
		            	'-webkit-print-color-adjust:exact; color:#fff!important;}' +
		            	'.inv1 .light-blue-td { ' +
		            		'background-color: #c6d9f1!important;' +
		            		'text-align: left;' +
		            		'padding-left: 5px;' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}' +
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed tr td { ' +
    						'background-color: #F2F2F2!important; -webkit-print-color-adjust:exact;' +
						'}'+
						'.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td { ' +
    						' background-color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block1>.span2 *, .journal_block1>.span5 * {color: #fff!important;}' +
		            	'.journal_block1>.span2:first-child { ' +
    						'background-color: #bbbbbb!important; -webkit-print-color-adjust:exact;' +
						'}' +
						'.journal_block1>.span5:last-child {' +
							'background-color: #496cad!important; color: #fff!important; -webkit-print-color-adjust:exact; ' +
						'}' +
						'.journal_block1>.span5 {' +
							'background-color: #5cc7dd!important; color: #fff!important; -webkit-print-color-adjust:exact;' +
						'}' +
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed tfoot .bg-total td {' +
		            		'background-color: #1C2633!important;' +
		            		'color: #fff!important; ' + 
		            		'-webkit-print-color-adjust:exact;' +
		            	'}' +
		            	'</style>' +
		            '</head>' +
		            '<body><div class="saleSummaryCustomer" style="padding: 0 10px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		}
	});
	banhji.statementFinancialPosition =  kendo.observable({
		lang 				: langVM,
		dataSource			: dataStore(apiUrl + "accounting_reports/balance_sheet"),
		liabilityDS			: dataStore(apiUrl + "accounting_reports/balance_sheet"),
		equityDS			: dataStore(apiUrl + "accounting_reports/balance_sheet"),
		as_of 				: new Date(),
		displayDate 		: "",
		company 			: banhji.institute,
		totalAsset 			: 0,
		totalLiability 		: 0,
		totalEquity 		: 0,
		totalLiabilityEquity: 0,
		pageLoad 			: function(){
			this.search();
		},
		search 				: function(){
			var self = this, as_of = this.get("as_of");

			if(as_of){
				var displayDate = "As Of " + kendo.toString(as_of, "dd-MM-yyyy");
				this.set("displayDate", displayDate);

				this.dataSource.filter([
					{ field:"issued_date", value:kendo.toString(new Date(as_of), "yyyy-MM-dd") },
					{ field:"account_type_id", value:[10,11,12,13,14,15,16,17,18,19,20,21,22] }
				]);
				var unReadAsset = true;
				this.dataSource.bind("requestEnd", function(e){				
					if(e.type=="read" && unReadAsset){
						unReadAsset = false;
						var response = e.response.totalAmount;

						self.set("totalAsset", kendo.toString(response, "c", banhji.locale));
					}
				});

				//Liability
				this.liabilityDS.filter([
					{ field:"issued_date", value:kendo.toString(new Date(as_of), "yyyy-MM-dd") },
					{ field:"account_type_id", value:[23,24,25,26,27,28,29,30,31] }
				]);
				var unReadLiability = true;
				this.liabilityDS.bind("requestEnd", function(e){
					if(e.type=="read" && unReadLiability){
						unReadLiability = false;
						var response = e.response.totalAmount;
						var total = self.get("totalLiabilityEquity");
						total += response;
						self.set("totalLiabilityEquity", total);
						self.set("totalLiability", kendo.toString(response, "c", banhji.locale));
					}
				});

				//Equity
				this.equityDS.filter([
					{ field:"issued_date", value:kendo.toString(new Date(as_of), "yyyy-MM-dd") },
					{ field:"account_type_id", value:[32,33,34] }
				]);
				var unReadEquity = true;
				this.equityDS.bind("requestEnd", function(e){
					if(e.type=="read" && unReadEquity){
						unReadEquity = false;
						var response = e.response.totalAmount;
						var total = self.get("totalLiabilityEquity");
						total += response;
						self.set("totalLiabilityEquity", total);
						self.set("totalEquity", kendo.toString(response, "c", banhji.locale));
					}
				});
			}
		}
	});
	banhji.chartOfAccount =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "accounts"),		
		as_of 				: new Date(),		
		currentSort 		: "asc",							
		pageLoad 			: function(){
		},	
		sort 				: function(e){
			var col = "",
			target = e.currentTarget.innerText;

			if(this.get("currentSort")=="asc"){
				this.set("currentSort", "desc");
			}else{
				this.set("currentSort", "asc");
			}

			switch(target) {
			    case "TYPE":
			        col = "type";
			        break;
			    case "DATE":
			        col = "issued_date";
			        break;
			    case "ACCOUNT":
			        col = "account_id";
			        break;
			    default:
			        //default code block
			}			

			this.dataSource.sort({ field:col, dir:this.get("currentSort") });
		}	      		
	});
	banhji.saleTax =  kendo.observable({
		lang 				: langVM,
        dataSource 			: dataStore(apiUrl + "tax_types"),
        itemDS 	 			: dataStore(apiUrl + "tax_items"),
        deleteDS 			: dataStore(apiUrl + "tax_items"),
        itemDeleteDS 		: dataStore(apiUrl + "transactions/line"),
        accountDS 			: banhji.source.accountDS,
        typeList			: [ 
	 		{ id:"Invoice Based", name: "Invoice Based" },
	 		{ id:"Payment Based", name: "Payment Based" },
	 		{ id:"No Tax", name: "No Tax" }
		],
		obj 				: null,
		item 				: null,
		taxName 			: "",
		windowVisible 		: false,
		windowItemVisible 	: false,
		pageLoad 			: function() {
        },        
        addType 			: function(){
        	this.dataSource.add({
        		number 				: "",
        		name 				: "",
        		agency 				: "",
        		tax_system 			: "Invoice Based",
        		end_date 			: new Date(),
        		submission_date 	: new Date(),
        		is_system 			: 0
        	});
        	var data = this.dataSource.data();
			var obj = data[data.length-1];
			this.set("obj", obj);
        },
        openWindow			: function(){
      		this.addType();

         	this.set("windowVisible", true);
      	},
      	closeWindow 		: function(){
      		this.dataSource.cancelChanges();

      		this.set("windowVisible", false);
      	},
        save 				: function(){
        	var self = this;
        	this.dataSource.sync();
        	this.dataSource.bind("requestEnd", function(e){
        		if( e.type == "create" || e.type == "update"){ 
        			self.set("windowVisible", false); 
        		}
        	});
        },
        edit 				: function(e){
      		var data = e.data;      		
      		this.set("obj", data);

      		this.set("windowVisible", true);       		
      	},      	
      	delete 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
		        var self = this, data = e.data;

		        this.deleteDS.query({
		        	filter: { field:"tax_type_id", value:data.id},
		        	page:1,
		        	pageSize:1
		        }).then(function(){
		        	var view = self.deleteDS.view();

		        	if(view.length>0){
		        		this.dataSource.remove(data);
		        		this.dataSource.sync();
		        	}else{
		        		alert("Sorry, this item can not be deleted.");
		        	}
		        });
	    	}	    	
	    },
	    view 				: function(e){
	    	var data = e.data;
	    	this.set("taxName", data.name);
	    	this.itemDS.filter({ field: "tax_type_id", value: data.id});
	    },
	    openWindowItem		: function(){
         	this.set("windowItemVisible", true);
      	},
      	closeWindowItem 	: function(){	      		
      		this.itemDS.cancelChanges();

      		this.set("windowItemVisible", false);
      	},
      	loadItem 			: function(e){
	        var d = e.data;

	        this.set("selectedType", true);
	        this.set("tax_type_id", d.id);
	        this.set("selectedTypeName", d.name);
	        
	        this.itemDS.query({
	        	filter: { field:"tax_type_id", value: d.id },
	        	page: 1,
	        	pageSize: 100
	        });  	
        },
      	addItem				: function(e){
		    var data = e.data;

        	this.itemDS.add({
        		tax_type_id 		: data.id,
        		account_id 			: 0,
        		name 				: "",
        		description 		: "",
        		rate 				: "",
        		is_system 			: "",
        		account 			: [{name: ""}]
        	});
        	var data = this.itemDS.data();
			var obj = data[data.length-1];
			this.set("item", obj);
			this.openWindowItem();
        },
      	saveItem 				: function(){
        	var self = this;
        	this.itemDS.sync();
        	this.itemDS.bind("requestEnd", function(e){
        		if( e.type == "create" || e.type == "update"){ 
        			self.set("windowItemVisible", false);
        		}
        	});
        },
        editItem 				: function(e){
      		var data = e.data;      		
      		this.set("item", data);

      		this.set("windowItemVisible", true);
      	}, 
      	deleteItem 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var self = this, data = e.data;

		        this.deleteDS.query({
		        	filter: { field:"tax_item_id", value:data.id},
		        	page:1,
		        	pageSize:1
		        }).then(function(){
		        	var view = self.deleteDS.view();

		        	if(view.length>0){
		        		this.dataSource.remove(data);
		        		this.dataSource.sync();
		        	}else{
		        		alert("Sorry, this item can not be deleted.");
		        	}
		        });
	    	}	    	
	    }
    });
	banhji.segment =  kendo.observable({
		lang 				: langVM,
        dataSource 			: dataStore(apiUrl + "segments"),
        itemDS 	 			: banhji.source.segmentItemDS,
        deleteDS 			: dataStore(apiUrl + "segments/item"),
        itemDeleteDS 		: dataStore(apiUrl + "transactions"),
        statusList 			: banhji.source.statusList,
		obj 				: null,
		item 				: null,
		objName 			: "",
		windowVisible 		: false,
		windowItemVisible 	: false,
		pageLoad 			: function() {
        },        
        addObj 				: function(){		    
        	this.dataSource.add({
        		code_length			: "",
        		name 				: "",
        		is_system			: 0
        	});
        	var data = this.dataSource.data();
			var obj = data[data.length-1];
			this.set("obj", obj);	            	
        },
        openWindow			: function(){
      		this.addObj();

         	this.set("windowVisible", true);
      	},
      	closeWindow 		: function(){
      		this.dataSource.cancelChanges();

      		this.set("windowVisible", false);
      	},
        save 				: function(){
        	var self = this;
        	this.dataSource.sync();
        	this.dataSource.bind("requestEnd", function(e){
        		if( e.type == "create" || e.type == "update"){ 
        			self.set("windowVisible", false);
        		}
        	});
        },
        edit 				: function(e){
      		var data = e.data;
      		this.set("obj", data);

      		this.set("windowVisible", true);
      	},      	
      	delete 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
		        var self = this, data = e.data;

		        this.deleteDS.query({
		        	filter: { field:"segment_id", value:data.id},
		        	page:1,
		        	pageSize:1
		        }).then(function(){
		        	var view = self.deleteDS.view();

		        	if(view.length>0){
		        		this.dataSource.remove(data);
		        		this.dataSource.sync();
		        	}else{
		        		alert("Sorry, this item can not be deleted.");
		        	}
		        });		        		        
	    	}	    	
	    },
	    view 				: function(e){
	    	var data = e.data;
	    	this.set("objName", data.name);
	    	this.itemDS.filter({ field: "segment_id", value: data.id});
	    },
	    openWindowItem		: function(){
         	this.set("windowItemVisible", true);
      	},
      	closeWindowItem 	: function(){
      		this.itemDS.cancelChanges();

      		this.set("windowItemVisible", false);
      	},
      	loadItem 			: function(e){
	        var d = e.data;

	        this.set("selectedType", true);
	        this.set("tax_type_id", d.id);
	        this.set("selectedTypeName", d.name);
	        
	        this.itemDS.query({
	        	filter: { field:"segment_id", value: d.id },
	        	page: 1,
	        	pageSize: 100
	        });  	
        },
      	addItem				: function(e){
		    var data = e.data;

        	this.itemDS.add({
        		segment_id 		: data.id,
        		code 			: "",
        		is_system		: 0,        		
        		segment 		: [{name: ""}]
        	});
        	var data = this.itemDS.data();
			var obj = data[data.length-1];
			this.set("item", obj);
			this.openWindowItem();	            	
        },
      	saveItem 				: function(){
        	var self = this;
        	this.itemDS.sync();
        	this.itemDS.bind("requestEnd", function(e){
        		if( e.type == "create" || e.type == "update"){ 
        			self.set("windowItemVisible", false);
        		}
        	});
        },
        editItem 				: function(e){
      		var data = e.data;
      		this.set("item", data);

      		this.set("windowItemVisible", true);
      	}, 
      	deleteItem 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
		        var self = this, data = e.data;

		        this.itemDeleteDS.query({
		        	filter: { field:"segments", operator:"contains", value:data.id},
		        	page:1,
		        	pageSize:1
		        }).then(function(){
		        	var view = self.itemDeleteDS.view();

		        	if(view.length>0){
		        		this.dataSource.remove(data);
		        		this.dataSource.sync();
		        	}else{
		        		alert("Sorry, this item can not be deleted.");
		        	}
		        });
	    	}
	    }
    });
	banhji.accountingReportCenter = kendo.observable({
		lang 				: langVM,
		dataSource			: dataStore(apiUrl+"accounting_reports/financial_snapshot"),
		income 				: 0,
		expense 			: 0,
		net_income 			: 0,
		asset 				: 0,
		liability 	 		: 0,
		equity 	 			: 0,		
		pageLoad 			: function(){
			var self = this;
			
			this.dataSource.query({
				filter: [],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.dataSource.view();				
				
				self.set("income", kendo.toString(view[0].income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("expense", kendo.toString(view[0].expense, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("net_income", kendo.toString(view[0].net_income, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				
				self.set("asset", kendo.toString(view[0].asset, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("liability", kendo.toString(view[0].liability, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("equity", kendo.toString(view[0].equity, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
			});										
		}
	});
	banhji.accountingSetting =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: banhji.source.customerTypeDS,
        txnTemplateDS		: dataStore(apiUrl + "transaction_templates"),
        prefixDS			: dataStore(apiUrl + "prefixes"),
        contactTypeName 	: "",
        contactTypeAbbr 	: "",
        contactTypeCompany 	: 0,
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTermNetDue	: "",
        paymentTermPeriod 	: "",
        paymentTermPercentage 	: "",
        pageLoad 			: function() {
        	this.txnTemplateDS.filter({ field: "moduls", value : "customer_mg" });
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 1,
	        		name 		: name,
	        		abbr 		: this.get("contactTypeAbbr"),
	        		description : "",
	        		is_company 	: this.get("contactTypeCompany"),
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();

	        	this.set("contactTypeName", "");
	        	this.set("contactTypeAbbr", "");
	        	this.set("contactTypeCompany", 0);
        	}
        },
        addPaymentMethod 		: function(){
        	var name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.paymentMethodDS.sync();

	        	this.set("paymentMethodName", "");
        	}
        },
        addPaymentTerm 		: function(){
        	var name = this.get("paymentTermName");

        	if(name!==""){
	        	this.paymentTermDS.add({	        		
	        		name 				: name,
	        		net_due 			: this.get("paymentTermNetDue"),
	        		discount_period 	: this.get("paymentTermPeriod"),
	        		discount_percentage : this.get("paymentTermPercentage"),
	        		is_system 			: 0
	        	});

	        	this.paymentTermDS.sync();

	        	this.set("paymentTermName", "");
	        	this.set("paymentTermNetDue", "");
	        	this.set("paymentTermPeriod", "");
	        	this.set("paymentTermPercentage", "");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;        	        	

        	if(kendo.parseInt(data.contact_id)>0){        		        	
	        	banhji.router.navigate('/customer/'+data.contact_id+'/1');   	
        	}else{
        		banhji.router.navigate('/customer');
        		banhji.customer.set("contact_type_id",data.id);
        	}
        },
        deleteForm 		: function(e){
        	var data = e.data;
        	if(confirm("Do you want to delete it?") == true) {
        		this.txnTemplateDS.remove(data);
        		this.txnTemplateDS.sync();
        	}
        },
        goInvoiceCustom : function(){

		    banhji.invoiceCustom.set("selectTypeList", banhji.source.customerFormList);
		    banhji.invoiceCustom.set("formShow", banhji.view.invoiceForm10);
		    banhji.router.navigate('/invoice_custom');
        }
    });
    banhji.addAccountingprefix =  kendo.observable({
		lang 				: langVM,		
		selectTypeList 		: banhji.source.typeList,
		Type 				: "Invoice",
        dataSource			: dataStore(apiUrl + "prefixes"),
        pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{	
				this.cancel;
			}
		},
		loadObj 			: function(id){
			var self = this;	
			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.dataSource.view();
				self.set("obj", view[0]);
				
			});	
		},	
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });
		    return dfd;	    		    	
	    }, 	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");
			//Save Obj
			this.objSync()
			.then(function(data){ //Success	
				banhji.accountingSetting.prefixDS.fetch();	
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					//window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();		
			window.history.back();
		}
    });
	/*********************
	*   Employee Section   *
	**********************/
	banhji.employeeDashboard = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/customer_summary"),
		topCustomerDS 		: dataStore(apiUrl + "dashboards/top_customer"),
		topARDS 			: dataStore(apiUrl + "dashboards/top_ar"),
		topProductDS 		: dataStore(apiUrl + "dashboards/top_product"),
		graphDS 			: dataStore(apiUrl + 'dashboards/monthly_sale'),
		sale 				: 0,
		sale_customer 		: 0,
		sale_product 		: 0,
		sale_order 			: 0,
		order 				: 0,
		order_avg 			: 0,
		order_open 			: 0,
		ar 					: 0,
		ar_open 			: 0,
		ar_customer 		: 0,
		ar_overdue 			: 0,
		pageLoad 			: function(){
			var self = this, today = new Date(),
			firstDayOfYear = new Date(today.getFullYear(), 0, 1);

			// this.summaryDS.query({
			// 	filter: [
			// 		{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
			// 		{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
			// 	],								
			// 	page: 1,
			// 	pageSize: 5
			// }).then(function(){
			// 	var view = self.summaryDS.view();

			// 	self.set("sale", kendo.toString(view[0].sale, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale));
			// 	self.set("sale_customer", kendo.toString(view[0].sale_customer, "n0"));
			// 	self.set("sale_product", kendo.toString(view[0].sale_product, "n0"));
			// 	self.set("sale_order", kendo.toString(view[0].sale_order, "n0"));

			// 	self.set("order", kendo.toString(view[0].order, "n0"));
			// 	self.set("order_avg", kendo.toString(view[0].order_avg, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale));				
			// 	self.set("order_open", kendo.toString(view[0].order_open, "n0"));

			// 	self.set("ar", kendo.toString(view[0].ar, banhji.institute.locale=="km-KH"?"c0":"c", banhji.institute.locale));
			// 	self.set("ar_open", kendo.toString(view[0].ar_open, "n0"));
			// 	self.set("ar_customer", kendo.toString(view[0].ar_customer, "n0"));
			// 	self.set("ar_overdue", kendo.toString(view[0].ar_overdue, "n0"));
			// });

			// this.topCustomerDS.query({
			// 	filter: [
			// 		{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
			// 		{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
			// 	],								
			// 	page: 1,
			// 	pageSize: 5
			// });

			// this.topARDS.query({
			// 	filter: [
			// 		{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
			// 		{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
			// 	],							
			// 	page: 1,
			// 	pageSize: 5
			// });

			// this.topProductDS.query({
			// 	filter: [
			// 		{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
			// 		{ field:"issued_date <=", operator:"where_related", model:"transaction", value:  kendo.toString(today, "yyyy-MM-dd") }
			// 	],							
			// 	page: 1,
			// 	pageSize: 5
			// });

			// this.loadGraph();								
		},
		loadGraph 			: function(){
			var self = this, 
			today = new Date(),
			firstDayOfYear = new Date(today.getFullYear(), 0, 1);

			this.graphDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],
				page: 1,
				pageSize: 100
			}).then(function(e) {
			    var view = self.graphDS.view();
			    
				$('#graph').kendoChart({
					dataSource: {data: view},												
					series: [
						{field: 'sale', categoryField:'month', type: 'line', axis: 'order'}
					],
					valueAxes: [
						{
		                    name: "order",
		                    color: "#007eff",
		                    min: 0,
		                    majorUnit: 500000,
		                    max: 1000000
		                }
	                ],
	                categoryAxis: {
	                    //categories: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],		                    
	                    axisCrossingValues: [0, 13],
	                    justified: true
	                },
	                tooltip: {
	                    visible: true,
	                    format: "{0}",
	                    template: "#= series.field #: #= value #"
	                }
				});
			});		
		}
	});
	banhji.employeeCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(apiUrl + 'transactions'),
		contactDS 			: dataStore(apiUrl + 'contacts'),
		contactTypeDS		: banhji.source.supplierTypeDS,
		noteDS 				: dataStore(apiUrl + 'notes'),
		currencyDS 			: banhji.source.currencyDS,
		summaryDS 			: dataStore(apiUrl + "transactions"),
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		note 				: "",
		searchText 			: "",
		contact_type_id 	: 0,
		currency_id 		: 0,
		user_id 			: banhji.source.user_id,
		balance 			: 0,
		po 					: 0,
		openInvoice 		: 0,
		overInvoice 		: 0,
		pageLoad 			: function(){
		},
		loadSummary 		: function(id){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Cash_Purchase","Credit_Purchase", "Purchase_Order"] },
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view(),
				balance = 0, open = 0, over = 0, po = 0, today = new Date();

				$.each(view, function(index, value){
					if(value.type=="Purchase_Order"){
						po++;
					}else{
						balance += kendo.parseFloat(value.amount);
						open++;

						if(new Date(value.due_date)<today){						
							over++;
						}
					}									
				});
				
				self.set("balance", kendo.toString(balance, "c", obj.locale));
				self.set("po", kendo.toString(po, "n0"));
				self.set("openInvoice", kendo.toString(open, "n0"));
				self.set("overInvoice", kendo.toString(over, "n0"));
			});
		},
		loadTransaction 	: function(id){
			this.transactionDS.query({
			  	filter: { field:"contact_id", value: id },
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 100
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value:["Purchase","Expense"] },			  		
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 100
			});
		},
		loadPO 				: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"PO" },			  		
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 100
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Purchase","Expense"] },
			  		{ field:"due_date <", value: new Date() },
			  		{ field:"status", value: 0 }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 100
			});
		},		
		loadNote 			: function(id){
			this.noteDS.query({
				filter: { field:"contact_id", value: id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				pageSize: 100
			});
		},			
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);			
			this.loadSummary(id);
			this.loadTransaction(id);			
			this.loadNote(id);
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
	  		txtSearch = this.get("searchText"),       		
	  		contact_type_id = this.get("contact_type_id"),
	  		currency_id = this.get("currency_id");      		
	  		
	  		if(txtSearch){
	  			para.push(      				
	  				{ field: "number", operator: "like", value: txtSearch },
	  				{ field: "surname", operator: "or_like", value: txtSearch },
					{ field: "name", operator: "or_like", value: txtSearch },
					{ field: "company", operator: "or_like", value: txtSearch }
	  			);
	  		}      		

	  		if(contact_type_id){
	  			para.push({ field: "contact_type_id", value: contact_type_id });
	  		}else{
	  			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 2 });
	  		}

	  		if(currency_id){
	  			para.push({ field: "currency_id", value: currency_id });
	  		}      		

	  		this.contactDS.filter(para);
	  		var loaded = false;
	  		this.contactDS.bind("requestEnd", function(){
	  			if(loaded==false){
	  				loaded = true;

	  				//Clear search filters
		      		self.set("searchText", "");		      		
		      		self.set("contact_type_id", 0);
		      		self.set("currency_id", 0);
	  			}
	  		});      			
		},
		searchTransaction	: function(){
			var self = this,
				para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
	    		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

	    	//Dates
	    	if(start && end){
	        	para.push({ field:"issued_date >=", value: kendo.toString(start, "yyyy-MM-dd") });
	        	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });            	            	
	        }else if(start){
	        	para.push({ field:"issued_date", value: kendo.toString(start, "yyyy-MM-dd") });
	        }else if(end){
	        	para.push({ field:"issued_date <=", value: kendo.toString(end, "yyyy-MM-dd") });
	        }else{
	        	
	        }

	        para.push({ field:"contact_id", value: obj.id });            

	        this.transactionDS.query({
	        	filter: para,
	        	sort: { field: "issued_date", dir: "desc" },
	        	page: 1,
	        	pageSize: 100
	        });            
		},	
		goEditContact 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/vendor/'+obj.id);
		},
		goCashadvance		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/cash_advance');
			banhji.cashAdvance.loadContact(obj.id);			
		},
		goExpense			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/expense');
			banhji.expense.loadContact(obj.id);
		},
		saveNote 			: function(){
			var self = this;

			if(this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: this.get("obj").id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});
				var saved = false;
				this.noteDS.sync();
				this.noteDS.bind("requestEnd", function(){
					if(saved==false){
						saved = true;

						self.set("note", "");
					}
				});
			}else{
				alert("memo is required");
			}
		}
	});
	banhji.employee = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl + "contacts"),
		patternDS 				: dataStore(apiUrl + "contacts"),
		deleteDS 				: dataStore(apiUrl + "transactions"),
		existingDS 				: dataStore(apiUrl + "contacts"),
		businessTypeDS			: dataStore(apiUrl + "businesstypes"),
		contactTypeDS  			: banhji.source.employeeTypeDS,
		contactPersonDS			: dataStore(apiUrl + "contact_persons"),
		currencyDS 				: banhji.source.currencyDS,
		adDS  					: banhji.source.ADAcountDS,
		saDS  					: banhji.source.SAAcountDS,
		genders					: banhji.source.genderList,
		statusList 				: banhji.source.statusList,
	    obj 					: null,
		originalNo				: null,
		isDuplicateNumber 		: false,
		isCompany 				: false,
		isEdit 					: false,
		pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);							
				this.loadObj(id);
				this.loadContactPerson(id);				
			}else{				
				if(this.get("isEdit")){
					this.set("isEdit", false);
										
					this.dataSource.data([]);					
					
					this.addEmpty();
				}else if(this.dataSource.total()==0){
					this.addEmpty();					
				}else{
					var obj = this.get("obj");

					obj.set("is_pattern", false);	
				}								
			}			
		},
		setPattern 				: function(id){
			var obj = this.get("obj");

			obj.set("contact_type_id", id);
			obj.set("is_pattern", true);
		},
		loadPattern 			: function(id){
			var self = this;

			this.patternDS.query({
				filter: [
					{ field:"contact_type_id", value: id },
					{ field:"is_pattern", value: true }
				],
				page: 1,
				pageSize: 1
			}).then(function(data){
				var view = self.patternDS.view(),
				obj = self.get("obj");

				if(view.length>0){
					obj.set("account_id", view[0].account_id);
					obj.set("discount_account_id", view[0].discount_account_id);
					obj.set("deposit_account_id", view[0].deposit_account_id);
					obj.set("tax_item_id", view[0].tax_item_id);
					obj.set("currency_id", view[0].currency_id);
					obj.set("credit_limit", view[0].credit_limit);

					obj.set("payment_term_id", view[0].payment_term_id);
					obj.set("payment_method_id", view[0].payment_method_id);
					obj.set("business_type_id", view[0].business_type_id);
				}else{
					obj.set("account_id", 0);
					obj.set("discount_account_id", 0);
					obj.set("deposit_account_id", 0);
					obj.set("tax_item_id", 0);
					obj.set("currency_id", 0);
					obj.set("credit_limit", 0);

					obj.set("payment_term_id", 0);
					obj.set("payment_method_id", 0);
					obj.set("business_type_id", 0);
				}
			});
		},
		loadObj 				: function(id){
			var self = this;

			this.dataSource.query({
				filter:{ "field":"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				if(view[0].contact_type_id=="6" || view[0].contact_type_id=="7" || view[0].contact_type_id=="8"){
					self.set("isCompany", true);
				}else{
					self.set("isCompany", false);
				}

				self.set("obj", view[0]);
				self.loadMap();
				self.set("originalNo", view[0].number);											
			});
		},
		loadPatternEdit			: function(id){
			var self = this;

			this.dataSource.query({
				filter:[
					{ "field":"id", value: id },
					{ "field":"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("obj", view[0]);														
			});
		},		
		loadContactPerson		: function(id){
			this.contactPersonDS.query({
				filter: { "field":"contact_id", value: id },
				page: 1,
				pageSize: 100
			});
		},		
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},
		contactTypeChanges 		: function(){
			var obj = this.get("obj");

			if(obj.contact_type_id>0){
				this.loadPattern(obj.contact_type_id);
			}
		},      	
		checkExistingNumber 	: function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},		
		addEmptyContactPerson 	: function(){
			var contact_id = 0;
			if(this.get("isEdit")){
				contact_id = this.get("obj").id;
			}

			this.contactPersonDS.add({					 			
				contact_id 			: contact_id,
	  			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},
	  	addEmpty 				: function(){
	  		this.dataSource.data([]);
	  		this.set("obj", null);

			this.dataSource.add({
				"company_id" 			: 0,
				"ebranch_id" 			: 0,
				"elocation_id"			: 0,
				"wbranch_id" 			: 0,
				"wlocation_id" 			: 0,			
				"currency_id" 			: 0,
				"user_id" 				: 0,
				"contact_type_id" 		: 0,							
				"number"				: "",
				"enumber"				: "",
				"wnumber"				: "",
				"surname"				: "",
				"name"					: "",
				"gender"				: "M",
				"dob"					: "",
				"pob"					: "",
				"latitute" 				: "",
				"longtitute" 			: "",
				"credit_limit"			: 0,				
				"id_number"				: "",
				"phone" 				: "",
				"email" 				: "",
				"website" 				: "",			
				"job"					: "",				
				"vat_no"				: "",
				"family_member"			: "",
				"address" 				: "",
				"bill_to" 				: "",
				"ship_to" 				: "",
				"memo"					: "",				
				"image_url"				: "",
				"company"				: "",
				"company_en"			: "",		
				"bank_name"				: "",
				"bank_address"			: "",
				"bank_account_name"		: "",
				"bank_account_number"	: "",
				"name_on_cheque"		: "",				
				"business_type_id"		: 0,
				"payment_term_id"		: 0,
				"payment_method_id"		: 0,
				"deposit_account_id"	: 0,
				"discount_account_id"	: 0,				
				"account_id"			: 0,
				"salary_account_id"		: 0,
				"ra_id"					: 0,
				"tax_item_id"			: 0,				
				"phase_id"				: 0,
				"voltage_id"			: 0,
				"ampere_id"				: 0,
				"registered_date" 		: new Date(),			
				"use_electricity"		: 0,
				"use_water"				: 0,
				"is_local" 				: 0,
				"is_pattern" 			: 0,				
				"status"				: 1							
			});			

			var data = this.dataSource.data();			
			var obj = data[data.length - 1];			
			this.set("obj", obj);	
		},
		contactSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
		save 					: function(){			
			var self = this, saved = false;

			if(this.get("isEdit")){
				this.dataSource.sync();
				this.contactPersonDS.sync();
			}else{
				this.contactSync().then(function(data){
					self.saveContactPerson(data[0].id);

					if(data[0].is_pattern){
						self.savePattern(data[0].contact_type_id, data[0].id);
					}
				}).then(function(){					
					self.contactPersonDS.data([]);

					self.addEmpty();
				});
			}						
		},
		delete 					: function(){
			var self = this,
			obj = this.get("obj"),
			id = obj.id;

			if (confirm("Are you sure, you want to delete it?")) {				
				this.deleteDS.query({
				  	filter: { field: "contact_id", value: id },
				  	page: 1,
				  	pageSize: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(id);
				        self.dataSource.remove(data);
				        self.save();

				        window.history.back();
					}
				});
	    	}
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();

			window.history.back();
		},
		saveContactPerson 		: function(id){
			$.each(this.contactPersonDS.data(), function(index, value) {
				value.set("contact_id", id);
			});

			this.contactPersonDS.sync();
		},
		savePattern 			: function(contact_type_id, contact_id){
			var data = this.contactTypeDS.get(contact_type_id);
			data.set("contact_id", contact_id);
			this.contactTypeDS.sync();

			banhji.vendorSetting.contactTypeDS.fetch();
			window.history.back();
		}
	});
	banhji.cashAdvance =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "account_lines"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "account_lines"),
		contactDS 			: banhji.source.employeeDS,
		currencyDS 			: banhji.source.currencyDS,
		jobDS				: banhji.source.jobDS,
		paymentMethodDS		: banhji.source.paymentMethodDS,
		accountDS  			: banhji.source.accountDS,
		cashAccountDS  		: banhji.source.cashAccountDS,
		advAccountDS  		: banhji.source.advAccountDS,
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		segmentItemDS 		: banhji.source.segmentItemDS,
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Cash_Advance" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		showRef 			: true,
		showName 			: false,
		showSegment 		: false,
		total				: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}

			this.recurringDS.filter([
				{ field:"type", value:"Cash_Advance" },
				{ field:"is_recurring", value:1 }
			]);
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
	    //Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);
			this.changes();						
		},
		//Segment
		segmentChanges  	: function(e) {
			var dataArr = e.data.segments;
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		transactionSegmentChanges  	: function() {
			dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}
		},
	    //Obj
		loadObj 			: function(id,is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();
				
				self.set("obj", view[0]);
				self.set("original_total", view[0].amount);		       		

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });								
			});				
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);								

			this.dataSource.insert(0, {
				recurring_id 		: "",
				account_id 			: 1,
				payment_method_id 	: 1,				
				user_id 			: this.get("uer_id"), 	    			    		
			   	type				: "Cash_Advance", //required			   		   				   		   					   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.institute.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: new Date(),			   	   	
			   	memo 				: "",
			   	memo2 				: "",
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0			
	    	});		    		
			
			var obj = this.dataSource.at(0);
			this.set("obj", obj);
			
			this.addRow();
			this.setRate();				
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,				
				account_id 			: "",								
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				amount 	 			: 0,							
				rate				: obj.rate,
				locale				: obj.locale
			});																	
		},		
		remove 				: function(e){						
			var data = e.data;
			
			if(this.lineDS.total()>1){
				this.lineDS.remove(data);
	        	this.changes();
        	}	        	        
		},
		changes				: function(){
			var obj = this.get("obj");
			
			if(this.lineDS.total()>0){			
				var sum = 0;								
				
				$.each(this.lineDS.data(), function(index, value) {
					value.set("rate", obj.rate);

					sum += value.amount;
		        });		       	

		        this.set("total", kendo.toString(sum, "c0", obj.locale));		        
		        obj.set("amount", sum);		       								    	
	    	}else{
	    		this.set("total", 0);		        
		        obj.set("amount", 0);				
	    	}   	
		},
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);

	    			$.each(this.additionalCostDS.data(), function(index, value){
	    				value.set("is_recurring", 1);
	    			});
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});
					
					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Supplier
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:3 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:3 });

			banhji.userManagement.removeMultiTask("expense");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Journal
		addJournal 			: function(transaction_id){
			var self = this, obj = this.get("obj");

			//Add Cash Account on Dr
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: obj.account_id,										
				description 		: "",
				reference_no 		: "",
				segments 	 		: obj.segments,								
				dr 	 				: obj.amount,
				cr 					: 0,				
				rate				: obj.rate,
				locale				: obj.locale
			});

			$.each(self.lineDS.data(), function(index, value){
				//Add Cash Advance Account on Cr
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.account_id,											
					description 		: value.description,
					reference_no 		: value.reference_no,
					segments 	 		: value.segments,								
					dr 	 				: 0,
					cr 					: value.amount,				
					rate				: value.rate,
					locale				: value.locale
				});						
			});

			this.journalLineDS.sync();
		},
		//Recurring	
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id>0){
				var recur = this.recurringDS.get(obj.recurring_id);				
				
				obj.set("account_id", recur.account_id);
				obj.set("segments", recur.segments);
				obj.set("sub_total", recur.sub_total);
				obj.set("discount", recur.discount);
				obj.set("tax", recur.tax);
				obj.set("amount", recur.amount);
				obj.set("rate", recur.rate);
				obj.set("locale", recur.locale);					
				obj.set("memo", recur.memo);
				obj.set("memo2", recur.memo2);
				
				this.set("sub_total", kendo.toString(recur.sub_total, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("discount", kendo.toString(recur.discount, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("tax", kendo.toString(recur.tax, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("total", kendo.toString(recur.amount, recur.locale=="km-KH"?"c0":"c", recur.locale));

				//Item Line
				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var line = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(line, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							cost 				: value.cost,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});
				});

				//Account Line
				this.recurringAccountLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var accountLine = self.recurringAccountLineDS.view();
					self.accountLineDS.data([]);

					$.each(accountLine, function(index, value){
						self.accountLineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,				
							account_id 			: value.account_id,								
							description 		: value.description,
							reference_no 		: value.reference_no,
							segments 	 		: value.segments,								
							amount 	 			: value.amount,							
							rate				: value.rate,
							locale				: value.locale
						});
					});
				});

				//Additional Cost Line
				this.recurringAdditionalCostDS.query({
					filter: [
						{ field:"reference_id", value:recur.id },
						{ field:"is_recurring", value:1 },
					],
					page: 1,
					pageSize: 100
				}).then(function(){
					var additionalCostLine = self.recurringAdditionalCostDS.view();
					self.additionalCostDS.data([]);

					$.each(additionalCostLine, function(index, value){
						self.additionalCostDS.add({
							contact_id 			: value.contact_id,
							tax_item_id 		: value.tax_item_id,				
							user_id 			: value.user_id,
							reference_no 		: value.reference_no,	    		
						   	type				: value.type,
						   	sub_total 			: value.sub_total,				   		   					   				   	
						   	amount				: value.amount,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: new Date(),
						   	due_date 			: new Date(),
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0				
			    		});
			    	});
				});				
			}else{
				this.addEmpty();
			} 
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.expense =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),						
		lineDS  			: dataStore(apiUrl + "account_lines"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "account_lines"),		
		contactDS  			: banhji.source.employeeDS,
		supplierDS  		: banhji.source.supplierDS,
		currencyDS  		: banhji.source.currencyDS,
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),		
		accountDS  			: banhji.source.accountDS,
		jobDS				: dataStore(apiUrl + "jobs"),
		cashAccountDS  		: banhji.source.cashAccountDS,
		expenseAccountDS    : banhji.source.expenseAccountDS,
		taxItemDS  			: dataStore(apiUrl + "tax_items"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Direct_Expense" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		segmentItemDS 		: banhji.source.segmentItemDS,		
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		showRef 			: true,
		showName 			: false,
		showJob 			: false,
		showSegment 		: false,
		showCashAdvance 	: false,		
		sub_total 			: 0,
		tax 				: 0,
		total				: 0,
		credit 		 		: 0,
		remain 				: 0,
		user_id				: banhji.source.user_id,																			
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}

			this.recurringDS.filter([
				{ field:"type", value:"Direct_Expense" },
				{ field:"is_recurring", value:1 }
			]);
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);
			this.changes();						
		},
		//Contact
		loadContact 		: function(id){
			var self = this;			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    			    	
		    	obj.set("locale", view[0].locale);				
				
				self.setRate();											
			});
		},		
		contactChanges 		: function(){
			var obj = this.get("obj");

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);
		    			    	
		    	obj.set("locale", contact.locale);		    	
		    	this.setRate();		    			    			    	
	    	}
	    },
	    typeChanges 		: function(){
	    	var obj = this.get("obj");

	    	switch(obj.type) {
			    case "Reimbursement":
			        this.set("showCashAdvance", false);
			        break;
			    case "Advance_Settlement":
			        this.set("showCashAdvance", true);
			        break;
			    default:			         
			        this.set("showCashAdvance", false);
			}
	    },
	    //Segment
		segmentChanges  	: function(e) {					
			var dataArr = e.data.segments;			
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		transactionSegmentChanges  	: function() {									
			dataArr = this.get("obj").segments,			
			lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
	    //Obj
	    loadObj 			: function(id,is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();

				if(view.length>0){	       
					self.set("obj", view[0]);					
		        }				

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });								
			});				
		},															
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("tax", 0);
			this.set("total", 0);								

			this.dataSource.insert(0, {
				recurring_id 		: "",
				reference_id 		: "",
				account_id 			: 1,
				job_id 				: 0,				
				user_id 			: this.get("user_id"), 	    			    		
			   	type				: "Direct_Expense", //required
			   	sub_total 			: 0,
			   	tax 				: 0,			   		   				   		   					   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   			   	   	
			   	memo 				: "",
			   	memo2 				: "",
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0			
	    	});		    		
			
			var obj = this.dataSource.at(0);
			this.set("obj", obj);
			
			this.addRow();
			this.setRate();				
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				job_id 				: "",
				contact_id 			: "",				
				account_id 			: "",								
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				amount 	 			: 0,							
				rate				: obj.rate,
				locale				: obj.locale,
				reference_date 		: new Date()
			});																	
		},		
		remove 				: function(e){						
			var data = e.data;			
			
			if(this.lineDS.total()>1){			
				this.lineDS.remove(data);
	        	this.changes();
        	}        	        	        
		},
		changes				: function(){
			var self = this, obj = this.get("obj"), 
			subTotal = 0, total = 0, tax = 0, remain = 0;								
			
			$.each(this.lineDS.data(), function(index, value) {
				value.set("rate", obj.rate);

				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id);
					tax += value.amount * taxItem.rate;
				}

				subTotal += value.amount;
	        });

	        total = subTotal + tax;

	        if(obj.credit>0){
	        	remain = obj.credit - total;
	        }

	        this.set("sub_total", kendo.toString(subTotal, "c0", obj.locale));
	        this.set("tax", kendo.toString(tax, "c0", obj.locale));
	        this.set("total", kendo.toString(total, "c0", obj.locale));
	        this.set("credit", kendo.toString(obj.credit, "c0", obj.locale));
	        this.set("remain", kendo.toString(remain, "c0", obj.locale));

	        obj.set("sub_total", subTotal);
	        obj.set("tax", tax);
	        obj.set("amount", total);	    		
		},
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);

	    			$.each(this.additionalCostDS.data(), function(index, value){
	    				value.set("is_recurring", 1);
	    			});
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});
					
					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Supplier
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:3 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:3 });

			banhji.userManagement.removeMultiTask("expense");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Journal
		addJournal 			: function(transaction_id){
			var self = this, obj = this.get("obj"),
			taxList = {};

			//Tax accounts
			if(obj.tax>0){				
				$.each(this.lineDS.data(), function(index, value){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxAmount = value.amount * taxItem.rate;

					if(taxItem.account_id>0){
						if(taxList[taxItem.account_id]===undefined){
							taxList[taxItem.account_id]={"id": taxItem.account_id, "amount":taxAmount};						
						}else{											
							if(taxList[taxItem.account_id].id===taxItem.account_id){
								taxList[taxItem.account_id].amount += taxAmount;
							}else{
								taxList[taxItem.account_id]={"id": taxItem.account_id, "amount": taxAmount};
							}
						}
					}
				});

				//Tax account on Dr
				if(!jQuery.isEmptyObject(taxList)){				
					$.each(taxList, function(index, value){
						self.journalLineDS.add({					
							transaction_id 		: transaction_id,
							account_id 			: value.id,				
							contact_id 			: value.contact_id,				
							description 		: "",
							reference_no 		: "",
							segments 	 		: [],								
							dr 	 				: value.amount,
							cr 					: 0,				
							rate				: obj.rate,
							locale				: obj.locale
						});										
					});
				}
			}

			switch(obj.type) {
			    case "Advance_Settlement":
			    	//Zero Expense
			    	if(obj.amount==0 && obj.credit>0){			    		
			    		//Cash on Dr
			    		this.journalLineDS.add({					
							transaction_id 		: transaction_id,
							contact_id 			: obj.contact_id,
							account_id 			: obj.account_id,										
							description 		: "",
							reference_no 		: "",
							segments 	 		: obj.segments,								
							dr 	 				: obj.credit,
							cr 					: 0,				
							rate				: obj.rate,
							locale				: obj.locale
						});

			    		//Cash Advance on Cr
			    		$.each(this.referenceLineDS.data(), function(index, value){			    			
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: 0,
								cr 					: value.amount,				
								rate				: value.rate,
								locale				: value.locale
							});													
						});
			    	}

			    	//Full Expense
			    	if(obj.amount==obj.credit){			    		
			    		//Expense on Dr
			    		$.each(this.lineDS.data(), function(index, value){				
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: value.amount,
								cr 					: 0,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});

			    		//Cash Advance on Cr
			    		$.each(this.referenceLineDS.data(), function(index, value){							
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: 0,
								cr 					: value.amount,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});
			    	}

			   		//Over Expense
			    	if(obj.amount>obj.credit){			    		
			    		//Expense on Dr
			    		$.each(this.lineDS.data(), function(index, value){				
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: value.amount,
								cr 					: 0,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});

						//Cash Advance on Cr
			    		$.each(this.referenceLineDS.data(), function(index, value){							
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: 0,
								cr 					: value.amount,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});

						//Cash on Cr
						this.journalLineDS.add({					
							transaction_id 		: transaction_id,
							contact_id 			: obj.contact_id,
							account_id 			: obj.account_id,										
							description 		: "",
							reference_no 		: "",
							segments 	 		: obj.segments,								
							dr 	 				: 0,
							cr 					: obj.amount - obj.credit,				
							rate				: obj.rate,
							locale				: obj.locale
						});
			    	}

			    	//Less Expense
			    	if(obj.amount>0 && obj.amount<obj.credit){
			    		//Cash on Dr			    		
						this.journalLineDS.add({					
							transaction_id 		: transaction_id,
							contact_id 			: obj.contact_id,
							account_id 			: obj.account_id,										
							description 		: "",
							reference_no 		: "",
							segments 	 		: obj.segments,								
							dr 	 				: obj.credit - obj.amount,
							cr 					: 0,				
							rate				: obj.rate,
							locale				: obj.locale
						});

			    		//Expense on Dr
			    		$.each(this.lineDS.data(), function(index, value){				
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: value.amount,
								cr 					: 0,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});

						//Advance account on Cr
			    		$.each(this.referenceLineDS.data(), function(index, value){							
							self.journalLineDS.add({					
								transaction_id 		: transaction_id,
								contact_id 			: value.contact_id,
								account_id 			: value.account_id,											
								description 		: value.description,
								reference_no 		: value.reference_no,
								segments 	 		: value.segments,								
								dr 	 				: 0,
								cr 					: value.amount,				
								rate				: value.rate,
								locale				: value.locale
							});						
						});						
			    	}
			        
			        break;			    
			    default:
			    //Direct Expense & Reimbursement
			    //Expense on Dr
			    $.each(this.lineDS.data(), function(index, value){				
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						contact_id 			: value.contact_id,
						account_id 			: value.account_id,											
						description 		: value.description,
						reference_no 		: value.reference_no,
						segments 	 		: value.segments,								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});						
				});

			    //Cash on Cr
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					contact_id 			: obj.contact_id,
					account_id 			: obj.account_id,										
					description 		: "",
					reference_no 		: "",
					segments 	 		: obj.segments,								
					dr 	 				: 0,
					cr 					: obj.amount,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}
			
			this.journalLineDS.sync();
		},
		//Recurring	
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id>0){
				var recur = this.recurringDS.get(obj.recurring_id);				
				
				obj.set("account_id", recur.account_id);
				obj.set("job_id", recur.job_id);
				obj.set("segments", recur.segments);
				obj.set("sub_total", recur.sub_total);
				obj.set("discount", recur.discount);
				obj.set("tax", recur.tax);
				obj.set("amount", recur.amount);
				obj.set("rate", recur.rate);
				obj.set("locale", recur.locale);					
				obj.set("memo", recur.memo);
				obj.set("memo2", recur.memo2);
				
				this.set("sub_total", kendo.toString(recur.sub_total, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("discount", kendo.toString(recur.discount, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("tax", kendo.toString(recur.tax, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("total", kendo.toString(recur.amount, recur.locale=="km-KH"?"c0":"c", recur.locale));

				//Item Line
				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var line = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(line, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							cost 				: value.cost,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});
				});

				//Account Line
				this.recurringAccountLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var accountLine = self.recurringAccountLineDS.view();
					self.accountLineDS.data([]);

					$.each(accountLine, function(index, value){
						self.accountLineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,				
							account_id 			: value.account_id,								
							description 		: value.description,
							reference_no 		: value.reference_no,
							segments 	 		: value.segments,								
							amount 	 			: value.amount,							
							rate				: value.rate,
							locale				: value.locale
						});
					});
				});

				//Additional Cost Line
				this.recurringAdditionalCostDS.query({
					filter: [
						{ field:"reference_id", value:recur.id },
						{ field:"is_recurring", value:1 },
					],
					page: 1,
					pageSize: 100
				}).then(function(){
					var additionalCostLine = self.recurringAdditionalCostDS.view();
					self.additionalCostDS.data([]);

					$.each(additionalCostLine, function(index, value){
						self.additionalCostDS.add({
							contact_id 			: value.contact_id,
							tax_item_id 		: value.tax_item_id,				
							user_id 			: value.user_id,
							reference_no 		: value.reference_no,	    		
						   	type				: value.type,
						   	sub_total 			: value.sub_total,				   		   					   				   	
						   	amount				: value.amount,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: new Date(),
						   	due_date 			: new Date(),
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0				
			    		});
			    	});
				});				
			}else{
				this.addEmpty();
			} 
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});

	/*********************
	*   Vendor Section   *
	**********************/
	banhji.vendorDashboard = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/supplier_dashboard_summary"),
		topContactDS 		: dataStore(apiUrl + "dashboards/top_supplier"),
		topAPDS 			: dataStore(apiUrl + "dashboards/top_ap"),
		topProductDS 		: dataStore(apiUrl + "dashboards/top_purchase_product"),		
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/monthly_purchase",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		purchase 			: 0,
		purchase_supplier 	: 0,
		purchase_product 	: 0,
		purchase_order 		: 0,
		order 				: 0,
		order_avg 			: 0,
		order_open 			: 0,
		ap 					: 0,
		ap_open 			: 0,
		ap_customer 		: 0,
		ap_overdue 			: 0,						
		pageLoad 			: function(){
			var self = this;

			this.graphDS.read();

			this.summaryDS.query({
				filter: [],								
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();
				
				self.set("purchase", kendo.toString(view[0].purchase, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("purchase_supplier", kendo.toString(view[0].purchase_supplier, "n0"));
				self.set("purchase_product", kendo.toString(view[0].purchase_product, "n0"));
				self.set("purchase_order", kendo.toString(view[0].purchase_order, "n0"));

				self.set("order", kendo.toString(view[0].order, "n0"));
				self.set("order_avg", kendo.toString(view[0].order_avg, banhji.locale=="km-KH"?"c0":"c", banhji.locale));				
				self.set("order_open", kendo.toString(view[0].order_open, "n0"));

				self.set("ap", kendo.toString(view[0].ap, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ap_open", kendo.toString(view[0].ap_open, "n0"));
				self.set("ap_customer", kendo.toString(view[0].ap_customer, "n0"));
				self.set("ap_overdue", kendo.toString(view[0].ap_overdue, "n0"));
			});

			this.topContactDS.query({
				filter: [],								
				page: 1,
				pageSize: 5
			});

			this.topAPDS.query({
				filter: [],							
				page: 1,
				pageSize: 5
			});

			this.topProductDS.query({
				filter: [],							
				page: 1,
				pageSize: 5
			});										
		}
	});
	banhji.vendorCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(apiUrl + 'transactions'),
		contactDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:2 },
			sort:{ field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactTypeDS		: banhji.source.supplierTypeDS,
		noteDS 				: dataStore(apiUrl + 'notes'),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		summaryDS 			: dataStore(apiUrl + "transactions"),
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: {id:0},
		note 				: "",
		searchText 			: "",
		contact_type_id 	: null,
		balance 			: 0,
		po 					: 0,
		openInvoice 		: 0,
		overInvoice 		: 0,
		currencyCode 		: "",
		user_id 			: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.loadObj(id);
			}

			//Refresh
			if(this.contactDS.total()>0){
				this.contactDS.fetch();
				this.searchTransaction();
				this.loadSummary();
			}							
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		setCurrencyCode 	: function(){
			var code = "", obj = this.get("obj");

			$.each(banhji.source.currencyRateDS.data(), function(index, value){				
				if(value.locale == obj.locale){
					code = value.currency[0].code;					

					return false;					
				}
			});

			this.set("currencyCode", code);
		},
		loadObj 			: function(id){
			var self = this;

			this.contactDS.query({
				filter: { field:"id", value:id },
				page:1,
				pageSize:100
			}).then(function(){
				var view = self.contactDS.view();

				if(view.length>0){
					self.set("obj", view[0]);
					self.loadData();
				}
			});
		},
		loadData 			: function(){
			var obj = this.get("obj");

			this.searchTransaction();
			this.loadSummary(obj.id);
			this.setCurrencyCode();
			
			this.attachmentDS.filter({ field:"contact_id", value: obj.id });
			this.noteDS.query({
				filter: { field:"contact_id", value: obj.id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				pageSize: 10
			});
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
			if(obj.id>0){
		        // Check the extension of each file and abort the upload if it is not .jpg
		        $.each(files, function(index, value){
		            if (value.extension.toLowerCase() === ".jpg"
		            	|| value.extension.toLowerCase() === ".jpeg"
		            	|| value.extension.toLowerCase() === ".tiff"
		            	|| value.extension.toLowerCase() === ".png" 
		            	|| value.extension.toLowerCase() === ".gif"
		            	|| value.extension.toLowerCase() === ".pdf"){

		            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

		            	self.attachmentDS.add({
		            		user_id 		: self.get("user_id"),
		            		contact_id 		: obj.id,
		            		type 			: "Contact",
		            		name 			: value.name,
		            		description 	: "",
		            		key 			: key,
		            		url 			: banhji.s3 + key,
		            		size 			: value.size,
		            		created_at 		: new Date(),

		            		file 			: value.rawFile
		            	});	            			            		            
		            }else{
		            	alert("This type of file is not allowed to attach.");
		            }
		        });
	    	}else{
	    		alert("Please select a supplier!");
	    	}
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    		this.attachmentDS.sync();
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
	    //Obj
		loadContact 		: function(id){
			var self = this;			
			
			this.contactDS.query({
			  	filter:[
			  		{ field:"id", value:id }
			  	],
			  	page: 1,
			  	pageSize: 50
			}).then(function(e) {
			    var view = self.contactDS.data();
			    
			    if(view.length>0){
			    	self.set("obj", view[0]);				    	
			    	self.loadData();		    	
			    }
			});			
		},				
		loadSummary 		: function(id){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Credit_Purchase", "Purchase_Order"] },
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 1000
			}).then(function(){
				var view = self.summaryDS.view(),
				balance = 0, open = 0, over = 0, po = 0, today = new Date();

				$.each(view, function(index, value){
					if(value.type=="Purchase_Order"){
						po++;
					}else{
						balance += kendo.parseFloat(value.amount);
						open++;

						if(new Date(value.due_date)<today){						
							over++;
						}
					}									
				});
				
				self.set("balance", kendo.toString(balance, "c", obj.locale));
				self.set("po", kendo.toString(po, "n0"));
				self.set("openInvoice", kendo.toString(open, "n0"));
				self.set("overInvoice", kendo.toString(over, "n0"));
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Credit_Purchase" },			  		
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadPO 				: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Purchase_Order" },			  		
			  		{ field:"status", value: 0 }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Cash_Purchase","Credit_Purchase"] },
			  		{ field:"due_date <", value: new Date() },
			  		{ field:"status", value: 0 }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		selectedRow			: function(e){
			var data = e.data;
			
			this.set("obj", data);
			this.loadData();
		},
		//Search		
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		searchText = this.get("searchText"),
      		contact_type_id = this.get("contact_type_id");
      		
      		if(searchText){
      			var textParts = searchText.replace(/([a-z]+)/i, "$1 ").split(/[^0-9a-z]+/ig);

      			para.push(
      				{ field: "abbr", value: textParts[0] },
      				{ field: "number", value: textParts[1] },
					{ field: "name", operator: "or_like", value: searchText }
      			);
      		}

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}else{
      			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 2 });
      		}

      		this.contactDS.filter(para);
			
			//Clear search filters
      		self.set("searchText", "");
      		self.set("contact_type_id", 0);
		},
		searchTransaction	: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),
        		para = [], obj = this.get("obj");

        	if(obj.id>0){
        		para.push({ field:"contact_id", value: obj.id });        	

	        	//Dates
	        	if(start && end){
	            	para.push({ field:"issued_date >=", value: start });
	            	para.push({ field:"issued_date <=", value: end });
	            }else if(start){
	            	para.push({ field:"issued_date", value: start });
	            }else if(end){
	            	para.push({ field:"issued_date <=", value: end });
	            }else{
	            	
	            }

	            this.transactionDS.query({
	            	filter: para,
	            	sort: [
				  		{ field: "issued_date", dir: "desc" },
				  		{ field: "id", dir: "desc" }
				  	],
	            	page: 1,
	            	pageSize: 10
	            });
            }            
		},
		//Links	
		goEdit 		 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/vendor/'+obj.id);
		},
		goPO				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/purchase_order');
			banhji.purchaseOrder.loadContact(obj.id);			
		},
		goDeposit			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/vendor_deposit');
			banhji.vendorDeposit.loadContact(obj.id);			
		},
		goPurchase			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/purchase');
			banhji.purchase.loadContact(obj.id);
		},
		goPurchaseReturn	: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/purchase_return');
			banhji.purchaseReturn.loadContact(obj.id);
		},
		goGRN				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/grn');
			banhji.grn.loadContact(obj.id);
		},
		goCashPayment		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/cash_payment');
			banhji.cashPayment.loadContact(obj.id);
		},
		payBill 			: function(e){
			var data = e.data;

			banhji.router.navigate('/cash_payment');
			banhji.cashPayment.loadInvoice(data.id);
		},
		//Note
		saveNoteEnter 		: function(e){
			e.preventDefault();
			this.saveNote();
		},
		saveNote 			: function(){
			var obj = this.get("obj");

			if(obj.id>0 && this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: obj.id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});

				this.noteDS.sync();
				this.set("note", "");					
			}else{
				alert("Please select a supplier and Memo is required");
			}
		}
	});
	banhji.vendor = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl + "contacts"),
		patternDS 				: dataStore(apiUrl + "contacts"),
		numberDS 				: dataStore(apiUrl + "contacts"),
		protectDS 				: dataStore(apiUrl + "transactions"),		
		existingDS 				: dataStore(apiUrl + "contacts"),		
		contactPersonDS			: dataStore(apiUrl + "contact_persons"),		
		paymentTermDS			: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS			: dataStore(apiUrl + "payment_methods"),
		taxItemDS				: dataStore(apiUrl + "tax_items"),
		countryDS 				: banhji.source.countryDS,
		contactTypeDS  			: banhji.source.supplierTypeDS,
		currencyDS 		  		: banhji.source.currencyDS,
		apDS 		  			: banhji.source.APAccountDS,		
		prepaidAccountDS 		: banhji.source.prepaidAccountDS,
		tradeDiscountDS 		: banhji.source.supplierTradeDiscountDS,
		settlementDiscountDS 	: banhji.source.supplierSettlementDiscountDS,
		genders					: banhji.source.genderList,
		statusList 				: banhji.source.statusList,
		confirmMessage 			: banhji.source.confirmMessage,
		isEdit 					: false,
		isProtected 			: false,
        obj 					: null,
        saveClose 				: false,
		showConfirm 			: false,
		isDuplicateNumber 		: false,
		phFullname 				: "Supplier Name ...",
		contact_type_id 		: 0,
		pageLoad 				: function(id, is_pattern){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}	
		},
		//Contact Person
		addEmptyContactPerson 	: function(){
			var obj = this.get("obj");
			
			this.contactPersonDS.add({					 			
				contact_id 			: obj.id,
      			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},
		//Map
		loadMap 				: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj");			
			
			if(obj.number!==""){

				if(this.get("isEdit")){
					para.push({ field:"id", operator:"where_not_in", value: [obj.id] });
				}

				para.push({ field:"abbr", value: obj.abbr });
				para.push({ field:"number", value: obj.number });
				para.push({ field:"contact_type_id", value: obj.contact_type_id });
				
				this.existingDS.query({
					filter: para,
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"contact_type_id", value:obj.contact_type_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}
			});
		},
		protectObj 				: function(){
			var self = this, obj = this.get("obj");

			this.protectDS.query({
			  	filter: { field: "contact_id", value: obj.id },
			  	page: 1,
			  	pageSize: 1
			}).then(function() {
				var view = self.protectDS.view();

				if(view.length>0){
					self.set("isProtected", true);
				}else{
					self.set("isProtected", false); 
				}
			});
		},
		//Obj
		loadObj 				: function(id, is_pattern){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

			this.dataSource.query({
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();			

				self.set("obj", view[0]);
				self.loadMap();
				self.protectObj();								
			});
		},
      	addEmpty 				: function(){
      		var self = this;
      		this.dataSource.data([]);
      		this.contactPersonDS.data([]);

      		this.set("isEdit", false);
      		this.set("isProtected", false);
      		this.set("isDuplicateNumber", false);
      		this.set("obj", null);

      		this.patternDS.query({
      			filter:[
      				{ field:"id", value:3 },
      				{ field:"is_pattern", value:1 }
      			],
      			page:1,
      			pageSize:1
      		}).then(function(){
      			var view = self.patternDS.view(),
      			type = self.contactTypeDS.at(0);

      			self.dataSource.insert(0, {				
					"country_id" 			: view[0].country_id,			
					"user_id" 				: 0,
					"contact_type_id" 		: 6,							
					"abbr"					: type.abbr,
					"number"				: "",				
					"surname"				: "",
					"name"					: "",
					"gender"				: view[0].gender,					
					"phone" 				: "",
					"email" 				: "",					
					"company"				: view[0].company,
					"vat_no"				: view[0].vat_no,					
					"memo"					: view[0].memo,
					"city"					: view[0].city,
					"post_code"				: view[0].post_code,
					"address" 				: view[0].address,
					"bill_to" 				: view[0].bill_to,
					"ship_to" 				: view[0].ship_to,
					"latitute" 				: "",
					"longtitute" 			: "",
					"credit_limit"			: view[0].credit_limit,
					"locale" 				: view[0].locale,														
					"payment_term_id"		: view[0].payment_term_id,
					"payment_method_id"		: view[0].payment_method_id,									
					"registered_date" 		: new Date(),
					"account_id"			: view[0].account_id,
					"ra_id"					: view[0].ra_id,
					"tax_item_id"			: view[0].tax_item_id,
					"deposit_account_id"	: view[0].deposit_account_id,
					"trade_discount_id"		: view[0].trade_discount_id,
					"settlement_discount_id": view[0].settlement_discount_id,					
					"is_pattern" 			: 0,
					"status"				: 1								
				});

				var obj = self.dataSource.at(0);				
				//Pattern
				if(self.get("contact_type_id")>0){
					obj.set("contact_type_id", self.get("contact_type_id"));
					obj.set("is_pattern", 1);
				}

				self.set("obj", obj);
				self.generateNumber();
      		});								
		},
		objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Contact Person has changes
		    	if(this.contactPersonDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Contact Person
					$.each(self.contactPersonDS.data(), function(index, value) {
						value.set("contact_id", data[0].id);
					});
					
					//Pattern
					if(data[0].is_pattern){
						self.savePattern(data[0].contact_type_id, data[0].id);
					}
				}
				self.contactPersonDS.sync();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();
			this.dataSource.data([]);
			this.contactPersonDS.data([]);
			this.set("contact_type_id", 0);

			banhji.userManagement.removeMultiTask("vendor");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(obj.is_pattern==0 && obj.isProtected==false){				
				obj.set("deleted", 1);
		        self.dataSource.sync();

		        window.history.back();					
			}else{
				alert("Sorry, this data is protected!");
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		},
		//Pattern		
		applyPattern 			: function(contact_id){
			var self = this, obj = self.get("obj");
			
			this.patternDS.query({
				filter: [
					{ field:"id", value: contact_id },
					{ field:"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 1
			}).then(function(data){
				var view = self.patternDS.view();				

				if(view.length>0){
					obj.set("country_id", view[0].country_id);					
					obj.set("gender", view[0].gender);
					obj.set("company", view[0].company);
					obj.set("vat_no", view[0].vat_no);
					obj.set("memo", view[0].memo);
					obj.set("city", view[0].city);
					obj.set("post_code", view[0].post_code);
					obj.set("address", view[0].address);
					obj.set("bill_to", view[0].bill_to);
					obj.set("ship_to", view[0].ship_to);									
					obj.set("payment_term_id", view[0].payment_term_id);
					obj.set("payment_method_id", view[0].payment_method_id);
					obj.set("credit_limit", view[0].credit_limit);
					obj.set("locale", view[0].locale);					
					obj.set("account_id", view[0].account_id);
					obj.set("ra_id", view[0].ra_id);
					obj.set("tax_item_id", view[0].tax_item_id);
					obj.set("deposit_account_id", view[0].deposit_account_id);
					obj.set("trade_discount_id", view[0].trade_discount_id);
					obj.set("settlement_discount_id", view[0].settlement_discount_id);					
				}else{
					obj.set("country_id", 0);					
					obj.set("gender", "M");
					obj.set("company", "");
					obj.set("vat_no", "");
					obj.set("memo", "");
					obj.set("city", "");
					obj.set("post_code", "");
					obj.set("address", "");
					obj.set("bill_to", "");
					obj.set("ship_to", "");									
					obj.set("payment_term_id", 0);
					obj.set("payment_method_id", 0);
					obj.set("credit_limit", 0);
					obj.set("locale", "");					
					obj.set("account_id", 0);
					obj.set("ra_id", 0);
					obj.set("tax_item_id", 0);
					obj.set("deposit_account_id", 0);
					obj.set("trade_discount_id", 0);
					obj.set("settlement_discount_id", 0);
				}
			});
		},
		savePattern 			: function(contact_type_id, contact_id){
			var data = banhji.customerSetting.contactTypeDS.get(contact_type_id);
			data.set("contact_id", contact_id);
			banhji.vendorSetting.contactTypeDS.sync();			
			window.history.back();
		},
		typeChanges 			: function(){
			var obj = this.get("obj");

			if(obj.contact_type_id){
				var type = this.contactTypeDS.get(obj.contact_type_id);
				this.applyPattern(type.contact_id);
				obj.set("abbr", type.abbr);

				this.generateNumber();
			}else{
				obj.set("company", "");
				obj.set("vat_no", "");

				obj.set("country_id", 0);					
				obj.set("gender", "M");
				obj.set("company", "");
				obj.set("vat_no", "");
				obj.set("memo", "");
				obj.set("city", "");
				obj.set("post_code", "");
				obj.set("address", "");
				obj.set("bill_to", "");
				obj.set("ship_to", "");									
				obj.set("payment_term_id", 0);
				obj.set("payment_method_id", 0);
				obj.set("credit_limit", 0);
				obj.set("locale", "");					
				obj.set("account_id", 0);
				obj.set("ra_id", 0);
				obj.set("tax_item_id", 0);
				obj.set("deposit_account_id", 0);
				obj.set("trade_discount_id", 0);
				obj.set("settlement_discount_id", 0);
			}
		}
	});
	banhji.purchaseOrder =  kendo.observable({
		lang 					: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS  			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		jobDS				: dataStore(apiUrl + "jobs"),
		measurementDS	 	: dataStore(apiUrl + "measurements"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),			
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Purchase_Order" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),		
		balanceDS  			: dataStore(apiUrl + "transactions"),
		contactDS  			: banhji.source.supplierDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.supplierTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm   		: false,
		statusSrc 			: "",
		showDeposit 		: false,
		showDiscount 		: false,
		showRequiredDate 	: false,
		sub_total 			: 0,
		tax 				: 0,
		discount 			: 0,
		balance 			: 0,
		total 				: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadBalance();
				self.loadRecurring();						
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			
	    	if(obj.contact_id>0){		    			    	
		    	contact = this.contactDS.get(obj.contact_id);
		    		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadBalance();
		    	this.loadRecurring();		    			    	
	    	}else{
	    		this.set("total_credit", 0);
	    	}
	    },
	    loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},	
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var rate = obj.rate / banhji.source.getRate(item.locale, new Date(obj.issued_date));

		        if(item.is_catalog=="1"){		        	
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));

							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.measurement_id,								
								description 		: value.purchase_description,				
								quantity 	 		: 1,
								cost 				: value.cost*catalogRate,												
								amount 				: value.cost*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: 1,								

								item_prices 		: []
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();
		    	}
	        }                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));				
				
				self.set("obj", view[0]);

				if(view[0].status=="1"){
					self.set("statusSrc", banhji.source.approvedSrc);
				}else{
					self.set("statusSrc", banhji.source.openSrc);
				}

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.jobDS.filter({ field: "contact_id", value: view[0].contact_id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });
				self.loadRecurring();				
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.cost;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}					

					value.set("amount", amt);					
					subTotal += amt;					
		        });				

		    	//Total
		        total = subTotal + tax;		        

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);									    	
	    	}	
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("discount", 0);
			this.set("tax", 0);
			this.set("total", 0);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 30);				

			this.dataSource.insert(0, {				
				contact_id 			: "",
				recurring_id 		: "",
				job_id 				: "",			
				user_id 			: this.get("user_id"),
			   	type				: "Purchase_Order",
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,			   				   	
			   	amount				: 0,
			   	deposit 			: 0,
			   	credit_allowed 		: 0,
			   	credit 				: 0,
			   	check_no 			: "",
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);					
			this.set("obj", obj);

			this.addRow();
			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				cost 				: 0,												
				amount 				: 0,
				discount 			: 0,
				rate				: obj.rate,
				locale				: obj.locale,
				movement 			: 1,
				required_date 		: new Date(),

				item_prices 		: []
			});																	
		},
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changes
		    	if(this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
    		//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){										
						value.set("transaction_id", data[0].id);										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}
				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Supplier
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });			

			banhji.userManagement.removeMultiTask("purchase_order");
		},
	    delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);					
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,							
							item_id 			: value.item_id,									
							description 		: value.description,							
							quantity 			: value.quantity,
							cost 				: value.cost,								
							amount 	 			: value.amount,									
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							required_date		: value.required_date,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});				
			}else{
				this.addEmpty();
			} 
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":			       
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;			    
			    default:			        
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");				
			}			

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,				
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,			   				   				   		   					   				   	
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,			   	
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,				   		   	   	
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1			
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({					
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,					
					item_id 			: value.item_id,								
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,													
					amount 	 			: value.amount,
					discount 			: value.discount,				
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.recurringDS.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    }
	});
	banhji.grn =  kendo.observable({
		lang 					: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		measurementDS	 	: dataStore(apiUrl + "measurements"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),			
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"GRN" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactDS  			: banhji.source.supplierDS,					
		itemDS  			: banhji.source.itemDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm   		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		total 				: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Contact
		loadContact 		: function(id){
			var self = this, obj = this.get("obj");
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view();
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadReference();
				self.loadRecurring();						
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			
	    	if(obj.contact_id>0){		    			    	
		    	contact = this.contactDS.get(obj.contact_id);
		    	
		    	obj.set("vat_id", contact.tax_item_id);
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadReference();
		    	this.loadRecurring();
	    	}
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var rate = obj.rate / banhji.source.getRate(item.locale, new Date(obj.issued_date));

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));

							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.measurement_id,								
								description 		: value.purchase_description,				
								quantity 	 		: 1,
								cost 				: value.cost*rate,												
								amount 				: value.cost*rate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: 1,								

								item_prices 		: []
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();
		    	}
	        }                	        	
		},		
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();
				
				self.set("obj", view[0]);
				self.set("total", kendo.toString(view[0].amount, "n0"));
				
				self.set("statusSrc", banhji.source.receivedSrc);

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });
				self.loadRecurring();				
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj"), total = 0;										

			$.each(this.lineDS.data(), function(index, value) {				
				total += value.quantity;										
	        });

			this.set("total", kendo.toString(total, "n0"));
			obj.set("amount", total);	    	
		},					
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);				

			this.dataSource.insert(0, {				
				contact_id 			: "",
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: "",				
				user_id 			: this.get("user_id"),
			   	type				: "GRN",
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	discount 			: 0,
			   	tax 				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: new Date(),			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();
			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				cost 				: 0,												
				amount 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: 1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var d = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(d);
		        this.changes();
	        }		        
		},
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changes
		    	if(this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
    		//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){										
						value.set("transaction_id", data[0].id);										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}
				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Supplier
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });			

			banhji.userManagement.removeMultiTask("grn");
		},
	    delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: "Purchase_Order" },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}				
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");

			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);

				obj.set("employee_id", data.employee_id);
				obj.set("segments", data.segments);
								
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: 0,
							item_id 			: value.item_id,
							tax_item_id 		: value.tax_item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							cost 				: value.cost,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});
		 	}
		},		 
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);					
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,							
							item_id 			: value.item_id,									
							description 		: value.description,							
							quantity 			: value.quantity,
							cost 				: value.cost,								
							amount 	 			: value.amount,									
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});				
			}else{
				this.addEmpty();
			} 
		},		
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":			       
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;			    
			    default:			        
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},		
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");				
			}			

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,				
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,			   				   				   		   					   				   	
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,			   	
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,				   		   	   	
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1			
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({					
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,					
					item_id 			: value.item_id,								
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,													
					amount 	 			: value.amount,
					discount 			: value.discount,				
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.recurringDS.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    }
	});
	banhji.vendorDeposit =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "account_lines"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "account_lines"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "account_lines"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		paymentMethodDS		: dataStore(apiUrl + "payment_methods"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Deposit" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactDS 			: banhji.source.supplierDS,
		depositAccountDS 	: banhji.source.prepaidAccountDS,
		segmentItemDS 		: banhji.source.segmentItemDS,
		accountDS 			: banhji.source.cashAccountDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthList 			: banhji.source.monthList,	
		monthOptionList 	: banhji.source.monthOptionList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,		
		obj 				: null,		
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		total				: 0,			
		uer_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;

			this.contactDS.query({
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("account_id", view[0].deposit_account_id);
		    	obj.set("locale", view[0].locale);
				
				self.setRate();
				self.loadReference();
				self.loadRecurring();
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");

	    	if(obj.contact_id>0){
		    	var contact = this.contactDS.get(obj.contact_id);
		    	
		    	obj.set("account_id", contact.deposit_account_id);
		    	obj.set("locale", contact.locale);
		    	this.setRate();
		    	this.loadReference();
		    	this.loadRecurring();
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment
		segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}
		},
		//Obj															
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);
			this.journalLineDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);								

			this.dataSource.insert(0, {
				recurring_id 		: "",
				account_id 			: "",				
				user_id 			: this.get("uer_id"), 	
				reference_id	 	: "",    			    		
			   	type				: "Vendor_Deposit", //required			   		   				   		   					   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   	   	
			   	memo 				: "",
			   	memo2 				: "",
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0			
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();
			this.setRate();				
		},
		addRow 				: function(){				
			var transaction_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				transaction_id = obj.id;
			}
						
			this.lineDS.add({					
				transaction_id 		: transaction_id,
				payment_method_id 	: 0,
				account_id 			: "",				
				contact_id 			: "",				
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				amount 	 			: 0,							
				rate				: obj.rate,
				locale				: obj.locale
			});																	
		},		
		remove 				: function(e){						
			var d = e.data;
							
			this.lineDS.remove(d);
        	this.changes();	        	        
		},
		changes				: function(){
			var obj = this.get("obj");
			
			if(this.lineDS.total()>0){			
				var sum = 0;								
				
				$.each(this.lineDS.data(), function(index, value) {
					sum += value.amount;
		        });		       	

		        this.set("total", kendo.toString(sum, "c", obj.locale));		        
		        obj.set("amount", sum);		       								    	
	    	}else{
	    		this.set("total", 0);		        
		        obj.set("amount", 0);				
	    	}   	
		},
		loadObj 			: function(id,is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();

				if(view.length>0){	       
					self.set("obj", view[0]);					
		        }				

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });								
			});				
		},			  
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("deposit", obj.amount);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				// Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			
			banhji.userManagement.removeMultiTask("vendor_deposit");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Journal
		addJournal 			: function(transaction_id){
	    	var self = this,
	    	sum =0,
	    	obj = this.get("obj");			

			//Cash account on CR
			$.each(this.lineDS.data(), function(index, value){
				sum += value.amount;
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.account_id,				
					contact_id 			: value.contact_id,				
					description 		: "",
					reference_no 		: value.reference_no,
					segments 	 		: [],								
					dr 	 				: 0,	
					cr 					: value.amount,			
					rate				: value.rate,
					locale				: value.locale
				});
			});

			//Deposit on DR
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: obj.account_id,				
				contact_id 			: obj.contact_id,				
				description 		: "",
				reference_no 		: "",
				segments 	 		: obj.segments,								
				dr 	 				: sum,	
				cr 					: 0,			
				rate				: obj.rate,
				locale				: obj.locale
			});

			this.journalLineDS.sync();
		},		
		//Reference
		loadReference 		: function(){
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: "Purchase_Order" },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}
		},
		referenceChanges 	: function(){
			var obj = this.get("obj");

			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);

				obj.set("segments", data.segments);
				obj.set("amount", data.amount);

				this.lineDS.data([]);
				this.lineDS.add({
					transaction_id 		: obj.id,
					account_id 			: "",
					description 		: "",
					reference_no 		: data.number,
					amount 	 			: data.amount,
					rate				: data.rate,
					locale				: data.locale
				});
			 	this.set("total", kendo.toString(data.amount, "c", data.locale));
		 	}
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							cost 				: value.cost,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.purchase =  kendo.observable({
		lang 					: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		accountLineDS  		: dataStore(apiUrl + "account_lines"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		additionalCostDS 	: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		recurringAccountLineDS : dataStore(apiUrl + "account_lines"),
		recurringAdditionalCostDS : dataStore(apiUrl + "transactions"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		jobDS				: dataStore(apiUrl + "jobs"),		
		balanceDS  			: dataStore(apiUrl + "transactions"),
		measurementDS		: dataStore(apiUrl + "measurements"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactListDS 		: banhji.source.supplierListDS,
		contactDS  			: banhji.source.supplierDS,
		accountDS  			: dataStore(apiUrl + "accounts"),
		expenseAccountDS  	: banhji.source.expenseAccountDS,
		itemDS  			: banhji.source.itemDS,
		depositDS  			: dataStore(apiUrl + "transactions"),
		depositSumDS  		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transactions/amount_sum",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,								
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		taxItemDS  			: banhji.source.supplierTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		paymentTermDS 		: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		segmentItemDS		: banhji.source.segmentItemDS,
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Purchase" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),	
		referenceTypes 		: [
			{ id:"Purchase_Order", name:"Purchase Order" },
			{ id:"GRN", name:"Goods Received Note" }
		],
		typeList 			: [
			{ id:"Cash_Purchase", name:"Cash" },
			{ id:"Credit_Purchase", name:"Credit" }
		],
		statusList 			: [
			{ id:1, name:"Cash" },
			{ id:0, name:"Credit" }
		],
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		isCash 				: true,
		showDiscount 		: false,
		showAdditionalCost 	: false,
		showRef 			: true,
		showName 			: false,
		showSegment 		: false,
		showDueDateColumn	: false,
		showDescriptionColumn : false,
		sub_total 			: 0,
		tax 				: 0,
		discount 			: 0,
		balance 			: 0,
		total 				: 0,
		remaining 			: 0,
		amount_due 			: 0,
		additional_cost 	: 0,
		original_deposit	: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Deposit
		loadDeposit 		: function(){
			var self = this, obj = this.get("obj");

			if(this.get("isEdit")){
				this.depositDS.filter([
					{ field:"type", value:"Vendor_Deposit" },
					{ field:"reference_id", value:obj.id }
				]);
			}

			this.depositSumDS.query({
				filter:[
					{ field:"type", value:"Vendor_Deposit" },
					{ field:"contact_id", value:obj.contact_id }
				],
				page: 1,
				pageSize: 1000
			}).then(function(){
				var view = self.depositSumDS.view(),
				total_deposit = view[0].amount + obj.deposit;

				self.set("total_deposit", total_deposit);
			});
		},
		addDeposit 			: function(id){
			var obj = this.get("obj");
			
			this.depositDS.data([]);

			if(obj.deposit>0){				
				this.depositDS.add({				
					contact_id 			: obj.contact_id,								
					reference_id 		: id,				
					user_id 			: this.get("user_id"),				    		
				   	type				: "Vendor_Deposit",
				   	amount				: obj.deposit*-1,			   	
				   	rate				: obj.rate,			   	
				   	locale 				: obj.locale,			   	
				   	issued_date 		: obj.issued_date			   	
		    	});
			}
		},		
		saveDeposit 		: function(id){			
			var obj = this.get("obj");
			
    		if(this.get("isEdit")){
    			if(this.depositDS.total()>0){
					var deposit = this.depositDS.at(0);
					deposit.set("amount", obj.deposit*-1);
				}else{
					this.addDeposit(id);
				}
    		}else{
				this.addDeposit(id);
    		}

			this.depositDS.sync();
		},
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_term_id", view[0].payment_term_id);
		    	obj.set("payment_method_id", view[0].payment_method_id);		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();				
				self.loadDeposit();
				self.loadReference();
		    	self.loadRecurring();							
			});
		},
		loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			
	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);		    	
		    	
		    	obj.set("account_id", contact.account_id);
		    	obj.set("payment_term_id", contact.payment_term_id);
		    	obj.set("payment_method_id", contact.payment_method_id);		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();		    	
		    	this.loadDeposit();
		    	this.loadBalance();
		    	this.loadReference();
		    	this.loadRecurring();		    			    	
	    	}

	    	this.lineDS.data([]);
	    	this.accountLineDS.data([]);
	    	this.additionalCostDS.data([]);

		    this.addRow();
		    this.changes();
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var rate = obj.rate / banhji.source.getRate(item.locale, new Date(obj.issued_date));

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));

							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.measurement_id,								
								description 		: value.purchase_description,				
								quantity 	 		: 1,
								cost 				: value.cost*catalogRate,												
								amount 				: value.cost*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: 1,								

								item_prices 		: []
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();
		    	}
	        }                	        	
		},
		//Account
		addRowAccount		: function(){				
			var obj = this.get("obj");
					
			this.accountLineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",				
				account_id 			: "",								
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				amount 	 			: 0,							
				rate				: obj.rate,
				locale				: obj.locale
			});																	
		},
		removeRowAccount	: function(e){						
			var d = e.data;
			if(this.lineDS.total()==0 && this.accountLineDS.total()==0){

			}else{				
				this.accountLineDS.remove(d);
		        this.changes();
	        }		        
		},
		//Additional Cost
		addRowAdditionalCost: function(){
			var self = this, obj = this.get("obj"), accountList = [];

			//Add default account list
			$.each(banhji.source.accountDS.data(), function(index, value){
				if(value.account_type_id=="10"){
					accountList.push(value);
				}
			});
			
			this.additionalCostDS.add({				
				contact_id 			: "",
				payment_term_id		: 0,				
				reference_id 		: obj.id,
				recurring_id 		: "",
				tax_item_id 		: "",				
				user_id 			: this.get("user_id"),
				reference_no 		: "",	    		
			   	type				: "Cash_Purchase",//Required
			   	sub_total 			: 0,				   		   					   				   	
			   	amount				: 0,
			   	tax 				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: new Date(),			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0,

			   	accountList 		: accountList				
	    	});

	    	$.each(this.lineDS.data(), function(index, value) {	    		
	    		if(value.item_id>0){
	    			var item = self.itemDS.get(value.item_id);

	    			if(item.item_type_id==1){
	    				value.set("additional_applied", true);
	    			}
	    		}
	    	});					
		},
		removeRowAdditionalCost: function(e){						
			var d = e.data;
							
			this.additionalCostDS.remove(d);
	        this.changes();	        		        
		},
		contactColumnChanges: function(e){
			var data = e.data;

			if(data.contact_id>0){
				var contact = this.contactListDS.get(data.contact_id);
				var rate = banhji.source.getRate(contact.locale, new Date(data.issued_date));
				data.set("rate", rate);
				data.set("locale", contact.locale);
			}
		},
		typeColumnChanges 	: function(e){
			var data = e.data, accountList = [];

			if(data.type=="Cash_Purchase"){
				data.set("status", 1);
				this.set("showDueDateColumn", false);

				//Add default cash account list
				$.each(banhji.source.accountDS.data(), function(index, value){
					if(value.account_type_id=="10"){
						accountList.push(value);
					}
				});
			}else{
				data.set("status", 0);
				this.set("showDueDateColumn", true);

				//Add default ap account list
				$.each(banhji.source.accountDS.data(), function(index, value){
					if(value.account_type_id=="23" || value.account_type_id=="24"){
						accountList.push(value);
					}
				});				
			}

			data.set("accountList", accountList);
		},			
		typeChanges 		: function(){
			var obj = this.get("obj");

			if(obj.type=="Cash_Purchase"){
				this.set("isCash", true);				

				this.accountDS.filter({ field:"account_type_id", value: 10 });
			}else{
				this.set("isCash", false);				

				this.accountDS.filter({ field:"account_type_id", operator:"where_in", value:[23,24] });
			}			
		},
		//Segment
		segmentChanges 		: function() {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				self.set("obj", view[0]);
				self.set("original_total", view[0].amount);				

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
		        self.set("amount_due", kendo.toString(view[0].amount - view[0].deposit, "c", view[0].locale));
		        self.set("additional_cost", kendo.toString(view[0].additional_cost, "c", view[0].locale));
								
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.accountLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.additionalCostDS.filter({ field: "reference_id", value: view[0].id });
				self.journalLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });				

				if(view[0].status=="1" || view[0].type=="Cash_Purchase"){
					self.set("statusSrc", banhji.source.paidSrc);
				}else if(view[0].status=="2"){
					self.set("statusSrc", banhji.source.partialyPaidSrc);
				}else{
					self.set("statusSrc", banhji.source.openSrc);
				}

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}

				if(view[0].additional_cost>0){
					self.set("showAdditionalCost", true);
				}				

				self.loadDeposit();
				self.typeChanges();				
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0 || this.accountLineDS.total()>0 || this.additionalCostDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0, 
				countAdditCheck = 0, amountAdditCheck = 0, additionalCost = 0, remaining = 0, amount_due = 0;													
				
				//Item
				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.cost;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}

					//Count additional cost and check
					if(value.additional_applied){
						amountAdditCheck += amt;
						countAdditCheck++;
					}
										
					subTotal += amt;
					value.set("amount", amt);					
		        });

				//Account
		        $.each(this.accountLineDS.data(), function(index, value) {
					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += value.amount * taxItem.rate;																	
					}

					subTotal += value.amount;					
		        });

		        //Additional Cost
		        $.each(this.additionalCostDS.data(), function(index, value) {
		        	var additionalTax = 0;
		        	//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						additionalTax += value.sub_total * taxItem.rate;
						tax += additionalTax;																							
					}

					additionalCost += value.sub_total;

					value.set("amount", value.sub_total + additionalTax);									
		        });

		        //Apply additional cost
		        if(additionalCost>0){
		        	this.set("showAdditionalCost", true);

		        	if(countAdditCheck>0){
				        $.each(this.lineDS.data(), function(index, value) {
							if(value.additional_applied){
					        	if(obj.additional_apply=="Equal"){
					        		//subTotal += singleAdditionalCost;
					        		var singleAdditionalCost = additionalCost / countAdditCheck;
					        		value.set("additional_cost", singleAdditionalCost);
					        	}else{
					        		var percentageAdditionalCheck = value.amount / amountAdditCheck;
					        		var weightedAdditionalCost = additionalCost * percentageAdditionalCheck;

					        		//subTotal += weightedAdditionalCost;
					        		value.set("additional_cost", weightedAdditionalCost);
				        		}
				        	}else{
				        		value.set("additional_cost", 0);
				        	}			        			        	
				        });
			    	}
		        }else{
		        	this.set("showAdditionalCost", false);

		        	$.each(this.lineDS.data(), function(index, value) {
		        		value.set("additional_cost", 0);
		        		value.set("additional_applied", false);
		        	});
		        }	

		    	//Total
		        total = subTotal + tax;
		        amount_due = total - obj.deposit;

		        //Apply Deposit
		        if(obj.deposit>0){
		        	if(obj.deposit <= this.get("total_deposit")){
			        	if(obj.deposit <= total){
			        		remaining = total - obj.deposit;
			        	}else{
			        		obj.set("deposit", total);
			        	}
			        }else{
		        		alert("Over deposit to apply!");
		        		obj.set("deposit", 0);
		        	}

		        	//Status
			        if(remaining==0){
			    		obj.set("status", 1);
			    	}else if(remaining==total){
			    		obj.set("status", 0);
			    	}else{
			    		obj.set("status", 2);
			    	}
		        }

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));
		        this.set("additional_cost", kendo.toString(additionalCost, "c", obj.locale));
		        this.set("remaining", kendo.toString(remaining, "c", obj.locale));
		        this.set("amount_due", kendo.toString(amount_due, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);
				obj.set("additional_cost", additionalCost);
				obj.set("remaining", remaining);									    	
	    	}
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.accountLineDS.data([]);
			this.journalLineDS.data([]);
			this.additionalCostDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("discount", 0);
			this.set("tax", 0);						
			this.set("total", 0);
			this.set("remaining", 0);
			this.set("amount_due", 0);
			this.set("additional_cost", 0);
			this.set("amtDueColor", banhji.source.amtDueColor);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 30);				

			this.dataSource.insert(0, {				
				contact_id 			: "",
				payment_term_id		: 0,
				payment_method_id	: 0,				
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),	    		
			   	type				: "Cash_Purchase", //Required
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,				   		   					   				   	
			   	amount				: 0,
			   	deposit 			: 0,
			   	remaining 			: 0,
			   	credit_allowed 		: 0,
			   	additional_cost 	: 0,
			   	additional_apply 	: "Equal",
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	bill_date 			: new Date(),
			   	due_date 			: duedate,			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	check_no 			: "",
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();			
			this.setRate();
			this.typeChanges();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				cost 				: 0,												
				amount 				: 0,
				discount 			: 0,
				fine 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,
				additional_cost 	: 0,
				additional_applied 	: false,							
				movement 			: 1,

				item_prices 		: []
			});																	
		},
		removeRow 			: function(e){						
			var d = e.data;
			if(this.lineDS.total()==0 && this.accountLineDS.total()==0){

			}else{				
				this.lineDS.remove(d);
		        this.changes();
	        }		        
		},
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Warning over credit allowed
	        if(obj.credit_limit>0 && obj.amount>obj.credit_allowed){
	        	alert("Over credit allowed!");		        	
	        }

	        //Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);

	    			$.each(this.additionalCostDS.data(), function(index, value){
	    				value.set("is_recurring", 1);
	    			});
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.accountLineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Account line
					$.each(self.accountLineDS.data(), function(index, value){										
						value.set("transaction_id", data[0].id);										
					});

					//Additional Cost line
					$.each(self.additionalCostDS.data(), function(index, value){										
						value.set("reference_id", data[0].id);										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.accountLineDS.sync();
				self.additionalCostDS.sync();
				self.saveDeposit(data[0].id);
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Supplier
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.accountLineDS.cancelChanges();
			this.additionalCostDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.accountLineDS.data([]);
			this.additionalCostDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });

			banhji.userManagement.removeMultiTask("purchase");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	contact = this.contactDS.get(obj.contact_id),	    	
	    	taxList = {},
	    	inventoryList = {},
	    	additionalList = {};			
			
			//Item line
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id);				

				//Add tax list																							
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = value.amount*taxItem.rate;
					
					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}				
				
				//Add Inventory
				if(item.item_type_id==1){					
					var inventoryID = item.inventory_account_id,
					inventoryAmt = (value.quantity*value.cost) + value.additional_cost;
					
					if(inventoryList[inventoryID]===undefined){
						inventoryList[inventoryID]={"id": inventoryID, "amount": inventoryAmt };						
					}else{											
						if(inventoryList[inventoryID].id===inventoryID){
							inventoryList[inventoryID].amount += inventoryAmt;
						}else{
							inventoryList[inventoryID]={"id": inventoryID, "amount": inventoryAmt };
						}
					}
				}					  	
			});

			//Account line
			$.each(this.accountLineDS.data(), function(index, value){				
				//Add tax list																							
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = value.amount*taxItem.rate;
					
					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}								  	
			});

			//Additional Cost line
			$.each(this.additionalCostDS.data(), function(index, value){				
				if(value.amount>0){
					additionalAccountID = value.account_id;
					additionalAmt = value.amount;

					if(additionalList[additionalAccountID]===undefined){
						additionalList[additionalAccountID]={"id": additionalAccountID, "amount": additionalAmt, "contact_id": value.contact_id };						
					}else{											
						if(additionalList[additionalAccountID].id===additionalAccountID){
							additionalList[additionalAccountID].amount += additionalAmt;
						}else{
							additionalList[additionalAccountID]={"id": additionalAccountID, "amount": additionalAmt, "contact_id": value.contact_id };
						}
					}
				}

				//Add tax list																							
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = value.sub_total*taxItem.rate;
					
					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}
			});

			//Start journal
			//Inventory on Dr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}

			//Expense Account on Dr
			$.each(this.accountLineDS.data(), function(index, value){
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.account_id,				
					contact_id 			: obj.contact_id,				
					description 		: value.description,
					reference_no 		: value.reference_no,
					segments 	 		: value.segments,								
					dr 	 				: value.amount,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			});			

			//Tax account on Dr
			if(!jQuery.isEmptyObject(taxList)){				
				$.each(taxList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: obj.rate,
						locale				: obj.locale
					});										
				});
			}
			
			//Add Obj Account
			var objAccountID = obj.account_id, objAmount = obj.amount;
			if(additionalList[objAccountID]===undefined){
				additionalList[objAccountID]={"id": objAccountID, "amount": objAmount };						
			}else{											
				if(additionalList[objAccountID].id===objAccountID){
					additionalList[objAccountID].amount += objAmount;
				}else{
					additionalList[objAccountID]={"id": objAccountID, "amount": objAmount };
				}
			}

			//Additional Cash OR A/P on Cr
			if(!jQuery.isEmptyObject(additionalList)){
				$.each(additionalList, function(index, value){				
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});
				});				
			}			

			//Discount on Cr			
			if(obj.discount > 0){				
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.trade_discount_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: obj.discount,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}			

			this.journalLineDS.sync();
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", operator:"where_in", value: ["Purchase_Order","GRN"] },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);		
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}							
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);

				//Deposit
				if(obj.discount>0){
					this.set("showDiscount", true);
				}else{
					this.set("showDiscount", false);
				}
				
				obj.set("sub_total", ref.sub_total);
				obj.set("discount", ref.discount);
				obj.set("tax", ref.tax);
				obj.set("deposit", ref.deposit);				
								
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							cost 				: value.cost,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							additional_cost 	: value.additional_cost,
							additional_applied 	: value.additional_applied,							

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				obj.set("deposit", 0);
				this.set("showDeposit", false);
			}								
		},
		//Recurring	
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id>0){
				var recur = this.recurringDS.get(obj.recurring_id);				
				
				obj.set("account_id", recur.account_id);
				obj.set("segments", recur.segments);
				obj.set("sub_total", recur.sub_total);
				obj.set("discount", recur.discount);
				obj.set("tax", recur.tax);
				obj.set("amount", recur.amount);
				obj.set("rate", recur.rate);
				obj.set("locale", recur.locale);					
				obj.set("memo", recur.memo);
				obj.set("memo2", recur.memo2);
				
				this.set("sub_total", kendo.toString(recur.sub_total, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("discount", kendo.toString(recur.discount, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("tax", kendo.toString(recur.tax, recur.locale=="km-KH"?"c0":"c", recur.locale));
				this.set("total", kendo.toString(recur.amount, recur.locale=="km-KH"?"c0":"c", recur.locale));

				//Item Line
				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var line = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(line, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							cost 				: value.cost,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});
				});

				//Account Line
				this.recurringAccountLineDS.query({
					filter: { field:"transaction_id", value:recur.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var accountLine = self.recurringAccountLineDS.view();
					self.accountLineDS.data([]);

					$.each(accountLine, function(index, value){
						self.accountLineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,				
							account_id 			: value.account_id,								
							description 		: value.description,
							reference_no 		: value.reference_no,
							segments 	 		: value.segments,								
							amount 	 			: value.amount,							
							rate				: value.rate,
							locale				: value.locale
						});
					});
				});

				//Additional Cost Line
				this.recurringAdditionalCostDS.query({
					filter: [
						{ field:"reference_id", value:recur.id },
						{ field:"is_recurring", value:1 },
					],
					page: 1,
					pageSize: 100
				}).then(function(){
					var additionalCostLine = self.recurringAdditionalCostDS.view();
					self.additionalCostDS.data([]);

					$.each(additionalCostLine, function(index, value){
						self.additionalCostDS.add({
							contact_id 			: value.contact_id,
							tax_item_id 		: value.tax_item_id,				
							user_id 			: value.user_id,
							reference_no 		: value.reference_no,	    		
						   	type				: value.type,
						   	sub_total 			: value.sub_total,				   		   					   				   	
						   	amount				: value.amount,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: new Date(),
						   	due_date 			: new Date(),
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0				
			    		});
			    	});
				});				
			}else{
				this.addEmpty();
			} 
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					cost 				: value.cost,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.purchaseReturn =  kendo.observable({
		lang 					: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),		
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		returnDS			: dataStore(apiUrl + "transactions"),
		invoiceDS			: dataStore(apiUrl + "transactions"),
		measurementDS		: dataStore(apiUrl + "measurements"),
		jobDS				: dataStore(apiUrl + "jobs"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.supplierDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.supplierTaxDS,
		accountDS  			: banhji.source.cashAccountDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),		
		segmentItemDS		: banhji.source.segmentItemDS,
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Purchase_Return" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		optionList 			: [
			{ id:"Offset_Bill", name:"Charge Against Bill" },
			{ id:"Deposit", name:"Add To Deposit" },
			{ id:"Debit_Note", name:"Cash Refund" }
		],
		amtDueColor 		: banhji.source.amtDueColor,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		statusSrc 			: "",
		enableRef 			: false,
		showReturn 			: true,
		showDiscount 		: false,		
		sub_total 			: 0,		
		discount 			: 0,
		tax 				: 0,		
		total 				: 0,
		remaining 			: 0,
		original_total 		: 0,		
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadReference();		
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			
	    	if(obj.contact_id>0){		    			    	
		    	contact = this.contactDS.get(obj.contact_id);   	
		    		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadReference();		    		    			    	
	    	}
	    },
	    //Currency Rate
	    setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var rate = obj.rate / banhji.source.getRate(item.locale, new Date(obj.issued_date));

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));

							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.measurement_id,								
								description 		: value.purchase_description,				
								quantity 	 		: 1,
								cost 				: value.cost*catalogRate,												
								amount 				: value.cost*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: 1,								

								item_prices 		: []
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", item.measurement_id);
		    		data.set("description", item.purchase_description);
		    		data.set("quantity", 1);	    		
			        data.set("cost", item.cost*rate);
			        data.set("rate", rate);

			        this.changes();
		    	}
	        }                	        	
		},
		//Return Option
		addRowOption 		: function(){				
			var transaction_id = 0, obj = this.get("obj");
			if(this.get("isEdit")){
				transaction_id = obj.id;
			}

			var account_id = 0;
			if(this.accountDS.total()>0){
				account_id = this.accountDS.at(0).id;
			}
						
			this.returnDS.add({					
				return_id 		: transaction_id,				
				reference_id 	: "",
				account_id 		: account_id,
				type 			: "",													
				amount 			: 0,				
				rate			: obj.rate,
				locale			: obj.locale,
				issued_date 	: obj.issued_date,
				
				showInvoice 	: false,
				showAccount 	: false				
			});																	
		},
		removeRowOption 	: function(e){						
			var d = e.data;
			
			if(this.returnDS.total()>1){			
				this.returnDS.remove(d);
		        this.changes();
	        }	        	        
		},
		invoiceChanges 		: function(e){
			var data = e.data;
			
			if(data.reference_id>0){
				var inv = this.invoiceDS.get(data.reference_id);
				data.set("amount", inv.amount - inv.amount_paid);

				this.changes();
			}else{
				data.set("amount", 0);
			}							
		},
		optionChanges 		: function(e){
			var data = e.data, obj = this.get("obj");

			switch(data.type) {
			    case "Offset_Bill": //Invoice		    	
			        data.set("showInvoice", true);
			        data.set("showAccount", false);

			        if(obj.contact_id>0){
			        	var para = [
					 			{ field:"contact_id", value: obj.contact_id },
					 			{ field:"status", operator:"where_in", value:[0,2] },
					 			{ field:"type", value:"Credit_Purchase" },
					 	];

					 	if(obj.reference_id>0){
					 		para.push({ field:"id", operator:"where_not_in", value:[obj.reference_id] });
					 	} 

				        this.invoiceDS.filter(para);
				 	}

			        break;
			    case "Debit_Note": //Refund		    	
			        data.set("showInvoice", false);
			        data.set("showAccount", true);
			        break;
			    default: //Credit		    	
			        data.set("showInvoice", false);
			        data.set("showAccount", false);
			}			
		},		
		//Obj
		loadObj 			: function(id){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("obj", view[0]);
				self.set("original_total", view[0].amount);

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));				
		        self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));				
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
		        self.set("remaining", kendo.toString(view[0].remaining, "c", view[0].locale));						
						
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.journalLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj"), 
			subTotal = 0, discount = 0, tax = 0, returnAmount = 0, remaining = 0;
			
	        $.each(this.lineDS.data(), function(index, value) {				
				var amt = value.quantity * value.cost;					

				//Discount by line
				if(value.discount>0){										
					var discount_amount = amt * value.discount;
					amt -= discount_amount;
					discount += discount_amount;																	
				}

				//Tax by line
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id);										
					tax += amt * taxItem.rate;																	
				}					

				value.set("amount", amt);
				subTotal += amt;									
	        });

	        total = subTotal + tax;

	        //Return
	        $.each(this.returnDS.data(), function(index, value) {								
				returnAmount += value.amount;					
	        });
	       
	        remaining = obj.amount_paid - returnAmount;

	        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
	        this.set("discount", kendo.toString(discount, "c", obj.locale));
	        this.set("tax", kendo.toString(tax, "c", obj.locale));
	        this.set("total", kendo.toString(total, "c", obj.locale));
	        this.set("remaining", remaining);

	        obj.set("sub_total", subTotal);
	        obj.set("discount", discount);
	        obj.set("tax", tax);			
			obj.set("amount", total);
			obj.set("remaining", remaining);    	
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.returnDS.data([]);
			this.referenceDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("discount", 0);
			this.set("tax", 0);						
			this.set("total", 0);
			this.set("remaining", 0);				

			this.dataSource.insert(0, {				
				contact_id 			: "",								
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
			   	type				: "Purchase_Return", //Require
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,				   		   					   				   	
			   	amount				: 0,
			   	deposit 			: 0,			   	
			   	amount_paid 		: 0,
			   	remaining 			: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();
			this.addRowOption();
			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				cost 				: 0,												
				amount 				: 0,
				discount 			: 0,
				fine 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var d = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(d);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}

	    	//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Return
					$.each(self.returnDS.data(), function(index, value){										
						value.set("return_id", data[0].id);

						if(value.type=="Offset_Invoice" && value.reference_id>0){
							var inv = self.invoiceDS.get(value.reference_id),
							amountPaid = inv.amount_paid + value.amount;

							inv.set("amount_paid", amountPaid);

							if(amountPaid>=inv.amount){								
								inv.set("status", 1); //Paid							
							}else{
								inv.set("status", 2); //Partially Paid
							}
						}										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.returnDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:2 });			

			banhji.userManagement.removeMultiTask("purchase_return");
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	contact = this.contactDS.get(obj.contact_id),
	    	taxList = {},	    	
	    	inventoryList = {},
	    	cashList = {},
	    	sumInvoice = 0,
	    	sumCredit = 0;			
			
			//Group Account from lineDS
			$.each(this.lineDS.data(), function(index, value){
				var item = self.itemDS.get(value.item_id),
				amount = value.quantity * value.cost;

				//Discount by line
				if(value.discount>0){										
					var discount_amount = amount * value.discount;
					amount -= discount_amount;																						
				}

				//TAX Account																								
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = amount * taxItem.rate;

					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}

				//Inventory
				if(item.item_type_id==1){
					//Add inventory list
					var inventoryID = item.inventory_account_id;

					if(inventoryList[inventoryID]===undefined){
						inventoryList[inventoryID]={"id": inventoryID, "amount": amount};						
					}else{											
						if(inventoryList[inventoryID].id===inventoryID){
							inventoryList[inventoryID].amount += amount;
						}else{
							inventoryList[inventoryID]={"id": inventoryID, "amount": amount};
						}
					}
				}					  	
			});

			//Group Account from returnDS
			$.each(this.returnDS.data(), function(index, value){
				//Offset Invoice
				if(value.type=="Offset_Bill"){
					sumInvoice += value.amount;
				}

				//Credit
				if(value.type=="Deposit"){ 
					sumCredit += value.amount;
				}

				//Refund
				if(value.type=="Debit_Note"){
					var cashID = value.account_id,
					cashAmt = value.amount;

					if(cashList[cashID]===undefined){
						cashList[cashID]={"id": cashID, "amount": cashAmt};						
					}else{											
						if(cashList[cashID].id===cashID){
							cashList[cashID].amount += cashAmt;
						}else{
							cashList[cashID]={"id": cashID, "amount": cashAmt};
						}
					}
				}
			});		

			//Start journal
			//Cash on Dr
			if(!jQuery.isEmptyObject(cashList)){
				$.each(cashList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}

			//A/P on Dr
			var ap = (obj.amount - obj.amount_paid) + sumInvoice;
			if(ap>0){						
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: ap,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Deposit on Dr
			if(sumCredit>0){			
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.deposit_account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: sumCredit,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}

			//Tax on Cr
			if(!jQuery.isEmptyObject(taxList)){
				$.each(taxList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}			

			//Discount on Cr
			if(obj.discount>0){			
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.trade_discount_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: obj.discount,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			this.journalLineDS.sync();
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },					
					{ field: "type", operator:"where_in", value:["Cash_Purchase", "Credit_Purchase"] }
				]);				
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");				
			}							
		},
		referenceChanges 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);

				if(ref.type=="Cash_Purchase"){
					this.set("showReturn", true);
					obj.set("amount_paid", ref.amount - ref.deposit);
				}else{
					obj.set("amount_paid", ref.amount_paid);

					if(ref.status==0){
						this.set("showReturn", false);

						this.returnDS.data([]);
						this.addRowOption();
					}else{
						this.set("showReturn", true);
					}
				}				
									
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							item_id 			: value.item_id,
							tax_item_id 		: value.tax_item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							cost 				: value.cost,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,													

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				this.returnDS.data([]);
				this.addRowOption();
			}							
		}
	});
	banhji.vendorReportCenter = kendo.observable({
		lang 				: langVM,	
		summaryDS 			: dataStore(apiUrl + "dashboards/supplier_dashboard_summary"),	
		dataSource 			: dataStore(apiUrl + "vendorReports/over_view"),		
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/monthly_sale",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),						
		pageLoad 			: function(){
			var self = this;

			this.summaryDS.query({
				filter: [],								
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();
				
				self.set("purchase", kendo.toString(view[0].purchase, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("purchase_supplier", kendo.toString(view[0].purchase_supplier, "n0"));
				self.set("purchase_product", kendo.toString(view[0].purchase_product, "n0"));
				self.set("purchase_order", kendo.toString(view[0].purchase_order, "n0"));


				self.set("ap", kendo.toString(view[0].ap, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ap_open", kendo.toString(view[0].ap_open, "n0"));
				self.set("ap_supplier", kendo.toString(view[0].ap_supplier, "n0"));
				self.set("ap_overdue", kendo.toString(view[0].ap_overdue, "n0"));
				self.set("collection_day", kendo.toString(view[0].collection_day, "n0"));
			});										
		}
	});
	banhji.vendorSetting =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: banhji.source.supplierTypeDS,
        paymentMethodDS		: dataStore(apiUrl+"payment_methods"),
        paymentTermDS		: dataStore(apiUrl+"payment_terms"),  
        txnTemplateDS		: dataStore(apiUrl + "transaction_templates"),      
        contactTypeName 	: "",
        contactTypeAbbr 	: "",
        contactTypeCompany 	: 0,
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTermNetDue	: "",
        paymentTermPeriod 	: "",
        paymentTermPercentage 	: "",
        pageLoad 			: function() {
        	this.txnTemplateDS.filter({ field: "moduls", value : "vendor_mg" });
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 2,
	        		name 		: name,
	        		abbr 		: this.get("contactTypeAbbr"),
	        		description : "",
	        		is_company 	: this.get("contactTypeCompany"),
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();

	        	this.set("contactTypeName", "");
	        	this.set("contactTypeAbbr", "");
	        	this.set("contactTypeCompany", 0);
        	}
        },
        addPaymentMethod 		: function(){
        	var name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.paymentMethodDS.sync();

	        	this.set("paymentMethodName", "");
        	}
        },
        addPaymentTerm 		: function(){
        	var name = this.get("paymentTermName");

        	if(name!==""){
	        	this.paymentTermDS.add({	        		
	        		name 				: name,
	        		net_due 			: this.get("paymentTermNetDue"),
	        		discount_period 	: this.get("paymentTermPeriod"),
	        		discount_percentage : this.get("paymentTermPercentage"),
	        		is_system 			: 0
	        	});

	        	this.paymentTermDS.sync();

	        	this.set("paymentTermName", "");
	        	this.set("paymentTermNetDue", "");
	        	this.set("paymentTermPeriod", "");
	        	this.set("paymentTermPercentage", "");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;        	        	

        	if(kendo.parseInt(data.contact_id)>0){        		        	
	        	banhji.router.navigate('/vendor/'+data.contact_id+'/1');   	
        	}else{
        		banhji.router.navigate('/vendor');
        		banhji.vendor.set("contact_type_id",data.id);
        	}
        },
        deleteForm 		: function(e){
        	var data = e.data;
        	if(confirm("Do you want to delete it?") == true) {
        		this.txnTemplateDS.remove(data);
        		this.txnTemplateDS.sync();
        	}
        },
        goInvoiceCustom : function(){

		    banhji.invoiceCustom.set("selectTypeList", banhji.source.vendorFormList);
		    banhji.invoiceCustom.set("selectCustom", "vendor_mg");
		    banhji.invoiceCustom.set("formShow", banhji.view.invoiceForm35);
		    banhji.invoiceCustom.set("formTitle", "Purchase Order");
		    banhji.invoiceCustom.set("formType", "Purchase_Order");
		    var obj= banhji.invoiceCustom.get("obj");
		    obj.set("type", "Purchase_Order");
		    banhji.router.navigate('/invoice_custom');
        }
    });

    //Report Vendor
    banhji.supplierList = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl + "contacts/supplier"),
		contactTypeDS			: banhji.source.customerTypeDS,
		statusList 				: banhji.source.statusList,
		contact_type_id 		: null,
		status 					: null,		
		pageLoad 				: function(){
		},
		search 					: function(){
			var para = [],
			status = this.get("status"),
			contact_type_id = this.get("contact_type_id");

			if(status!==null){
				para.push({ field:"status", value: status });
			}

			if(contact_type_id){
				para.push({ field:"contact_type_id", value: contact_type_id });
			}

			this.dataSource.filter(para);
			this.set("status", null);
			this.set("contact_type_id", null);
		}
	});
	banhji.expensesPurchaseSummarySupplier = kendo.observable({
		lang 					: langVM,
		startDate 			: new Date(),
		endDate				: new Date(),
		dataSource 		: dataStore(apiUrl + "vendorReports/expense_summary"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.expensesPurchaseSummarySupplier.dataSource.filter({
				logic: banhji.expensesPurchaseSummarySupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.expensesPurchaseSummarySupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.expenseDetailSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/expense_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.expenseDetailSupplier.dataSource.filter({
				logic: banhji.expenseDetailSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.expenseDetailSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.summaryProductSuppplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/summary_list"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.summaryProductSuppplier.dataSource.filter({
				logic: banhji.summaryProductSuppplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.summaryProductSuppplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.purchaseOrderReport = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/purchase_order"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.purchaseOrder.dataSource.filter({
				logic: banhji.purchaseOrder.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.purchaseOrder.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.detailProductSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/detail_list"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.detailProductSupplier.dataSource.filter({
				logic: banhji.detailProductSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.detailProductSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.supplierTransaction = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/transaction_vendor"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.supplierTransaction.dataSource.filter({
				logic: banhji.supplierTransaction.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.supplierTransaction.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.depositDetailSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/deposit_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.depositDetailSupplier.dataSource.filter({
				logic: banhji.depositDetailSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.depositDetailSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.supplierBalance = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/summary_balance"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.supplierBalance.dataSource.filter({
				logic: banhji.supplierBalance.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.supplierBalance.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.balanceDetailSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/detail_balance"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.balanceDetailSupplier.dataSource.filter({
				logic: banhji.balanceDetailSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.balanceDetailSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.payablesAgingSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/aging_summary"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.payablesAgingSupplier.dataSource.filter({
				logic: banhji.payablesAgingSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.payablesAgingSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.payablesAgingDetailSupplier = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/aging_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.payablesAgingDetailSupplier.dataSource.filter({
				logic: banhji.payablesAgingDetailSupplier.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.payablesAgingDetailSupplier.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.listBillsPaid = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/bill2pay"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.listBillsPaid.dataSource.filter({
				logic: banhji.listBillsPaid.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.listBillsPaid.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.billPaymentList = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "vendorReports/billPaid"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.billPaymentList.dataSource.filter({
				logic: banhji.billPaymentList.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.billPaymentList.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.vendorSale = kendo.observable({
		lang 				: langVM,
		locale 				: banhji.locale,
		// purchaseSummary 		: dataStore(apiUrl + "vendorReports/expense_summary"),	
		count 				: 0,
		total_avg 			: 0,
		supplierCount 		: 0,
		saleNumber 			: 0,
		gpm 				: 0,
		total_sale 			: 0,
		companyName 		: null,
		startDate 			: "<?php echo date("d-m-y"); ?>",
		endDate				: new Date(),
		sorter				: '',
		openInvoice 		: 0,	
		company 			: banhji.institute,		
		sortList			: banhji.source.sortList, 
		//line to sale summary
		purchaseSummary     	: banhji.expensesPurchaseSummarySupplier,
		purchaseDetail      	: banhji.expenseDetailSupplier,
		summaryProduct 			: banhji.summaryProductSuppplier,
		purchaseOrder 			: banhji.purchaseOrderReport,
		detailProduct 			: banhji.detailProductSupplier,
		supplierTransaction 	: banhji.supplierTransaction,
		depositDetail  			: banhji.depositDetailSupplier,
		supplierBalance 		: banhji.supplierBalance,
		balanceDetailSupplier	: banhji.balanceDetailSupplier,
		payablesAging 			: banhji.payablesAgingSupplier,
		payablesAgingDetail 	: banhji.payablesAgingDetailSupplier,
		listBillsPaid 			: banhji.listBillsPaid,
		billPaymentList 		: banhji.billPaymentList,

		collectReportDB 		: banhji.collectReport,
		invoiceListDB 			: banhji.invoiceList,
		// search button
		saleDetailSearch 	: function() {
			this.detailSale.filter({
				logic: 'segment',
				filters: [
					{field: "id", "operator": "segment", value: 9},
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		},
		displayDateStart    : function() {
			return kendo.toString(new Date(this.get('startDate')), 'dd-MM-yyyy');
		},
		displayDateEnd    : function() {
			return kendo.toString(new Date(this.get('endDate')), 'dd-MM-yyyy');
		},
		trnxSearch 			: function() {},
		depositDetailSearch : function() {},
		summaryProductSearch: function() {},
		detailProductSearch : function() {},
		saleJobSearch 		: function() {},
		saleOrderSearch 	: function() {},
		balanaceSearch 		: function() {},
		balanceDetailSearch : function() {},
		agingSummarySearch  : function() {},
		agingDetailSearch   : function() {},
		collectingInvSearch : function() {},
		collectedInvSearch  : function() {},
		invoiceListSearch 	: function() {},
		customerListSearch 	: function() {},

		dateMax 			: function(e) {
			$('#edate').css('width', '160px');
			var edate = $('#edate').kendoDatePicker().data("kendoDatePicker");
			edate.min(e.sender.value());
		},
		dateMin 			: function(e) {
			$('#sdate').css('width', '160px');
			var sdate = $('#sdate').kendoDatePicker().data("kendoDatePicker");
			sdate.max(e.sender.value());
		},
		printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=900, height=700'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="<?php echo base_url(); ?>assets/responsive.css" rel="stylesheet" >' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            '*{  } html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: landscape; margin:0mm; } .saleSummaryCustomer .total-customer, .saleSummaryCustomer .total-sale { background-color: #DDEBF7!important; -webkit-print-color-adjust:exact; }.saleSummaryCustomer .table.table-borderless.table-condensed  tr th { background-color: #1E4E78!important;-webkit-print-color-adjust:exact;}.saleSummaryCustomer .table.table-borderless.table-condensed  tr th span{ color: #fff!important; }.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td {  background-color: #fff!important; -webkit-print-color-adjust:exact;} .saleSummaryCustomer .table.table-borderless.table-condensed tr td { background-color: #F2F2F2!important;-webkit-print-color-adjust:exact; } </style>' +
		            '</head>' +
		            '<body><div id="example" class="k-content saleSummaryCustomer" style="padding: 30px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		},
		dateChange 			: function(){
			// var strDate = "";

			// 	if(this.startDate && this.endDate){
			// 		strDate = "From " + kendo.toString(this.startDate, "dd-MM-yyyy") + " To " + kendo.toString(this.endDate, "dd-MM-yyyy");
			// 	}else if(this.startDate){
			// 		strDate = "On " + kendo.toString(this.startDate,"dd-MM-yyyy");
			// 	}else if(this.endDate){
			// 		strDate = "As Of " + kendo.toString(this.endDate,"dd-MM-yyyy");
			// 	}else{
			// 		strDate = "";
			// 	}

			var today = new Date(),
			day = today.getDate();
        	sdate = "",
        	edate = "",
        	value = this.get('sorter');

			switch(value){
			case "today":
				sdate = today;

			  	break;
			case "week":
				var first = new Date(today.getTime() - 60*60*24* day*1000),
				last = new Date(today.getTime() + 60*60*24* day*1000);

				sdate = first;
				edate = last;

			  	break;
			case "month":
				var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
				edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

			  	break;
			case "year":
			  	var sdate = new Date(today.getFullYear(), 0, 1),
			  	edate = new Date(today.getFullYear(), 11, 31);

			  	break;
			default:

			}

			this.set("startDate", sdate);
			this.set("endDate", edate);
			// start.value(sdate);
			// end.value(edate);

			// start.max(end.value());
   //      	end.min(start.value());

   //      	dateChanges();
   //          });

   //          start.max(end.value());
   //          end.min(start.value());
		}

	});



	/*************************
	*   SME Section   *
	**************************/
	banhji.customerDashboard = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/customer_dashboard_summary"),
		topCustomerDS 		: dataStore(apiUrl + "dashboards/top_customer"),
		topARDS 			: dataStore(apiUrl + "dashboards/top_ar"),
		topProductDS 		: dataStore(apiUrl + "dashboards/top_sale_product"),		
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/monthly_sale",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		sale 				: 0,
		sale_customer 		: 0,
		sale_product 		: 0,
		sale_order 			: 0,
		order 				: 0,
		order_avg 			: 0,
		order_open 			: 0,
		ar 					: 0,
		ar_open 			: 0,
		ar_customer 		: 0,
		ar_overdue 			: 0,
		pageLoad 			: function(){
			var self = this, today = new Date(),
			firstDayOfYear = new Date(today.getFullYear(), 0, 1);

			this.graphDS.read();

			this.summaryDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.summaryDS.view();
				
				self.set("sale", kendo.toString(view[0].sale, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("sale_customer", kendo.toString(view[0].sale_customer, "n0"));
				self.set("sale_product", kendo.toString(view[0].sale_product, "n0"));
				self.set("sale_order", kendo.toString(view[0].sale_order, "n0"));

				self.set("order", kendo.toString(view[0].order, "n0"));
				self.set("order_avg", kendo.toString(view[0].order_avg, banhji.locale=="km-KH"?"c0":"c", banhji.locale));				
				self.set("order_open", kendo.toString(view[0].order_open, "n0"));

				self.set("ar", kendo.toString(view[0].ar, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ar_open", kendo.toString(view[0].ar_open, "n0"));
				self.set("ar_customer", kendo.toString(view[0].ar_customer, "n0"));
				self.set("ar_overdue", kendo.toString(view[0].ar_overdue, "n0"));
			});

			this.topCustomerDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],								
				page: 1,
				pageSize: 5
			});

			this.topARDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});

			this.topProductDS.query({
				filter: [
					{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", operator:"where_related", model:"transaction", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});										
		}
	});
	banhji.customerCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(apiUrl + 'transactions'),
		contactDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
			sort:{ field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactTypeDS  		: banhji.source.customerTypeDS,
		noteDS 				: dataStore(apiUrl + 'notes'),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		currencyDS  		: banhji.source.currencyDS,
		summaryDS 			: dataStore(apiUrl + "transactions"),
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: {id:0},
		note 				: "",
		searchText 			: "",
		contact_type_id 	: null,
		currency_id 		: 0,
		balance 			: 0,
		deposit 			: 0,
		outInvoice 			: 0,
		overInvoice 		: 0,
		currencyCode 		: "",
		user_id 			: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.loadObj(id);
			}

			//Refresh
			if(this.contactDS.total()>0){
				this.contactDS.fetch();
				this.searchTransaction();
				this.loadSummary();
			}
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		setCurrencyCode 	: function(){
			var code = "", obj = this.get("obj");

			$.each(banhji.source.currencyRateDS.data(), function(index, value){				
				if(value.locale == obj.locale){
					code = value.currency[0].code;					

					return false;					
				}
			});

			this.set("currencyCode", code);
		},
		loadObj 			: function(id){
			var self = this;

			this.contactDS.query({
				filter: { field:"id", value:id},
				page:1,
				pageSize:100
			}).then(function(){
				var view = self.contactDS.view();

				if(view.length>0){
					self.set("obj", view[0]);
					self.loadData();
				}
			});
		},
		loadData 			: function(){
			var obj = this.get("obj");

			this.searchTransaction();
			this.loadSummary(obj.id);
			this.setCurrencyCode();

			this.attachmentDS.filter({ field:"contact_id", value: obj.id });
			this.noteDS.query({
				filter: { field:"contact_id", value: obj.id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				pageSize: 10
			});
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
			if(obj.id>0){
		        // Check the extension of each file and abort the upload if it is not .jpg
		        $.each(files, function(index, value){
		            if (value.extension.toLowerCase() === ".jpg"
		            	|| value.extension.toLowerCase() === ".jpeg"
		            	|| value.extension.toLowerCase() === ".tiff"
		            	|| value.extension.toLowerCase() === ".png" 
		            	|| value.extension.toLowerCase() === ".gif"
		            	|| value.extension.toLowerCase() === ".pdf"){

		            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

		            	self.attachmentDS.add({
		            		user_id 		: self.get("user_id"),
		            		contact_id 		: obj.id,
		            		type 			: "Contact",
		            		name 			: value.name,
		            		description 	: "",
		            		key 			: key,
		            		url 			: banhji.s3 + key,
		            		size 			: value.size,
		            		created_at 		: new Date(),

		            		file 			: value.rawFile
		            	});	            			            		            
		            }else{
		            	alert("This type of file is not allowed to attach.");
		            }
		        });
	    	}else{
	    		alert("Please select a customer!");
	    	}
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    		this.attachmentDS.sync();
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
	    //Summary
		loadContact 		: function(id){
			var self = this;
			
			this.contactDS.query({
			  	filter:[
			  		{ field:"id", value:id }
			  	],
			  	page: 1,
			  	pageSize: 50
			}).then(function(e) {
			    var view = self.contactDS.data();
			    
			    if(view.length>0){
			    	self.set("obj", view[0]);
			    	self.loadData();
			    }
			});
		},
		loadSummary 		: function(id){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Customer_Deposit", "Invoice"] },
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 1000
			}).then(function(){
				var view = self.summaryDS.view(),
				deposit = 0, open = 0, over = 0, balance = 0, today = new Date();

				$.each(view, function(index, value){
					if(value.type=="Customer_Deposit"){
						deposit += kendo.parseFloat(value.amount);
					}else{
						balance += kendo.parseFloat(value.amount) - kendo.parseFloat(value.deposit);
						open++;

						if(new Date(value.due_date)<today){						
							over++;
						}
					}									
				});
				
				self.set("deposit", kendo.toString(deposit, obj.locale=="km-KH"?"c0":"c", obj.locale));
				self.set("outInvoice", kendo.toString(open, "n0"));
				self.set("overInvoice", kendo.toString(over, "n0"));
				self.set("balance", kendo.toString(balance, obj.locale=="km-KH"?"c0":"c", obj.locale));
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Invoice" },
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadDeposit 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Customer_Deposit" }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value: "Invoice" },
			  		{ field:"status", operator:"where_in", value: [0,2] },
			  		{ field:"due_date <", value: kendo.toString(new Date(), "yyyy-MM-dd") }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},	
		selectedRow			: function(e){
			var data = e.data;
			
			this.set("obj", data);
			this.loadData();
		},
		//Search
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		searchText = this.get("searchText"),
      		contact_type_id = this.get("contact_type_id");
      		
      		if(searchText){
      			var textParts = searchText.replace(/([a-z]+)/i, "$1 ").split(/[^0-9a-z]+/ig);

      			para.push(
      				{ field: "abbr", value: textParts[0] },
      				{ field: "number", value: textParts[1] },
					{ field: "name", operator: "or_like", value: searchText }
      			);
      		}

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}else{
      			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 1 });
      		}

      		this.contactDS.filter(para);
			
			//Clear search filters
      		self.set("searchText", "");
      		self.set("contact_type_id", 0);
		},
		searchTransaction	: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),
        		para = [], obj = this.get("obj");

        	if(obj.id>0){
        		para.push({ field:"contact_id", value: obj.id });
        	
	        	//Dates
	        	if(start && end){
	            	para.push({ field:"issued_date >=", value: start });
	            	para.push({ field:"issued_date <=", value: end });
	            }else if(start){
	            	para.push({ field:"issued_date", value: start });
	            }else if(end){
	            	para.push({ field:"issued_date <=", value: end });
	            }else{
	            	
	            }

	            this.transactionDS.query({
	            	filter: para,
	            	sort: [
				  		{ field: "issued_date", dir: "desc" },
				  		{ field: "id", dir: "desc" }
				  	],
	            	page: 1,
	            	pageSize: 10
	            });
	        }            
		},
		//Links	
		goEdit 		 		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/customer/'+obj.id);
		},
		goQuote				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/quote');
			banhji.quote.loadContact(obj.id);
		},
		goDeposit			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/customer_deposit');
			banhji.customerDeposit.loadContact(obj.id);
		},
		goSaleOrder			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/sale_order');
			banhji.saleOrder.loadContact(obj.id);
		},
		goCashSale			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/cash_sale');
			banhji.cashSale.loadContact(obj.id);
		},
		goInvoice			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/invoice');
			banhji.invoice.loadContact(obj.id);
		},
		goGDN				: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/gdn');
			banhji.gdn.loadContact(obj.id);
		},
		goSaleReturn		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/sale_return');
			banhji.saleReturn.loadContact(obj.id);
		},
		goStatement			: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/statement');
			banhji.statement.loadContact(obj.id);
		},
		goCashReceipt		: function(){
			var obj = this.get("obj");

			banhji.router.navigate('/cash_receipt');
			banhji.cashReceipt.loadContact(obj.id);
		},
		payInvoice			: function(e){
			var data = e.data;

			banhji.router.navigate('/cash_receipt');
			banhji.cashReceipt.loadInvoice(data.id);
		},
		//Note
		saveNoteEnter 		: function(e){
			e.preventDefault();
			this.saveNote();
		},		
		saveNote 			: function(){
			var obj = this.get("obj");

			if(obj.id>0 && this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: obj.id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});

				this.noteDS.sync();
				this.set("note", "");					
			}else{
				alert("Please select a customer and Memo is required");
			}
		}
	});
	banhji.customer = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl + "contacts"),
		patternDS 				: dataStore(apiUrl + "contacts"),
		numberDS 				: dataStore(apiUrl + "contacts"),
		protectDS 				: dataStore(apiUrl + "transactions"),		
		existingDS 				: dataStore(apiUrl + "contacts"),		
		contactPersonDS			: dataStore(apiUrl + "contact_persons"),		
		paymentTermDS			: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS			: dataStore(apiUrl + "payment_methods"),
		taxItemDS				: dataStore(apiUrl + "tax_items"),
		countryDS 				: banhji.source.countryDS,
		contactTypeDS  			: banhji.source.customerTypeDS,
		currencyDS 		  		: banhji.source.currencyDS,
		arDS 		  			: banhji.source.ARAccountDS,
		raDS 		  			: banhji.source.incomeAccountDS,
		depositDS 		  		: banhji.source.depositAccountDS,
		tradeDiscountDS 		: banhji.source.tradeDiscountDS,
		settlementDiscountDS 	: banhji.source.settlementDiscountDS,
		genders					: banhji.source.genderList,
		statusList 				: banhji.source.statusList,
		confirmMessage 			: banhji.source.confirmMessage,
		isEdit 					: false,
		isProtected 			: false,
        obj 					: null,
        saveClose 				: false,
		showConfirm 			: false,
		isDuplicateNumber 		: false,
		phFullname 				: "Customer Name ...",
		contact_type_id 		: 0,						
		pageLoad 				: function(id, is_pattern){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}	
		},							
		//Contact Person
		addEmptyContactPerson 	: function(){
			var obj = this.get("obj");
			
			this.contactPersonDS.add({					 			
				contact_id 			: obj.id,
      			prefix 				: "",      			
				name 				: "",
				department			: "",
				phone				: "",
				email				: ""
			});								
		},
		deleteContactPerson 	: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.contactPersonDS.getByUid(d.uid);

				this.contactPersonDS.remove(obj);
			}
		},
		//Map
		loadMap 				: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);
			
			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		copyBillTo 				: function(){
			var obj = this.get("obj");

			obj.set("ship_to", obj.bill_to);
		},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj");			
			
			if(obj.number!==""){

				if(this.get("isEdit")){
					para.push({ field:"id", operator:"where_not_in", value: [obj.id] });
				}

				para.push({ field:"abbr", value: obj.abbr });
				para.push({ field:"number", value: obj.number });
				para.push({ field:"contact_type_id", value: obj.contact_type_id });
				
				this.existingDS.query({
					filter: para,
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"contact_type_id", value:obj.contact_type_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}
			});
		},
		protectObj 				: function(){
			var self = this, obj = this.get("obj");

			this.protectDS.query({
			  	filter: { field: "contact_id", value: obj.id },
			  	page: 1,
			  	pageSize: 1
			}).then(function() {
				var view = self.protectDS.view();

				if(view.length>0){
					self.set("isProtected", true);
				}else{
					self.set("isProtected", false); 
				}
			});
		},
		//Obj
		loadObj 				: function(id, is_pattern){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

			this.dataSource.query({
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();
				
				self.set("obj", view[0]);
				self.loadMap();
				self.protectObj();								
			});

			this.contactPersonDS.filter({ field:"contact_id", value: id });
		},		
      	addEmpty 				: function(){
      		var self = this;
      		this.dataSource.data([]);
      		this.contactPersonDS.data([]);
      		
      		this.set("isEdit", false);
      		this.set("isProtected", false);
      		this.set("isDuplicateNumber", false);
      		this.set("obj", null);

      		this.patternDS.query({
      			filter:[
      				{ field:"id", value:1 },
      				{ field:"is_pattern", value:1 }
      			],
      			page:1,
      			pageSize:1
      		}).then(function(){
      			var view = self.patternDS.view(),
      			type = self.contactTypeDS.at(0);

      			self.dataSource.insert(0, {				
					"country_id" 			: view[0].country_id,			
					"user_id" 				: 0,
					"contact_type_id" 		: 4, //General Customer							
					"abbr"					: type.abbr,
					"number"				: "",				
					"surname"				: "",
					"name"					: "",
					"gender"				: view[0].gender,					
					"phone" 				: "",
					"email" 				: "",					
					"company"				: view[0].company,
					"vat_no"				: view[0].vat_no,					
					"memo"					: view[0].memo,
					"city"					: view[0].city,
					"post_code"				: view[0].post_code,
					"address" 				: view[0].address,
					"bill_to" 				: view[0].bill_to,
					"ship_to" 				: view[0].ship_to,
					"latitute" 				: "",
					"longtitute" 			: "",
					"credit_limit"			: view[0].credit_limit,
					"locale" 				: view[0].locale,														
					"payment_term_id"		: view[0].payment_term_id,
					"payment_method_id"		: view[0].payment_method_id,									
					"registered_date" 		: new Date(),
					"account_id"			: view[0].account_id,
					"ra_id"					: view[0].ra_id,
					"tax_item_id"			: view[0].tax_item_id,
					"deposit_account_id"	: view[0].deposit_account_id,
					"trade_discount_id"		: view[0].trade_discount_id,
					"settlement_discount_id": view[0].settlement_discount_id,					
					"is_pattern" 			: 0,
					"status"				: 1								
				});

				var obj = self.dataSource.at(0);				
				//Pattern
				if(self.get("contact_type_id")>0){
					obj.set("contact_type_id", self.get("contact_type_id"));
					obj.set("abbr", "");
					obj.set("is_pattern", 1);
				}

				self.set("obj", obj);
				self.generateNumber();
      		});								
		},
	    objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Contact Person has changes
		    	if(this.contactPersonDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Contact Person
					$.each(self.contactPersonDS.data(), function(index, value) {
						value.set("contact_id", data[0].id);
					});
					
					//Pattern
					if(data[0].is_pattern){
						self.savePattern(data[0].contact_type_id, data[0].id);
					}
				}
				self.contactPersonDS.sync();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.contactPersonDS.cancelChanges();
			this.dataSource.data([]);
			this.contactPersonDS.data([]);
			this.set("contact_type_id", 0);

			banhji.userManagement.removeMultiTask("customer");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(!obj.is_system==1){
				if(obj.isProtected==false){				
					obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();					
				}else{
					alert("Sorry, this data is protected!");
				}
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		},
		//Pattern		
		applyPattern 			: function(contact_id){
			var self = this, obj = self.get("obj");
			
			this.patternDS.query({
				filter: [
					{ field:"id", value: contact_id },
					{ field:"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 1
			}).then(function(data){
				var view = self.patternDS.view();				

				if(view.length>0){
					obj.set("country_id", view[0].country_id);					
					obj.set("gender", view[0].gender);
					obj.set("company", view[0].company);
					obj.set("vat_no", view[0].vat_no);
					obj.set("memo", view[0].memo);
					obj.set("city", view[0].city);
					obj.set("post_code", view[0].post_code);
					obj.set("address", view[0].address);
					obj.set("bill_to", view[0].bill_to);
					obj.set("ship_to", view[0].ship_to);									
					obj.set("payment_term_id", view[0].payment_term_id);
					obj.set("payment_method_id", view[0].payment_method_id);
					obj.set("credit_limit", view[0].credit_limit);
					obj.set("locale", view[0].locale);					
					obj.set("account_id", view[0].account_id);
					obj.set("ra_id", view[0].ra_id);
					obj.set("tax_item_id", view[0].tax_item_id);
					obj.set("deposit_account_id", view[0].deposit_account_id);
					obj.set("trade_discount_id", view[0].trade_discount_id);
					obj.set("settlement_discount_id", view[0].settlement_discount_id);					
				}else{
					obj.set("country_id", 0);					
					obj.set("gender", "M");
					obj.set("company", "");
					obj.set("vat_no", "");
					obj.set("memo", "");
					obj.set("city", "");
					obj.set("post_code", "");
					obj.set("address", "");
					obj.set("bill_to", "");
					obj.set("ship_to", "");									
					obj.set("payment_term_id", 0);
					obj.set("payment_method_id", 0);
					obj.set("credit_limit", 0);
					obj.set("locale", "");					
					obj.set("account_id", 0);
					obj.set("ra_id", 0);
					obj.set("tax_item_id", 0);
					obj.set("deposit_account_id", 0);
					obj.set("trade_discount_id", 0);
					obj.set("settlement_discount_id", 0);
				}
			});
		},		
		savePattern 			: function(contact_type_id, contact_id){
			var data = banhji.customerSetting.contactTypeDS.get(contact_type_id);
			data.set("contact_id", contact_id);
			banhji.customerSetting.contactTypeDS.sync();			
			window.history.back();
		},
		typeChanges 			: function(){
			var obj = this.get("obj");

			if(obj.contact_type_id){
				var type = this.contactTypeDS.get(obj.contact_type_id);
				this.applyPattern(type.contact_id);
				obj.set("abbr", type.abbr);

				this.generateNumber();
			}else{
				obj.set("company", "");
				obj.set("vat_no", "");

				obj.set("country_id", 0);					
				obj.set("gender", "M");
				obj.set("company", "");
				obj.set("vat_no", "");
				obj.set("memo", "");
				obj.set("city", "");
				obj.set("post_code", "");
				obj.set("address", "");
				obj.set("bill_to", "");
				obj.set("ship_to", "");									
				obj.set("payment_term_id", 0);
				obj.set("payment_method_id", 0);
				obj.set("credit_limit", 0);
				obj.set("locale", "");					
				obj.set("account_id", 0);
				obj.set("ra_id", 0);
				obj.set("tax_item_id", 0);
				obj.set("deposit_account_id", 0);
				obj.set("trade_discount_id", 0);
				obj.set("settlement_discount_id", 0);
			}
		}
	});
	banhji.quote =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),			
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Quote" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		balanceDS  			: dataStore(apiUrl + "transactions"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		paymentTermDS 		: dataStore(apiUrl + "payment_terms"),
		contactDS  			: banhji.source.customerDS,
		employeeDS  		: banhji.source.saleRepDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS 			: banhji.source.customerTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),		
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,		
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		showDiscount 		: false,
		sub_total 			: 0,		
		discount 			: 0,
		balance 			: 0,		
		total 				: 0,		
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },   
		//Contact
		loadContact 		: function(id){
			var self = this, obj = self.get("obj");			
			
			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view();
		    	
		    	obj.set("contact_id", view[0].id);		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadBalance();
				self.loadRecurring();						
			});
		},		
		contactChanges 		: function(){
			var obj = this.get("obj");

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);
		    		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadBalance();		    			    	
		    	this.loadRecurring();    			    	
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
	    loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
	    //Currency Rate	
		setRate 			: function(){
			var self = this, 
			obj = this.get("obj"),
			date = kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd");
			
			this.currencyRateDS.query({
				filter: [
					{ field:"locale", value: obj.locale },
					{ field:"date <=", value: date }
				],
				sort: { field:"date", dir:"desc" },
				page: 1,
				pageSize: 1
			}).then(function(){
				var view = self.currencyRateDS.view();

				if(view.length>0){
					obj.set("rate", kendo.parseFloat(view[0].rate));
				}else{
					obj.set("rate", 1);
				}
			});				
		},
		//Payment Term
		setTerm 			: function(){
			var duedate = new Date(), obj = this.get("obj");

			if(obj.payment_term_id>0){
				var term = this.paymentTermDS.get(obj.payment_term_id);

				duedate.setDate(duedate.getDate() + term.net_due);

				obj.set("due_date", duedate);
			}else{
				obj.set("due_date", new Date());
			}			
		},
		//Segment				
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				self.set("obj", view[0]);				

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));				
				
				if(view[0].status=="1"){
					self.set("statusSrc", banhji.source.usedSrc);
				}else{
					self.set("statusSrc", banhji.source.openSrc);
				}

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}

				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.attachmentDS.filter({ field: "transaction_id", value: view[0].id });
				self.loadRecurring();				
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.price;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}					

					value.set("amount", amt);					
					subTotal += amt;					
		        });				

		    	//Total
		        total = subTotal + tax;		        

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);									    	
	    	}	
		},					
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);			

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("tax", 0);
			this.set("discount", 0);			
			this.set("total", 0);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 30);				

			this.dataSource.insert(0,{				
				contact_id 				: "",				
				transaction_template_id : 1,
				payment_term_id 		: 0,				
				recurring_id 			: "",				
				user_id 				: this.get("user_id"),
				employee_id 			: "", 	    		
			   	type					: "Quote",
			   	sub_total 				: 0,			   			   	
			   	amount					: 0,
			   	discount 				: 0,
			   	tax 					: 0,
			   	rate					: 1,			   	
			   	locale 					: banhji.locale,			   	
			   	issued_date 			: new Date(),
			   	due_date 				: duedate,			   	
			   	bill_to 				: "",
			   	ship_to 				: "",
			   	memo 					: "",
			   	memo2 					: "",
			   	status 					: 0,
			   	segments 				: [],
			   	//Recurring
			   	recurring_name 			: "",
			   	start_date 				: new Date(),
			   	frequency 				: "Daily",
			   	month_option 			: "Day",
			   	interval 				: 1,
			   	day 					: 1,
			   	week 					: 0,
			   	month 					: 0,
			   	is_recurring 			: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);					
			this.set("obj", obj);

			this.addRow();
			this.setRate();
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,
				rate				: obj.rate,
				locale				: obj.locale,
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changes
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
    		//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){										
						value.set("transaction_id", data[0].id);										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}
				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });			

			banhji.userManagement.removeMultiTask("quote");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},		 
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);					
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,							
							item_id 			: value.item_id,									
							description 		: value.description,							
							quantity 			: value.quantity,
							price 				: value.price,								
							amount 	 			: value.amount,									
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});				
			}else{
				this.addEmpty();
			} 
		},		
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":			       
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;			    
			    default:			        
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},		
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");				
			}			

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,				
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,			   				   				   		   					   				   	
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,			   	
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,				   		   	   	
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1			
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({					
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,					
					item_id 			: value.item_id,								
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,													
					amount 	 			: value.amount,
					discount 			: value.discount,				
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.recurringDS.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    }
	});
	banhji.saleOrder =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),		
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Sale_Order" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		jobDS				: dataStore(apiUrl + "jobs"),		
		balanceDS  			: dataStore(apiUrl + "transactions"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.customerDS,
		employeeDS  		: banhji.source.saleRepDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.customerTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
		confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,    
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		showDiscount 		: false,
		showRequiredDate 	: false,
		sub_total 			: 0,		
		discount 			: 0,
		balance 			: 0,		
		total 				: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadBalance();
				self.loadReference();
				self.loadRecurring();						
			});
		},		
		contactChanges 		: function(){
			var obj = this.get("obj");
			this.jobDS.filter({ field:"contact_id", value: obj.contact_id });

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);
		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadBalance();
		    	this.loadReference();
		    	this.loadRecurring();    	
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
	    loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment		
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				self.set("obj", view[0]);				

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));

				if(view[0].status=="1"){
					self.set("statusSrc", banhji.source.usedSrc);
				}else{
					self.set("statusSrc", banhji.source.openSrc);
				}

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}

				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.attachmentDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });
				self.loadRecurring();	
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.price;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}					

					value.set("amount", amt);					
					subTotal += amt;					
		        });				

		    	//Total
		        total = subTotal + tax;		        

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);									    	
	    	}	
		},					
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);
			
			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);			
			this.set("discount", 0);
			this.set("tax", 0);			
			this.set("total", 0);
			this.set("amtDueColor", banhji.source.amtDueColor);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 30);				

			this.dataSource.insert(0, {				
				contact_id 			: "",
				transaction_template_id : 2,				
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
				employee_id			: "", 	    		
			   	type				: "Sale_Order",
			   	sub_total 			: 0,
			   	amount				: 0,
			   	credit_allowed 		: 0,			   	
			   	discount 			: 0,
			   	tax 				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);
			this.set("obj", obj);

			this.addRow();
			this.setRate();
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,				
				rate				: obj.rate,
				locale				: obj.locale,
				movement 			: -1,
				required_date 		: new Date(),

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);
	    		ref.set("status", 1);
	    		this.referenceDS.sync();
	    	}else{
	    		obj.set("reference_id", 0);
	    	}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changes
		    	if(this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){										
						value.set("transaction_id", data[0].id);										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}
				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });			

			banhji.userManagement.removeMultiTask("sale_order");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id },
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: "Quote" },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}				
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");

			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);

				obj.set("employee_id", data.employee_id);
				obj.set("segments", data.segments);
								
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: 0,
							item_id 			: value.item_id,
							tax_item_id 		: value.tax_item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							price 				: value.price,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							required_date 		: value.required_date,

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});
		 	}
		},
		//Recurring		
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);					
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,							
							item_id 			: value.item_id,									
							description 		: value.description,							
							quantity 			: value.quantity,
							price 				: value.price,								
							amount 	 			: value.amount,									
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							required_date 		: value.required_date,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});				
			}else{
				this.addEmpty();
			} 
		},		
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":			       
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;			    
			    default:			        
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},		
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");				
			}			

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,				
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,			   				   				   		   					   				   	
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,			   	
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,				   		   	   	
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1			
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({					
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,					
					item_id 			: value.item_id,								
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,													
					amount 	 			: value.amount,
					discount 			: value.discount,				
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.recurringDS.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    }
	});
	banhji.customerDeposit =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "account_lines"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "account_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "account_lines"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Customer_Deposit" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactDS 			: banhji.source.customerDS,
		depositAccountDS 	: banhji.source.depositAccountDS,
		segmentItemDS 		: banhji.source.segmentItemDS,
		accountDS 			: banhji.source.cashAccountDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthList 			: banhji.source.monthList,	
		monthOptionList 	: banhji.source.monthOptionList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		total				: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;

			this.contactDS.query({
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("account_id", view[0].deposit_account_id);
		    	obj.set("locale", view[0].locale);
				
				self.setRate();
				self.loadReference();
				self.loadRecurring();
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");

	    	if(obj.contact_id>0){
		    	var contact = this.contactDS.get(obj.contact_id);
		    	
		    	obj.set("account_id", contact.deposit_account_id);
		    	obj.set("locale", contact.locale);
		    	this.setRate();
		    	this.loadReference();
		    	this.loadRecurring();
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment
		segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();

				self.set("obj", view[0]);
				self.set("original_total", view[0].amount);
				self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
				self.lineDS.filter({ field: "transaction_id", value: id });				
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });

				self.loadRecurring();
			});
		},
		changes				: function(){
			var obj = this.get("obj");
			
			if(this.lineDS.total()>0){
				var sum = 0;
				
				$.each(this.lineDS.data(), function(index, value) {
					sum += value.amount;
		        });

		        this.set("total", kendo.toString(sum, "c", obj.locale));
		        obj.set("amount", sum);
	    	}else{
	    		this.set("total", 0);
		        obj.set("amount", 0);
	    	}
		},
		addEmpty 		 	: function(){
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);
			this.journalLineDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);

			this.dataSource.insert(0, {
				contact_id 				: "",
				transaction_template_id : "",
				recurring_id 			: "",
				reference_id	 		: "",
				account_id 				: "",
				user_id 				: this.get("uer_id"),
			   	type					: "Customer_Deposit", //required
			   	amount					: 0,
			   	rate					: 1,
			   	locale 					: banhji.institute.locale,
			   	issued_date 			: new Date(),
			   	memo 					: "",
			   	memo2 					: "",
			   	segments 				: [],
			   	is_journal 				: 1,
			   	//Recurring
			   	recurring_name 			: "",
			   	start_date 				: new Date(),
			   	frequency 				: "Daily",
			   	month_option 			: "Day",
			   	interval 				: 1,
			   	day 					: 1,
			   	week 					: 0,
			   	month 					: 0,
			   	is_recurring 			: 0
	    	});

			var obj = this.dataSource.at(0);
			this.set("obj", obj);
			this.addRow();
			this.setRate();
		},
		addRow 				: function(){
			var obj = this.get("obj");
					
			this.lineDS.add({
				transaction_id 		: obj.id,
				account_id 			: "",
				description 		: "",
				reference_no 		: "",
				amount 	 			: 0,
				rate				: obj.rate,
				locale				: obj.locale
			});
		},
		removeRow  			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				ref.set("deposit", obj.amount);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);

	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}	    	

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				// Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});			
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			
			banhji.userManagement.removeMultiTask("customer_deposit");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Journal
		addJournal 			: function(transaction_id){
	    	var self = this,
	    	sum = 0,
	    	obj = this.get("obj");

			//Cash account on DR
			$.each(this.lineDS.data(), function(index, value){
				sum += value.amount;
				self.journalLineDS.add({
					transaction_id 		: transaction_id,
					account_id 			: value.account_id,
					contact_id 			: value.contact_id,
					description 		: "",
					reference_no 		: value.reference_no,
					segments 	 		: [],
					dr 	 				: value.amount,
					cr 					: 0,
					rate				: value.rate,
					locale				: value.locale
				});
			});

			//Deposit on CR
			this.journalLineDS.add({
				transaction_id 		: transaction_id,
				account_id 			: obj.account_id,
				contact_id 			: obj.contact_id,
				description 		: "",
				reference_no 		: "",
				segments 	 		: obj.segments,
				dr 	 				: 0,
				cr 					: sum,
				rate				: obj.rate,
				locale				: obj.locale
			});

			this.journalLineDS.sync();
		},
		//Reference
		loadReference 		: function(){
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", value: "Sale_Order" },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}
		},
		referenceChanges 	: function(){
			var obj = this.get("obj");

			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);

				obj.set("segments", data.segments);
				obj.set("amount", data.amount);

				this.lineDS.data([]);
				this.lineDS.add({
					transaction_id 		: obj.id,
					account_id 			: "",
					description 		: "",
					reference_no 		: data.number,
					amount 	 			: data.amount,
					rate				: data.rate,
					locale				: data.locale
				});
			 	this.set("total", kendo.toString(data.amount, "c", data.locale));
		 	}
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							price 				: value.price,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.cashSale =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		jobDS				: dataStore(apiUrl + "jobs"),		
		balanceDS  			: dataStore(apiUrl + "transactions"),
		depositDS  			: dataStore(apiUrl + "transactions"),
		depositSumDS  		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transactions/amount_sum",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,								
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Cash_Sale" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		cashAccountDS  		: banhji.source.cashAccountDS,
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.customerDS,
		employeeDS  		: banhji.source.saleRepDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.customerTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		showDiscount 		: false,
		sub_total 			: 0,
		tax 				: 0,
		discount 			: 0,
		balance 			: 0,
		total_deposit		: 0,
		total 				: 0,
		remaining 			: 0,
		amount_due 			: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		loadData 			: function(){
			var obj = this.get("obj");

			this.setRate();
	    	this.loadDeposit();
	    	this.loadBalance();
	    	this.loadReference();
	    	this.loadRecurring();
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
	        	}	            
	        });

	        this.attachmentDS.sync();
	        var saved = false;
	        this.attachmentDS.bind("requestEnd", function(e){
	        	//Delete File
	        	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
	        	}
	        });
	    },
		//Deposit
		loadDeposit 		: function(){
			var self = this, obj = this.get("obj");

			if(this.get("isEdit")){
				this.depositDS.filter([
					{ field:"type", value:"Customer_Deposit" },
					{ field:"reference_id", value:obj.id }
				]);
			}

			this.depositSumDS.query({
				filter:[
					{ field:"type", value:"Customer_Deposit" },
					{ field:"contact_id", value:obj.contact_id }
				],
				page: 1,
				pageSize: 1000
			}).then(function(){
				var view = self.depositSumDS.view(),
				total_deposit = view[0].amount + obj.deposit;

				self.set("total_deposit", total_deposit);
			});
		},
		addDeposit 			: function(id){
			var obj = this.get("obj");
			
			this.depositDS.data([]);

			if(obj.deposit>0){				
				this.depositDS.add({				
					contact_id 			: obj.contact_id,								
					reference_id 		: id,				
					user_id 			: this.get("user_id"),				    		
				   	type				: "Customer_Deposit",
				   	amount				: obj.deposit*-1,			   	
				   	rate				: obj.rate,			   	
				   	locale 				: obj.locale,			   	
				   	issued_date 		: obj.issued_date			   	
		    	});
			}
		},		
		saveDeposit 		: function(id){			
			var obj = this.get("obj");
			
    		if(this.get("isEdit")){
    			if(this.depositDS.total()>0){
					var deposit = this.depositDS.at(0);
					deposit.set("amount", obj.deposit*-1);
				}else{
					this.addDeposit(id);
				}
    		}else{
				this.addDeposit(id);
    		}

			this.depositDS.sync();
		},
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_method_id", view[0].payment_method_id);		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);				
							
				self.loadData();							
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			this.jobDS.filter({ field:"contact_id", value: obj.contact_id });

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);		    			    	
		    	
		    	obj.set("payment_method_id", contact.payment_method_id);		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.loadData();	    	
	    	}else{
	    		this.set("total_deposit", 0);
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
	    loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 10000
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
	    //Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment	
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("obj", view[0]);
				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
		        self.set("remaining", kendo.toString(view[0].remaining, "c", view[0].locale));
		        self.set("amount_due", kendo.toString(view[0].amount - view[0].deposit, "c", view[0].locale));
		        
				self.set("statusSrc", banhji.source.paidSrc);

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}
								
				//self.contactDS.filter({ field: "id", value: view[0].contact_id });				
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.journalLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });

				self.depositDS.filter([
					{ field: "reference_id", value: view[0].id },
					{ field: "type", value: "Credit" }
				]);
				
				self.set("original_total", view[0].amount);
				self.set("original_credit", view[0].credit);

				self.loadDeposit();
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0, remaining = 0, amount_due = 0;
								
				if(kendo.parseInt(obj.tax_item_id)>0){
					var selectedVat 					
					vatAmt = kendo.parseFloat(selectedVat.item_prices[0].price);
				}								

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.price;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}					

					value.set("amount", amt);					
					subTotal += amt;					
		        });				

		    	//Total
		        total = subTotal + tax;
		        amount_due = total - obj.deposit;

		        //Apply Deposit
		        if(obj.deposit>0){
		        	if(obj.deposit <= this.get("total_deposit")){
			        	if(obj.deposit <= total){
			        		remaining = total - obj.deposit;
			        	}else{
			        		obj.set("deposit", total);
			        	}
			        }else{
		        		alert("Over deposit to apply!");
		        		obj.set("deposit", 0);
		        	}

		        	//Status
			        if(remaining==0){
			    		obj.set("status", 1);
			    	}else if(remaining==total){
			    		obj.set("status", 0);
			    	}else{
			    		obj.set("status", 2);
			    	}
		        }

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));
		        this.set("remaining", kendo.toString(remaining, "c", obj.locale));
		        this.set("amount_due", kendo.toString(amount_due, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);
				obj.set("remaining", remaining);									    	
	    	}	
		},					
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.depositDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("discount", 0);
			this.set("tax", 0);
			this.set("total", 0);
			this.set("total_deposit", 0);			
			this.set("remaining", 0);
			this.set("amount_due", 0);
			this.set("amtDueColor", banhji.source.amtDueColor);				

			this.dataSource.insert(0, {				
				contact_id 			: "",//Customer
				payment_method_id	: 0,				
				reference_id 		: "",
				recurring_id 		: "",
				account_id 			: 1,
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
				employee_id			: "",//Sale Rep 	    		
			   	type				: "Cash_Sale",//Required
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,  					   				   	
			   	amount				: 0,
			   	deposit 			: 0,
			   	remaining 			: 0,
			   	credit_allowed 		: 0,
			   	credit 				: 0,
			   	check_no 			: "",
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);
			
			this.setRate();
			this.addRow();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,
				fine 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var d = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(d);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Warning over credit allowed
	        if(obj.credit_limit>0 && obj.amount>obj.credit_allowed){
	        	alert("Over credit allowed!");		        	
	        }

	        //Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.saveDeposit(data[0].id);
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();

			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });

			banhji.userManagement.removeMultiTask("cash_sale");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	contact = this.contactDS.get(obj.contact_id),	    				    	
	    	saleList = {},
	    	taxList = {},
	    	inventoryList = {},
			cogsList = {};			
			
			//Arrange sale, cogs, inventory
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				amount = value.quantity * value.price;				
				
				//Add sale list
				var incomeID = item.income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amount": amount};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amount += amount;
						}else{
							saleList[incomeID]={"id": incomeID, "amount": amount};
						}
					}
				}

				//Add tax list																							
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = value.amount*taxItem.rate;

					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}				
				
				//Inventory
				if(item.item_type_id==1){
					//Add cogs list
					var itemCost = value.quantity*item.cost,
					cogsID = item.cogs_account_id,
					itemRate = banhji.source.getRate(item.locale, new Date(obj.issued_date));

					if(cogsList[cogsID]===undefined){
						cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(cogsList[cogsID].id===cogsID){
							cogsList[cogsID].amount += itemCost;
						}else{
							cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
						}
					}						

					//Add inventory list
					var inventoryID = item.inventory_account_id;
					if(inventoryList[inventoryID]===undefined){
						inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(inventoryList[inventoryID].id===inventoryID){
							inventoryList[inventoryID].amount += itemCost;
						}else{
							inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
						}
					}
				}					  	
			});//End Foreach Loop			

			//Start journal
			//Cash on Dr 
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: obj.account_id,				
				contact_id 			: obj.contact_id,				
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				dr 	 				: obj.amount - obj.deposit,
				cr 					: 0,				
				rate				: obj.rate,
				locale				: obj.locale
			});

			//Discount on Dr			
			if(obj.discount > 0){				
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.trade_discount_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: obj.discount,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Deposit and Credit on Dr
			if(obj.deposit > 0){				
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.deposit_account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: obj.deposit,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Sale accounts on Cr		
			if(!jQuery.isEmptyObject(saleList)){				
				$.each(saleList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});										
				});
			}

			//Tax on Cr					
			if(!jQuery.isEmptyObject(taxList)){				
				$.each(taxList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});										
				});
			}	

			//Inventory to journal
			//COGS on Dr 			
			if(!jQuery.isEmptyObject(cogsList)){							
				$.each(cogsList, function(index, value){				
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});								
				});							
			}
			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: value.rate,
						locale				: value.locale
					});						
				});
			}

			this.journalLineDS.sync();
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", operator:"where_in", value:["Sale_Order", "Quote", "GDN"] },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}					
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);

				obj.set("employee_id", data.employee_id);
				obj.set("segments", data.segments);
				obj.set("deposit", data.deposit);
												
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							price 				: value.price,												
							amount 				: value.amount,
							discount 			: value.discount,
							fine 				: value.fine,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,							

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				obj.set("deposit", 0);
			}								
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							price 				: value.price,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});	
	banhji.invoice =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		jobDS				: dataStore(apiUrl + "jobs"),		
		balanceDS  			: dataStore(apiUrl + "transactions"),
		depositDS  			: dataStore(apiUrl + "transactions"),
		depositSumDS  		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transactions/amount_sum",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,								
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Invoice" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.customerDS,
		employeeDS  		: banhji.source.saleRepDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.customerTaxDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		paymentTermDS 		: dataStore(apiUrl + "payment_terms"),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		showDiscount 		: false,
		sub_total 			: 0,
		tax 				: 0,
		discount 			: 0,
		balance 			: 0,
		total_deposit		: 0,
		total 				: 0,
		amount_due 			: 0,
		remaining 			: 0,
		original_total 		: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		loadData 			: function(){
			this.setRate();
			this.setTerm();
			this.loadBalance();
			this.loadDeposit();
			this.loadReference();
			this.loadRecurring();
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
		//Deposit
		loadDeposit 		: function(){
			var self = this, obj = this.get("obj");

			if(this.get("isEdit")){
				this.depositDS.filter([
					{ field:"type", value:"Customer_Deposit" },
					{ field:"reference_id", value:obj.id }
				]);
			}

			this.depositSumDS.query({
				filter:[
					{ field:"type", value:"Customer_Deposit" },
					{ field:"contact_id", value:obj.contact_id }
				],
				page: 1,
				pageSize: 1000
			}).then(function(){
				var view = self.depositSumDS.view(),
				total_deposit = view[0].amount + obj.deposit;

				self.set("total_deposit", total_deposit);
			});
		},
		addDeposit 			: function(id){
			var obj = this.get("obj");
			
			this.depositDS.data([]);

			if(obj.deposit>0){				
				this.depositDS.add({				
					contact_id 			: obj.contact_id,								
					reference_id 		: id,				
					user_id 			: this.get("user_id"),				    		
				   	type				: "Customer_Deposit",
				   	amount				: obj.deposit*-1,			   	
				   	rate				: obj.rate,			   	
				   	locale 				: obj.locale,			   	
				   	issued_date 		: obj.issued_date			   	
		    	});
			}
		},		
		saveDeposit 		: function(id){			
			var obj = this.get("obj");
			
    		if(this.get("isEdit")){
    			if(this.depositDS.total()>0){
					var deposit = this.depositDS.at(0);
					deposit.set("amount", obj.deposit*-1);
				}else{
					this.addDeposit(id);
				}
    		}else{
				this.addDeposit(id);
    		}

			this.depositDS.sync();
		},
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("payment_term_id", view[0].payment_term_id);		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.loadData();							
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			this.jobDS.filter({ field:"contact_id", value: obj.contact_id });

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);		    	 	
		    	
		    	obj.set("payment_term_id", contact.payment_term_id);
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.setTerm();
		    	this.loadDeposit();
		    	this.loadBalance();
		    	this.loadReference();
		    	this.loadRecurring();  			    	
	    	}else{
	    		this.set("total_deposit", 0);
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
	    loadBalance 		: function(){
			var self = this, obj = this.get("obj");			

			this.balanceDS.query({    			
				filter:[
					{ field:"contact_id", value:obj.contact_id },
					{ field:"type", value:"Invoice" },
					{ field:"status", operator:"where_in", value:[0,2] }
				],
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.balanceDS.view(),				
				contact = self.contactDS.get(obj.contact_id),
				balance = 0,
				creditAllowed = 0;

				$.each(view, function(index, value){
					if(value.status==0){
						balance += value.amount;
					}else{
						balance += (value.amount - value.amount_paid);
					}
				});

				if(contact.credit_limit > balance){
					creditAllowed = contact.credit_limit - balance;
				}
						    	
		    	self.set("balance", kendo.toString(balance, "c", obj.locale));
		    	obj.set("credit_allowed", creditAllowed);		
			});				
		},
	    //Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Payment Term
		setTerm 			: function(){
			var duedate = new Date(), obj = this.get("obj");

			if(obj.payment_term_id>0){
				var term = this.paymentTermDS.get(obj.payment_term_id);

				duedate.setDate(duedate.getDate() + term.net_due);

				obj.set("due_date", duedate);
			}else{
				obj.set("due_date", new Date());
			}			
		},
		//Segments	
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				

				self.set("obj", view[0]);
				self.set("original_total", view[0].amount);

				if(view[0].status=="1"){
					self.set("statusSrc", banhji.source.paidSrc);
				}else if(view[0].status=="2"){
					self.set("statusSrc", banhji.source.partialyPaidSrc);
				}else{
					self.set("statusSrc", banhji.source.openSrc);
				}

				if(view[0].discount>0){
					self.set("showDiscount", true);
				}

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));
				self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
		        self.set("remaining", kendo.toString(view[0].remaining, "c", view[0].locale));
		        self.set("amount_due", kendo.toString(view[0].amount - view[0].deposit, "c", view[0].locale));
											
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.journalLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.attachmentDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });				
				
				self.loadDeposit();				
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj");

			if(this.lineDS.total()>0){			
				var total = 0, subTotal = 0, discount =0, tax = 0, remaining = 0, amount_due = 0;											

				$.each(this.lineDS.data(), function(index, value) {				
					var amt = value.quantity * value.price;					

					//Discount by line
					if(value.discount>0){										
						var discount_amount = amt * value.discount;
						amt -= discount_amount;
						discount += discount_amount;																	
					}

					//Tax by line
					if(value.tax_item_id>0){
						var taxItem = self.taxItemDS.get(value.tax_item_id);										
						tax += amt * taxItem.rate;																	
					}					

					value.set("amount", amt);					
					subTotal += amt;					
		        });				

		    	//Total
		        total = subTotal + tax;
		        amount_due = total - obj.deposit;

		        //Apply Deposit
		        if(obj.deposit>0){
		        	if(obj.deposit <= this.get("total_deposit")){
			        	if(obj.deposit <= total){
			        		remaining = total - obj.deposit;
			        	}else{
			        		obj.set("deposit", total);
			        	}
			        }else{
		        		alert("Over deposit to apply!");
		        		obj.set("deposit", 0);
		        	}

		        	//Status
			        if(remaining==0){
			    		obj.set("status", 1);
			    	}else if(remaining==total){
			    		obj.set("status", 0);
			    	}else{
			    		obj.set("status", 2);
			    	}
		        }

		        //Warning over credit allowed
		        if(obj.credit_allowed>0 && total>obj.credit_allowed){
		        	this.set("amtDueColor", "Gold");		        	
		        }else{
		        	this.set("amtDueColor", banhji.source.amtDueColor);
		        }

		        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
		        this.set("discount", kendo.toString(discount, "c", obj.locale));
		        this.set("tax", kendo.toString(tax, "c", obj.locale));
		        this.set("total", kendo.toString(total, "c", obj.locale));
		        this.set("remaining", kendo.toString(remaining, "c", obj.locale));
		        this.set("amount_due", kendo.toString(amount_due, "c", obj.locale));

		        obj.set("sub_total", subTotal);
		        obj.set("discount", discount);
		        obj.set("tax", tax);			
				obj.set("amount", total);
				obj.set("remaining", remaining);									    	
	    	}	
		},					
		addEmpty 		 	: function(){
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.depositDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("tax", 0);
			this.set("discount", 0);
			this.set("total_deposit", 0);
			this.set("total", 0);
			this.set("remaining", 0);
			this.set("amount_due", 0);
			this.set("amtDueColor", banhji.source.amtDueColor);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 7);				

			this.dataSource.insert(0, {				
				contact_id 			: "",//Customer
				transaction_template_id : 3,
				payment_term_id		: 0,				
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
				employee_id 		: "",//Sale Rep 	    		
			   	type				: "Invoice",//Required
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,
			   	deposit 			: 0,			   	
			   	amount				: 0,
			   	remaining 			: 0,
			   	credit_allowed 		: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.setRate();	
			this.addRow();
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,
				fine 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");
	    	
	    	//Warning over credit allowed
	        if(obj.credit_limit>0 && obj.amount>obj.credit_allowed){
	        	alert("Over credit allowed!");		        	
	        }

	        //Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.saveDeposit(data[0].id);
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });			

			banhji.userManagement.removeMultiTask("invoice");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	contact = this.contactDS.get(obj.contact_id),	    				    	
	    	saleList = {},
	    	taxList = {},
	    	inventoryList = {},
			cogsList = {};			
			
			//Arrange sale, cogs, inventory
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				amount = value.quantity * value.price;				
				
				//Add sale list
				var incomeID = item.income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amount": amount};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amount += amount;
						}else{
							saleList[incomeID]={"id": incomeID, "amount": amount};
						}
					}
				}

				//Add tax list																							
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = value.amount*taxItem.rate;

					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}				
				
				//Inventory
				if(item.item_type_id==1){
					//Add cogs list
					var itemCost = value.quantity*item.cost,
					cogsID = item.cogs_account_id,
					itemRate = banhji.source.getRate(item.locale, new Date(obj.issued_date));

					if(cogsList[cogsID]===undefined){
						cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(cogsList[cogsID].id===cogsID){
							cogsList[cogsID].amount += itemCost;
						}else{
							cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
						}
					}						

					//Add inventory list
					var inventoryID = item.inventory_account_id;
					if(inventoryList[inventoryID]===undefined){
						inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(inventoryList[inventoryID].id===inventoryID){
							inventoryList[inventoryID].amount += itemCost;
						}else{
							inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": item.rate, "locale": item.locale};
						}
					}
				}					  	
			});//End Foreach Loop			

			//Start journal
			//A/R on Dr
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: contact.account_id,				
				contact_id 			: obj.contact_id,				
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				dr 	 				: obj.amount - obj.deposit,
				cr 					: 0,				
				rate				: obj.rate,
				locale				: obj.locale
			});

			//Discount on Dr			
			if(obj.discount > 0){				
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.trade_discount_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: obj.discount,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Deposit on Dr
			if(obj.deposit > 0){				
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.deposit_account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: obj.deposit,
					cr 					: 0,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Sale accounts on Cr		
			if(!jQuery.isEmptyObject(saleList)){				
				$.each(saleList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});										
				});
			}

			//Tax on Cr					
			if(!jQuery.isEmptyObject(taxList)){				
				$.each(taxList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});										
				});
			}	

			//Inventory to journal
			//COGS on Dr 			
			if(!jQuery.isEmptyObject(cogsList)){							
				$.each(cogsList, function(index, value){				
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});								
				});							
			}
			//Inventory on Cr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: value.rate,
						locale				: value.locale
					});						
				});
			}

			this.journalLineDS.sync();
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", operator:"where_in", value:["Sale_Order", "Quote", "GDN"] },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}					
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);
				
				obj.set("employee_id", data.employee_id);
				obj.set("segments", data.segments);
				obj.set("deposit", data.deposit);
												
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							price 				: value.price,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,							

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				obj.set("deposit", 0);
			}								
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							price 				: value.price,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.gdn =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "transactions/line"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		contactDS  			: banhji.source.customerDS,
		itemDS  			: banhji.source.itemDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"GDN" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		amtDueColor 		: banhji.source.amtDueColor,
	    confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		total 				: 0,
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();						
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");

	    	if(obj.contact_id>0){		    			    	
		    	var contact = this.contactDS.get(obj.contact_id);
		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadReference();
		    	this.loadRecurring();   			    	
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
	    //Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Obj
		loadObj 			: function(id, is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}			

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();

				self.set("obj", view[0]);
				
				self.set("statusSrc", banhji.source.deliveredSrc);
							
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });
				self.loadRecurring();
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj"), total = 0;												

			$.each(this.lineDS.data(), function(index, value) {				
				total += value.quantity;										
	        });

	        this.set("total", kendo.toString(total, "n0"));
	        obj.set("amount", total);	    	
		},					
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);

			//Set Date
			var duedate = new Date();
			duedate.setDate(duedate.getDate() + 7);				

			this.dataSource.insert(0, {				
				contact_id 			: "",
				transaction_template_id : 4,
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
				employee_id 		: "",
			   	type				: "GDN",	   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	due_date 			: duedate,//Delivery Date
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();
			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });
				}

				self.lineDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });			

			banhji.userManagement.removeMultiTask("gdn");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },
					{ field: "status", value: 0 },
					{ field: "type", operator:"where_in", value:["Quote", "Sale_Order", "Invoice"] },
					{ field: "due_date >=", value: kendo.toString(obj.issued_date, "yyyy-MM-dd") }
				]);
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");
			}					
		},
		referenceChanges 	: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var data = this.referenceDS.get(obj.reference_id);
				
				obj.set("employee_id", data.employee_id);
				obj.set("segments", data.segments);
				obj.set("deposit", data.deposit);
												
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							price 				: value.price,												
							amount 				: value.amount,
							discount 			: value.discount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,							

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				obj.set("deposit", 0);
			}								
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", value:obj.type },
				{ field:"contact_id", value:obj.contact_id },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("employee_id", data.employee_id);//Sale Rep
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							tax_item_id 		: value.tax_item_id,
							item_id 			: value.item_id,
							description 		: value.description,
							quantity 			: value.quantity,
							price 				: value.price,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,
							
							item_prices 		: value.item_prices
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				employee_id 			: obj.employee_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	discount 				: obj.discount,
			   	tax 					: obj.tax,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					measurement_id 		: value.measurement_id,
					tax_item_id 		: value.tax_item_id,
					item_id 			: value.item_id,
					description 		: value.description,
					quantity 			: value.quantity,
					price 				: value.price,
					amount 	 			: value.amount,
					discount 			: value.discount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.saleReturn =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		lineDS  			: dataStore(apiUrl + "transactions/line"),
		deleteDS 			: dataStore(apiUrl + "transactions"),		
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		referenceDS			: dataStore(apiUrl + "transactions"),
		referenceLineDS		: dataStore(apiUrl + "transactions/line"),
		returnDS			: dataStore(apiUrl + "transactions"),
		invoiceDS			: dataStore(apiUrl + "transactions"),
		jobDS				: dataStore(apiUrl + "jobs"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.customerDS,
		itemDS  			: banhji.source.itemDS,
		taxItemDS  			: banhji.source.customerTaxDS,
		accountDS  			: banhji.source.cashAccountDS,
		catalogDS			: dataStore(apiUrl + "items"),
		assemblyDS			: dataStore(apiUrl + "items/assembly"),		
		segmentItemDS		: banhji.source.segmentItemDS,
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Sale_Return" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		optionList 			: [
			{ id:"Offset_Invoice", name:"Charge Against Invoice" },
			{ id:"Customer_Deposit", name:"Add To Deposit" },
			{ id:"Credit_Note", name:"Cash Refund" }
		],
		amtDueColor 		: banhji.source.amtDueColor,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		statusSrc 			: "",
		enableRef 	 		: false,
		showReturn 			: true,
		showDiscount 		: false,		
		sub_total 			: 0,		
		discount 			: 0,
		tax 				: 0,		
		total 				: 0,
		remain 				: 0,
		original_total 		: 0,		
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
		//Contact
		loadContact 		: function(id){
			var self = this;
			this.jobDS.filter({ field:"contact_id", value:id });			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				obj = self.get("obj");
		    	
		    	obj.set("contact_id", view[0].id);		    		    	
		    	obj.set("locale", view[0].locale);				
				obj.set("bill_to", view[0].bill_to);
				obj.set("ship_to", view[0].ship_to);
				
				self.setRate();
				self.loadReference();		
			});
		},
		contactChanges 		: function(){
			var obj = this.get("obj");
			this.jobDS.filter({ field:"contact_id", value: obj.contact_id });

	    	if(obj.contact_id>0){		    			    	
		    	contact = this.contactDS.get(obj.contact_id);   	
		    		    	
		    	obj.set("locale", contact.locale);
		    	obj.set("bill_to", contact.bill_to);
		    	obj.set("ship_to", contact.ship_to);

		    	this.setRate();
		    	this.loadReference();		    		    			    	
	    	}

	    	this.lineDS.data([]);
		    this.addRow();
		    this.changes();
	    },
		//Currency Rate		
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);						
		},
		//Segment	
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 		: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){
		        			var catalogRate = obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date));										
							
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*catalogRate,												
								amount 				: value.item_prices[0].price*catalogRate,
								discount 			: 0,
								rate				: catalogRate,
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);
		    		data.set("rate", rate);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},
		measurementChanges 	: function(e){										
			var data = e.data, obj = this.get("obj");			

			if(data.measurement_id>0){
				$.each(data.item_prices, function(index, value){
					if(value.measurement_id==data.measurement_id){
						var rate = obj.rate / banhji.source.getRate(value.locale, new Date(obj.issued_date));						
				        data.set("price", value.price*rate);				       			       
				        
						return false;
					}
				});	    		
		        	        
		        this.changes();
	        }	                	        	
		},
		//Return Option
		addRowOption 		: function(){				
			var obj = this.get("obj");
			

			var account_id = 0;
			if(this.accountDS.total()>0){
				account_id = this.accountDS.at(0).id;
			}
						
			this.returnDS.add({					
				return_id 		: obj.id,				
				reference_id 	: "",
				account_id 		: account_id,
				type 			: "",													
				amount 			: 0,				
				rate			: obj.rate,
				locale			: obj.locale,
				issued_date 	: obj.issued_date,
				
				showInvoice 	: false,
				showAccount 	: false				
			});																	
		},
		removeRowOption 	: function(e){						
			var d = e.data;
			
			if(this.returnDS.total()>1){			
				this.returnDS.remove(d);
		        this.changes();
	        }	        	        
		},
		invoiceChanges 		: function(e){
			var data = e.data;
			
			if(data.reference_id>0){
				var inv = this.invoiceDS.get(data.reference_id);
				data.set("amount", inv.amount - (inv.amount_paid + inv.deposit));

				this.changes();
			}else{
				data.set("amount", 0);
			}							
		},
		optionChanges 		: function(e){
			var data = e.data, obj = this.get("obj");

			switch(data.type) {
			    case "Offset_Invoice": //Invoice		    	
			        data.set("showInvoice", true);
			        data.set("showAccount", false);

			        if(obj.contact_id>0){
			        	var para = [
					 			{ field:"contact_id", value: obj.contact_id },
					 			{ field:"status", operator:"where_in", value:[0,2] },
					 			{ field:"type", value:"Invoice" },
					 	];

					 	if(obj.reference_id>0){
					 		para.push({ field:"id", operator:"where_not_in", value:[obj.reference_id] });
					 	} 

				        this.invoiceDS.filter(para);
				 	}

			        break;
			    case "Credit_Note": //Refund		    	
			        data.set("showInvoice", false);
			        data.set("showAccount", true);
			        break;
			    default: //Deposit		    	
			        data.set("showInvoice", false);
			        data.set("showAccount", false);
			}			
		},		
		//Obj
		loadObj 			: function(id){
			var self = this, para = [];

			para.push({ field:"id", value: id });					

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.dataSource.view();				
				
				self.set("obj", view[0]);
				
				self.set("statusSrc", banhji.source.usedSrc);

				self.set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));				
		        self.set("discount", kendo.toString(view[0].discount, "c", view[0].locale));
		        self.set("tax", kendo.toString(view[0].tax, "c", view[0].locale));				
		        self.set("total", kendo.toString(view[0].amount, "c", view[0].locale));
		        self.set("remaining", kendo.toString(view[0].remaining, "c", view[0].locale));

		        self.set("original_total", view[0].amount);
				
				self.lineDS.filter({ field: "transaction_id", value: view[0].id });
				self.journalLineDS.filter({ field: "transaction_id", value: view[0].id });
				self.attachmentDS.filter({ field: "transaction_id", value: view[0].id });
				self.referenceDS.filter({ field: "id", value: view[0].reference_id });

				self.returnDS.query({
					filter:{ field: "return_id", value: view[0].id },
					page:1,
					pageSize:100
				}).then(function(){
					var reInvoice = self.returnDS.view();

					$.each(reInvoice, function(index, value){
						if(value.type=="Offset_Invoice"){
							value.set("showInvoice", true);
			        		value.set("showAccount", false);
						}else if(value.type=="Credit_Note"){
							value.set("showInvoice", false);
			        		value.set("showAccount", true);
						}else{
							value.set("showInvoice", false);
			        		value.set("showAccount", false);
						}
					});
				});
			});				
		},
		changes				: function(){
			var self = this, obj = this.get("obj"), 
			subTotal = 0, discount =0, tax = 0, returnAmount = 0, remaining = 0;
			
	        $.each(this.lineDS.data(), function(index, value) {				
				var amt = value.quantity * value.price;					

				//Discount by line
				if(value.discount>0){										
					var discount_amount = amt * value.discount;
					amt -= discount_amount;
					discount += discount_amount;																	
				}

				//Tax by line
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id);										
					tax += amt * taxItem.rate;																	
				}					

				value.set("amount", amt);
				subTotal += amt;									
	        });

	        total = subTotal + tax;

	        //Return
	        $.each(this.returnDS.data(), function(index, value) {								
				returnAmount += value.amount;					
	        });
	       
	        remaining = obj.amount_paid - returnAmount;

	        this.set("sub_total", kendo.toString(subTotal, "c", obj.locale));
	        this.set("discount", kendo.toString(discount, "c", obj.locale));
	        this.set("tax", kendo.toString(tax, "c", obj.locale));
	        this.set("total", kendo.toString(total, "c", obj.locale));
	        this.set("remaining", kendo.toString(remaining, "c", obj.locale));

	        obj.set("sub_total", subTotal);
	        obj.set("discount", discount);
	        obj.set("tax", tax);			
			obj.set("amount", total);
			obj.set("remaining", remaining);			    	
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);
			this.returnDS.data([]);
			this.referenceDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);
			this.set("discount", 0);
			this.set("tax", 0);						
			this.set("total", 0);	
			this.set("remaining", 0);				

			this.dataSource.insert(0, {				
				contact_id 			: "",								
				reference_id 		: "",
				recurring_id 		: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
			   	type				: "Sale_Return", //Require
			   	sub_total 			: 0,
			   	discount 			: 0,
			   	tax 				: 0,				   		   					   				   	
			   	amount				: 0,
			   	deposit 			: 0,			   	
			   	remaining 			: 0,
			   	amount_paid 		: 0,
			   	credit_allowed 		: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   			   	
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.addRow();
			this.addRowOption();
			this.setRate();			
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1,

				item_prices 		: []
			});																	
		},		
		removeRow 			: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");

	    	//Reference
	    	if(obj.reference_id>0){
	    		var ref = this.referenceDS.get(obj.reference_id);				
				ref.set("status", 1);
				this.referenceDS.sync();
			}else{
				obj.set("reference_id", 0);
			}

	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}

	    	//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Return
					$.each(self.returnDS.data(), function(index, value){										
						value.set("return_id", data[0].id);

						if(value.type=="Offset_Invoice" && value.reference_id>0){
							var inv = self.invoiceDS.get(value.reference_id),
							amountPaid = inv.amount_paid + value.amount;

							inv.set("amount_paid", amountPaid);

							if(amountPaid>=inv.amount){								
								inv.set("status", 1); //Paid							
							}else{
								inv.set("status", 2); //Partially Paid
							}
						}										
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
				self.returnDS.sync();
				self.uploadFile();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}

				//Refresh Customer
				self.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			this.contactDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });			

			banhji.userManagement.removeMultiTask("sale_return");
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	contact = this.contactDS.get(obj.contact_id),
	    	saleList = {},
	    	taxList = {},	    	
	    	inventoryList = {},
	    	cogsList = {},
	    	cashList = {},
	    	sumInvoice = 0,
	    	sumCredit = 0;			
			
			//Group Account from lineDS
			$.each(this.lineDS.data(), function(index, value){
				var item = self.itemDS.get(value.item_id),
				amount = value.quantity * value.price;

				//Income Account
				var incomeID = item.income_account_id;																				
				if(incomeID>0){
					if(saleList[incomeID]===undefined){
						saleList[incomeID]={"id": incomeID, "amount": amount};						
					}else{											
						if(saleList[incomeID].id===incomeID){
							saleList[incomeID].amount += amount;
						}else{
							saleList[incomeID]={"id": incomeID, "amount": amount};
						}
					}
				}

				//Discount by line
				if(value.discount>0){										
					var discount_amount = amount * value.discount;
					amount -= discount_amount;																						
				}

				//TAX Account																								
				if(value.tax_item_id>0){
					var taxItem = self.taxItemDS.get(value.tax_item_id),
					taxID = taxItem.account_id,
					taxAmt = amount * taxItem.rate;
					if(taxList[taxID]===undefined){
						taxList[taxID]={"id": taxID, "amount": taxAmt};						
					}else{											
						if(taxList[taxID].id===taxID){
							taxList[taxID].amount += taxAmt;
						}else{
							taxList[taxID]={"id": taxID, "amount": taxAmt};
						}
					}
				}				

				//Inventory
				if(item.item_type_id==1){
					var itemCost = value.quantity * item.cost,
					itemRate = banhji.source.getRate(item.locale, new Date(obj.issued_date));

					//Add inventory list
					var inventoryID = item.inventory_account_id;					
					if(inventoryList[inventoryID]===undefined){
						inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(inventoryList[inventoryID].id===inventoryID){
							inventoryList[inventoryID].amount += itemCost;
						}else{
							inventoryList[inventoryID]={"id": inventoryID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
						}
					}

					//Add cogs list
					var cogsID = item.cogs_account_id;				
					if(cogsList[cogsID]===undefined){
						cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
					}else{											
						if(cogsList[cogsID].id===cogsID){
							cogsList[cogsID].amount += itemCost;
						}else{
							cogsList[cogsID]={"id": cogsID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
						}
					}
				}					  	
			});

			//Group Account from returnDS
			$.each(this.returnDS.data(), function(index, value){
				//Offset Invoice
				if(value.type=="Offset_Invoice"){
					sumInvoice += value.amount;
				}

				//Deposit
				if(value.type=="Customer_Deposit"){ 
					sumCredit += value.amount;
				}

				//Refund
				if(value.type=="Credit_Note"){
					var cashID = value.account_id,
					cashAmt = value.amount;

					if(cashList[cashID]===undefined){
						cashList[cashID]={"id": cashID, "amount": cashAmt};						
					}else{											
						if(cashList[cashID].id===cashID){
							cashList[cashID].amount += cashAmt;
						}else{
							cashList[cashID]={"id": cashID, "amount": cashAmt};
						}
					}
				}
			});		

			//Start journal			
			//Sale on Dr
			if(!jQuery.isEmptyObject(saleList)){
				$.each(saleList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}

			//Tax on Dr
			if(!jQuery.isEmptyObject(taxList)){
				$.each(taxList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}			

			//Discount on Cr
			if(obj.discount>0){			
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.trade_discount_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: obj.discount,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//A/R on Cr
			var ar = obj.amount - (obj.amount_paid + obj.deposit);
			if(ar>0){						
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: ar,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}			

			//Deposit on Cr
			if(sumCredit>0){			
				this.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: contact.deposit_account_id,				
					contact_id 			: obj.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: sumCredit,				
					rate				: obj.rate,
					locale				: obj.locale
				});
			}

			//Cash on Cr
			if(!jQuery.isEmptyObject(cashList)){
				$.each(cashList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: obj.rate,
						locale				: obj.locale
					});						
				});
			}

			//INVENTORY
			//Inventory on Dr
			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.amount,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});						
				});
			}

			//Cogs on Cr
			if(!jQuery.isEmptyObject(cogsList)){
				$.each(cogsList, function(index, value){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						contact_id 			: obj.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: value.rate,
						locale				: value.locale
					});						
				});
			}

			this.journalLineDS.sync();
		},
		//Reference					
		loadReference 		: function(){			
			var obj = this.get("obj");

			if(obj.contact_id>0){
				this.set("enableRef", true);

				this.referenceDS.filter([
					{ field: "contact_id", value: obj.contact_id },					
					{ field: "type", operator:"where_in", value:["Invoice","Cash_Sale"] }
				]);				
			}else{
				this.set("enableRef", false);
				obj.set("reference_id", "");				
			}							
		},
		referenceChanges 	: function(e){
			var self = this, obj = this.get("obj");
			
			if(obj.reference_id>0){
				var ref = this.referenceDS.get(obj.reference_id);
				
				obj.set("amount", ref.amount);

				if(ref.type=="Cash_Sale"){					
					obj.set("amount_paid", ref.amount);
					this.set("showReturn", true);
				}else{
					obj.set("amount_paid", ref.amount_paid + ref.deposit);
					if(ref.status==0){
						this.set("showReturn", false);

						this.returnDS.data([]);
					}else{
						this.set("showReturn", true);

						this.returnDS.data([]);
						this.addRowOption();
					}
				}				
									
			 	this.referenceLineDS.query({
			 		filter: { field:"transaction_id", value: obj.reference_id },
			 		page: 1,
			 		pageSize: 100
			 	}).then(function(){
			 		var view = self.referenceLineDS.view();					

			 		self.lineDS.data([]);
			 		$.each(view, function(index, value){
			 			self.lineDS.add({					
							transaction_id 		: obj.id,
							item_id 			: value.item_id,
							tax_item_id 		: value.tax_item_id,
							measurement_id 		: value.measurement_id,							
							description 		: value.description,				
							quantity 	 		: value.quantity,
							price 				: value.price,												
							amount 				: value.amount,
							discount 			: value.discount,
							fine 				: value.fine,
							rate				: value.rate,
							locale				: value.locale,
							movement 			: value.movement,													

							item_prices			: value.item_prices
						});
			 		});

			 		self.changes();
			 	});			 				 				 				 				
			}else{
				this.returnDS.data([]);
				this.addRowOption();
			}							
		}
	});
	banhji.statement = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions/statement"),
		agingDS 			: dataStore(apiUrl + "transactions/statement_aging"),
		contactDS 			: banhji.source.customerDS,
		sortList 			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		company 			: banhji.institute,
		obj 				: null,
		displayDate 		: "",
		contact_id 			: "",
		pageLoad 			: function(){
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		search				: function(){
			var self = this, para = [], displayDate = "",
				contact_id = this.get("contact_id"),
				start = this.get("sdate"),
        		end = this.get("edate");

        	if(contact_id>0){
        		var contact = this.contactDS.get(contact_id);
        		this.set("obj", contact);

        		para.push({ field:"contact_id", value: contact_id });
        	
	        	//Dates
		    	if(start && end){
		        	para.push({ field:"issued_date >=", value: kendo.toString(new Date(start), "yyyy-MM-dd") });
		        	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

		        	displayDate = "From " + kendo.toString(new Date(start), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end), "dd-MM-yyyy");
		        }else if(start){
		        	para.push({ field:"issued_date", value: kendo.toString(new Date(start), "yyyy-MM-dd") });

		        	displayDate = "On " + kendo.toString(new Date(start), "dd-MM-yyyy");
		        }else if(end){
		        	para.push({ field:"issued_date <=", value: kendo.toString(new Date(end), "yyyy-MM-dd") });

		        	displayDate = "As Of " + kendo.toString(new Date(end), "dd-MM-yyyy");
		        }else{
		        	
		        }

	            this.set("displayDate", displayDate);

	            this.dataSource.filter(para);
	            this.agingDS.filter(para);
	            this.agingDS.bind("requestEnd", function(e){				
					if(e.type=="read"){
						var response = e.response.results[0];

						self.set("total", kendo.toString(response.amount, "c", response.locale));
					}
				}); 
	        }            
		}
	});	
	banhji.stamentSummary = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/statement"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.stamentSummary.dataSource.filter({
				logic: banhji.stamentSummary.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.stamentSummary.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.customerReportCenter = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/customer_dashboard_summary"),				
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/monthly_sale",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),						
		pageLoad 			: function(){
			var self = this,
			today = new Date(),			        	
			start = kendo.toString(banhji.source.getFiscalDate(), "yyyy-MM-dd"),
			end = kendo.toString(today, "yyyy-MM-dd");

			this.summaryDS.query({
				filter: [
					{ field:"issued_date >=", value: start },
					{ field:"issued_date <=", value: end }
				],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.summaryDS.view();
				
				self.set("sale", kendo.toString(view[0].sale, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("sale_customer", kendo.toString(view[0].sale_customer, "n0"));
				self.set("sale_product", kendo.toString(view[0].sale_product, "n0"));
				self.set("sale_order", kendo.toString(view[0].sale_order, "n0"));

				self.set("order", kendo.toString(view[0].order, "n0"));
				self.set("order_avg", kendo.toString(view[0].order_avg, banhji.locale=="km-KH"?"c0":"c", banhji.locale));				
				self.set("order_open", kendo.toString(view[0].order_open, "n0"));

				self.set("ar", kendo.toString(view[0].ar, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
				self.set("ar_open", kendo.toString(view[0].ar_open, "n0"));
				self.set("ar_customer", kendo.toString(view[0].ar_customer, "n0"));
				self.set("ar_overdue", kendo.toString(view[0].ar_overdue, "n0"));

				self.set("collection_day", kendo.toString(view[0].collection_day, "n0"));
			});
		}
	});
	banhji.customerList = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl+"contacts"),
		contactTypeDS			: banhji.source.customerTypeDS,
		statusList 				: banhji.source.statusList,
		contact_type_id 		: null,
		status 					: null,		
		pageLoad 				: function(){
		},
		search 					: function(){
			var para = [],
			status = this.get("status"),
			contact_type_id = this.get("contact_type_id");

			if(status!==null){
				para.push({ field:"status", value: status });
			}

			if(contact_type_id){
				para.push({ field:"contact_type_id", value: contact_type_id });
			}

			this.dataSource.filter(para);
			this.set("status", null);
			this.set("contact_type_id", null);
		}
	});
	banhji.customerBalance = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl+"contact_reports/balance"),
		totalDS 				: dataStore(apiUrl+"contact_reports/balance_total"),
		contactTypeDS			: banhji.source.customerTypeDS,
		statusList 				: banhji.source.statusList,
		contact_type_id 		: null,
		status 					: null,
		date 					: new Date(),
		total 					: 0,		
		pageLoad 				: function(){
		},
		search 					: function(){
			var self = this, para = [],
			status = this.get("status"),
			date = this.get("date"),
			contact_type_id = this.get("contact_type_id");

			if(status!==null){
				para.push({ field:"status", value: status });
			}

			if(date){
				para.push({ field:"issued_date", operator:"transaction_date", value: kendo.toString(date, "yyyy-MM-dd") });
			}

			if(contact_type_id){
				para.push({ field:"contact_type_id", value: contact_type_id });
			}

			this.dataSource.filter(para);
			this.totalDS.query({
				filter: para,
				page:1,
				pageSize:100
			}).then(function(){
				var view = self.totalDS.view();
				self.set("total", kendo.toString(view[0].total, "c0", banhji.locale));
			});
			this.set("status", null);
			this.set("contact_type_id", null);
		}
	});
	banhji.customerSetting =  kendo.observable({
		lang 				: langVM,
        contactTypeDS 		: banhji.source.customerTypeDS,
        paymentMethodDS		: banhji.source.paymentMethodDS,
        paymentTermDS		: dataStore(apiUrl+"payment_terms"),
        txnTemplateDS		: dataStore(apiUrl + "transaction_templates"),
        contactTypeName 	: "",
        contactTypeAbbr 	: "",
        contactTypeCompany 	: 0,
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTermNetDue	: "",
        paymentTermPeriod 	: "",
        paymentTermPercentage 	: "",
        pageLoad 			: function() {
        	this.txnTemplateDS.filter({ field: "moduls", value : "customer_mg" });
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 1,
	        		name 		: name,
	        		abbr 		: this.get("contactTypeAbbr"),
	        		description : "",
	        		is_company 	: this.get("contactTypeCompany"),
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();

	        	this.set("contactTypeName", "");
	        	this.set("contactTypeAbbr", "");
	        	this.set("contactTypeCompany", 0);
        	}
        },
        addPaymentMethod 		: function(){
        	var name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.paymentMethodDS.sync();

	        	this.set("paymentMethodName", "");
        	}
        },
        addPaymentTerm 		: function(){
        	var name = this.get("paymentTermName");

        	if(name!==""){
	        	this.paymentTermDS.add({	        		
	        		name 				: name,
	        		net_due 			: this.get("paymentTermNetDue"),
	        		discount_period 	: this.get("paymentTermPeriod"),
	        		discount_percentage : this.get("paymentTermPercentage"),
	        		is_system 			: 0
	        	});

	        	this.paymentTermDS.sync();

	        	this.set("paymentTermName", "");
	        	this.set("paymentTermNetDue", "");
	        	this.set("paymentTermPeriod", "");
	        	this.set("paymentTermPercentage", "");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;        	        	

        	if(kendo.parseInt(data.contact_id)>0){        		        	
	        	banhji.router.navigate('/customer/'+data.contact_id+'/1');   	
        	}else{
        		banhji.router.navigate('/customer');
        		banhji.customer.set("contact_type_id",data.id);
        	}
        },
        deleteForm 		: function(e){
        	var data = e.data;
        	if(confirm("Do you want to delete it?") == true) {
        		this.txnTemplateDS.remove(data);
        		this.txnTemplateDS.sync();
        	}
        },
        goInvoiceCustom : function(){

		    banhji.invoiceCustom.set("selectTypeList", banhji.source.customerFormList);
		    banhji.invoiceCustom.set("formShow", banhji.view.invoiceForm10);
		    banhji.router.navigate('/invoice_custom');
        }
    });
    banhji.job = kendo.observable({
		lang 				: langVM,		
        dataSource 			: dataStore(apiUrl + "jobs"),        
        contactDS 	 		: banhji.source.customerDS,        
		obj 				: null,
		isVisible 			: false,
		pageLoad 			: function() {
        },        
        addObj 			: function(){		    
        	this.dataSource.add({	        		
        		number 				: "",
        		name 				: "",
        		description 		: "",
        		contact_id 			: "",
        		contact 			: []        		
        	});
        	var data = this.dataSource.data();
			var obj = data[data.length-1];			
			this.set("obj", obj);	            	
        },        
        openWindow			: function(){
        	this.addObj();
      		this.set("isVisible", true);      		         	
      	},
      	closeWindow 		: function(){	      		
      		this.dataSource.cancelChanges();

      		this.set("isVisible", false);          	
      	},
        save 				: function(){
        	var self = this;
        	this.dataSource.sync();
        	this.dataSource.bind("requestEnd", function(e){
        		if( e.type == "create" || e.type == "update"){ 
        			self.set("isVisible", false); 
        		}
        	});
        },
        edit 				: function(e){
      		var data = e.data;      		
      		this.set("obj", data);

      		this.set("isVisible", true);       		
      	},      	
      	delete 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;
		        this.dataSource.remove(data);
		        this.dataSource.sync();		        
	    	}	    	
	    },
	    cancel 			: function(){	      		
      		this.dataSource.cancelChanges();

      		window.history.back();
      	}
    });
    banhji.invoiceCustom =  kendo.observable({
    	lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transaction_templates"),		
		txnFormDS			: dataStore(apiUrl + "transaction_forms"),
		obj 				: {type: "Quote", amount: "$500,000.00",title: "Quotation"},
		objForm	 			: null,
		formShow			: null,
		formTitle 			: "Quotation",
		formType			: "Quote",
		company 			: banhji.institute,
		saveClose 			: false,
		selectTypeList 		: banhji.source.customerFormList,
		selectCustom		: "customer_mg",
		isEdit 				: false,
		onChange			: function(e) {
			var obj = this.get("obj"), self = this;
			this.txnFormDS.query({    			
				filter: [{ field:"type", value: obj.type }, {field:"moduls", value: obj.moduls }],
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.txnFormDS.view();
				if(view.length > 0){
					banhji.invoiceForm.set("obj", view[0]);
					var obj = self.get("obj");
					obj.set("type", view[0].type);
					obj.set("title", view[0].title);
					obj.set("note", view[0].note);
				}
			});	
			setTimeout(function(e){ $('#formStyle a').eq(0).click(); },2000);
        },
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{	
				var obj = this.get("obj"), self = this;
				if(this.formShow === null){ this.formShow = banhji.view.invoiceForm10; }
				banhji.view.invoiceCustom.showIn('#invFormContent', this.formShow);		
				this.addRowLineDS();
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
					this.txnFormDS.query({    			
						filter: { field:"type", value: obj.type },
						page: 1,
						take: 100
					}).then(function(e){
						var view = self.txnFormDS.view();
						var obj = self.get("obj");
						obj.set("type", view[0].type);
						obj.set("title", view[0].title);
						obj.set("note", view[0].note);
						
					});	
				}	
				var name = banhji.invoiceForm.get("obj");
				name.set("title", this.formTitle);
			}
		},
		addRowLineDS			: function(e){
			banhji.invoiceForm.lineDS.data([]);
			for (var i = 0; i < 15; i++) { 
				banhji.invoiceForm.lineDS.add({				
					id			: i,
					description : '',
					quantity 	: '',
					price 		: '',
					amount 		: '',
					description : '',
					locale : '',
					item_prices : [],
					item_id 	: ''
		    	});	
		    }
		},
		activeInvoiceTmp		: function(e){
			var Active;
			switch(e) {
				case 1: Active = banhji.view.invoiceForm1; break;
				case 2: Active = banhji.view.invoiceForm2; break;
				//case 3: Active = banhji.view.invoiceForm3; break;
				//case 4: Active = banhji.view.invoiceForm4; break;
				//case 5: Active = banhji.view.invoiceForm5; break;
				case 6: Active = banhji.view.invoiceForm6; break;
				case 7: Active = banhji.view.invoiceForm7; break;
				case 8: Active = banhji.view.invoiceForm8; break;
				case 9: Active = banhji.view.invoiceForm9; break;
				case 10: Active = banhji.view.invoiceForm10; break;
				case 11: Active = banhji.view.invoiceForm11; break;
				case 12: Active = banhji.view.invoiceForm12; break;
				case 13: Active = banhji.view.invoiceForm13; break;
				case 14: Active = banhji.view.invoiceForm31; break;
				case 15: Active = banhji.view.invoiceForm15; break;
				case 16: Active = banhji.view.invoiceForm25; break;
				case 17: Active = banhji.view.invoiceForm17; break;
				case 18: Active = banhji.view.invoiceForm18; break;
				case 19: Active = banhji.view.invoiceForm19; break;
				case 20: Active = banhji.view.invoiceForm20; break;
				case 21: Active = banhji.view.invoiceForm21; break;
				case 22: Active = banhji.view.invoiceForm22; break;
				case 23: Active = banhji.view.invoiceForm28; break;
				case 24: Active = banhji.view.invoiceForm29; break;
				case 25: Active = banhji.view.invoiceForm35; break;
				case 26: Active = banhji.view.invoiceForm39; break;
				case 27: Active = banhji.view.invoiceForm19; break;
				case 28: Active = banhji.view.invoiceForm25; break;
				case 29: Active = banhji.view.invoiceForm26; break;
				case 30: Active = banhji.view.invoiceForm25; break;
				case 31: Active = banhji.view.invoiceForm25; break;
				case 32: Active = banhji.view.invoiceForm27; break;
				case 33: Active = banhji.view.invoiceForm30; break;
				case 34: Active = banhji.view.invoiceForm32; break;
				case 35: Active = banhji.view.invoiceForm33; break;
				case 36: Active = banhji.view.invoiceForm34; break;
				case 37: Active = banhji.view.invoiceForm36; break;
				case 38: Active = banhji.view.invoiceForm37; break;
				case 39: Active = banhji.view.invoiceForm38; break;
				case 40: Active = banhji.view.invoiceForm40; break;
				case 41: Active = banhji.view.invoiceForm41; break;
				case 42: Active = banhji.view.invoiceForm42; break;
			}
			banhji.view.invoiceCustom.showIn('#invFormContent', Active);
		},
		colorCC 			: function(e){
			var Color = e.value;
			var tS = '';
			if(Color == '#000000' || Color =='#1f497d') tS = '#fff'; 
			else tS = '#333';
			$('.main-color').css({'background-color': e.value, 'color': tS});
			$('.main-color div').css({'color': tS});
			$('.main-color p').css({'color': tS});
			$('.main-color span').css({'color': tS});
			$('.main-color th').css({'color': tS});
		},
		selectedForm 		: function(e){
			var Index = e.data.id;
			this.activeInvoiceTmp(Index);
			this.addRowLineDS();

			var data = e.data, obj = this.get("obj");
			obj.set("transaction_form_id", data.id);
		},	    			
		loadObj 			: function(id){
			var self = this;	
			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.dataSource.view();
				self.set("obj", view[0]);
				
				banhji.invoiceForm.set("obj", view[0]);	
				var Index = parseInt(view[0].transaction_form_id);
				self.activeInvoiceTmp(Index);
				self.addRowLineDS();

				self.txnFormDS.filter([{ field:"type", value: view[0].type }, { field:"moduls", value: view[0].moduls }]);	
				
				if(view[0].moduls == "customer_mg"){
					self.set("selectTypeList", banhji.source.customerFormList);
				}else if(view[0].moduls == "vendor_mg"){
					self.set("selectTypeList", banhji.source.vendorFormList);
				}
			});	
		},		
		addEmpty 		 	: function(){			
			this.dataSource.data([]);		
			this.set("obj", null);		
			this.set("isEdit", false);		
			this.dataSource.insert(0,{				
				user_id			: banhji.source.user_id,
				transaction_form_id : 0,
				type 			: this.formType,
				name 			: "",
				title 			: "Quotation",
				note 			: "",
				color  			: null,
				moduls 			: this.selectCustom,
				item_id 		: '',
				status 			: 0
	    	});		
			var obj = this.dataSource.at(0);			
			this.set("obj", obj);		
		},		
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });
		    return dfd;	    		    	
	    }, 	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");
			//Save Obj
			this.objSync()
			.then(function(data){ //Success	
				banhji.customerSetting.txnTemplateDS.fetch();	
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					//window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();		
			window.history.back();
		}
	});
	banhji.invoiceForm =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		txnTemplateDS		: dataStore(apiUrl + "transaction_templates"),		
		obj 				: {title: "Quotation", issued_date : "<?php echo date('d/M/Y'); ?>", number : "QO123456", type : "Quote", amount: "$500,000.00", contact: []},
		company 			: banhji.institute,		
		lineDS 				: dataStore(apiUrl + "transactions/line"),
		user_id				: banhji.source.user_id,
		selectForm 			: null,
		pageLoad 			: function(id, is_recurring){
			if(id){				
				this.loadObj(id);
			}
		},	 
		printGrid			: function() {
			var obj = this.get('obj'), colorM, ts;
			if(obj.color == null){
				colorM = "#10253f";
			}else{
				colorM = obj.color;
			}
			if(obj.color == '#000000' || obj.color =='#1f497d' || obj.color == null){ 
				ts = 'color: #fff!important;';
			} else { ts = 'color: #333;'; }
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=800, height=900'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link href="<?php echo base_url(); ?>assets/invoice/invoice.css" rel="stylesheet" />'+
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            'html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: portrait; margin:0mm;margin-top: 1mm; }'+
		            	'.inv1 .main-color {' +
		            		'background-color: '+colorM+'!important; ' + ts +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'} ' +
		            	'.inv1 .light-blue-td { ' +
		            		'background-color: #c6d9f1!important;' +
		            		'text-align: left;' +
		            		'padding-left: 5px;' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}' +
		            	'.inv1 thead tr {'+
		            		'background-color: rgb(242, 242, 242)!important;'+
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}'+
		            	'.pcg .mid-title div {' + ts + '}' +
		            	'.pcg .mid-header {' +
		            		'background-color: #dce6f2!important; ' +
		            		'-webkit-print-color-adjust:exact; ' +
		            	'}'+
		            	'.inv1 span.total-amount { ' +
		            		'color:#fff!important;' +
		            	'}</style>' +
		            '</head>' +
		            '<body>';
		    var htmlEnd =
		            '</body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	//win.close();
		    },2000);
		},
		activeInvoiceTmp		: function(e){
			var Active;
			switch(e) {
				case 1: Active = banhji.view.invoiceForm1; break;
				case 2: Active = banhji.view.invoiceForm2; break;
				//case 3: Active = banhji.view.invoiceForm3; break;
				//case 4: Active = banhji.view.invoiceForm4; break;
				//case 5: Active = banhji.view.invoiceForm5; break;
				case 6: Active = banhji.view.invoiceForm6; break;
				case 7: Active = banhji.view.invoiceForm7; break;
				case 8: Active = banhji.view.invoiceForm8; break;
				case 9: Active = banhji.view.invoiceForm9; break;
				case 10: Active = banhji.view.invoiceForm10; break;
				case 11: Active = banhji.view.invoiceForm11; break;
				case 12: Active = banhji.view.invoiceForm12; break;
				case 13: Active = banhji.view.invoiceForm13; break;
				case 14: Active = banhji.view.invoiceForm31; break;
				case 15: Active = banhji.view.invoiceForm15; break;
				case 16: Active = banhji.view.invoiceForm25; break;
				case 17: Active = banhji.view.invoiceForm17; break;
				case 18: Active = banhji.view.invoiceForm18; break;
				case 19: Active = banhji.view.invoiceForm19; break;
				case 20: Active = banhji.view.invoiceForm20; break;
				case 21: Active = banhji.view.invoiceForm21; break;
				case 22: Active = banhji.view.invoiceForm22; break;
				case 23: Active = banhji.view.invoiceForm28; break;
				case 24: Active = banhji.view.invoiceForm29; break;
				case 25: Active = banhji.view.invoiceForm35; break;
				case 26: Active = banhji.view.invoiceForm39; break;
				case 27: Active = banhji.view.invoiceForm19; break;
				case 28: Active = banhji.view.invoiceForm25; break;
				case 29: Active = banhji.view.invoiceForm26; break;
				case 30: Active = banhji.view.invoiceForm25; break;
				case 31: Active = banhji.view.invoiceForm25; break;
				case 32: Active = banhji.view.invoiceForm27; break;
				case 33: Active = banhji.view.invoiceForm30; break;
				case 34: Active = banhji.view.invoiceForm32; break;
				case 35: Active = banhji.view.invoiceForm33; break;
				case 36: Active = banhji.view.invoiceForm34; break;
				case 37: Active = banhji.view.invoiceForm36; break;
				case 38: Active = banhji.view.invoiceForm37; break;
				case 39: Active = banhji.view.invoiceForm38; break;
				case 40: Active = banhji.view.invoiceForm40; break;
				case 41: Active = banhji.view.invoiceForm41; break;
				case 42: Active = banhji.view.invoiceForm42; break;
			}
			banhji.view.invoiceForm.showIn('#invFormContent', Active);
		},
		loadObj 			: function(id){
			var self = this;				
			this.dataSource.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.dataSource.view();	
				view[0].set("sub_total", kendo.toString(view[0].sub_total, "c", view[0].locale));	
				view[0].set("tax", kendo.toString(view[0].tax, "c", view[0].locale));
				view[0].set("amount", kendo.toString(view[0].amount, "c", view[0].locale));
				view[0].set("discount", kendo.toString(view[0].discount, "c", view[0].locale));	
				view[0].set("deposit", kendo.toString(view[0].deposit, "c", view[0].locale));	
				view[0].set("amount_due", kendo.toString(view[0].amount_due, "c", view[0].locale));				
				self.set("obj", view[0]);
				self.loadObjTemplate(view[0].transaction_template_id, id);		
			});	
		},
		loadObjTemplate 		: function(id, transaction_id){
			var self = this, obj = this.get('obj');			
			this.txnTemplateDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				take: 100
			}).then(function(e){
				var view = self.txnTemplateDS.view(), Index = parseInt(view[0].transaction_form_id), Active;
				obj.set("color", view[0].color);
				obj.set("title", view[0].title);
				self.activeInvoiceTmp(Index);
				self.lineDS.filter({ field:"transaction_id", value: transaction_id });
				setTimeout(function(){ 	
					var CountItemsRow = parseInt(self.lineDS.data().length); 
					var TotalRow = 15 - CountItemsRow;
					if(TotalRow > 0){
						for (var i = 1; i < TotalRow; i++) { 
							self.lineDS.add({				
								id			: '',
								description : '',
								quantity 	: '',
								price 		: '',
								amount 		: '',
								description : '',
								locale 		: '',
								item_prices : [],
								item_id 	: ''
					    	});	
					    }
					    $("#loading-inv").remove();
					}
				},6000);
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();		
			window.history.back();
		}
	});

	//Report Customer
	banhji.saleSummaryCustomer = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/summary_customer"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleSummaryCustomer.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleSummaryCustomer.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleDetailCustomer = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/detail_customer"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleDetailCustomer.dataSource.filter({
				logic: banhji.saleDetailCustomer.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleDetailCustomer.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.customerTransactionList = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/transaction_customer"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.customerTransactionList.dataSource.filter({
				logic: banhji.customerTransactionList.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.customerTransactionList.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.depositDetailCustomer = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/deposit_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.depositDetailCustomer.dataSource.filter({
				logic: banhji.depositDetailCustomer.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.depositDetailCustomer.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleSummaryProduct = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/summary_list"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleSummaryProduct.dataSource.filter({
				logic: banhji.saleSummaryProduct.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleSummaryProduct.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleDetailProduct = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/detail_list"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleDetailProduct.dataSource.filter({
				logic: banhji.saleDetailProduct.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleDetailProduct.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleJob = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/sale_job"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleJob.dataSource.filter({
				logic: banhji.saleJob.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleJob.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleOrderReport = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/sale_order"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleOrder.dataSource.filter({
				logic: banhji.saleOrder.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleOrder.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.summaryBalance = kendo.observable({
		lang 					: langVM,
		dataSource 		: dataStore(apiUrl + "sales/summary_balance"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.summaryBalance.dataSource.filter({
				logic: banhji.summaryBalance.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.summaryBalance.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.saleDetail = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/detail_balance"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.saleDetail.dataSource.filter({
				logic: banhji.saleDetail.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.saleDetail.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.receivableAging = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/aging_summary"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.receivableAging.dataSource.filter({
				logic: banhji.receivableAging.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.receivableAging.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.receivableDetail = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/aging_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.receivableDetail.dataSource.filter({
				logic: banhji.receivableDetail.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.receivableDetail.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.listInvoicesCollect = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/invoice2collect"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.listInvoicesCollect.dataSource.filter({
				logic: banhji.listInvoicesCollect.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.listInvoicesCollect.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.collectReport = kendo.observable({
		lang 				: langVM,
		institute 		: banhji.institute,
		dataSource 		: dataStore(apiUrl + "sales/invoicecollected"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		startDate 		: kendo.toString(new Date(), 'yyyy-MM-dd'),
		endDate 		: kendo.toString(new Date(), 'yyyy-MM-dd'),
		search 	: function() {

			banhji.collectReport.dataSource.filter({
				logic: banhji.collectReport.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.collectReport.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.invoiceList = kendo.observable({
		lang 				: langVM,
		dataSource 		: dataStore(apiUrl + "sales/invoice_list"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.invoiceList.dataSource.filter({
				logic: banhji.invoiceList.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.invoiceList.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.customerSale = kendo.observable({
		institute 			: banhji.institute,
		lang 				: langVM,
		locale 				: banhji.locale,
		statementDB 		: dataStore(apiUrl + "sales/statement"),	
		count 				: 0,
		total_avg 			: 0,
		saleNumber 			: 0,
		gpm 				: 0,
		total_sale 			: 0,
		companyName 		: null,
		startDate 			: "<?php echo date("d-m-y"); ?>",
		endDate				: "<?php echo date("d-m-y"); ?>",
		sorter				: '',
		openInvoice 		: 0,
		company 			: banhji.institute,		
		sortList			: banhji.source.sortList, 
		//line to sale summary
		saleSummary         : banhji.saleSummaryCustomer,
		detailSummary       : banhji.saleDetailCustomer,
		customerTransaction : banhji.customerTransactionList,
		depositDetail 		: banhji.depositDetailCustomer,
		summaryProductSale 	: banhji.saleSummaryProduct,
		detailCustomerSale 	: banhji.saleDetailProduct,
		saleJob  			: banhji.saleJob,
		saleOrderDB 		: banhji.saleOrderReport,
		summaryBalance 		: banhji.summaryBalance,
		saleDetail 			: banhji.saleDetail,
		receivableAging 	: banhji.receivableAging,
		receivableDetail 	: banhji.receivableDetail,
		listInvoicesCollect : banhji.listInvoicesCollect,
		collectReportDB 	: banhji.collectReport,
		invoiceListDB 		: banhji.invoiceList,
		stamentSummary 		: banhji.stamentSummary,
		// search button
		saleDetailSearch 	: function() {
			this.detailSale.filter({
				logic: 'segment',
				filters: [
					{field: "id", "operator": "segment", value: 9},
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		},
		displayDateStart    : function() {
			return kendo.toString(new Date(this.get('startDate')), 'dd-MM-yyyy');
		},
		displayDateEnd    : function() {
			return kendo.toString(new Date(this.get('endDate')), 'dd-MM-yyyy');
		},
		trnxSearch 			: function() {},
		depositDetailSearch : function() {},
		summaryProductSearch: function() {},
		detailProductSearch : function() {},
		saleJobSearch 		: function() {},
		saleOrderSearch 	: function() {},
		balanaceSearch 		: function() {},
		balanceDetailSearch : function() {},
		agingSummarySearch  : function() {},
		agingDetailSearch   : function() {},
		collectingInvSearch : function() {},
		collectedInvSearch  : function() {},
		invoiceListSearch 	: function() {},
		customerListSearch 	: function() {},

		dateMax 			: function(e) {
			$('#edate').css('width', '160px');
			var edate = $('#edate').kendoDatePicker().data("kendoDatePicker");
			edate.min(e.sender.value());
		},
		dateMin 			: function(e) {
			$('#sdate').css('width', '160px');
			var sdate = $('#sdate').kendoDatePicker().data("kendoDatePicker");
			sdate.max(e.sender.value());
		},
		printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=900, height=700'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="<?php echo base_url(); ?>assets/responsive.css" rel="stylesheet" >' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            '*{  } html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> '+
		            '@page { size: landscape; margin:0mm; }'+
		            '.saleSummaryCustomer .total-customer, .saleSummaryCustomer .total-sale { '+
		            	'background-color: #DDEBF7!important; -webkit-print-color-adjust:exact; }'+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed  tr th { '+
		            	'background-color: #1E4E78!important;-webkit-print-color-adjust:exact;}'+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed  tr th span{ '+
		            	'color: #fff!important; }'+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td {'+
		              	'background-color: #fff!important; -webkit-print-color-adjust:exact;} '+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed tr td { '+
		            	'background-color: #F2F2F2!important;-webkit-print-color-adjust:exact; }'+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed  tr th span{ '+
		            	'color: #fff!important; }'+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td {'+
		              	'background-color: #fff!important; -webkit-print-color-adjust:exact;} '+
		            '.saleSummaryCustomer .table.table-borderless.table-condensed tr td { '+
		            	'background-color: #F2F2F2!important;-webkit-print-color-adjust:exact; }'+
		            	'.saleSummaryCustomer .table.table-borderless.table-condensed  tr th span{ '+
		            	'color: #fff!important; }'+		            
		            '</style>' +
		            '</head>' +
		            '<body><div id="example" class="k-content saleSummaryCustomer" style="padding: 30px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>'; 
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		},
		dateChange 			: function(){
			// var strDate = "";

			// 	if(this.startDate && this.endDate){
			// 		strDate = "From " + kendo.toString(this.startDate, "dd-MM-yyyy") + " To " + kendo.toString(this.endDate, "dd-MM-yyyy");
			// 	}else if(this.startDate){
			// 		strDate = "On " + kendo.toString(this.startDate,"dd-MM-yyyy");
			// 	}else if(this.endDate){
			// 		strDate = "As Of " + kendo.toString(this.endDate,"dd-MM-yyyy");
			// 	}else{
			// 		strDate = "";
			// 	}

			var today = new Date(),
			day = today.getDate();
        	sdate = "",
        	edate = "",
        	value = this.get('sorter');

			switch(value){
			case "today":
				sdate = today;

			  	break;
			case "week":
				var first = new Date(today.getTime() - 60*60*24* day*1000),
				last = new Date(today.getTime() + 60*60*24* day*1000);

				sdate = first;
				edate = last;

			  	break;
			case "month":
				var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
				edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

			  	break;
			case "year":
			  	var sdate = new Date(today.getFullYear(), 0, 1),
			  	edate = new Date(today.getFullYear(), 11, 31);

			  	break;
			default:

			}

			this.set("startDate", sdate);
			this.set("endDate", edate);
			// start.value(sdate);
			// end.value(edate);

			// start.max(end.value());
   //      	end.min(start.value());

   //      	dateChanges();
   //          });

   //          start.max(end.value());
   //          end.min(start.value());
		}

	});


	/*************************
	*	Cash Section   *
	**************************/
	banhji.cashier = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		paymentByCashierDS	: dataStore(apiUrl + "transactions"),		
		contactDS 			: dataStore(apiUrl + "contacts"),				
		invoiceDS 			: dataStore(apiUrl + "transactions"),
		updateInvoiceDS 	: dataStore(apiUrl + "transactions"),
		transactionDS 		: dataStore(apiUrl + "transactions"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),
		invoiceList 		: [],
		customer 			: null,		
		total_customer 		: 0,
		total_payment 		: kendo.toString(0,"c0", "km-KH"),
		//Payment		
		payment_date		: new Date(),
		payment_method_id	: 1,
		account_id 	 		: 2,
		check_no			: "",		
		cashier				: banhji.source.user_id,
		discount 			: 0,
		fine 				: 0,							
		pay_amount  		: kendo.toString(0,"c0", "km-KH"),
		receive_amount  	: kendo.toString(0,"c0", "km-KH"),
		remain				: kendo.toString(0,"c0", "km-KH"),
		pageLoad 			: function(id){
			var self = this;

			if(id){
				this.set("invoiceList", []);

				this.invoiceDS.query({
					filter: { field:"id", value: id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.invoiceDS.view(),
					fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].surname +" "+ view[0].contact[0].name;

					if(view[0].contact[0].contact_type_id==5 && view[0].contact[0].contact_type_id==6 && view[0].contact[0].contact_type_id==7){
						fullIdName = view[0].contact[0].number +" "+ view[0].contact[0].company;
					}

					self.loadInvoice(view[0].contact_id, fullIdName);
				});
			}else{
				this.loadPaymentByCashier();
			}			
		},
		total 				: function() {      		
	        var sum = 0;

	        $.each(this.invoiceList, function(index, value) {	        		            
	        	sum += kendo.parseInt(value.amount);		        	          
	        });

	        return kendo.toString(sum, "c0", "km-KH");
	    },
	    loadContact 		: function(id){
			var self = this;

			this.set("invoiceList", []);			

			this.contactDS.query({    			
				filter: { field:"id", value: id },
				page: 1,
				pageSize: 100
			}).then(function(e){
				var view = self.contactDS.view(),
				fullIdName = view[0].number +" "+ view[0].fullname;

				self.get("customer", view[0]);
				self.loadInvoice(id, fullIdName, view[0].account_id);		    										
			});
		},		
		loadPaymentByCashier: function(){
			var self = this;

			this.paymentByCashierDS.query({
				filter: [
					{ field:"user_id", value: this.get("cashier") },
					{ field:"issued_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				]
			}).then(function(e){
				var view = self.paymentByCashierDS.view(),
				contactIDList = {}, sum = 0, counter = 0;

				if(view.length>0){
					$.each(view, function(index, value){
						var contact_id = value.contact_id;

						if(contactIDList[contact_id]===undefined){
							contactIDList[contact_id]={"id": contact_id};
							counter++;
						}

						sum += value.amount / value.rate;
					});

					self.set("total_customer", counter);
			    	self.set("total_payment", kendo.toString(sum, "c0", banhji.institute.locale));
				}else{						    	
			    	self.set("total_customer", 0);
			    	self.set("total_payment", 0);
		    	}
			});
		},		
		loadInvoice 		: function(contact_id, fullIdName, ar_id){
			var self = this;

			this.invoiceDS.query({
				filter: [
					{ field:"contact_id", value: contact_id },
		    		{ field:"status", operator:"where_in", value: [0,2] },
		    		{ field:"type", operator:"where_in", value:["Invoice", "eInvoice", "wInvoice"] }
				],
				page: 1,
				pageSize: 50	  	
			}).then(function(e) {
			    var view = self.invoiceDS.view();
			    
			    $.each(view, function(index, value){
		    		var result = $.grep(self.get("invoiceList"), function(e){ return e.id == value.id; });

		    		if (result.length == 0) {
					  	// not found
					  	var remainAmount = kendo.parseFloat(value.amount) - kendo.parseFloat(value.amount_paid);
					  	
					  	self.get("invoiceList").push({				
							id 				: value.id,
							isPay 			: true,				
							issued_date 	: value.issued_date,
							fullname 		: fullIdName,							
							number			: value.number,										
							amount 			: remainAmount,
							pay_amount 		: remainAmount,
							rate 			: value.rate,
							locale 			: value.locale,
							contact_id 		: value.contact_id,
							ar_id 			: ar_id,							
							company_id 		: value.company_id
 						});
						self.change();
						self.autoIncreaseNo();
					} else if (result.length == 1) {
					  	// access the foo property using result[0].foo					  
					} else {
					  	// multiple items found					  
					}		    					    		
		    	});		    	
			});			
		},						
		autoIncreaseNo 		: function(){
			$(".sno").each(function(index,element){                 
			   $(element).text(index + 1); 
			});
		},
		change				: function(){		
			var total = 0;		
		    var tpay = 0;
		    $.each(this.get("invoiceList"), function(index, value){
		    	total += kendo.parseFloat(value.amount)/kendo.parseFloat(value.rate);
		    	tpay += kendo.parseFloat(value.pay_amount)/kendo.parseFloat(value.rate);
		    });

		    this.set("pay_amount", kendo.toString(tpay, "c0", banhji.institute.locale));		  	   	    	
	    	
	    	var receive_amount = tpay + kendo.parseFloat(this.get("fine"));
			this.set("receive_amount", kendo.toString(receive_amount, "c0", banhji.institute.locale));
	    	
	    	var remain = (total + kendo.parseFloat(this.get("fine"))) - (tpay + kendo.parseFloat(this.get("discount")));
	    	this.set("remain", kendo.toString(remain, "c0", banhji.institute.locale));	    	   	
		},	
		remove 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var item = e.data,
		        index = this.get("invoiceList").indexOf(item);
		        this.get("invoiceList").splice(index, 1);
		        this.change();
		        this.autoIncreaseNo();
	    	}	    	
	    },
	    checkPay 			: function(e){
	    	e.preventDefault();

	    	var d = e.data;
	    	var target = e.currentTarget;

	    	if(target.checked){
	    		d.set("pay_amount", d.amount);
	    	}else{
	    		d.set("pay_amount", 0);
	    	}
	    	this.change();
	    },
	    transactionSync 	: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;	    		    	
	    },
		save 		 		: function(){
			var self = this, data = this.get("invoiceList"), idList = {};
			
			if(data.length>0){
				$.each(data, function(index, value){
					if(kendo.parseFloat(value.pay_amount)>0 && value.isPay){
						// var contact_id = value.contact_id;						
						// if(idList[contact_id]===undefined){
						// 	idList[contact_id]={"id": contact_id, "amount": value.pay_amount};						
						// }else{											
						// 	if(idList[contact_id].id===contact_id){
						// 		idList[contact_id].amount += value.pay_amount;
						// 	}else{
						// 		idList[contact_id]={"id": contact_id, "amount": value.pay_amount};
						// 	}
						// }

						self.dataSource.add({							
							contact_id 			: value.contact_id,
							user_id 			: self.get("cashier"),													
							reference_id		: value.id,														
							payment_method_id	: self.get("payment_method_id"),
							account_id			: self.get("account_id"),
							check_no			: self.get("check_no"),							
							type 				: "Cash_Receipt",
							amount 				: value.pay_amount,
							fine 				: self.get("fine"),
							discount 			: self.get("discount"),
							rate 				: value.rate,
							locale 				: value.locale,
							issued_date			: kendo.toString(self.get("payment_date"), "yyyy-MM-dd"),
							payment_date		: kendo.toString(self.get("payment_date"), "yyyy-MM-dd"),
							is_journal 			: 1
						});																		
					}
				});							

				this.transactionSync()
				.then(function(data){
					//Start journal
					//Cash on Dr
					self.journalLineDS.add({					
						transaction_id 		: data[0].id,
						account_id 			: data[0].account_id,				
						contact_id 			: data[0].contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: obj.amount,
						cr 					: 0,				
						rate				: data[0].rate,
						locale				: data[0].locale
					});

					//A/R on Cr					
					self.journalLineDS.add({					
						transaction_id 		: data[0].id,
						account_id 			: value.id,				
						contact_id 			: data[0].contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: data[0].rate,
						locale				: data[0].locale
					});										
					
					self.journalLineDS.sync();																						
				}).then(function(){					
					self.clear();
					self.loadPaymentByCashier();
				});				
			}
		},					
		clear 				: function() {
			this.set("check_no", "");			
			this.set("discount", 0);
			this.set("fine", 0);		
			this.set("pay_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("receive_amount", kendo.toString(0,"c0", "km-KH"));
			this.set("remain", kendo.toString(0,"c0", "km-KH"));

			this.set("invoiceList", []);

			this.updateInvoiceDS.data([]);
			this.dataSource.data([]);							
		}
	});
	banhji.reconcile = kendo.observable({
		lang 					: langVM,
		dataSource 				: dataStore(apiUrl + "reconciles"),
		existingDS 				: dataStore(apiUrl + "reconciles"),
		prevAmountDS			: dataStore(apiUrl + "reconciles"),
		reconcileItemDS			: dataStore(apiUrl + "reconciles/item"),
		paymentDS 				: dataStore(apiUrl + "payments"),
		denominationList 		: [
			{ 'denomination':1, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':2, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':5, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':10, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':20, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':50, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':100, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':200, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':500, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':1000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':2000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':5000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':10000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':20000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':50000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' },
			{ 'denomination':100000, 'khr_qty':'', 'usd_qty':'', 'khr_transfer':'', 'usd_transfer': '' }
		],		
		reconcileItemList 		: [],
		obj 					: null,		
		searchDate 				: new Date(),			
		isEdit 					: false,
		isExisting 				: false,
		cashier 				: banhji.source.user_id,
		cashier_name 			: banhji.userManagement.getLogin() === null ? "" : banhji.userManagement.getLogin().username,
		pageLoad 				: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadReconcile(id);
			}else{				
				this.set("isEdit", false);				
				this.addEmpty();
				this.loadPayment();
				this.loadPreviousAmount();

				this.checkExisting();
			}
		},
		str_date 				: function(){
			var strDate = "", obj = this.get("obj");

			if(obj){
				strDate = kendo.toString(new Date(obj.reconciled_date), "dd-MM-yyyy");
			}

			return strDate;
		},		
		loadReconcile 			: function(id){				
			var self = this, obj = this.get("obj");			
						
			this.dataSource.query({
				filter: { field: "id" , value: id },
				page: 1,
				pageSize: 50
			}).then(function(){
				var view = self.dataSource.view();

				self.set("obj", view[0]);
				self.reconcileItemDS.filter({ field:"reconcile_id", value: id });				
			});								
		},
		loadPreviousAmount 			: function(){
			var self = this, obj = this.get("obj");

			this.prevAmountDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },										
					{ field: "reconciled_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],				
				page: 1,
				pageSize: 1
			}).then(function(){
				var view = self.prevAmountDS.view();

				obj.set("previous_amount", view[0].balance);
			});			
		},
		loadPayment 			: function(){
			var self = this, obj = this.get("obj");

			this.paymentDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },
					{ field: "type" , value: "invoice" },						
					{ field: "payment_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],
				aggregate: [
					{ field: "amount", aggregate: "sum" }
				],
				page: 1,
				pageSize: 50
			}).then(function(){
				var results = self.paymentDS.aggregates().amount;

				obj.set("received_amount", results.sum);
			});			
		},
		checkExisting 			: function(){				
			var self = this;			
						
			this.existingDS.query({
				filter: [
					{ field: "cashier", value: this.get("cashier") },										
					{ field: "reconciled_date", value: kendo.toString(new Date(), "yyyy-MM-dd") }
				],
				page: 1,
				pageSize: 50
			}).then(function(){
				var view = self.existingDS.view();

				if(view.length>0){
					self.set("isExisting", true);
				}else{
					self.set("isExisting", false);
				}					
			});								
		},		
		change					: function(){
			var totalD = 0;
			var totalR = 0;
			var totalDT = 0;
			var totalRT = 0;

			for(var i=0; i < this.denominationList.length; i++){
				var data = this.denominationList[i];
				var dem = kendo.parseFloat(data.denomination);

		    	totalD += kendo.parseFloat(data.qty_usd) * dem;
		    	totalR += kendo.parseFloat(data.qty_khr) * dem;

		    	totalDT += kendo.parseFloat(data.qty_usd_transfer) * dem;
		    	totalRT += kendo.parseFloat(data.qty_khr_transfer) * dem;	    	
			}

			this.set('totalD', kendo.toString(totalD, 'n0'));
			this.set('totalR', kendo.toString(totalR, 'c0'));

			this.set('totalDT', kendo.toString(totalDT, 'n0'));
			this.set('totalRT', kendo.toString(totalRT, 'c0'));		  	 	
		},	
		transferAll 			: function(){
			$.each(this.reconcileItemDS.data(), function(index, value){
				if(value.khr_qty>0){									
					value.set("khr_transfer", value.khr_qty);
				}

				if(value.usd_qty>0){									
					value.set("usd_transfer", value.usd_qty);
				}
			});
			
			this.change();
		},
		change 					: function(){
			var obj = this.get("obj"),
			khr_sum = 0, usd_sum = 0, khr_transfer_sum = 0, usd_transfer_sum = 0,
			usd2khr_amount = 0, usd2khr_transfer_amount = 0;

			$.each(this.reconcileItemDS.data(), function(index, value){
				if(value.khr_qty>0){
					var khrAmt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.khr_qty);
					khr_sum += khrAmt;					
					value.set("khr_amount", khrAmt);
				}

				if(value.usd_qty>0){
					var usdAmt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.usd_qty);
					usd_sum += usdAmt;
					value.set("usd_amount", usdAmt);
				}

				if(value.khr_transfer>0){
					var khr_transfer_amt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.khr_transfer);
					khr_transfer_sum += khr_transfer_amt;
					value.set("khr_transfer_amount", khr_transfer_amt);
				}

				if(value.usd_transfer>0){
					var usd_transfer_amt = kendo.parseFloat(value.denomination) * kendo.parseFloat(value.usd_transfer);
					usd_transfer_sum += usd_transfer_amt;
					value.set("usd_transfer_amount", usd_transfer_amt);
				}
			});

			//Refresh lisview
			var listView = $("#lvReconcileItem").data("kendoListView");			
			listView.refresh();

			//Total Cash1
			obj.set("total_cash1", kendo.parseFloat(obj.received_amount) + kendo.parseFloat(obj.previous_amount));

			//Actual cash
			obj.set("usd_amount", usd_sum);
			usd2khr_amount = obj.rate * usd_sum;
			obj.set("usd2khr_amount", usd2khr_amount);

			obj.set("khr_amount", khr_sum);

			//Total Cash2
			obj.set("total_cash2", kendo.parseFloat(obj.khr_amount) + kendo.parseFloat(obj.usd2khr_amount));

			//Reconcile
			obj.set("reconciled_amount", kendo.parseFloat(obj.total_cash1) - kendo.parseFloat(obj.total_cash2));

			//Transer
			obj.set("transfer_usd", usd_transfer_sum);
			usd2khr_transfer_amount = kendo.parseFloat(obj.rate) * kendo.parseFloat(usd_transfer_sum);
			obj.set("usd2khr_transfer_amount", usd2khr_transfer_amount);

			obj.set("transfer_khr", khr_transfer_sum);

			//Transfered amount
			obj.set("transfered_amount", kendo.parseFloat(obj.usd2khr_transfer_amount) + kendo.parseFloat(obj.transfer_khr));

			//Balance
			obj.set("balance", kendo.parseFloat(obj.total_cash1) - kendo.parseFloat(obj.transfered_amount));
		},
		addEmpty 				: function(){
			var self = this;
			this.set("isEdit", false);
			this.dataSource.data([]);
			this.reconcileItemDS.data([]);        	
      		
			this.dataSource.add({
				company_id 				: 0,
				transfer_account_id 	: 2,
				cashier 				: this.get('cashier'),															
				rate					: 4000,
				received_amount 		: 0,
				previous_amount 		: 0,
				total_cash1 			: 0,
				usd_amount 				: 0,
				usd2khr_amount			: 0,
				khr_amount 				: 0,
				total_cash2 			: 0,
				reconciled_amount 		: 0,
				transfer_usd			: 0,
				usd2khr_transfer_amount	: 0,
				transfer_khr 			: 0,					
				transfered_amount		: 0,
				balance 				: 0,										
				memo 					: "",
				reconciled_date 		: new Date(),
				status 					: 1		
			});			

			//Reconcile Item							
			$.each(this.get("denominationList"), function(index, value){
				self.reconcileItemDS.add({
					"reconcile_id" 			: 0,
					"denomination" 			: value.denomination,			   			   						   
				   	"khr_qty" 				: value.khr_qty,
				   	"khr_amount"			: 0,		   	
				   	"usd_qty" 				: value.usd_qty,
				   	"usd_amount"			: 0,
				   	"khr_transfer" 			: value.khr_transfer,
				   	"khr_transfer_amount" 	: 0,
				   	"usd_transfer" 			: value.usd_transfer,
				   	"usd_transfer_amount" 	: 0
				});
			});			

			var data = this.dataSource.data();			
			var obj = data[data.length - 1];			
			this.set("obj", obj);	
		},
		save 					: function(){
			var self = this;

			this.dataSource.sync();
			this.reconcileItemDS.sync();
		},			
		addReconcile 			: function(){
			var dfd = $.Deferred();

			var tr = this.get("totalReceive");
			var pr = this.get("prevRemain");				
			var receiveAmount = Number(tr.replace(/[^0-9\.]+/g,""));
			var prevRemain = Number(pr.replace(/[^0-9\.]+/g,""));		

			banhji.ds.reconcileDS.add({
				cashier 			: this.get('cashier'),					 
				reconciled_date 	: kendo.toString(new Date(), 'yyyy-MM-dd'),					
				rate				: this.get('rate'),
				received_amount 	: receiveAmount,
				prev_remain 		: prevRemain,
				reconciled_amount	: kendo.parseFloat(this.totalDR()),
				transfered_amount	: kendo.parseFloat(this.totalTransferCash()),
				transfer_account_id : this.get('transfer_account_id'),
				class_id 			: this.get('class_id'),
				memo 				: this.get('memo')
			});				        

	    	banhji.ds.reconcileDS.sync();
		    banhji.ds.reconcileDS.bind("requestEnd", function(e){			    	
				dfd.resolve(e.response.results);    				
		    });

		    return dfd;		
		},
		addJournal 				: function(){
			var self = this;				
			var totalTransferCash = kendo.parseFloat(this.totalTransferCash());

			//Transfer account on Dr
			banhji.journalEntry.add({
				journal_id 	: 0,
		 		account 	: this.get("transfer_account_id"), 		
		 		dr 			: totalTransferCash, 
		 		cr 			: 0,
		 		class_id  	: self.get("class_id"),
		 		memo 		: self.get("memo"),
		 		exchange_rate: 1,
			 	main 		: 0	 		
			});				
			
			var cashInTillList = {};
			$.each(banhji.ds.invoiceDS.data(), function(index, value){
				var cash_in_till_id = value.account_id;
				var amt = kendo.parseFloat(value.paid)															
				if(cash_in_till_id>0){
					if(cashInTillList[cash_in_till_id]===undefined){
						cashInTillList[cash_in_till_id]={"id": cash_in_till_id, "amt": amt};						
					}else{											
						if(cashInTillList[cash_in_till_id].id===cash_in_till_id){
							cashInTillList[cash_in_till_id].amt += amt;
						}else{
							cashInTillList[cash_in_till_id]={"id": cash_in_till_id, "amt": amt};
						}
					}
				}
			});

			//Cash in till on Cr
			$.each(cashInTillList, function(index, value){					
				banhji.journalEntry.add({
					journal_id 	: 0,
			 		account 	: value.id,	 		
			 		dr 			: 0, 
			 		cr 			: value.amt,
			 		class_id  	: self.get("class_id"),
			 		memo 		: self.get("memo"),
			 		exchange_rate: 1,
				 	main 		: 0	 		
				});
			});

		 	//Add journal to datasource
			banhji.transaction.addNew();
			var journal = banhji.transaction.get("current");
			
			journal.set("company_id", banhji.config.userData.company);
			journal.set("people_id", 0);
			journal.set("employee_id", banhji.config.userData.userId);
			journal.set("payment_id", 0);
			journal.set("payment_term_id", 0);
			journal.set("transaction_type", "Reconcile");
			journal.set("payment_method", "");
			journal.set("check_no", null);
			journal.set("memo", "ផ្ទៀងផ្ទាត់ និង ផ្ទេរសាច់ប្រាក់");
			journal.set("date", kendo.toString(new Date(this.get("searchDate")), "yyyy-MM-dd"));				
			journal.set("amount_billed", totalTransferCash);
			journal.set("amount_due", 0);
			journal.set("amount_paid", 0);
			journal.set("voucher", null);
			journal.set("class_id", this.get("class_id"));
			journal.set("status", 0);
			journal.set("reference", null);
			journal.set("vat_id", {id: null});
			journal.set("inJournal", 1);			 	
		 			 	
		 	banhji.transaction.save()
		 	.then(function(journal){			 		
	 			$.each(banhji.journalEntry.dataSource.data(), function(index, value){
	 				value.set("journal_id", journal.data.id);
	 			});
	 					 			
	 			banhji.journalEntry.save();
		 	});			  
		}
	});
	banhji.cashTransaction =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),						
		lineDS  			: dataStore(apiUrl + "account_lines"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		recurringDS 		: dataStore(apiUrl + "transactions"),
		recurringLineDS 	: dataStore(apiUrl + "account_lines"),		
		contactDS 			: banhji.source.contactDS,				
		currencyDS 			: banhji.source.currencyDS,
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		paymentMethodDS		: banhji.source.paymentMethodDS,
		accountDS  			: banhji.source.cashAccountDS,
		segmentItemDS 		: banhji.source.segmentItemDS,
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Deposit" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),					
		types 				: [
			{id: 'Deposit', name: 'Deposit'},
			{id: 'Witdraw', name: 'Witdraw'},
			{id: 'Transfer', name: 'Transfer'}
		],
		confirmMessage 		: banhji.source.confirmMessage,
		frequencyList 		: banhji.source.frequencyList,
		monthOptionList 	: banhji.source.monthOptionList,
		monthList 			: banhji.source.monthList,
		weekDayList 		: banhji.source.weekDayList,
		dayList 			: banhji.source.dayList,
		fileMan 			: banhji.fileManagement,
		showMonthOption 	: false,
		showMonth 			: false,
		showWeek 			: false,
		showDay 			: false,
		obj 				: null,
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		saveRecurring 		: false,
		showConfirm 		: false,
		showRef 			: true,
		showName 			: false,
		showSegment 		: false,
		total				: 0,
		original_total 		: 0,
		fromToTop 			: "TO",
		fromToBottom 		: "FROM",
		uer_id				: banhji.source.user_id,											
		pageLoad 			: function(id, is_recurring){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id, is_recurring);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}

			this.loadRecurring();
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
		//Currency Rate
		setRate 			: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);
			this.changes();						
		},
		//Segment
		transactionSegmentChanges  	: function() {									
			dataArr = this.get("obj").segments,			
			lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment.id === last.segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		segmentChanges  	: function(e) {					
			var dataArr = e.data.segments;			
			var lastIndex = dataArr.length - 1;
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current = this.segmentItemDS.get(dataArr[i]);
					var last = this.segmentItemDS.get(dataArr[lastIndex]);
					if(current.segment.id === last.segment.id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Obj
		loadObj 			: function(id,is_recurring){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_recurring){
				para.push({ field:"is_recurring", value: 1 });
			}

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 1
			}).then(function(e){
				var view = self.dataSource.view();

				if(view.length>0){	       
					self.set("obj", view[0]);					
		        }				

				self.lineDS.filter({ field: "transaction_id", value: id });
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.attachmentDS.filter({ field: "transaction_id", value: id });								
			});				
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);								

			this.dataSource.insert(0, {
				transaction_template_id : 0,
				recurring_id 		: "",
				account_id 			: "",				
				user_id 			: this.get("user_id"), 	    			    		
			   	type				: "Deposit", //required			   		   				   		   					   				   	
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   	   	
			   	memo 				: "",
			   	memo2 				: "",
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0			
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.typeChanges();
			this.addRow();
			this.setRate();				
		},
		addRow 				: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				payment_method_id 	: 0,
				account_id 			: "",				
				contact_id 			: "",				
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				amount 	 			: 0,							
				rate				: obj.rate,
				locale				: obj.locale
			});																	
		},		
		remove 				: function(e){						
			var data = e.data;
			
			if(this.lineDS.total()>1){			
				this.lineDS.remove(data);
        		this.changes();
        	}	        	        
		},
		changes				: function(){
			var obj = this.get("obj"),
			sum = 0;								
			
			$.each(this.lineDS.data(), function(index, value) {
				value.set("rate", obj.rate);

				sum += value.amount;
	        });		       	

	        this.set("total", kendo.toString(sum, "c0", obj.locale));		        
	        obj.set("amount", sum);
		},
		typeChanges 		: function(){
			var obj = this.get("obj");

			this.txnTemplateDS.filter({ field:"type", value:obj.type });

			switch(obj.type) {
			    case "Deposit":
			        this.set("fromToTop", "TO");
			        this.set("fromToBottom", "FROM");
			        break;
			    default:
			        this.set("fromToTop", "FROM");
			        this.set("fromToBottom", "TO");
			}
		},
		objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");	    	
	    	
	    	//Recurring
	    	if(this.get("saveRecurring")){
	    		this.set("saveRecurring", false);
	    		
	    		if(this.get("isEdit")){
		    		if(obj.is_recurring=="0"){ //Add brand new recurring from existing transaction	    			
		    			this.addNewRecurring();

		    			this.recurringSync()
						.then(function(data){ //Success
							$.each(self.recurringLineDS.data(), function(index, value){										
								value.set("transaction_id", data[0].id);						
							});
							self.recurringLineDS.sync();

							return data;			
						}, function(reason) { //Error
							$("#ntf1").data("kendoNotification").error(reason);
						}).then(function(result){
							$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

							self.addEmpty();
						});
		    		}
		    	}else{
	    			obj.set("is_recurring", 1);
		    	}
	    	}

	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		//Upload has changed
		    	if(this.lineDS.hasChanges() || this.attachmentDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}

		    	//Line has changed
		    	if(obj.amount!==this.get("original_total")){
		    		this.set("original_total",0);

			    	$.each(this.journalLineDS.data(), function(index, value){
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}	    	
	    	
			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item line
					$.each(self.lineDS.data(), function(index, value){
						value.set("transaction_id", data[0].id);
					});

					//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);
				}

				self.lineDS.sync();
							
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.attachmentDS.cancelChanges();
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.attachmentDS.data([]);

			banhji.userManagement.removeMultiTask("cash_transaction");
		},
		delete 				: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);			
			
	        this.deleteDS.query({
	        	filter:[
	        		{ field:"reference_id", value:obj.id }
	        	],
	        	page:1,
	        	pageSize:1
	        }).then(function(){
	        	var view = self.deleteDS.view();

	        	if(view.length>0){
	        		alert("Sorry, you can not delete it.");
	        	}else{
	        		obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();
	        	}
	        });		    	    	
		},
		openConfirm 		: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 		: function(){
			this.set("showConfirm", false);
		},
	    //Journal	        
	    addJournal 			: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj");
			
			var debit = 0, credit = 0;
			if(obj.type=="Deposit"){
				debit = obj.amount;
			}else{
				credit = obj.amount;
			}

			//Add Journal
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: obj.account_id,				
				contact_id 			: obj.contact_id,				
				description 		: "",
				reference_no 		: "",
				segments 	 		: obj.segments,								
				dr 	 				: debit,
				cr 					: credit,				
				rate				: obj.rate,
				locale				: obj.locale
			});

			$.each(this.lineDS.data(), function(index, value){				
				var dr = 0, cr = 0;
				if(obj.type=="Deposit"){
					cr = value.amount;
				}else{
					dr = value.amount;
				}

				//Add Journal
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.account_id,				
					contact_id 			: value.contact_id,				
					description 		: value.description,
					reference_no 		: value.reference_no,
					segments 	 		: value.segments,								
					dr 	 				: dr,
					cr 					: cr,				
					rate				: value.rate,
					locale				: value.locale
				});						
			});			

			this.journalLineDS.sync();
		},
		//Recurring
		loadRecurring 		: function(){
			var obj = this.get("obj");

			this.recurringDS.filter([
				{ field:"type", operator:"where_in", value:["Deposit","Witdraw","Transfer"] },
				{ field:"is_recurring", value:1 }
			]);
		},		
		applyRecurring 		: function(){
			var self = this, obj = this.get("obj");
			
			if(obj.recurring_id){
				var data = this.recurringDS.get(obj.recurring_id);

				obj.set("account_id", data.account_id);
				obj.set("segments", data.segments);
				obj.set("rate", data.rate);
				obj.set("locale", data.locale);
				obj.set("memo", data.memo);
				obj.set("memo2", data.memo2);
				obj.set("bill_to", data.bill_to);
				obj.set("ship_to", data.ship_to);

				this.recurringLineDS.query({
					filter: { field:"transaction_id", value:data.id },
					page: 1,
					pageSize: 100
				}).then(function(){
					var view = self.recurringLineDS.view();
					self.lineDS.data([]);

					$.each(view, function(index, value){
						self.lineDS.add({
							transaction_id 		: obj.id,
							account_id 			: value.account_id,
							payment_method_id 	: value.payment_method_id,
							description 		: value.description,
							reference_no 		: value.reference_no,
							contact_id 			: value.contact_id,
							segments 			: value.segments,
							amount 	 			: value.amount,
							rate				: value.rate,
							locale				: value.locale
						});
					});

					self.changes();
				});
			}else{
				this.addEmpty();
			}
		},
		frequencyChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.frequency) {
			    case "Daily":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", false);
			       
			        break;
			    case "Weekly":
			        this.set("showMonthOption", false);
			        this.set("showMonth", false);
			        this.set("showWeek", true);
			        this.set("showDay", false);

			        break;
			    case "Monthly":
			        this.set("showMonthOption", true);
			        this.set("showMonth", false);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    case "Annually":
			        this.set("showMonthOption", false);
			        this.set("showMonth", true);
			        this.set("showWeek", false);
			        this.set("showDay", true);

			        break;
			    default:
			        //Default here..
			}
		},
		monthOptionChanges 	: function(){
			var obj = this.get("obj");

			switch(obj.month_option) {
			    case "Day":
			        this.set("showWeek", false);
			        this.set("showDay", true);
			       
			        break;
			    default:
			        this.set("showWeek", true);
			        this.set("showDay", false);
			}
		},
		validateRecurring  	: function(){
			var result = true, obj = this.get("obj");
			
			if(obj.recurring_name!==""){
				//Check existing name
				$.each(this.recurringDS.data(), function(index, value){
					if(value.recurring_name==obj.recurring_name){
						result = false;
						alert("This is name is taken.");

						return false;
					}
				});
			}
			else{
				result = false;
				alert("Recurring name is required.");
			}

			return result;
		},
		addNewRecurring 	: function(){
			var self = this, obj = this.get("obj");

			this.recurringDS.add({
				contact_id 				: obj.contact_id,
				transaction_template_id : obj.transaction_template_id,
				user_id 				: this.get("user_id"),
				account_id 				: obj.account_id,
			   	type					: obj.type,
			   	amount					: obj.amount,
			   	rate					: obj.rate,
			   	locale 					: obj.locale,
			   	bill_to 				: obj.bill_to,
			   	ship_to 				: obj.ship_to,
			   	memo 					: obj.memo,
			   	memo2 					: obj.memo2,
			   	segments 				: obj.segments,
			   	recurring_name 			: obj.recurring_name,
			   	start_date 				: obj.start_date,
			   	frequency 				: obj.frequency,
			   	month_option 			: obj.month_option,
			   	interval 				: obj.interval,
			   	day 					: obj.day,
			   	week 					: obj.week,
			   	month 					: obj.month,
			   	is_recurring 			: 1
	    	});

	    	$.each(this.lineDS.data(), function(index, value){
	    		self.recurringLineDS.add({
					transaction_id 		: 0,
					account_id 			: value.account_id,
					payment_method_id 	: value.payment_method_id,
					description 		: value.description,
					reference_no 		: value.reference_no,
					contact_id 			: value.contact_id,
					segments 			: value.segments,
					amount 	 			: value.amount,
					rate				: value.rate,
					locale				: value.locale
				});
	    	});
		},
		recurringSync 		: function(){
	    	var dfd = $.Deferred();	        

	    	this.recurringDS.sync();
		    this.recurringDS.bind("requestEnd", function(e){
		    	if(e.response){
					dfd.resolve(e.response.results);
				}
		    });
		    this.recurringDS.bind("error", function(e){
				dfd.reject(e.errorThrown);
		    });

		    return dfd;
	    }
	});
	banhji.cashReceipt =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		invoiceDS 			: dataStore(apiUrl + "transactions"),
		creditDS 			: dataStore(apiUrl + "transactions"),		
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		jobDS				: dataStore(apiUrl + "jobs"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.customerDS,
		employeeDS  		: banhji.source.saleRepDS,
		accountDS  			: banhji.source.cashAccountDS,		
		paymentTermDS 		: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),	
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Cash_Receipt" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
		showCheckNo 		: false,
		obj 				: null,		
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		searchText 			: "",
		contact_id 			: "",
		invoice_id 			: 0,		
		sub_total 			: 0,		
		discount 			: 0,		
		total 				: 0,
		pay 		 		: 0,
		remain 				: 0,
		original_total 		: 0,				
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		loadInvoice 		: function(id){
			this.set("invoice_id", id);
			this.search();
		},	
		//Contact
		loadContact 		: function(id){
			this.set("contact_id", id);
			this.search();
		},		
		contactChanges 		: function(){
			this.search();
	    },
	    //Payment Method
	    issuedDateChanges 	: function(){
	    	this.applyTerm();
	    	this.setRate();	
	    },
	    applyTerm 			: function(){
	    	var self = this, obj = this.get("obj"), 
	    	today = new Date();

	    	$.each(this.dataSource.data(), function(index, value){	    		   		
	    		var term = self.paymentTermDS.get(value.payment_term_id),
	    		termDate = new Date(value.reference[0].issued_date);

    			termDate.setDate(termDate.getDate() + term.discount_period);
    			
    			if(today<=termDate){
    				if(value.amount_paid==0){
	    				var amount = value.reference[0].amount * term.discount_percentage;
	    				value.set("discount", amount);
	    				value.set("amount", value.reference[0].amount - amount);
    				}
    			}		    	
	    	});	    	
	    },
	    //Currency Rate		
		setRate 			: function(){
			var obj = this.get("obj");

			$.each(this.dataSource.data(), function(index, value){
				var rate = banhji.source.getRate(value.locale, new Date(obj.issued_date));				
				
				value.set("rate", rate);				
			});

			this.changes();			
		},
		//Search		
		search 				: function(){
			var self = this, 
			para = [],
			obj = this.get("obj"),			
			date = kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd"), 
			searchText = this.get("searchText"), 
			invoice_id = this.get("invoice_id"),
			contact_id = this.get("contact_id");

	    	if(contact_id>0){		    			    	
		    	para.push({ field:"contact_id", value: contact_id });				    			    	
	    	}

	    	if(invoice_id>0){		    			    	
		    	para.push({ field:"id", value: invoice_id });				    			    	
	    	}
			
			if(searchText!==""){
				para.push({ field:"number", value: searchText });
			}

			para.push({ field:"type", value:"Invoice" });
			para.push({ field:"status", operator:"where_in", value:[0,2] });

			if(this.dataSource.total()>0){
				var idList = [];
				$.each(this.dataSource.data(), function(index, value){
					idList.push(value.reference_id);
				});
				para.push({ field:"id", operator:"where_not_in", value:idList });
			}

			this.invoiceDS.query({
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.invoiceDS.view();

				if(view.length>0){
					$.each(view, function(index, value){											
						var amount_due = value.amount - (value.amount_paid + value.deposit);							

						self.dataSource.add({
		    				contact_id 			: value.contact_id,				
							account_id 			: obj.account_id,
							payment_term_id		: value.payment_term_id,
							payment_method_id	: obj.payment_method_id,				
							reference_id 		: value.id,								
							user_id 			: self.get("user_id"),
							check_no 			: value.check_no,
						   	type				: "Cash_Receipt",
						   	amount 				: amount_due,				   	
						   	discount 			: 0,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: obj.issued_date,					   	
						   	memo 				: obj.memo,
						   	memo2 				: obj.memo2,
						   	status 				: 0,
						   	segments 			: obj.segments,
						   	is_journal 			: 1,
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0,

						   	contact				: value.contact,
						   	amount_paid 		: value.amount_paid,
						   	reference 			: [{ "number" : value.number, "amount" : value.amount, "deposit" : value.deposit, "issued_date":value.issued_date, "account_id":value.account_id }]				
				    	});						
					});
					self.applyTerm();
					self.setRate();	
				}				
			});

			this.set("searchText", "");
			this.set("contact_id", "");
			this.set("invoice_id", 0);	
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		//Segments		
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Obj
		loadObj 			: function(id){
			var self = this, para = [];

			para.push({ field:"id", value: id });					

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.dataSource.view();
				
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.creditDS.filter([
					{ field: "reference_id", value: id },
					{ field: "type", value: "Customer_Deposit" }
				]);				
				self.set("obj", view[0]);
				self.set("original_total", view[0].amount+view[0].discount);
				self.changes();														
			});						
		},
		changes				: function(){
			var self = this, obj = this.get("obj"),
			total = 0, subTotal = 0, discount = 0, pay = 0, remain = 0;											

			$.each(this.dataSource.data(), function(index, value) {
				var amount = value.reference[0].amount - (value.amount_paid + value.reference[0].deposit);								
				subTotal += amount / value.rate;					
				discount += value.discount / value.rate;
				pay += value.amount / value.rate;					
	        });

			total = subTotal - discount;
			remain = total - pay;

	        this.set("sub_total", kendo.toString(subTotal, "c", banhji.locale));
	        this.set("discount", kendo.toString(discount, "c", banhji.locale));		        
	        this.set("total", kendo.toString(total, "c", banhji.locale));
	        this.set("pay", kendo.toString(pay, "c", banhji.locale));
	        this.set("remain", kendo.toString(remain, "c", banhji.locale));	    		
		},
		removeRow 			: function(e){			
			this.dataSource.remove(e.data);		    
		    this.changes();	        
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.invoiceDS.data([]);
			this.creditDS.data([]);			
			this.journalLineDS.data([]);			

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);			
			this.set("discount", 0);		
			this.set("total", 0);
			this.set("pay", 0);
			this.set("remain", 0);				

			this.set("obj", {				
				account_id 			: 7,
				payment_method_id	: 1,							   	
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   	
			   	memo 				: "",
			   	memo2 				: "",			   	
			   	segments 			: []		
	    	});						
		},					    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	      	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");	    			
	    	
	    	//Edit Mode
	    	if(this.get("isEdit")){
	    		if(this.get("original_total")!==obj.amount+obj.discount){
	    			this.set("original_total", obj.amount+obj.discount)

	    			$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);

					//Credit
					if(this.creditDS.total()>0){
						var credit = this.creditDS.at(0),
						overAmount = ((obj.reference[0].amount - obj.amount_paid) - obj.amount) - obj.discount;
						
						if(overAmount<0){
							credit.set("amount", overAmount*-1);
						}else{
							credit.set("amount", 0);
						}

						this.creditDS.sync();
					}else{
						this.addCredit(obj.id);
					}					
				}	    			    		
	    	}else{
	    		//Add brand new transaction
	    		$.each(this.dataSource.data(), function(index, value){
	    			value.set("account_id", obj.account_id);
	    			value.set("payment_method_id", obj.payment_method_id);	    			
	    			value.set("issued_date", obj.issued_date);
	    			value.set("memo", obj.memo);
	    			value.set("memo2", obj.memo2);
	    			value.set("segments", obj.segments);
	    		});
			}

			this.objSync()
			.then(function(data){
				if(self.get("isEdit")==false){
					self.addCredit(data[0].id);
					self.addJournal(data[0].id);
				}
									
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			
			banhji.userManagement.removeMultiTask("cash_receipt");
		},
		//Deposit
		addCredit 			: function(cash_receipt_id){
			var self = this, obj = this.get("obj");
			
			//Add over amount to customer credit
			$.each(this.dataSource.data(), function(index, value){			
				var overAmount = ((value.reference[0].amount - value.amount_paid) - value.amount) - value.discount;
				
				if(overAmount<0){
					self.creditDS.add({
	    				contact_id 			: value.contact_id,				
						account_id 			: value.contact[0].deposit_account_id,						
						payment_method_id	: obj.payment_method_id,				
						reference_id 		: cash_receipt_id,								
						user_id 			: self.get("user_id"),
						check_no 			: value.check_no,
					   	type				: "Customer_Deposit",
					   	amount 				: overAmount*-1,				   	
					   	discount 			: 0,
					   	rate				: value.rate,			   	
					   	locale 				: value.locale,			   	
					   	issued_date 		: obj.issued_date,					   	
					   	memo 				: obj.memo,
					   	memo2 				: obj.memo2,
					   	status 				: 0,
					   	segments 			: obj.segments,
					   	is_journal 			: 0,
					   	//Recurring
					   	recurring_name 		: "",
					   	start_date 			: new Date(),
					   	frequency 			: "Daily",
					   	month_option 		: "Day",
					   	interval 			: 1,
					   	day 				: 1,
					   	week 				: 0,
					   	month 				: 0,
					   	is_recurring 		: 0
			    	});	    			
				}
			});

			this.creditDS.sync();
		},
		//Journal
		addJournal 			: function(transaction_id){
			var self = this, obj = this.get("obj");

			$.each(this.dataSource.data(), function(index, value){
				var overAmount = ((value.reference[0].amount - value.amount_paid) - value.amount) - value.discount;

				//Cash on Dr
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: obj.account_id,				
					contact_id 			: value.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: value.amount,
					cr 					: 0,				
					rate				: value.rate,
					locale				: value.locale
				});

				if(value.discount>0){
					//Discount on Dr
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.contact[0].settlement_discount_id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: value.discount,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});
				}

				//AR on Cr
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.contact[0].account_id,				
					contact_id 			: value.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: value.amount + value.discount,				
					rate				: value.rate,
					locale				: value.locale
				});

				if(overAmount<0){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.contact[0].deposit_account_id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: overAmount*-1,				
						rate				: value.rate,
						locale				: value.locale
					});
				}				
			});

			self.journalLineDS.sync();	
		}
	});
	banhji.cashPayment =  kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(apiUrl + "transactions"),
		deleteDS 			: dataStore(apiUrl + "transactions"),
		invoiceDS 			: dataStore(apiUrl + "transactions"),
		creditDS 			: dataStore(apiUrl + "transactions"),		
		journalLineDS		: dataStore(apiUrl + "journal_lines"),
		currencyRateDS		: dataStore(apiUrl + "currencies/rate"),
		contactDS  			: banhji.source.supplierDS,
		employeeDS  		: banhji.source.saleRepDS,
		accountDS  			: banhji.source.cashAccountDS,		
		paymentTermDS 		: dataStore(apiUrl + "payment_terms"),
		paymentMethodDS 	: dataStore(apiUrl + "payment_methods"),	
		txnTemplateDS		: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Cash_Payment" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		segmentItemDS		: banhji.source.segmentItemDS,
		amtDueColor 		: banhji.source.amtDueColor,
		showCheckNo 		: false,
		obj 				: null,		
		isEdit 				: false,
		saveClose 			: false,
		savePrint 			: false,
		searchText 			: "",
		contact_id 			: "",
		invoice_id 			: 0,		
		sub_total 			: 0,		
		discount 			: 0,		
		total 				: 0,
		pay 		 		: 0,
		remain 				: 0,
		original_total 		: 0,				
		user_id				: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.set("isEdit", true);
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}
		},
		//Contact
		loadContact 		: function(id){
			this.set("contact_id", id);
			this.search();
		},		
		contactChanges 		: function(){
			this.search();
	    },
	    //Payment Term
	    issuedDateChanges 	: function(){
	    	this.applyTerm();
	    	this.setRate();	
	    },
	    applyTerm 			: function(){
	    	var self = this, obj = this.get("obj"), 
	    	today = new Date();

	    	$.each(this.dataSource.data(), function(index, value){	    		   		
	    		var term = self.paymentTermDS.get(value.payment_term_id),
	    		termDate = new Date(value.reference[0].issued_date);

    			termDate.setDate(termDate.getDate() + term.discount_period);
    			
    			if(today<=termDate){
    				if(value.amount_paid==0){
	    				var amount = value.reference[0].amount * term.discount_percentage;
	    				value.set("discount", amount);
	    				value.set("amount", value.reference[0].amount - amount);
    				}
    			}		    	
	    	});	    	
	    },
	    //Currency Rate		
		setRate 			: function(){
			var obj = this.get("obj");

			$.each(this.dataSource.data(), function(index, value){
				var rate = banhji.source.getRate(value.locale, new Date(obj.issued_date));				
				
				value.set("rate", rate);				
			});

			this.changes();			
		},
		//Search		
		search 				: function(){
			var self = this, 
			para = [],
			obj = this.get("obj"),			
			date = kendo.toString(new Date(obj.issued_date), "yyyy-MM-dd"), 
			searchText = this.get("searchText"), 
			invoice_id = this.get("invoice_id"),
			contact_id = this.get("contact_id");

	    	if(contact_id>0){		    			    	
		    	para.push({ field:"contact_id", value: contact_id });				    			    	
	    	}

	    	if(invoice_id>0){		    			    	
		    	para.push({ field:"id", value: invoice_id });				    			    	
	    	}
			
			if(searchText!==""){
				para.push({ field:"number", value: searchText });
			}

			para.push({ field:"type", value:"Credit_Purchase" });
			para.push({ field:"status", operator:"where_in", value:[0,2] });

			if(this.dataSource.total()>0){
				var idList = [];
				$.each(this.dataSource.data(), function(index, value){
					idList.push(value.reference_id);
				});
				para.push({ field:"id", operator:"where_not_in", value:idList });
			}

			this.invoiceDS.query({
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.invoiceDS.view();

				if(view.length>0){
					$.each(view, function(index, value){											
						var amount_due = value.amount - (value.amount_paid + value.deposit);							

						self.dataSource.add({
		    				contact_id 			: value.contact_id,				
							account_id 			: obj.account_id,
							payment_term_id		: value.payment_term_id,
							payment_method_id	: obj.payment_method_id,				
							reference_id 		: value.id,								
							user_id 			: self.get("user_id"),
							check_no 			: value.check_no,
						   	type				: "Cash_Payment",
						   	amount 				: amount_due,				   	
						   	discount 			: 0,
						   	rate				: value.rate,			   	
						   	locale 				: value.locale,			   	
						   	issued_date 		: obj.issued_date,					   	
						   	memo 				: obj.memo,
						   	memo2 				: obj.memo2,
						   	status 				: 0,
						   	segments 			: obj.segments,
						   	is_journal 			: 1,
						   	//Recurring
						   	recurring_name 		: "",
						   	start_date 			: new Date(),
						   	frequency 			: "Daily",
						   	month_option 		: "Day",
						   	interval 			: 1,
						   	day 				: 1,
						   	week 				: 0,
						   	month 				: 0,
						   	is_recurring 		: 0,

						   	contact				: value.contact,
						   	amount_paid 		: value.amount_paid,
						   	reference 			: [{ "number" : value.number, "amount" : value.amount, "deposit" : value.deposit, "issued_date":value.issued_date, "account_id":value.account_id }]				
				    	});						
					});
					self.applyTerm();
					self.setRate();	
				}				
			});

			this.set("searchText", "");
			this.set("contact_id", "");
			this.set("invoice_id", 0);	
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},		
	    segmentChanges 		: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Obj
		loadObj 			: function(id){
			var self = this, para = [];

			para.push({ field:"id", value: id });

			this.dataSource.query({    			
				filter: para,
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.dataSource.view();
				
				self.journalLineDS.filter({ field: "transaction_id", value: id });
				self.creditDS.filter([
					{ field: "reference_id", value: id },
					{ field: "type", value: "Vendor_Deposit" }
				]);				
				self.set("obj", view[0]);
				self.set("original_total", view[0].amount+view[0].discount);
				self.changes();														
			});						
		},
		loadInvoice 		: function(id){
			this.set("invoice_id", id);
			this.search();
		},
		changes				: function(){
			var self = this, obj = this.get("obj"),
			total = 0, subTotal = 0, discount =0, pay = 0, remain = 0;											

			$.each(this.dataSource.data(), function(index, value) {
				var amount = value.reference[0].amount - (value.amount_paid + value.reference[0].deposit);								
				subTotal += amount / value.rate;					
				discount += value.discount / value.rate;
				pay += value.amount / value.rate;				
	        });

			total = subTotal - discount;
			remain = total - pay;	        

	        this.set("sub_total", kendo.toString(subTotal, "c", banhji.locale));
	        this.set("discount", kendo.toString(discount, "c", banhji.locale));		        
	        this.set("total", kendo.toString(total, "c", banhji.locale));
	        this.set("pay", kendo.toString(pay, "c", banhji.locale));
	        this.set("remain", kendo.toString(remain, "c", banhji.locale));	    		
		},
		removeRow 			: function(e){
			var data = e.data;			
			this.dataSource.remove(data);		    
		    this.changes();	        
		},
		addEmpty 		 	: function(){			
			this.dataSource.data([]);
			this.invoiceDS.data([]);
			this.creditDS.data([]);			
			this.journalLineDS.data([]);			

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("sub_total", 0);			
			this.set("discount", 0);		
			this.set("total", 0);
			this.set("pay", 0);
			this.set("remain", 0);				

			this.set("obj", {				
				account_id 			: 7,
				payment_method_id	: 1,							   	
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),			   	
			   	memo 				: "",
			   	memo2 				: "",			   	
			   	segments 			: []		
	    	});						
		},							    
	    objSync 			: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },	      	    	    
		save 				: function(){				
	    	var self = this, obj = this.get("obj");	    			
	    	
	    	if(this.get("isEdit")){	    		
	    		if(this.get("original_total")!==obj.amount+obj.discount){
	    			this.set("original_total", obj.amount+obj.discount)

	    			$.each(this.journalLineDS.data(), function(index, value){										
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);

					//Credit
					if(this.creditDS.total()>0){
						var credit = this.creditDS.at(0),
						overAmount = ((obj.reference[0].amount - obj.amount_paid) - obj.amount) - obj.discount;
						
						if(overAmount<0){
							credit.set("amount", overAmount*-1);
						}else{
							credit.set("amount", 0);
						}

						this.creditDS.sync();
					}else{
						this.addCredit(obj.id);
					}					
				}	    			    		
	    	}else{
	    		//Add brand new transaction
	    		$.each(this.dataSource.data(), function(index, value){
	    			value.set("account_id", obj.account_id);
	    			value.set("payment_method_id", obj.payment_method_id);	    			
	    			value.set("issued_date", obj.issued_date);
	    			value.set("memo", obj.memo);
	    			value.set("memo2", obj.memo2);
	    			value.set("segments", obj.segments);
	    		});
			}

			this.objSync()
				.then(function(data){
					if(self.get("isEdit")==false){
						self.addCredit(data[0].id);
						self.addJournal(data[0].id);
					}					
					return data;
				}, function(reason) { //Error
					$("#ntf1").data("kendoNotification").error(reason);
				}).then(function(result){				
					$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

					if(self.get("saveClose")){
						//Save Close					
						self.set("saveClose", false);
						self.cancel();
						window.history.back();
					}else if(self.get("savePrint")){
						//Save Print					
						self.set("savePrint", false);
						self.cancel();
						banhji.router.navigate("/invoice_form/"+result[0].id);
					}else{
						//Save New
						self.addEmpty();
					}
				});
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			
			banhji.userManagement.removeMultiTask("cash_payment");
		},
		//Deposit
		addCredit 			: function(cash_receipt_id){
			var self = this, obj = this.get("obj");
			
			//Add over amount to customer credit
			$.each(this.dataSource.data(), function(index, value){			
				var overAmount = ((value.reference[0].amount - value.amount_paid) - value.amount) - value.discount;
				
				if(overAmount<0){
					self.creditDS.add({
	    				contact_id 			: value.contact_id,				
						account_id 			: value.contact[0].deposit_account_id,						
						payment_method_id	: obj.payment_method_id,				
						reference_id 		: cash_receipt_id,								
						user_id 			: self.get("user_id"),
						check_no 			: value.check_no,
					   	type				: "Vendor_Deposit",
					   	amount 				: overAmount*-1,				   	
					   	discount 			: 0,
					   	rate				: value.rate,			   	
					   	locale 				: value.locale,			   	
					   	issued_date 		: obj.issued_date,					   	
					   	memo 				: obj.memo,
					   	memo2 				: obj.memo2,
					   	status 				: 0,
					   	segments 			: obj.segments,
					   	is_journal 			: 0,
					   	//Recurring
					   	recurring_name 		: "",
					   	start_date 			: new Date(),
					   	frequency 			: "Daily",
					   	month_option 		: "Day",
					   	interval 			: 1,
					   	day 				: 1,
					   	week 				: 0,
					   	month 				: 0,
					   	is_recurring 		: 0
			    	});	    			
				}
			});

			this.creditDS.sync();
		},
		//Journal
		addJournal 			: function(transaction_id){
			var self = this, obj = this.get("obj");

			$.each(this.dataSource.data(), function(index, value){
				var overAmount = ((value.reference[0].amount - value.amount_paid) - value.amount) - value.discount;
				
				//AP on Dr
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: value.reference[0].account_id,				
					contact_id 			: value.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: value.amount + value.discount,
					cr 					: 0,				
					rate				: value.rate,
					locale				: value.locale
				});

				//Credit on Dr
				if(overAmount<0){
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.contact[0].deposit_account_id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: overAmount*-1,
						cr 					: 0,				
						rate				: value.rate,
						locale				: value.locale
					});
				}

				//Cash on Cr
				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: obj.account_id,				
					contact_id 			: value.contact_id,				
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: 0,
					cr 					: value.amount,				
					rate				: value.rate,
					locale				: value.locale
				});

				if(value.discount>0){
					//Discount on Cr
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.contact[0].settlement_discount_id,				
						contact_id 			: value.contact_id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.discount,				
						rate				: value.rate,
						locale				: value.locale
					});
				}				
			});

			self.journalLineDS.sync();	
		}
	});

	banhji.cashCenter = kendo.observable({
		lang 				: langVM,
		dataStore 			: banhji.source.cashAccountDS,
		summaryDS  			: dataStore(apiUrl + 'centers/accounting_summary'),
		transactionDS  		: dataStore(apiUrl + 'centers/accounting_txn'),
		accountTypeDS 		: banhji.source.accountTypeDS,
		balance 			: 0,
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		searchText 			: null,
		totalTxn 			: 0,
		sorterChanges: function(event){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	value = event.sender.selectedIndex;

			switch(value){
				case 1:								
					banhji.cashCenter.set('sdate', today);
					banhji.cashCenter.set('edate', today);
													  					
				  	break;
				case 2:			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					banhji.cashCenter.set('sdate', new Date(today.setDate(first)));
					banhji.cashCenter.set('edate', new Date(today.setDate(last)));						
					
				  	break;
				case 3:							  	
					banhji.cashCenter.set('sdate', new Date(today.getFullYear(), today.getMonth(), 1));
					banhji.cashCenter.set('edate', new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case 4:				
				  	banhji.cashCenter.set('edate', new Date(today.getFullYear(), 0, 1));
				  	banhji.cashCenter.set('edate', new Date(today.getFullYear(), 11, 31));

				  	break;									  
			}
		},
		searchTransaction: function() {
			var self = this, obj = this.get("obj");
			var para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");
			this.set('balance', 'Loading');
			var para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");
			this.set('balance', 'Loading');
			this.summaryDS.query({
			  	filter: [
			  		{ field:"account_id", value: obj.id },
			  		{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(this.get("sdate"), 'yyyy-MM-dd') },
			  		{ field:"issued_date <=", operator:"where_related", model:"transaction", value: kendo.toString(this.get("edate"), 'yyyy-MM-dd') }
			  	],
			  	page: 1,
			  	pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();				
				
				if(view.length>0){
					banhji.cashCenter.set("balance", kendo.toString(view[0].balance, view[0].locale=="km-KH"?"c0":"c", view[0].locale));
				}else{
					banhji.cashCenter.set("balance", 0);
				}
			});
			this.transactionDS.query({
			  	filter: [
			  		{ field:"account_id", value: obj.id },
			  		{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(this.get("sdate"), 'yyyy-MM-dd') },
			  		{ field:"issued_date <=", operator:"where_related", model:"transaction", value: kendo.toString(this.get("edate"), 'yyyy-MM-dd') }
			  	],
			  	page: 1,
			  	pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();				
				
				if(view.length>0){
					banhji.cashCenter.set('totalTxn', banhji.cashCenter.transactionDS.data().length);
				}else{
					banhji.cashCenter.set('totalTxn', 0);
				}
			});
		},
		goCashTransaction: function() {
			banhji.router.navigate('/cash_transaction');
		},
		goCashReceipt: function() {
			banhji.router.navigate('/cash_receipt');
		},
		goCashPayment: function() {
			banhji.router.navigate('/cash_payment');
		},
		goCashAdvance: function() {
			banhji.router.navigate('/cash_advance');
		},
		goExpense: function() {
			banhji.router.navigate('/expense');
		},
		goExchange: function() {
			banhji.router.navigate('/currency_rate');
		},
		typeName: null,
		nature: null,
		goEdit 				: function(){
			var obj = this.get("obj");
			banhji.router.navigate('/account/'+obj.id);
		},
		selectedRow	: function(e) {
			this.set('obj', e.data);
			var data = e.data,

			sub = this.dataStore.get(data.sub_of_id),
			type = this.accountTypeDS.get(data.account_type_id);
			
			if(data.sub_of_id>0){
				this.set("subName", sub.name);
			}else{
				this.set("subName", "");
			}

			// this.set("typeName", type.name);
			this.set("nature", type.nature);

			// this.set("obj", data);
			// this.loadSummary();
			// this.searchTransaction();
			//
			
			var self = this, obj = this.get("obj");
			var para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");
			this.set('balance', 'Loading');
			this.summaryDS.query({
			  	filter: [
			  		{ field:"account_id", value: obj.id }
			  	],
			  	page: 1,
			  	pageSize: 100
			}).then(function(){
				var view = self.summaryDS.view();				
				
				if(view.length>0){
					self.set("balance", kendo.toString(view[0].balance, view[0].locale=="km-KH"?"c0":"c", view[0].locale));
				}else{
					self.set("balance", 0);
				}
			});

        	if(obj.id){
        		para.push({ field:"account_id", value: obj.id });
        	}

        	//Dates
        	if(start && end){
            	para.push({ field:"issued_date >=", operator:"where_related", model:"transaction", value: start });
            	para.push({ field:"issued_date <=", operator:"where_related", model:"transaction", value: end });            	            	
            }else if(start){
            	para.push({ field:"issued_date", operator:"where_related", model:"transaction", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", operator:"where_related", model:"transaction", value: end });
            }else{
            	
            }                        

            this.transactionDS.query({
            	filter: para,            	
            	page: 1,
            	pageSize: 100
            }).then(function(){
            	banhji.cashCenter.set('totalTxn', banhji.cashCenter.transactionDS.data().length);
            });
		},
		search 		: function() {
			var isNumber =  /^\d+$/.test(this.get('searchText'));

			if(isNumber) {
				this.dataStore.filter([
					{field: "number", value: this.get('searchText')},
					{field: "account_type_id", value: 10}
				]);
			} else {
				this.dataStore.filter([
					{field: "name", operator: "like", value: this.get('searchText')},
					{field: "account_type_id", value: 10}
				]);
			}
		}
	});

	banhji.cashDashboard = kendo.observable({
		lang 				: langVM,
		topCashDS 	: dataStore(apiUrl + 'dashboards/top_cash'),
		topAdvaDS 	: dataStore(apiUrl + 'dashboards/top_advance'),
		topExpsDS 	: dataStore(apiUrl + 'dashboards/top_expense'),
		graphDS 	: banhji.index.graphDS,
		balance 	: 0,
		open 		: 0,
		overDue 	: 0,
		totalAdvance: 0,
		cashACNumber: 0,
		ar 			: 0,
		ar_open 	: 0,
		ar_customer : 0
	});

	banhji.cashSetting =  kendo.observable({
		lang 				: langVM,		
        contactTypeDS 		: banhji.source.customerTypeDS,
        paymentMethodDS		: dataStore(apiUrl+"payment_methods"),
        paymentTermDS		: dataStore(apiUrl+"payment_terms"),
        txnTemplateDS		: dataStore(apiUrl + "transaction_templates"),
        contactTypeName 	: "",
        contactTypeAbbr 	: "",
        contactTypeCompany 	: 0,
        paymentMethodName 	: "",
        paymentTermName 	: "",
        paymentTermNetDue	: "",
        paymentTermPeriod 	: "",
        paymentTermPercentage 	: "",
        pageLoad 			: function() {
        	this.txnTemplateDS.filter({ field: "moduls", value : "cash_mg" });
        },	    
        addContactType 		: function(){
        	var name = this.get("contactTypeName");

        	if(name!==""){
	        	this.contactTypeDS.add({
	        		parent_id 	: 1,
	        		name 		: name,
	        		abbr 		: this.get("contactTypeAbbr"),
	        		description : "",
	        		is_company 	: this.get("contactTypeCompany"),
	        		is_system 	: 0
	        	});

	        	this.contactTypeDS.sync();

	        	this.set("contactTypeName", "");
	        	this.set("contactTypeAbbr", "");
	        	this.set("contactTypeCompany", 0);
        	}
        },
        addPaymentMethod 		: function(){
        	var name = this.get("paymentMethodName");

        	if(name!==""){
	        	this.paymentMethodDS.add({	        		
	        		name 		: name,
	        		description : "",
	        		is_system 	: 0
	        	});

	        	this.paymentMethodDS.sync();

	        	this.set("paymentMethodName", "");
        	}
        },
        addPaymentTerm 		: function(){
        	var name = this.get("paymentTermName");

        	if(name!==""){
	        	this.paymentTermDS.add({	        		
	        		name 				: name,
	        		net_due 			: this.get("paymentTermNetDue"),
	        		discount_period 	: this.get("paymentTermPeriod"),
	        		discount_percentage : this.get("paymentTermPercentage"),
	        		is_system 			: 0
	        	});

	        	this.paymentTermDS.sync();

	        	this.set("paymentTermName", "");
	        	this.set("paymentTermNetDue", "");
	        	this.set("paymentTermPeriod", "");
	        	this.set("paymentTermPercentage", "");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;        	        	

        	if(kendo.parseInt(data.contact_id)>0){        		        	
	        	banhji.router.navigate('/customer/'+data.contact_id+'/1');   	
        	}else{
        		banhji.router.navigate('/customer');
        		banhji.customer.set("contact_type_id",data.id);
        	}
        },
        deleteForm 		: function(e){
        	var data = e.data;
        	if(confirm("Do you want to delete it?") == true) {
        		this.txnTemplateDS.remove(data);
        		this.txnTemplateDS.sync();
        	}
        },
        goInvoiceCustom : function(){
        	banhji.invoiceCustom.set("selectCustom", "cash_mg");
		    banhji.invoiceCustom.set("formShow", banhji.view.invoiceForm15);
		    banhji.invoiceCustom.set("formTitle", "Cash Transfer");
		    banhji.invoiceCustom.set("formType", "Cash_Transfer");
		    var obj= banhji.invoiceCustom.get("obj");
		    obj.set("type", "Cash_Transfer");
		    banhji.invoiceCustom.set("selectTypeList", banhji.source.cashFormList);
		    banhji.router.navigate('/invoice_custom');
        }
    });



	/*************************
	*	Inventory Section   *
	**************************/
	banhji.itemDashBoard = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/inventory_dashboard_summary"),
		dataSource 			: dataStore(apiUrl + "itemReports/item_sale"),
		positionSummary 	: dataStore(apiUrl + "itemReports/position_summary"),
		topCustomerDS 		: dataStore(apiUrl + "dashboards/top_supplier"),
		topARDS 			: dataStore(apiUrl + "dashboards/top_ar"),
		topProductDS 		: dataStore(apiUrl + "dashboards/top_sale_product"),
		topPurchase 		: dataStore(apiUrl + "dashboards/top_purchase"),
		topTurnOver 		: dataStore(apiUrl + "dashboards/top_inventory_turnover"),
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/item_monthly_purchase_sale",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),
		sale 				: 0,
		sale_customer 		: 0,
		sale_product 		: 0,
		sale_order 			: 0,
		order 				: 0,
		order_avg 			: 0,
		order_open 			: 0,
		ar 					: 0,
		ar_open 			: 0,
		ar_customer 		: 0,
		ar_overdue 			: 0,						
		pageLoad 			: function(){
			var self = this, today = new Date(),
			firstDayOfYear = new Date(today.getFullYear(), 0, 1);

			this.graphDS.read();

			this.summaryDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.summaryDS.view();
				
			
				self.set("purchaseSupplierCount", kendo.toString(view[0].purchaseSupplierCount, "n0"));
				self.set("purchaseProductCount", kendo.toString(view[0].purchaseProductCount, "n0"));
				self.set("purchase_order", kendo.toString(view[0].purchase_order, "n0"));

				self.set("inventoryTurnOver", kendo.toString(view[0].inventoryTurnOver, "n0"));
				self.set("turnover", kendo.toString(view[0].turnover, "n0"));

				self.set("grossProfitMargin", kendo.toString(view[0].grossProfitMargin, "p"));
				self.set("product", kendo.toString(view[0].product, "n0"));

			});

			this.topCustomerDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],								
				page: 1,
				pageSize: 5
			});

			this.topARDS.query({
				filter: [
					{ field:"issued_date >=", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});

			this.topPurchase.query({
				filter: [
					{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", operator:"where_related", model:"transaction", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});	

			this.topProductDS.query({
				filter: [
					{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", operator:"where_related", model:"transaction", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});	

			this.topTurnOver.query({
				filter: [
					{ field:"issued_date >=", operator:"where_related", model:"transaction", value: kendo.toString(firstDayOfYear, "yyyy-MM-dd") },
					{ field:"issued_date <=", operator:"where_related", model:"transaction", value:  kendo.toString(today, "yyyy-MM-dd") }
				],							
				page: 1,
				pageSize: 5
			});										
		}
	});
	banhji.itemCenter = kendo.observable({
		lang 				: langVM,		
		itemDS				: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort:[
				{ field:"item_type_id", dir:"asc" },
				{ field:"id", dir:"asc" }
			],
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		categoryDS 			: dataStore(apiUrl + "categories"),
		sumamryDS 			: dataStore(apiUrl + "transactions/line"),
		transactionDS		: dataStore(apiUrl + "items/movement"),
		attachmentDS 		: dataStore(apiUrl + "attachments"),		
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: null,
		searchText 			: "",	
		category_id 		: null,
		total_value 		: 0,
		itemType 			: "",
		uom 		 		: "",
		currencyCode 		: "",
		pageLoad 			: function(id){
			if(id){
				this.loadObj(id);
			}

			//Refresh
			if(this.itemDS.total()>0){
				this.itemDS.fetch();
				this.transactionDS.fetch();
			}													
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		setItemType 	 	: function(){
			var itemType = "", obj = this.get("obj");

			$.each(banhji.source.itemTypeDS.data(), function(index, value){				
				if(value.id == obj.item_type_id){
					itemType = value.name;					

					return false;					
				}
			});

			this.set("itemType", itemType);
		},
		setCurrencyCode 	: function(){
			var code = "", obj = this.get("obj");

			$.each(banhji.source.currencyRateDS.data(), function(index, value){				
				if(value.locale == obj.locale){
					code = value.currency[0].code;					

					return false;					
				}
			});

			this.set("currencyCode", code);
		},
		setUOM 	 			: function(){
			var measurement = "", obj = this.get("obj");

			$.each(banhji.source.measurementDS.data(), function(index, value){				
				if(value.id == obj.measurement_id){
					measurement = value.name;					

					return false;					
				}
			});

			this.set("uom", measurement);
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Item",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },	    
	    onRemove 			: function(e){
	        // Array with information about the uploaded files
	        var self = this, files = e.files;
	        $.each(this.attachmentDS.data(), function(index, value){
	        	if(value.name==files[0].name){
	        		self.attachmentDS.remove(value);

	        		return false;
	        	}
	        });
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm("Are you sure, you want to delete it?")) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	var self = this;

	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });            

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	if(e.type=="destroy"){
	            	if(saved==false){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var paramz = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(paramz, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });

            //Clear upload files
            $(".k-upload-files").remove();
	    },
	    //Obj
		loadObj 			: function(id){
			var self = this;

			this.itemDS.query({
				filter: { field:"id", value:id},
				page:1,
				pageSize:100
			}).then(function(){
				var view = self.itemDS.view();

				if(view.length>0){
					self.set("obj", view[0]);
					self.loadData();
				}
			});
		},
		loadData 			: function(){
			var obj = this.get("obj"),
			totalValue = kendo.parseFloat(obj.on_hand) * kendo.parseFloat(obj.cost);

			this.searchTransaction();			
			this.set("total_value", kendo.toString(totalValue, "c", obj.locale));
			this.attachmentDS.filter({ field:"item_id", value:obj.id });
			this.setCurrencyCode();
			this.setUOM();
			this.setItemType();
		},		
		selectedRow			: function(e){
			var id = e.data.id,
			data = e.data;			
			
			this.set("obj", data);
			this.loadData();
		},
		sorterChanges 		: function(){
			var value = this.get("sorter");

			switch(value){
			case "today":
				var today = new Date();
				
				this.set("sdate", today);
				this.set("edate", today);
			  					
			  	break;
			case "week":
			  	var thisWeek = new Date;
				var first = thisWeek.getDate() - thisWeek.getDay(); 
				var last = first + 6;

				var firstDayOfWeek = new Date(thisWeek.setDate(first));
				var lastDayOfWeek = new Date(thisWeek.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var thisMonth = new Date;				  	
				var firstDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth(), 1);
				var lastDayOfMonth = new Date(thisMonth.getFullYear(), thisMonth.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
				var thisYear = new Date();
			  	var firstDayOfYear = new Date(thisYear.getFullYear(), 0, 1);
				var lastDayOfYear = new Date(thisYear.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this,
			para = [],
			searchText = this.get("searchText"),			
			category_id = this.get("category_id");

        	if(searchText){
      			var textParts = searchText.replace(/([a-z]+)/i, "$1 ").split(/[^0-9a-z]+/ig);

      			para.push(
      				{ field: "abbr", value: textParts[0] },
      				{ field: "number", value: textParts[1] },
					{ field: "name", operator: "or_like", value: searchText }
      			);
      		}

			if(category_id){
				para.push({ field:"category_id", value:category_id });
			}

			para.push({ field:"item_type_id", value:1 });
			// para.push({ field:"is_catalog", value: 0 });
			// para.push({ field:"is_assembly", value: 0 });          

            this.itemDS.filter(para);

            this.set("searchText", "");
            this.set("category_id", 0);      			
		},
		searchTransaction	: function(){
			var self = this, para = [],
				obj = this.get("obj"),
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	if(obj.id>0){
        		para.push({ field:"item_id", value: obj.id });
        	
	        	//Dates
	        	if(start && end){
	            	para.push({ field:"issued_date >=", model:"transaction", operator: "where_related", value: start });
	            	para.push({ field:"issued_date <=", model:"transaction", operator: "where_related", value: end });            	            	
	            }else if(start){
	            	para.push({ field:"issued_date", model:"transaction", operator: "where_related", value: start });
	            }else if(end){
	            	para.push({ field:"issued_date <=", model:"transaction", operator: "where_related", value: end });
	            }else{
	            	
	            }

	            this.transactionDS.query({
	            	filter: para,
	            	page: 1,
	            	pageSize: 10
	            });
	        }            
		},
		edit				: function(){
			var obj = this.get("obj");

			if(obj.item_type_id=="1"){
				if(obj.is_catalog=="1"){
					banhji.router.navigate('/item_catalog/'+obj.id);
				}else if(obj.is_assembly=="1"){
					banhji.router.navigate('/item_assembly/'+obj.id);
				}else{
					banhji.router.navigate('/item/'+obj.id);
				}
			}else if(obj.item_type_id=="2"){
				banhji.router.navigate('/non_inventory_part/'+obj.id);
			}else if(obj.item_type_id=="3"){
				banhji.router.navigate('/fixed_assets/'+obj.id);
			}else if(obj.item_type_id=="4"){
				banhji.router.navigate('/item_service/'+obj.id);
			}else if(obj.item_type_id=="5"){
				banhji.router.navigate('/txn_item/'+obj.id);
			}else{

			}
		},
		pricing				: function(){
			var obj = this.get("obj");

			if(obj.is_catalog=="1"){
				banhji.router.navigate('/item_catalog/'+obj.id);
			}else if(obj.is_assembly=="1"){
				banhji.router.navigate('/item_assembly/'+obj.id);
			}else{
				banhji.router.navigate('/item_prices/'+obj.id);
			}			
		}
	});	
	banhji.itemPrice = kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(apiUrl + "item_prices"),
    	itemDS 				: dataStore(apiUrl + "items"),
    	recordDS 			: dataStore(apiUrl + "items/movement"),
    	poDS 				: dataStore(apiUrl + "transactions/line"),
    	soDS 				: dataStore(apiUrl + "transactions/line"),
    	currencyDS  		: banhji.source.currencyDS,
    	unitDS	   			: banhji.source.measurementDS,
    	obj 				: null,
    	priceList 			: null,
    	on_po 				: 0,
    	on_so 				: 0,
    	pageLoad 			: function(id){    		
    		this.dataSource.filter({ field:"item_id", value: id });    		
    		this.recordDS.filter({ field:"item_id", value: id });    		
    		this.loadObj(id);
    		this.countPO(id);
    		this.countSO(id);
    	},
    	loadObj 			: function(id){
    		var self = this;

    		this.itemDS.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.itemDS.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},
    	countPO 			: function(id){
    		var self = this;

    		this.poDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"transaction", operator:"where_related", value:"Purchase_Order" },
	    			{ field:"status", model:"transaction", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		pageSize:1
	    	}).then(function(){
	    		var view = self.poDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_po", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_po", 0);
	    		}
	    	});
    	},
    	countSO 			: function(id){
    		var self = this;

    		this.soDS.query({
    			filter:[
	    			{ field:"item_id", value: id },
	    			{ field:"type", model:"transaction", operator:"where_related", value:"SO" },
	    			{ field:"status", model:"transaction", operator:"where_related", value:0 }
	    		],
	    		page:1,
	    		pageSize:1
	    	}).then(function(){
	    		var view = self.soDS.view();

	    		if(view.length>0){
	    			var sum = 0;

	    			$.each(view, function(index, value){
	    				sum += kendo.parseInt(value.unit);
	    			});

	    			self.set("on_so", kendo.toString(sum, "n0"));
	    		}else{
	    			self.set("on_so", 0);
	    		}
	    	});
    	},
    	openWindow			: function(){
      		this.addEmpty();

         	var window = $("#priceList-window").data("kendoWindow");
          	window.title("តំលៃ");          	
          	window.center().open();         	
      	},
      	closeWindow 		: function(){	      		
      		this.dataSource.cancelChanges();

      		var window = $("#priceList-window").data("kendoWindow");          	         	
          	window.close();          	
      	},      	
      	addEmpty 			: function () {
      		this.dataSource.add({      			      			
      			item_id			: this.get("obj").id,
      			measurement_id 	: 0,
      			price 			: 0,
      			unit_value		: 0,
      			locale 			: "km-KH",

      			currency 		: [{locale:"km-KH"}],      			
      			measurement 	: []
			});

			var data = this.dataSource.data();
			var obj = data[data.length - 1];
      						
			this.set("priceList", obj);	
      	},      	 	
      	save 				: function(){
      		this.dataSource.sync();
      		banhji.itemCenter.itemDS.fetch();

      		var window = $("#priceList-window").data("kendoWindow");          	         	
          	window.close(); 		
      	},
      	edit 				: function(e){
      		var data = e.data;
      		
      		this.set("priceList", data);

      		var window = $("#priceList-window").data("kendoWindow");
          	window.title("តំលៃ");          	
          	window.center().open();       		
      	},      	
      	delete 				: function(e){
			if (confirm("Are you sure, you want to delete it?")) {        
		        var data = e.data;

		        if(this.dataSource.total()>1){
			        this.dataSource.remove(data);
			        this.dataSource.sync();
			        banhji.itemCenter.dataSource.fetch();
		    	}else{
		    		alert("Sorry, you can't delete it!");
		    	}
	    	}	    	
	    }
    });	
    banhji.item = kendo.observable({
    	lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	patternDS 				: dataStore(apiUrl + "items"),
    	deleteDS 				: dataStore(apiUrl + "transactions/line"),
    	categoryDS 				: banhji.source.inventoryCategoryDS,
    	itemGroupDS 			: dataStore(apiUrl + "items/group"),   	
    	brandDS 	 			: dataStore(apiUrl + "brands"),    	   	   	
    	measurementDS			: banhji.source.measurementDS,
    	numberDS 				: dataStore(apiUrl + "items"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	itemPriceDS 			: dataStore(apiUrl + "item_prices"),
    	vendorDS 	 			: banhji.source.supplierDS,
    	customerDS 	 			: banhji.source.customerDS,
    	itemVendorDS 	 		: dataStore(apiUrl + "items/contact"),
    	itemCustomerDS 	 		: dataStore(apiUrl + "items/contact"),
    	currencyDS 	 			: banhji.source.currencyDS,  	
    	incomeAccountDS 		: banhji.source.incomeAccountDS,
    	cogsAccountDS 			: banhji.source.cogsAccountDS,
    	inventoryAccountDS 		: banhji.source.inventoryAccountDS,
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		isDuplicateNumber 		: false,
		user_id					: banhji.source.user_id,
    	pageLoad 				: function(id, is_pattern){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Pattern
		setPattern 				: function(category_id){
			var obj = this.get("obj");

			obj.set("category_id", category_id);
			obj.set("is_pattern", 1);
		},
		savePattern 			: function(category_id, item_id){
			var data = banhji.itemSetting.categoryDS.get(category_id);
			data.set("item_id", item_id);
			banhji.itemSetting.categoryDS.sync();			
			window.history.back();
		},
		loadPattern 			: function(){
			var self = this, obj = self.get("obj"), 
			cat = this.categoryDS.get(obj.category_id);

			this.patternDS.query({
				filter: [
					{ field:"id", value: cat.item_id },
					{ field:"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 1
			}).then(function(data){
				var view = self.patternDS.view();				

				if(view.length>0){
	      			obj.set("item_group_id", view[0].item_group_id),
	      			obj.set("brand_id", view[0].brand_id),
	      			obj.set("measurement_id", view[0].measurement_id),
	      			obj.set("abbr", cat.abbr),
	      			obj.set("number", ""),
	      			obj.set("international_code", view[0].international_code),
	      			obj.set("color_code", view[0].color_code),
	      			obj.set("name", ""),
	      			obj.set("purchase_description", view[0].purchase_description),
	      			obj.set("sale_description", view[0].sale_description),
	      			obj.set("measurements", view[0].measurements),	      			
	      			obj.set("cost", view[0].cost),
	      			obj.set("price", view[0].price),
	      			obj.set("locale", view[0].locale),	      			     			
	      			obj.set("order_point", view[0].order_point),
	      			obj.set("income_account_id", view[0].income_account_id),
	      			obj.set("cogs_account_id", view[0].cogs_account_id),
	      			obj.set("inventory_account_id", view[0].inventory_account_id),
	      			obj.set("favorite", view[0].favorite)	      						
				}else{
					obj.set("item_group_id", ""),
	      			obj.set("brand_id", ""),
	      			obj.set("measurement_id", ""),
	      			obj.set("abbr", ""),
	      			obj.set("number", ""),
	      			obj.set("international_code", ""),
	      			obj.set("color_code", ""),
	      			obj.set("name", ""),
	      			obj.set("purchase_description", ""),
	      			obj.set("sale_description", ""),
	      			obj.set("measurements", ""),	      			
	      			obj.set("cost", ""),
	      			obj.set("price", ""),
	      			obj.set("locale", ""),	      			     			
	      			obj.set("order_point", ""),
	      			obj.set("income_account_id", ""),
	      			obj.set("cogs_account_id", ""),
	      			obj.set("inventory_account_id", ""),
	      			obj.set("favorite", false)
				}
			});
		},
		//Item Price
		addItemPrice 			: function () {
			var obj = this.get("obj");

      		this.itemPriceDS.add({      			      			
      			item_id			: obj.id,
      			measurement_id 	: obj.measurement_id,
      			price 			: obj.price,
      			unit_value		: 0,
      			locale 			: obj.locale
			});
      	},
      	//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj");			
			
			if(obj.number!==""){

				if(this.get("isEdit")){
					para.push({ field:"id", operator:"where_not_in", value: [obj.id] });
				}

				para.push({ field:"abbr", value: obj.abbr });
				para.push({ field:"number", value: obj.number });
				para.push({ field:"category_id", value: obj.category_id });

				this.existingDS.query({
					filter: para,
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number",kendo.toString(lastNo, "00001"));
				}
			});
		},
		categoryChanges 		: function(){
			var obj = this.get("obj");

			if(obj.category_id){
				var category = this.categoryDS.get(obj.category_id);
				obj.set("abbr", category.abbr);

				this.loadPattern();
				this.generateNumber();
			}
		},
      	//Item Contact
		loadItemContact			: function(){
    		var obj = this.get("obj");

			this.itemVendorDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "vendor" }
				],
				page: 1,
				pageSize: 100
			});

			this.itemCustomerDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "customer" }
				],
				page: 1,
				pageSize: 100
			});
		},
	    addEmptyItemVendor 		: function(){
			var obj = this.get("obj");
			
			this.itemVendorDS.add({
				item_id 	: obj.id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "vendor"
			});								
		},
		deleteItemVendor 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemVendorDS.getByUid(d.uid);

				this.itemVendorDS.remove(obj);
			}
		},
		addEmptyItemCustomer 	: function(){
			var obj = this.get("obj");

			this.itemCustomerDS.add({
				item_id 	: obj.id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "customer"
			});								
		},
		deleteItemCustomer 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemCustomerDS.getByUid(d.uid);

				this.itemCustomerDS.remove(obj);
			}
		},
		//Obj
		loadObj 				: function(id, is_pattern){
    		var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

    		this.dataSource.query({    			
				filter: para,
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.loadItemContact();
			});
    	},    	   	
      	addEmpty 				: function(){
      		var self = this;

      		this.dataSource.data([]);
      		this.itemVendorDS.data([]);
	      	this.itemCustomerDS.data([]);

	      	this.set("isEdit", false);
      		this.set("obj", null);

      		this.patternDS.query({
      			filter:[
      				{ field:"id", value:1 },
      				{ field:"is_pattern", value:1 }
      			],
      			page:1,
      			pageSize:1
      		}).then(function(){
      			var view = self.patternDS.view(),
      			cat = self.categoryDS.at(0);

      			self.dataSource.insert(0, {				
					item_type_id 			: 1,//Inventory Part      			      			
	      			category_id 			: view[0].category_id,
	      			item_group_id 			: view[0].item_group_id,
	      			brand_id 				: view[0].brand_id,
	      			measurement_id			: view[0].measurement_id,
	      			abbr 					: cat.abbr,
	      			number 					: "",
	      			international_code 		: view[0].international_code,
	      			color_code 				: view[0].color_code,
	      			name 					: "",
	      			purchase_description	: view[0].purchase_description,
	      			sale_description		: view[0].sale_description,
	      			measurements 			: view[0].measurements,	      			
	      			cost 					: view[0].cost,
	      			price 					: view[0].price,
	      			locale 					: view[0].locale,	      			     			
	      			order_point 			: view[0].order_point,
	      			income_account_id 		: view[0].income_account_id,
	      			cogs_account_id  		: view[0].cogs_account_id,
	      			inventory_account_id 	: view[0].inventory_account_id,
	      			favorite 				: view[0].favorite,
	      			is_pattern 				: 0,
	      			status 					: 1,
	      			deleted 				: 0								
				});

				var obj = self.dataSource.at(0);				
				//Pattern
				// if(self.get("contact_type_id")>0){
				// 	obj.set("contact_type_id", self.get("contact_type_id"));
				// 	obj.set("abbr", "");
				// 	obj.set("is_pattern", 1);
				// }

				self.set("obj", obj);
				self.generateNumber();
      		});
      	},
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Contact Item has changes
		    	if(this.itemVendorDS.hasChanges() || this.itemCustomerDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}else{
	    		this.addItemPrice();
	    		obj.set("cost", 0);
	    		obj.set("price", 0);
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					$.each(self.itemVendorDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			$.each(self.itemCustomerDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			$.each(self.itemPriceDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			if(data[0].is_pattern){
						self.savePattern(data[0].category_id, data[0].id);
					}

					self.itemPriceDS.sync();
				}
				
      			self.itemVendorDS.sync();
      			self.itemCustomerDS.sync();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.itemVendorDS.cancelChanges();
			this.itemCustomerDS.cancelChanges();
			
			this.dataSource.data([]);
			this.itemVendorDS.data([]);
			this.itemCustomerDS.data([]);

			banhji.userManagement.removeMultiTask("item");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(!obj.is_system==1){
				this.deleteDS.query({
				  	filter: { field: "item_id", value: obj.id },
				  	page: 1,
				  	pageSize: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						obj.set("deleted", 1);
				        self.dataSource.sync();

				        window.history.back();				        
					}
				});
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
    banhji.itemCatalog =  kendo.observable({
		lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	deleteDS 				: dataStore(apiUrl + "transactions"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	numberDS 				: dataStore(apiUrl + "items"),    	
    	itemDS 					: banhji.source.itemNonCatalogDS,
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		originalNo 				: "",
		isDuplicateNumber 		: false,
    	user_id					: banhji.source.user_id,
    	pageLoad 				: function(id){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj"),
			originalNo = this.get("originalNo");			
			
			if(obj.number!=="" && obj.number!==originalNo){
				this.existingDS.query({
					filter: [
						{ field:"number", value: obj.number },
						{ field:"category_id", value: obj.category_id }
					],
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number","00001");
				}
			});
		},
		//Obj
		loadObj 				: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},    	   	
      	addEmpty 				: function(){      		
      		this.dataSource.data([]);
      		
      		this.set("isEdit", false);
      		this.set("obj", null);

      		this.dataSource.insert(0, {
      			item_type_id 			: 1,      			 			
      			category_id 			: 6,
      			abbr 					: "CAT",
      			number 					: "",      			
      			name 					: "",
      			purchase_description	: "",
      			sale_description 		: "",
      			catalogs 				: [],
      			locale 					: banhji.locale,
      			favorite 				: false,
      			status 					: 1,
      			is_catalog 				: 1,
      			deleted 				: 0
			});      		

			var obj = this.dataSource.at(0);      						
			this.set("obj", obj);
			this.generateNumber();			
      	},
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");
			
			//Save Obj
			this.objSync()
			.then(function(data){ //Success			
				      			
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.dataSource.data([]);
			
			banhji.userManagement.removeMultiTask("item_catalog");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			this.deleteDS.query({
			  	filter: { field: "item_id", value: obj.id },
			  	page: 1,
			  	pageSize: 1
			}).then(function() {
				var view = self.deleteDS.view();

				if(view.length>0){
					alert("Sorry, you can not delete it because it is using now.");
				}else{
					obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();				        
				}
			});	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.itemAssembly =  kendo.observable({
		lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	lineDS 					: dataStore(apiUrl + "item_prices"),
    	deleteDS 				: dataStore(apiUrl + "transactions"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	numberDS 				: dataStore(apiUrl + "items"),    	
    	itemDS 					: banhji.source.itemNonAssemblyDS,
    	currencyDS 				: banhji.source.currencyDS,
    	measurementDS 			: banhji.source.measurementDS,    	
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		originalNo 				: "",
		isDuplicateNumber 		: false,
		total 					: 0,
    	user_id					: banhji.source.user_id,
    	pageLoad 				: function(id){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Item
		itemChanges 			: function(e){								
			var data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var cost = 0, rate = 1;

				if(item.item_type_id=="1" || item.item_type_id=="4"){					
					rate = obj.rate / banhji.source.getRate(item.locale, new Date(obj.issued_date));
					cost = item.cost*rate;					
				}

	    		data.set("measurement_id", item.measurement_id);
	    		data.set("quantity", 1);	    		
		        data.set("price", cost);
		        data.set("amount", cost);			        

		        this.onChanges();		    	
	        }                	        	
		},
		onChanges 				: function(){
			var total = 0, obj = this.get("obj");

			$.each(this.lineDS.data(), function(index, value){
				var amount = value.quantity * value.price;
				total += amount;

				value.set("amount", amount);
			});

			this.set("total", kendo.toString(total, "c", obj.locale));
		},
		addRow 					: function(){      		
      		var obj = this.get("obj");			
	      		    			
      		this.lineDS.add({
      			assembly_id 	: obj.id,
      			item_id 		: "",      			
      			quantity 		: 1,
      			price 			: 0,
      			amount 			: 0,
      			locale 			: obj.locale    			
			});				
      	},
      	removeRow 				: function(e){
      		e.preventDefault();

			if(this.lineDS.total()>1){      		        
		        var data = e.data;		        
		        this.lineDS.remove(data);
	        }	    	
      	},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj"),
			originalNo = this.get("originalNo");			
			
			if(obj.number!=="" && obj.number!==originalNo){
				this.existingDS.query({
					filter: [
						{ field:"number", value: obj.number },
						{ field:"category_id", value: obj.category_id }
					],
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number","00001");
				}
			});
		},
		//Obj
		loadObj 				: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id }
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.lineDS.filter({ field:"assembly_id", value:id });
			});
    	},    	   	
      	addEmpty 				: function(){      		
      		this.dataSource.data([]);
      		this.lineDS.data([]);

      		this.set("isEdit", false);
      		this.set("obj", null);

      		this.dataSource.insert(0, {
      			item_type_id 			: 1,      			 			
      			category_id 			: 5,
      			abbr 					: "ASS",
      			number 					: "",      			
      			name 					: "",
      			purchase_description	: "",
      			sale_description 		: "",
      			price 					: "",
      			rate 					: banhji.source.getRate(banhji.locale, new Date()),
      			locale 					: banhji.locale,
      			favorite 				: false,
      			status 					: 1,
      			is_assembly 			: 1,
      			deleted 				: 0
			});      		

			var obj = this.dataSource.at(0);      						
			this.set("obj", obj);
			this.addRow();
			this.generateNumber();			
      	},      	
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Line
		    	if(this.lineDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					$.each(self.lineDS.data(), function(index, value){
	      				value.set("assembly_id", data[0].id);
	      			});
				}
				
      			self.lineDS.sync();
      			
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
						
			this.dataSource.data([]);
			this.lineDS.data([]);
			
			banhji.userManagement.removeMultiTask("item_assembly");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			this.deleteDS.query({
			  	filter: { field: "item_id", value: obj.id },
			  	page: 1,
			  	pageSize: 1
			}).then(function() {
				var view = self.deleteDS.view();

				if(view.length>0){
					alert("Sorry, you can not delete it because it is using now.");
				}else{
					obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();				        
				}
			});	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.itemService =  kendo.observable({
    	lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	patternDS 				: dataStore(apiUrl + "items"),
    	deleteDS 				: dataStore(apiUrl + "transactions/line"),
    	numberDS 				: dataStore(apiUrl + "items"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	categoryDS 				: banhji.source.serviceCategoryDS,
    	itemGroupDS 			: dataStore(apiUrl + "items/group"),    	  	   	
    	measurementDS			: banhji.source.measurementDS,
    	vendorDS 	 			: banhji.source.supplierDS,
    	customerDS 	 			: banhji.source.customerDS,
    	itemVendorDS 	 		: dataStore(apiUrl + "items/contact"),
    	itemCustomerDS 	 		: dataStore(apiUrl + "items/contact"),
    	currencyDS 	 			: banhji.source.currencyDS,  	
    	incomeAccountDS 		: banhji.source.incomeAccountDS,
    	cogsAccountDS 			: banhji.source.cogsAccountDS,    	
    	statusList 				: banhji.source.statusList,
        confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		originalNo 				: "",
		isDuplicateNumber 		: false,
    	pageLoad 				: function(id, is_pattern){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Pattern
		setPattern 				: function(category_id){
			var obj = this.get("obj");

			obj.set("category_id", category_id);
			obj.set("is_pattern", 1);
		},
		savePattern 			: function(category_id, item_id){
			var data = banhji.itemSetting.categoryDS.get(category_id);
			data.set("item_id", item_id);
			banhji.itemSetting.categoryDS.sync();			
			window.history.back();
		},
		loadPattern 			: function(){
			var self = this, obj = self.get("obj"), cat = this.categoryDS.get(obj.category_id);

			this.patternDS.query({
				filter: [
					{ field:"id", value: cat.item_id },
					{ field:"is_pattern", value: 1 }
				],
				page: 1,
				pageSize: 1
			}).then(function(data){
				var view = self.patternDS.view();				

				if(view.length>0){
					obj.set("measurement_id", view[0].measurement_id),
	      			obj.set("abbr", cat.abbr),	      			
					obj.set("price", view[0].price);
					obj.set("cost", view[0].cost);
					obj.set("locale", view[0].locale);
					obj.set("purchase_description", view[0].purchase_description),
	      			obj.set("sale_description", view[0].sale_description),
					obj.set("income_account_id", view[0].income_account_id);
					obj.set("cogs_account_id", view[0].cogs_account_id);					
				}else{
					obj.set("measurement_id", 0),
	      			obj.set("abbr", ""),
	      			obj.set("price", view[0].price);
					obj.set("cost", view[0].cost);
					obj.set("locale", banhji.locale);
					obj.set("purchase_description", ""),
	      			obj.set("sale_description", ""),
					obj.set("income_account_id", 0);
					obj.set("cogs_account_id", 0);
				}
			});
		},
		//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj"),
			originalNo = this.get("originalNo");			
			
			if(obj.number!=="" && obj.number!==originalNo){
				this.existingDS.query({
					filter: [
						{ field:"number", value: obj.number },
						{ field:"contact_type_id", value: obj.contact_type_id }
					],
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number","00001");
				}
			});
		},
		categoryChanges 		: function(){
			var obj = this.get("obj");

			if(obj.category_id){
				var category = this.categoryDS.get(obj.category_id);
				obj.set("abbr", category.abbr);

				this.loadPattern();
				this.generateNumber();
			}
		},
      	//Item Contact
		loadItemContact			: function(){
    		var obj = this.get("obj");

			this.itemVendorDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "vendor" }
				],
				page: 1,
				pageSize: 100
			});

			this.itemCustomerDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "customer" }
				],
				page: 1,
				pageSize: 100
			});
		},
	    addEmptyItemVendor 		: function(){
			var item_id = 0;
			if(this.get("isEdit")){
				item_id = this.get("obj").id;
			}

			this.itemVendorDS.add({
				item_id 	: item_id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "vendor"
			});								
		},
		deleteItemVendor 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemVendorDS.getByUid(d.uid);

				this.itemVendorDS.remove(obj);
			}
		},
		addEmptyItemCustomer 	: function(){
			var item_id = 0;
			if(this.get("isEdit")){
				item_id = this.get("obj").id;
			}

			this.itemCustomerDS.add({
				item_id 	: item_id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "customer"
			});								
		},
		deleteItemCustomer 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemCustomerDS.getByUid(d.uid);

				this.itemCustomerDS.remove(obj);
			}
		},
		//Obj
		loadObj 				: function(id, is_pattern){
    		var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

    		this.dataSource.query({    			
				filter: para,
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.set("originalNo", view[0].number);
		    	self.loadItemContact();
			});
    	},    	   	
      	addEmpty 				: function(){
      		var self = this;

      		this.dataSource.data([]);
      		this.itemVendorDS.data([]);
	      	this.itemCustomerDS.data([]);

	      	this.set("isEdit", false);
      		this.set("obj", null);

      		this.patternDS.query({
      			filter:[
      				{ field:"id", value: 3 },
      				{ field:"is_pattern", value: 1 }
      			],
      			page:1,
      			pageSize:1
      		}).then(function(){
      			var view = self.patternDS.view(),
      			cat = self.categoryDS.at(0);

      			self.dataSource.insert(0, {				
					item_type_id 			: 4,//Service      			      			
	      			category_id 			: view[0].category_id,
	      			item_group_id 			: view[0].item_group_id,
	      			measurement_id			: view[0].measurement_id,
	      			abbr 					: cat.abbr,
	      			number 					: "",
	      			name 					: "",
	      			price 					: view[0].price,
	      			cost 					: view[0].cost,
	      			locale 					: view[0].locale, 
	      			purchase_description	: view[0].purchase_description,
	      			sale_description		: view[0].sale_description,
	      			income_account_id 		: view[0].income_account_id,
	      			cogs_account_id  		: view[0].cogs_account_id,
	      			favorite 				: view[0].favorite,
	      			is_pattern 				: 0,
	      			status 					: 1							
				});

				var obj = self.dataSource.at(0);				
				//Pattern
				// if(self.get("contact_type_id")>0){
				// 	obj.set("contact_type_id", self.get("contact_type_id"));
				// 	obj.set("abbr", "");
				// 	obj.set("is_pattern", 1);
				// }

				self.set("obj", obj);
				self.generateNumber();
      		});
      	},
		objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Contact Item has changes
		    	if(this.itemVendorDS.hasChanges() || this.itemCustomerDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					$.each(self.itemVendorDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			$.each(self.itemCustomerDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			if(data[0].is_pattern){
						self.savePattern(data[0].category_id, data[0].id);
					}
				}
				
      			self.itemVendorDS.sync();
      			self.itemCustomerDS.sync();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.itemVendorDS.cancelChanges();
			this.itemCustomerDS.cancelChanges();
			
			this.dataSource.data([]);
			this.itemVendorDS.data([]);
			this.itemCustomerDS.data([]);

			banhji.userManagement.removeMultiTask("item_service");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(!obj.is_system==1){
				this.deleteDS.query({
				  	filter: { field: "item_id", value: obj.id },
				  	page: 1,
				  	pageSize: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						obj.set("deleted", 1);
				        self.dataSource.sync();

				        window.history.back();				        
					}
				});
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.nonInventoryPart =  kendo.observable({
    	lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	patternDS 				: dataStore(apiUrl + "items"),
    	deleteDS 				: dataStore(apiUrl + "transactions/line"),
    	categoryDS 				: banhji.source.nonInventoryPartCategoryDS,
    	itemGroupDS 			: dataStore(apiUrl + "items/group"),
    	brandDS 	 			: dataStore(apiUrl + "brands"),    	   	   	
    	measurementDS			: dataStore(apiUrl + "measurements"),
    	numberDS 				: dataStore(apiUrl + "items"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	vendorDS 	 			: banhji.source.supplierDS,
    	customerDS 	 			: banhji.source.customerDS,
    	itemVendorDS 	 		: dataStore(apiUrl + "items/contact"),
    	itemCustomerDS 	 		: dataStore(apiUrl + "items/contact"),
    	inventoryAccountDS 		: banhji.source.inventoryAccountDS,
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		originalNo 				: "",
		isDuplicateNumber 		: false,    	
    	pageLoad 				: function(id, is_pattern){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Pattern
		setPattern 				: function(category_id){
			var obj = this.get("obj");

			obj.set("category_id", category_id);
			obj.set("is_pattern", 1);
		},
		savePattern 			: function(category_id, item_id){
			var data = banhji.itemSetting.categoryDS.get(category_id);
			data.set("item_id", item_id);
			banhji.itemSetting.categoryDS.sync();			
			window.history.back();
		},
		loadPattern 			: function(){
			var self = this, obj = self.get("obj");

			if(obj.category_id){
				var cat = this.categoryDS.get(obj.category_id);

				this.patternDS.query({
					filter: [
						{ field:"id", value: cat.item_id },
						{ field:"is_pattern", value: 1 }
					],
					page: 1,
					pageSize: 1
				}).then(function(){
					var view = self.patternDS.view();				

					if(view.length>0){
		      			obj.set("item_group_id", view[0].item_group_id),
		      			obj.set("brand_id", view[0].brand_id),
		      			obj.set("measurement_id", view[0].measurement_id),
		      			obj.set("abbr", cat.abbr),
		      			obj.set("number", ""),
		      			obj.set("name", ""),
		      			obj.set("purchase_description", view[0].purchase_description),
		      			obj.set("sale_description", view[0].sale_description),
		      			obj.set("measurements", view[0].measurements),
		      			obj.set("color_code", view[0].color_code),
		      			obj.set("international_code", view[0].international_code),
		      			obj.set("inventory_account_id", view[0].inventory_account_id),
		      			obj.set("favorite", view[0].favorite)
					}else{
		      			obj.set("item_group_id", ""),
		      			obj.set("brand_id", ""),
		      			obj.set("measurement_id", ""),
		      			obj.set("abbr", ""),
		      			obj.set("number", ""),
		      			obj.set("name", ""),
		      			obj.set("purchase_description", ""),
		      			obj.set("sale_description", ""),
		      			obj.set("measurements", ""),
		      			obj.set("color_code", ""),
		      			obj.set("international_code", ""),
		      			obj.set("inventory_account_id", ""),
		      			obj.set("favorite", false)
					}
				});
			}
		},
      	//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj"),
			originalNo = this.get("originalNo");			
			
			if(obj.number!=="" && obj.number!==originalNo){
				this.existingDS.query({
					filter: [
						{ field:"number", value: obj.number },
						{ field:"item_type_id", value: obj.item_type_id }
					],
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number","00001");
				}
			});
		},
		categoryChanges 		: function(){
			var obj = this.get("obj");

			if(obj.category_id){
				this.loadPattern();
				this.generateNumber();
			}
		},
      	//Item Contact
		loadItemContact			: function(){
    		var obj = this.get("obj");

			this.itemVendorDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "vendor" }
				],
				page: 1,
				pageSize: 100
			});

			this.itemCustomerDS.query({
				filter: [ 
					{ "field":"item_id", value: obj.id },
					{ "field":"type", value: "customer" }
				],
				page: 1,
				pageSize: 100
			});
		},
	    addEmptyItemVendor 		: function(){
			var obj = this.get("obj");
			
			this.itemVendorDS.add({
				item_id 	: obj.id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "vendor"
			});								
		},
		deleteItemVendor 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemVendorDS.getByUid(d.uid);

				this.itemVendorDS.remove(obj);
			}
		},
		addEmptyItemCustomer 	: function(){
			var obj = this.get("obj");

			this.itemCustomerDS.add({
				item_id 	: obj.id,					 			
				contact_id 	: "",
				code 		: "",      				
				type 		: "customer"
			});								
		},
		deleteItemCustomer 		: function(e){
			if (confirm("Are you sure, you want to delete it?")) {
				var d = e.data,
				obj = this.itemCustomerDS.getByUid(d.uid);

				this.itemCustomerDS.remove(obj);
			}
		},
		//Obj
		loadObj 				: function(id, is_pattern){
    		var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

    		this.dataSource.query({    			
				filter: para,
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.set("originalNo", view[0].number);
		    	self.loadItemContact();
			});
    	},    	   	
      	addEmpty 				: function(){
      		var self = this;

      		this.dataSource.data([]);
      		this.itemVendorDS.data([]);
	      	this.itemCustomerDS.data([]);

	      	this.set("isEdit", false);
      		this.set("obj", null);

      		this.patternDS.query({
      			filter:[
      				{ field:"id", value:2 },
      				{ field:"is_pattern", value:1 }
      			],
      			page:1,
      			pageSize:1
      		}).then(function(){
      			var view = self.patternDS.view(),
      			cat = self.categoryDS.at(0);

      			self.dataSource.insert(0, {				
					item_type_id 			: 2,//Non Inventory Part      			      			
	      			category_id 			: view[0].category_id,
	      			item_group_id 			: view[0].item_group_id,
	      			brand_id 				: view[0].brand_id,
	      			measurement_id			: view[0].measurement_id,
	      			abbr 					: cat.abbr,
	      			number 					: "",
	      			name 					: "",
	      			purchase_description	: view[0].purchase_description,
	      			sale_description		: view[0].sale_description,
	      			measurements 			: view[0].measurements,
	      			color_code 				: view[0].color_code,
	      			international_code 		: view[0].international_code,
	      			inventory_account_id 	: view[0].inventory_account_id,
	      			favorite 				: view[0].favorite,
	      			is_pattern 				: 0,
	      			status 					: 1,
	      			deleted 				: 0								
				});

				var obj = self.dataSource.at(0);
				self.set("obj", obj);
				self.generateNumber();
      		});
      	},
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Contact Item has changes
		    	if(this.itemVendorDS.hasChanges() || this.itemCustomerDS.hasChanges()){
		    		obj.set("dirty", true);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					$.each(self.itemVendorDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			$.each(self.itemCustomerDS.data(), function(index, value){
	      				value.set("item_id", data[0].id);
	      			});

	      			if(data[0].is_pattern){
						self.savePattern(data[0].category_id, data[0].id);
					}
				}
				
      			self.itemVendorDS.sync();
      			self.itemCustomerDS.sync();
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.itemVendorDS.cancelChanges();
			this.itemCustomerDS.cancelChanges();
			
			this.dataSource.data([]);
			this.itemVendorDS.data([]);
			this.itemCustomerDS.data([]);

			banhji.userManagement.removeMultiTask("item");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			if(!obj.is_system==1){
				this.deleteDS.query({
				  	filter: { field: "item_id", value: obj.id },
				  	page: 1,
				  	pageSize: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						obj.set("deleted", 1);
				        self.dataSource.sync();

				        window.history.back();				        
					}
				});
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.fixedAssets =  kendo.observable({
    	lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),
    	patternDS 				: dataStore(apiUrl + "items"),
    	deleteDS 				: dataStore(apiUrl + "transactions/line"),
    	categoryDS 				: banhji.source.fixedAssetCategoryDS,
    	measurementDS			: dataStore(apiUrl + "measurements"),
    	numberDS 				: dataStore(apiUrl + "items"),
    	existingDS 				: dataStore(apiUrl + "items"),
    	itemPriceDS 			: dataStore(apiUrl + "item_prices"),
    	fixedAssetAccountDS 	: banhji.source.fixedAssetAccountDS,
    	accumulatedAccountDS 	: banhji.source.accumulatedAccountDS,
    	deposalAccountDS 		: banhji.source.deposalAccountDS,
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		isDuplicateNumber 		: false,    	
    	pageLoad 				: function(id, is_pattern){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id, is_pattern);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
      	//Number      	
		checkExistingNumber 	: function(){
			var self = this, para = [], 
			obj = this.get("obj");
			
			if(obj.number!==""){

				if(this.get("isEdit")){
					para.push({ field:"id", operator:"where_not_in", value: [obj.id] });
				}

				para.push({ field:"abbr", value: obj.abbr });
				para.push({ field:"number", value: obj.number });
				para.push({ field:"category_id", value: obj.category_id });
				
				this.existingDS.query({
					filter: para,
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		generateNumber 			: function(){
			var self = this, obj = this.get("obj");

			this.numberDS.query({
				filter:[
					{ field:"category_id", value:obj.category_id }
				],
				sort: { field:"number", dir:"desc" },
				page:1,
				pageSize:1
			}).then(function(){
				var view = self.numberDS.view();

				if(view.length>0){
					var lastNo = kendo.parseInt(view[0].number);
					if(lastNo){
						lastNo++;
						obj.set("number",kendo.toString(lastNo, "00000"));
					}
				}else{
					obj.set("number","00001");
				}
			});
		},
		categoryChanges 		: function(){
			var obj = this.get("obj");

			if(obj.category_id){
				var cat = this.categoryDS.get(obj.category_id);

				obj.set("abbr", cat.abbr);
				
				this.generateNumber();
			}
		},
		//Obj
		loadObj 				: function(id, is_pattern){
    		var self = this, para = [];

			para.push({ field:"id", value: id });

			if(is_pattern){
				para.push({ field:"is_pattern", value: 1 });
			}

    		this.dataSource.query({    			
				filter: para,
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
			});
    	},    	   	
      	addEmpty 				: function(){
      		var self = this;
      		this.dataSource.data([]);
      		
	      	this.set("isEdit", false);
      		this.set("obj", null);

      		this.dataSource.insert(0, {				
				item_type_id 			: 3,//Fixed Assets      			      			
      			category_id 			: 0,
      			measurement_id			: 0,
      			abbr 					: "",
      			number 					: "",
      			name 					: "",
      			locale 					: banhji.locale,
      			purchase_description	: "",
      			sale_description		: "",
      			fixed_assets_account_id : 0,
      			accumulated_account_id 	: 0,
      			depreciation_account_id	: 0,
      			is_pattern 				: 0,
      			status 					: 1,
      			deleted 				: 0								
			});

			var obj = this.dataSource.at(0);
			this.set("obj", obj);
			this.generateNumber();
      	},
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");			

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){					
	      			
				}      			
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();			
			
			this.dataSource.data([]);			

			banhji.userManagement.removeMultiTask("fixed_assets");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);
			
			if(!obj.is_system==1){
				this.deleteDS.query({
				  	filter: { field: "item_id", value: obj.id },
				  	page: 1,
				  	pageSize: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						obj.set("deleted", 1);
				        self.dataSource.sync();

				        window.history.back();				        
					}
				});
			}	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
	banhji.txnItem =  kendo.observable({
    	lang 					: langVM,    	
    	dataSource 				: dataStore(apiUrl + "items"),    	
    	deleteDS 				: dataStore(apiUrl + "transactions/line"),
    	numberDS 				: dataStore(apiUrl + "items"),
    	existingDS 				: dataStore(apiUrl + "items"),    	
    	currencyDS 	 			: banhji.source.currencyDS,  	
    	accountDS 				: banhji.source.accountDS,   	
    	statusList 				: banhji.source.statusList,
    	confirmMessage 			: banhji.source.confirmMessage,
    	obj 	 				: null,
    	isEdit 					: false,
    	saveClose 				: false,
		showConfirm 			: false,
		originalName 				: "",
		isDuplicateNumber 		: false,
		user_id					: banhji.source.user_id,
    	pageLoad 				: function(id){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Number      	
		checkExistingName 	: function(){
			var self = this, para = [], 
			obj = this.get("obj"),
			originalName = this.get("originalName");			
			
			if(obj.name!=="" && obj.name!==originalName){
				this.existingDS.query({
					filter: [
						{ field:"name", value: obj.name },
						{ field:"category_id", value: obj.category_id }
					],
					page: 1,
					pageSize: 1
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},
		//Obj
    	loadObj 				: function(id){
    		var self = this;			

    		this.dataSource.query({    			
				filter: { field:"id", value: id },
				page:1,
				pageSize:1
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.set("originalName", view[0].name);
			});
    	},		
      	addEmpty 				: function(){      		
      		this.dataSource.data([]);

      		this.set("isEdit", false);      		
      		this.set("obj", null);

      		this.dataSource.insert(0, {
      			account_id 				: 0,
      			item_type_id 			: 5,//Transaction type
      			category_id 			: 4,
      			name 					: "",
      			purchase_description	: "",
      			sale_description		: "",
      			locale 					: banhji.locale,
      			status 					: 1
			});      		

			var obj = this.dataSource.at(0);			
      						
			this.set("obj", obj);			
      	},
      	objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Save Obj
			this.objSync()
			.then(function(data){ //Success				
				
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();						
			this.dataSource.data([]);
			
			banhji.userManagement.removeMultiTask("txn_item");
		},
		delete 					: function(){
			var self = this, obj = this.get("obj");
			this.set("showConfirm",false);

			this.deleteDS.query({
			  	filter: { field: "item_id", value: obj.id },
			  	page: 1,
			  	pageSize: 1
			}).then(function() {
				var view = self.deleteDS.view();

				if(view.length>0){
					alert("Sorry, you can not delete it because it is using now.");
				}else{
					obj.set("deleted", 1);
			        self.dataSource.sync();

			        window.history.back();				        
				}
			});	
		},
		openConfirm 			: function(){
			this.set("showConfirm", true);
		},
		closeConfirm 			: function(){
			this.set("showConfirm", false);
		}
    });
    banhji.itemAdjustment = kendo.observable({
    	lang 					: langVM,
    	dataSource  			: dataStore(apiUrl + "transactions"),	
    	lineDS  				: dataStore(apiUrl + "transactions/line"),
    	journalLineDS			: dataStore(apiUrl + "journal_lines"),	
		itemDS  				: dataStore(apiUrl + "items"),
		contactDS 				: banhji.source.employeeDS,
		accountDS 				: banhji.source.adjustmentAccountDS,		
		segmentItemDS			: banhji.source.segmentItemDS,
		categoryDS 				: banhji.source.inventoryCategoryDS,
		attachmentDS	 		: dataStore(apiUrl + "attachments"),
		jobDS					: dataStore(apiUrl + "jobs"),
		txnTemplateDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", value:"Adjustment" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		obj 					: null,
		isEdit 					: false,
		saveClose 				: false,
		savePrint 				: false,
		searchText 				: "",
		category_id 			: null,
		user_id					: banhji.source.user_id,
		pageLoad 				: function(id){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Upload
		onSelect 				: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 				: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 				: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
	    //Currency Rate
		setRate 				: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);					
		},
        //Segment        
        segmentChanges 			: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Search
		search 					: function(){
			var self = this,
			para = [],
			obj = this.get("obj"),			
			category_id = this.get("category_id"),
			searchText = this.get("searchText");        	

            if(searchText!==""){
				var textParts = searchText.replace(/([a-z]+)/i, "$1 ").split(/[^0-9a-z]+/ig);

				para.push(
					{ field:"abbr", value: textParts[0] },
					{ field:"number", value: textParts[1] }
				);
			}

			if(category_id>0){
				para.push({ field:"category_id", value:category_id });
			}

			// para.push({ field:"item_type_id", value:1 });
			para.push({ field:"is_catalog", value: 0 });
			para.push({ field:"is_assembly", value: 0 });          

            this.itemDS.query({
            	filter: para,
            	page: 1,
            	pageSize: 100
            }).then(function(data){
            	var view = self.itemDS.view();

            	$.each(view, function(index, value){
            		self.lineDS.add({
            			transaction_id 		: 0,
						item_id 			: value.id,
						measurement_id 		: value.measurement_id,						
						description 		: value.name,
						on_hand 			: value.on_hand,
						quantity_adjusted 	: "",				
						quantity 	 		: 0,
						rate				: banhji.source.getRate(value.locale, new Date(obj.issued_date)),
						locale				: value.locale,
						movement 			: 1				
            		});
            	});
            });

            this.set("searchText", "");
            this.set("category_id", null);
		},
		enterSearch 			: function(e){
			e.preventDefault();

			this.search();
		},
		onChange 				: function(e) {
      		var data = e.data;            
            
            if(data.quantity_adjusted){
            	var diff = data.quantity_adjusted - data.on_hand;

            	data.set("quantity", diff);         
		        
		        if(diff>0){
		        	data.set("movement", 1);
		        }else{
		        	data.set("movement", -1);
		        }
			}			
			
			var index = this.lineDS.indexOf(data);
			index++;
			var nextDataItem = this.lineDS.at(index);

			if(nextDataItem){
				$(".txt"+nextDataItem.uid).focus();
			}else{
				var firstRow = this.lineDS.at(0);
				$(".txt"+firstRow.uid).focus();
			}            
        },
		removeRow 				: function(e){						
			var d = e.data;				
			this.lineDS.remove(d);	        		        
		},
		//Obj
		loadObj 				: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id },
				page:1,
				pageSize:100
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);		    	
		    	self.journalLineDS.filter({ field:"transaction_id", value: id });
		    	self.lineDS.filter({ field:"transaction_id", value: id });
		    	self.lineDS.bind("requestEnd", function(e){
		    		if(e.type=="read"){
		    			var response = e.response.results;

		    			$.each(response, function(index, value){		    				
		    				var qty = value.quantity*value.movement;
		    				value.quantity = qty;
		    			});
		    		}
		    	});
			});
    	},
        addEmpty 		 		: function(){							
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);				
			
			this.dataSource.insert(0, {
				transaction_template_id : "",				
				employee_id 			: "",
				job_id 					: "",
				account_id 	 			: 0,
			   	type					: "Item_Adjustment",			   				   
			   	rate					: banhji.source.getRate(banhji.locale, new Date()),			   	
			   	locale 					: banhji.locale,			   	
			   	issued_date 			: new Date(),			   	
			   	memo 					: "",
			   	memo2 					: "",
			   	segments 				: [],
			   	is_journal 				: 1
	    	});		    		
			
			var obj = this.dataSource.at(0);	
			this.set("obj", obj);			
		},		
	    objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");

			//Remove empty row
			$.each(this.lineDS.view(), function(index, value){
		  		if(!value.quantity_adjusted){
		  			self.lineDS.remove(value);
		  		}
		  	});			

			// //Edit Mode
	  //   	if(this.get("isEdit")){
	  //   		//Line has changes
		 //    	if(this.lineDS.hasChanges()){
		 //    		obj.set("dirty", true);

		 //    		$.each(this.journalLineDS.data(), function(index, value){
			// 			value.set("deleted", 1);										
			// 		});

			// 		this.addJournal(obj.id);
		 //    	}
	  //   	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item Line
					$.each(self.lineDS.data(), function(index, value){						
	      				value.set("transaction_id", data[0].id);
	      				value.set("quantity", Math.abs(value.quantity));	      				
	      			});

	      			//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);    			
				}
				
      			self.lineDS.sync();
      			self.uploadFile();
      							
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.journalLineDS.cancelChanges();			
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);			

			banhji.userManagement.removeMultiTask("item_adjustment");
		},
		//Journal	        
	    addJournal 				: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),	    				    	
	    	inventoryList = {};			
			
			//Group accounts
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				accountID = item.inventory_account_id,
				itemRate = banhji.source.getRate(item.locale, new Date(obj.issued_date)),
				itemCost = value.quantity*(item.cost/itemRate);
				
				if(inventoryList[accountID]===undefined){
					inventoryList[accountID]={"id": accountID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
				}else{											
					if(inventoryList[accountID].id===accountID){
						inventoryList[accountID].amount += itemCost;
					}else{
						inventoryList[accountID]={"id": accountID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
					}
				}
			});//End Foreach Loop			

			//Start journal		
			if(!jQuery.isEmptyObject(inventoryList)){
				var gainLoss = 0;

				$.each(inventoryList, function(index, value){
					gainLoss += value.amount;

					if(value.amount>0){
						//Add +Positive Inventory On Dr
						self.journalLineDS.add({					
							transaction_id 		: transaction_id,
							account_id 			: value.id,				
							description 		: "",
							reference_no 		: "",
							segments 	 		: [],								
							dr 	 				: Math.abs(value.amount),
							cr 					: 0,				
							rate				: value.rate,
							locale				: value.locale
						});
					}else{						
						//Add -Negative Inventory On Cr
						self.journalLineDS.add({					
							transaction_id 		: transaction_id,
							account_id 			: value.id,				
							description 		: "",
							reference_no 		: "",
							segments 	 		: [],								
							dr 	 				: 0,
							cr 					: Math.abs(value.amount),				
							rate				: value.rate,
							locale				: value.locale
						});
					}								
				});

				//Add Gain Or Loss Account
				var dr = 0, cr = 0;
				if(gainLoss>0){					
					cr = Math.abs(gainLoss);
				}else{
					dr = Math.abs(gainLoss);
				}

				self.journalLineDS.add({					
					transaction_id 		: transaction_id,
					account_id 			: obj.account_id,			
					description 		: "",
					reference_no 		: "",
					segments 	 		: [],								
					dr 	 				: dr,
					cr 					: cr,				
					rate				: obj.rate,
					locale				: obj.locale
				});				
			}			

			this.journalLineDS.sync();
		}
	});
	banhji.internalUsage = kendo.observable({
    	lang 					: langVM,
    	dataSource  			: dataStore(apiUrl + "transactions"),	
    	lineDS  				: dataStore(apiUrl + "transactions/line"),
    	journalLineDS			: dataStore(apiUrl + "journal_lines"),	
		itemDS  				: banhji.source.itemDS,
		measurementDS			: dataStore(apiUrl + "measurements"),		
		segmentItemDS			: banhji.source.segmentItemDS,
		attachmentDS	 		: dataStore(apiUrl + "attachments"),
		jobDS					: dataStore(apiUrl + "jobs"),
		txnTemplateDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "transaction_templates",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter: { field: "type", operator:"where_in", value:["Transfer_In","Transfer_Out","Usage_Disposal"] },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		amtDueColor 			: banhji.source.amtDueColor,
	    confirmMessage 			: banhji.source.confirmMessage,
		frequencyList 			: banhji.source.frequencyList,
		monthOptionList 		: banhji.source.monthOptionList,
		monthList 				: banhji.source.monthList,
		weekDayList 			: banhji.source.weekDayList,
		dayList 				: banhji.source.dayList,
		showMonthOption 		: false,
		showMonth 				: false,
		showWeek 				: false,
		showDay 				: false,
		obj 					: null,
		isEdit 					: false,
		saveClose 				: false,
		savePrint 				: false,
		saveRecurring 			: false,
		showConfirm 			: false,
		total 					: 0,
		user_id					: banhji.source.user_id,
		pageLoad 				: function(id){			
			if(id){
				this.set("isEdit", true);						
				this.loadObj(id);
			}else{				
				if(this.get("isEdit") || this.dataSource.total()==0){
					this.addEmpty();
				}								
			}  																							
		},
		//Upload
		onSelect 				: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
	        // Check the extension of each file and abort the upload if it is not .jpg
	        $.each(files, function(index, value){
	            if (value.extension.toLowerCase() === ".jpg"
	            	|| value.extension.toLowerCase() === ".jpeg"
	            	|| value.extension.toLowerCase() === ".tiff"
	            	|| value.extension.toLowerCase() === ".png" 
	            	|| value.extension.toLowerCase() === ".gif"
	            	|| value.extension.toLowerCase() === ".pdf"){

	            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

	            	self.attachmentDS.add({
	            		user_id 		: self.get("user_id"),
	            		transaction_id 	: obj.id,
	            		type 			: "Transaction",
	            		name 			: value.name,
	            		description 	: "",
	            		key 			: key,
	            		url 			: banhji.s3 + key,
	            		size 			: value.size,
	            		created_at 		: new Date(),

	            		file 			: value.rawFile
	            	});	            			            		            
	            }else{
	            	alert("This type of file is not allowed to attach.");
	            }
	        });
	    },
	    removeFile 				: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    	}	    	
	    },
	    uploadFile 				: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
	    //Currency Rate
		setRate 				: function(){
			var obj = this.get("obj"), 
			rate = banhji.source.getRate(obj.locale, new Date(obj.issued_date));			
			
			obj.set("rate", rate);					
		},
        //Segment        
        segmentChanges 			: function(e) {
			var dataArr = this.get("obj").segments,
			lastIndex = dataArr.length - 1,
			last = this.segmentItemDS.get(dataArr[lastIndex]);
			
			if(dataArr.length > 1) {
				for(var i = 0; i < dataArr.length - 1; i++) {
					var current_index = dataArr[i],
					current = this.segmentItemDS.get(current_index);

					if(current.segment_id === last.segment_id) {
						dataArr.splice(lastIndex, 1);
						break;
					}
				}
			}				
		},
		//Item		
		itemChanges 			: function(e){								
			var self = this, 
			data = e.data,
			obj = this.get("obj"), 
			item = this.itemDS.get(data.item_id);

			if(data.item_id>0){
				var price = 0, rate = 1, measurement_id = item.measurement_id;

				if(item.item_type_id=="1" || item.item_type_id=="4"){
					if(item.item_prices.length>0){
						rate = obj.rate / banhji.source.getRate(item.item_prices[0].locale, new Date(obj.issued_date));
						price = item.item_prices[0].price*rate;
						measurement_id = item.item_prices[0].measurement_id;
					}
				}

		        if(item.is_catalog=="1"){
		        	var catalogList = [];
		        	$.each(item.catalogs, function(index, value){
		        		catalogList.push(value);
		        	});
		        	
		        	this.catalogDS.query({
		        		filter: { field:"id", operator:"where_in", value:catalogList },
		        		page:1,
		        		pageSize:100
		        	}).then(function(){
		        		self.lineDS.remove(data);

		        		$.each(self.catalogDS.view(), function(index, value){										
							self.lineDS.add({					
								transaction_id 		: obj.id,
								tax_item_id 		: 0,
								item_id 			: value.id,
								measurement_id 		: value.item_prices[0].measurement_id,								
								description 		: value.sale_description,				
								quantity 	 		: 1,
								price 				: value.item_prices[0].price*rate,												
								amount 				: value.item_prices[0].price*rate,
								discount 			: 0,
								rate				: obj.rate / banhji.source.getRate(value.item_prices[0].locale, new Date(obj.issued_date)),
								locale				: obj.locale,
								movement 			: -1,								

								item_prices 		: value.item_prices
							});								
		        		});

		        		self.changes();
		        	});
		        }else if(item.is_assembly=="1"){
		        	data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);	    		
			        data.set("price", price);
			       	data.set("item_prices", []);

			        this.changes();		     
		        }else{	        	
		    		data.set("measurement_id", measurement_id);
		    		data.set("description", item.sale_description);
		    		data.set("quantity", 1);	    		
			        data.set("price", price);
			        data.set("item_prices", item.item_prices);			        

			        this.changes();
		    	}
	        }                	        	
		},		
		changes 				: function(e) {
      		var data = e.data;            
            
            if(data.quantity_adjusted){
            	var diff = data.quantity_adjusted - data.on_hand;

            	data.set("quantity", diff);         
		        
		        if(diff>0){
		        	data.set("movement", 1);
		        }else{
		        	data.set("movement", -1);
		        }
			}			
			
			var index = this.lineDS.indexOf(data);
			index++;
			var nextDataItem = this.lineDS.at(index);

			if(nextDataItem){
				$(".txt"+nextDataItem.uid).focus();
			}else{
				var firstRow = this.lineDS.at(0);
				$(".txt"+firstRow.uid).focus();
			}            
        },
		removeRow 				: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
			}	        		        
		},
		//Obj
		loadObj 				: function(id){
    		var self = this;

    		this.dataSource.query({    			
				filter: { field:"id", value: id },
				page:1,
				pageSize:100
			}).then(function(e){
				var view = self.dataSource.view();
						    	
		    	self.set("obj", view[0]);
		    	self.set("total", kendo.toString(view[0].amount, "n0"));
		    			    	
		    	self.journalLineDS.filter({ field:"transaction_id", value: id });
		    	self.lineDS.filter({ field:"transaction_id", value: id });
			});
    	},
		changes					: function(){
			var self = this, 
			obj = this.get("obj"),
			total = 0;											

			$.each(this.lineDS.data(), function(index, value) {				
				total += value.quantity;
	        });
	        
	        this.set("total", kendo.toString(total, "n"));
			obj.set("amount", total);
		},					
		addEmpty 		 		: function(){
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);

			this.set("isEdit", false);
			this.set("obj", null);
			this.set("total", 0);					

			this.dataSource.insert(0, {
				transaction_template_id : 0,
				recurring_id 		: "",
				item_id 			: "",
				job_id 				: 0,				
				user_id 			: this.get("user_id"),
			   	type				: "Internal_Usage",//Required
			   	amount				: 0,
			   	rate				: 1,			   	
			   	locale 				: banhji.locale,			   	
			   	issued_date 		: new Date(),
			   	bill_to 			: "",
			   	ship_to 			: "",
			   	memo 				: "",
			   	memo2 				: "",
			   	status 				: 0,
			   	segments 			: [],
			   	is_journal 			: 1,
			   	//Recurring
			   	recurring_name 		: "",
			   	start_date 			: new Date(),
			   	frequency 			: "Daily",
			   	month_option 		: "Day",
			   	interval 			: 1,
			   	day 				: 1,
			   	week 				: 0,
			   	month 				: 0,
			   	is_recurring 		: 0				
	    	});		    		
			
			var obj = this.dataSource.at(0);		
			this.set("obj", obj);

			this.setRate();	
			this.addRow();
		},
		addRow 					: function(){				
			var obj = this.get("obj");
									
			this.lineDS.add({					
				transaction_id 		: obj.id,
				tax_item_id 		: "",
				item_id 			: "",				
				measurement_id 		: 0,				
				description 		: "",				
				quantity 	 		: 1,
				cost 				: 0,
				price 				: 0,												
				amount 				: 0,
				discount 			: 0,
				rate				: obj.rate,
				locale				: obj.locale,							
				movement 			: -1
			});																	
		},		
		removeRow 				: function(e){						
			var data = e.data;
			if(this.lineDS.total()>1){				
				this.lineDS.remove(data);
		        this.changes();
	        }		        
		},		
	    objSync 				: function(){
	    	var dfd = $.Deferred();	        

	    	this.dataSource.sync();
		    this.dataSource.bind("requestEnd", function(e){
		    	if(e.response){				
					dfd.resolve(e.response.results);
				}				  				
		    });
		    this.dataSource.bind("error", function(e){		    		    	
				dfd.reject(e.errorThrown);    				
		    });

		    return dfd;	    		    	
	    },			
		save 					: function(){			
			var self = this, obj = this.get("obj");					

			//Edit Mode
	    	if(this.get("isEdit")){
	    		//Line has changes
		    	if(this.lineDS.hasChanges()){
		    		obj.set("dirty", true);

		    		$.each(this.journalLineDS.data(), function(index, value){
						value.set("deleted", 1);										
					});

					this.addJournal(obj.id);
		    	}
	    	}

			//Save Obj
			this.objSync()
			.then(function(data){ //Success												
				if(self.get("isEdit")==false){
					//Item Line
					$.each(self.lineDS.data(), function(index, value){						
	      				value.set("transaction_id", data[0].id);
	      			});

	      			//Attachment
					$.each(self.attachmentDS.data(), function(index, value){
			    		value.set("transaction_id", data[0].id);
		            });

		            //Journal
		            self.addJournal(data[0].id);    			
				}
				
      			self.lineDS.sync();
      			self.uploadFile();
      							
				return data;
			}, function(reason) { //Error
				$("#ntf1").data("kendoNotification").error(reason);
			}).then(function(result){				
				$("#ntf1").data("kendoNotification").success(banhji.source.successMessage);

				if(self.get("saveClose")){
					//Save Close					
					self.set("saveClose", false);
					self.cancel();
					window.history.back();
				}else if(self.get("savePrint")){
					//Save Print					
					self.set("savePrint", false);
					self.cancel();
					banhji.router.navigate("/invoice_form/"+result[0].id);
				}else{
					//Save New
					self.addEmpty();
				}
			});
		},
		cancel 					: function(){
			this.dataSource.cancelChanges();
			this.lineDS.cancelChanges();
			this.journalLineDS.cancelChanges();
			this.attachmentDS.cancelChanges();			
			
			this.dataSource.data([]);
			this.lineDS.data([]);
			this.journalLineDS.data([]);
			this.attachmentDS.data([]);		

			banhji.userManagement.removeMultiTask("internal_usage");
		},
		//Journal	        
	    addJournal 				: function(transaction_id){
	    	var self = this,
	    	obj = this.get("obj"),
	    	total = 0,	    				    	
	    	inventoryList = {};			
			
			//Group accounts
			$.each(this.lineDS.data(), function(index, value){										
				var item = self.itemDS.get(value.item_id),
				accountID = item.inventory_account_id,
				itemRate = banhji.source.getRate(item.locale, new Date(obj.issued_date)),
				itemCost = value.quantity*(item.cost/itemRate);
				
				total += itemCost;

				if(inventoryList[accountID]===undefined){
					inventoryList[accountID]={"id": accountID, "amount": itemCost, "rate": itemRate, "locale": item.locale};						
				}else{											
					if(inventoryList[accountID].id===accountID){
						inventoryList[accountID].amount += itemCost;
					}else{
						inventoryList[accountID]={"id": accountID, "amount": itemCost, "rate": itemRate, "locale": item.locale};
					}
				}
			});//End Foreach Loop			

			//Start journal
			//Add To item's account on Dr
			var itemTo = this.itemDS.get(obj.item_id);
			this.journalLineDS.add({					
				transaction_id 		: transaction_id,
				account_id 			: itemTo.inventory_account_id,				
				description 		: "",
				reference_no 		: "",
				segments 	 		: [],								
				dr 	 				: total,
				cr 					: 0,				
				rate				: obj.rate,
				locale				: obj.locale
			});

			if(!jQuery.isEmptyObject(inventoryList)){
				$.each(inventoryList, function(index, value){										
					//Add From item's account on Cr
					self.journalLineDS.add({					
						transaction_id 		: transaction_id,
						account_id 			: value.id,				
						description 		: "",
						reference_no 		: "",
						segments 	 		: [],								
						dr 	 				: 0,
						cr 					: value.amount,				
						rate				: value.rate,
						locale				: value.locale
					});							
				});	
			}			

			this.journalLineDS.sync();
		}
	});
	banhji.itemSetting =  kendo.observable({
		lang 				: langVM,
		itemTypeDS 			: banhji.source.itemTypeDS,		        
        categoryDS 			: dataStore(apiUrl + "categories"),        
        itemGroupDS 		: dataStore(apiUrl + "items/group"),        
        measurementDS		: dataStore(apiUrl + "measurements"),
        brandDS 			: dataStore(apiUrl + "brands"),
        category_code 		: "",
        category_name 		: "",
        category_abbr 		: "",
        category_item_type_id : 1,
        item_group_category_id : 0,       
        item_group_code 	: "",
        item_group_name 	: "",
        item_group_abbr 	: "",        
        measurement_name 	: "",        
        brand_code 			: "",
        brand_name 			: "",
        brand_abbr 			: "",        
        pageLoad 			: function() {
        },        
        addCategory 		: function(){
        	var self = this, 
        	name = this.get("category_name"),
        	abbr = this.get("category_abbr");

        	if(name!=="" && abbr!==""){        		
	        	this.categoryDS.add({	        		
	        		sub_of 		 	: 0,
	        		item_type_id 	: this.get("category_item_type_id"),
	        		item_id 		: 0,
	        		code 			: "",	        		
	        		name 			: name,
	        		abbr 			: abbr,	        		
	        		is_system 		: 0,
	        		item_type 		: []
	        	});

	        	this.categoryDS.sync();
    			this.set("category_name", "");
    			this.set("category_abbr", "");
        	}else{
        		alert("required abbr and name!");
        	}
        },
        addItemGroup 		: function(){
        	var self = this, 
        	category_id = this.get("item_group_category_id"),
        	name = this.get("item_group_name"),
        	abbr = this.get("item_group_abbr");

        	if(category_id>0 && name!=="" && abbr!==""){        		
	        	this.itemGroupDS.add({	        		
	        		category_id	 	: category_id,
	        		sub_of 		 	: 0,
	        		code 			: "",	        		
	        		name 			: name,
	        		abbr 			: abbr,	        		
	        		is_system 		: 0,

	        		category 		: [{name:""}]
	        	});

	        	this.itemGroupDS.sync();
	        	
    			self.set("item_group_category_id", 0);    			
    			self.set("item_group_code", "");
    			self.set("item_group_name", "");
    			self.set("item_group_abbr", "");	        		
        	}else{
        		alert("required category, abbr, and name!");
        	}
        },
        addMeasurement 		: function(){
        	var self = this, 
        	name = this.get("measurement_name");

        	if(name!==""){
	        	this.measurementDS.add({	        		
	        		name 		: name,
	        		description : name,
	        		is_system 	: 0
	        	});

	        	this.measurementDS.sync();
	        		        			
	        	this.set("measurement_name", "");	        		
        	}else{
        		alert("required name");
        	}
        },
        addBrand 		: function(){
        	var self = this, 
        	code = this.get("brand_code"),
        	name = this.get("brand_name");

        	if(name!=="" && code!==""){
	        	this.brandDS.add({
	        		sub_of 		: this.get("brand_sub_of"),
	        		code 		: code,        		
	        		name 		: name,
	        		abbr 		: this.get("brand_abbr")
	        	});

	        	this.brandDS.sync();	        	    			
	        			
    			this.set("brand_code", "");
    			this.set("brand_name", "");
    			this.set("brand_abbr", "");	        		
        	}else{
        		alert("required number and name!");
        	}
        },
        goPattern 	: function(e){
        	var data = e.data;        	        	

        	if(kendo.parseInt(data.item_id)>0){
        		if(data.item_type_id==1){        		        	
	        		banhji.router.navigate('/item/'+data.item_id+'/1');
	        	
	        	}else{
	        		banhji.router.navigate('/non_inventory_part/'+data.item_id+'/1');
	        	}   	
        	}else{
        		if(data.item_type_id==1){        		        	
	        		banhji.router.navigate('/item');
	        		banhji.item.setPattern(data.id);

	        	}else if(data.item_type_id==3){        		        	
	        		banhji.router.navigate('/fixed_assets');
	        		banhji.item.setPattern(data.id);

	        	}else if(data.item_type_id==5){        		        	
	        		banhji.router.navigate('/item_service');
	        		banhji.item.setPattern(data.id);

	        	}else{
	        		banhji.router.navigate('/non_inventory_part');
	        		banhji.nonInventoryPart.setPattern(data.id);
	        	}        		
        	}
        } 
    });
    banhji.serviceSetting =  kendo.observable({
		lang 				: langVM,		        
        categoryDS 			: dataStore(apiUrl + "categories"),        
        itemGroupDS 		: dataStore(apiUrl + "items/group"),        
        measurementDS		: dataStore(apiUrl + "measurements"),        
        itemTypeDS 			: dataStore(apiUrl + "item_types"),        
        category_code 		: "",
        category_name 		: "",
        category_abbr 		: "",
        category_item_type_id : 4,
        item_group_category_id : 0,       
        item_group_code 	: "",
        item_group_name 	: "",
        item_group_abbr 	: "",        
        measurement_name 	: "",        
        pageLoad 			: function() {
        	
        },        
        addCategory 		: function(){
        	var self = this, 
        	name = this.get("category_name"),
        	code = this.get("category_code");

        	if(name!=="" && code!==""){        		
	        	this.categoryDS.add({	        		
	        		sub_of 		 	: 0,
	        		item_type_id 	: this.get("category_item_type_id"),
	        		item_id 		: 0,
	        		code 			: code,	        		
	        		name 			: name,
	        		abbr 			: this.get("category_abbr"),	        		
	        		is_system 		: 0,
	        		item_type 		: []
	        	});

	        	this.categoryDS.sync();
	        	this.set("category_code", "");
    			this.set("category_name", "");
    			this.set("category_abbr", "");
        	}else{
        		alert("required number and name!");
        	}
        },
        addItemGroup 		: function(){
        	var self = this, 
        	category_id = this.get("item_group_category_id"),
        	name = this.get("item_group_name"),
        	code = this.get("item_group_code");

        	if(category_id>0 && name!=="" && code!==""){        		
	        	this.itemGroupDS.add({	        		
	        		category_id	 	: category_id,
	        		sub_of 		 	: 0,
	        		code 			: code,	        		
	        		name 			: name,
	        		abbr 			: this.get("item_group_abbr"),	        		
	        		is_system 		: 0
	        	});

	        	this.itemGroupDS.sync();
	        	
    			self.set("item_group_category_id", 0);    			
    			self.set("item_group_code", "");
    			self.set("item_group_name", "");
    			self.set("item_group_abbr", "");	        		
        	}else{
        		alert("required category, number, and name!");
        	}
        },
        addMeasurement 		: function(){
        	var self = this, 
        	name = this.get("measurement_name");

        	if(name!==""){
	        	this.measurementDS.add({	        		
	        		name 		: name,
	        		description : name,
	        		is_system 	: 0
	        	});

	        	this.measurementDS.sync();
	        		        			
	        	this.set("measurement_name", "");	        		
        	}else{
        		alert("required name");
        	}
        },        
        goPattern 	: function(e){
        	var data = e.data;        	

        	if(kendo.parseInt(data.item_id)>0){        		       		        	
	        	banhji.router.navigate('/item_service/'+data.item_id+'/1');	        		
        	}else{        		       		        	
	        	banhji.router.navigate('/item_service');	        	   		
        		banhji.item.setPattern(data.id);
        	}
        } 
    });
    banhji.itemReportCenter = kendo.observable({
		lang 				: langVM,
		summaryDS 			: dataStore(apiUrl + "dashboards/inventory_report"),				
		graphDS  			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "dashboards/item_monthly_purchase_sale",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			sort: {
                field: "month",
                dir: "asc"
            },								
			batch: true,			
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			pageSize: 100
		}),					
		pageLoad 			: function(){
			var self = this,
			today = new Date(),			        	
			start = kendo.toString(banhji.source.getFiscalDate(), "yyyy-MM-dd"),
			end = kendo.toString(today, "yyyy-MM-dd");
			console.log("akjdsflksj");
			this.summaryDS.query({
				filter: [
					{ field:"issued_date >=", value: start },
					{ field:"issued_date <=", value: end }
				],								
				page: 1,
				pageSize: 5
			}).then(function(){
				var view = self.summaryDS.view();
			
				self.set("inventoryTurnOver", kendo.toString(view[0].inventoryTurnOver, "n2"));				
				self.set("grossProfitMargin", kendo.toString(view[0].grossProfitMargin, "p"));

				self.set("inventoryBalance", kendo.toString(view[0].inventoryBalance, banhji.locale=="km-KH"?"c0":"c", banhji.locale));
			});
		}
	});
	banhji.inventoryPositionSummary = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/position_summary"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventoryPositionSummary.dataSource.filter({
				logic: banhji.inventoryPositionSummary.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventoryPositionSummary.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		},
		// excel  : function(){
		// 	var workbook = new kendo.ooxml.Workbook({
		// 		dataSource : this.dataSource
		// 		column: [
		// 			{field: "item", title: "Item Name"}
		// 		],
		// 	});
		// 	kendo.saveAs({
		//     dataURI: workbook.toDataURL(),
		//     fileName: "Test.xlsx"
		// 	});
		// }
	});
	banhji.inventoryPositionDetail = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/position_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventoryPositionDetail.dataSource.filter({
				logic: banhji.inventoryPositionDetail.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventoryPositionDetail.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.inventorySaleItemAnalysis = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/item_sale"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventorySaleItemAnalysis.dataSource.filter({
				logic: banhji.inventorySaleItemAnalysis.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventorySaleItemAnalysis.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.inventoryTurnoverList = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/item_turnover"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventoryTurnoverList.dataSource.filter({
				logic: banhji.inventoryTurnoverList.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventoryTurnoverList.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.inventoryMovementSummary = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/movement_summary"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventoryMovementSummary.dataSource.filter({
				logic: banhji.inventoryMovementSummary.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventoryMovementSummary.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		}
	});
	banhji.inventoryMovementDetail = kendo.observable({
		dataSource 		: dataStore(apiUrl + "itemReports/movement_detail"),
		filterDB	 		: [
			{id: 'customer', name: 'Customer'},
			{id: 'segment', name: 'Segment'}
		],
		filteredBy          : "customer",
		sortDB 				: [
			{id: 'date', name: 'Date'}
		],
		search 	: function() {

			banhji.inventoryMovementDetail.dataSource.filter({
				logic: banhji.inventoryMovementDetail.get('filteredBy'),
				filters: [			
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		}, 
		filterChange  : function(e){
			banhji.inventoryMovementDetail.set("filteredBy", e.sender.dataSource.at(e.sender.selectedIndex-1).id);
		},
	});
	banhji.inventorySale = kendo.observable({
		institute 			: banhji.institute,
		lang 				: langVM,
		locale 				: banhji.locale,
		statementDB 		: dataStore(apiUrl + "sales/statement"),	
		count 				: 0,
		total_avg 			: 0,
		saleNumber 			: 0,
		gpm 				: 0,
		total_sale 			: 0,
		companyName 		: null,
		startDate 			: "<?php echo date("d-m-y"); ?>",
		endDate				: "<?php echo date("d-m-y"); ?>",
		sorter				: '',
		openInvoice 		: 0,
		company 			: banhji.institute,		
		sortList			: banhji.source.sortList, 
		//line to sale summary
		inventoryPositionSummary         : banhji.inventoryPositionSummary,
		inventoryPositionDetail 		 : banhji.inventoryPositionDetail,
		inventorySaleDB		 			 : banhji.inventorySaleItemAnalysis,
		inventoryTurnoverList		 	 : banhji.inventoryTurnoverList,
		inventoryMovementSummary		 : banhji.inventoryMovementSummary,
		inventoryMovementDetail		 	: banhji.inventoryMovementDetail,
		// search button
		saleDetailSearch 	: function() {
			this.detailSale.filter({
				logic: 'segment',
				filters: [
					{field: "id", "operator": "segment", value: 9},
					{field: "issued_date >=", value: kendo.toString(this.startDate, "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(this.endDate, "yyyy-MM-dd")}
				]
			});
		},
		trnxSearch 			: function() {},
		depositDetailSearch : function() {},
		summaryProductSearch: function() {},
		detailProductSearch : function() {},
		saleJobSearch 		: function() {},
		saleOrderSearch 	: function() {},
		balanaceSearch 		: function() {},
		balanceDetailSearch : function() {},
		agingSummarySearch  : function() {},
		agingDetailSearch   : function() {},
		collectingInvSearch : function() {},
		collectedInvSearch  : function() {},
		invoiceListSearch 	: function() {},
		customerListSearch 	: function() {},
		dateMax 			: function(e) {
			$('#edate').css('width', '160px');
			var edate = $('#edate').kendoDatePicker().data("kendoDatePicker");
			edate.min(e.sender.value());
		},
		dateMin 			: function(e) {
			$('#sdate').css('width', '160px');
			var sdate = $('#sdate').kendoDatePicker().data("kendoDatePicker");
			sdate.max(e.sender.value());
		},
		printGrid			: function() {
			var gridElement = $('#grid'),
		        printableContent = '',
		        win = window.open('', '', 'width=900, height=700'),
		        doc = win.document.open();
		    var htmlStart =
		            '<!DOCTYPE html>' +
		            '<html>' +
		            '<head>' +
		            '<meta charset="utf-8" />' +
		            '<title></title>' +
		            '<link href="http://kendo.cdn.telerik.com/' + kendo.version + '/styles/kendo.common.min.css" rel="stylesheet" />'+
		            '<link rel="stylesheet" href="<?php echo base_url(); ?>assets/bootstrap.css">' +
		            '<link href="https://fonts.googleapis.com/css?family=Content:400,700" rel="stylesheet" type="text/css">' +
		            '<link href="<?php echo base_url(); ?>assets/responsive.css" rel="stylesheet" >' +
		            '<link href="https://fonts.googleapis.com/css?family=Moul" rel="stylesheet">' +
		            '<style>' +
		            '*{  } html { font: 11pt sans-serif; }' +
		            '.k-grid { border-top-width: 0; }' +
		            '.k-grid, .k-grid-content { height: auto !important; }' +
		            '.k-grid-content { overflow: visible !important; }' +
		            'div.k-grid table { table-layout: auto; width: 100% !important; }' +
		            '.k-grid .k-grid-header th { border-top: 1px solid; }' +
		            '.k-grid-toolbar, .k-grid-pager > .k-link { display: none; }' +
		            '</style><style type="text/css" media="print"> @page { size: landscape; margin:0mm; } .saleSummaryCustomer .total-customer, .saleSummaryCustomer .total-sale { background-color: #DDEBF7!important; -webkit-print-color-adjust:exact; }.saleSummaryCustomer .table.table-borderless.table-condensed  tr th { background-color: #1E4E78!important;-webkit-print-color-adjust:exact;}.saleSummaryCustomer .table.table-borderless.table-condensed  tr th span{ color: #fff!important; }.saleSummaryCustomer .table.table-borderless.table-condensed tr:nth-child(2n+1) td {  background-color: #fff!important; -webkit-print-color-adjust:exact;} .saleSummaryCustomer .table.table-borderless.table-condensed tr td { background-color: #F2F2F2!important;-webkit-print-color-adjust:exact; } </style>' +
		            '</head>' +
		            '<body><div id="example" class="k-content saleSummaryCustomer" style="padding: 30px;">';
		    var htmlEnd =
		            '</div></body>' +
		            '</html>';
		    
		    printableContent = $('#invFormContent').html();
		    doc.write(htmlStart + printableContent + htmlEnd);
		    doc.close();
		    setTimeout(function(){
		    	win.print();
		    	win.close();
		    },2000);
		},
		dateChange 			: function(){
			// var strDate = "";

			// 	if(this.startDate && this.endDate){
			// 		strDate = "From " + kendo.toString(this.startDate, "dd-MM-yyyy") + " To " + kendo.toString(this.endDate, "dd-MM-yyyy");
			// 	}else if(this.startDate){
			// 		strDate = "On " + kendo.toString(this.startDate,"dd-MM-yyyy");
			// 	}else if(this.endDate){
			// 		strDate = "As Of " + kendo.toString(this.endDate,"dd-MM-yyyy");
			// 	}else{
			// 		strDate = "";
			// 	}

			var today = new Date(),
			day = today.getDate();
        	sdate = "",
        	edate = "",
        	value = this.get('sorter');

			switch(value){
			case "today":
				sdate = today;

			  	break;
			case "week":
				var first = new Date(today.getTime() - 60*60*24* day*1000),
				last = new Date(today.getTime() + 60*60*24* day*1000);

				sdate = first;
				edate = last;

			  	break;
			case "month":
				var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
				edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

			  	break;
			case "year":
			  	var sdate = new Date(today.getFullYear(), 0, 1),
			  	edate = new Date(today.getFullYear(), 11, 31);

			  	break;
			default:

			}

			this.set("startDate", sdate);
			this.set("endDate", edate);
			// start.value(sdate);
			// end.value(edate);

			// start.max(end.value());
   //      	end.min(start.value());

   //      	dateChanges();
   //          });

   //          start.max(end.value());
   //          end.min(start.value());
		}

	});
    banhji.inventoryList =  kendo.observable({
		lang 				: langVM,    	
    	dataSource 			: dataStore(apiUrl + "items"),
    	categoryDS 			: dataStore(apiUrl + "categories"),
    	itemGroupDS 		: dataStore(apiUrl + "items/group"),    	
    	contactDS  			: dataStore(apiUrl + "contacts"),
    	vendorDS  			: dataStore(apiUrl + "contacts"),
    	    	
    	searchField			: "",
    	category_id 		: 0,
    	item_group_id 		: 0,     	
    	
    	pageLoad 			: function(){    		
    		
    	},
    	search 				: function(){
    		var para = [],
    		searchField = this.get("searchField"),
    		category_id = this.get("category_id"),
    		item_group_id = this.get("item_group_id");

    		if(searchField!==""){
    			para.push(      				
      				{ field: "number", operator: "like", value: searchField },
      				{ field: "name", operator: "or_like", value: searchField }
      			);
    		}

    		if(item_group_id>0){
    			para.push({ field:"item_group_id", value:item_group_id });
    		}else if(category_id>0){
    			para.push({ field:"category_id", value:category_id });
    		}

    		this.dataSource.filter(para);    		
    	},
    	searchFavorite 	: function(){
    		this.dataSource.filter({ field:"favorite", value: 1 });
    	},    	
    	vendorChanges 	: function(e){    		
    		var index = e.sender.select().index();
    		var data = this.vendorDS.at(index);    		
    		
    		this.dataSource.filter({ field:"contact_id", operator:"by_vendor", value:data.id });
    	}    		
    });
    banhji.inventoryPurchaseByVendorSummary =  kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items/purchase_by_vendor_summary",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "amount", dir: "desc" },
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),
    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
    	pageLoad 			: function(id){
		},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":								
				this.set("sdate", today);
				this.set("edate", "");
							  					
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));				

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":							  	
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":				
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");					  
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });            	          	            	
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }          

            this.dataSource.filter(para);
		}
    });
    banhji.inventoryPurchaseByVendorDetail = kendo.observable({
    	lang 				: langVM,    	    	    	
    	dataSource 			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "items/purchase_by_vendor_detail",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							limit: options.pageSize,
							page: options.page,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			sort: { field: "issued_date", dir: "asc" },			
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			batch: true,
			serverFiltering: true			
		}),
    	sortList			: [ 
	 		{ text:"All", value: "all" }, 
	 		{ text:"Today",	value: "today" }, 
	 		{ text:"This Week", value: "week" }, 
	 		{ text:"This Month", value: "month" }, 
	 		{ text:"This Year", value: "year" } 
		],
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
    	pageLoad 			: function(id){},
		sorterChanges 		: function(){
			var value = this.get("sorter"),
			today = new Date();

			switch(value){
			case "today":
				this.set("sdate", today);
				this.set("edate", "");
			  	break;
			case "week":			  	
				var first = today.getDate() - today.getDay(),
				last = first + 6;

				var firstDayOfWeek = new Date(today.setDate(first)),
				lastDayOfWeek = new Date(today.setDate(last));

				this.set("sdate", firstDayOfWeek);
				this.set("edate", lastDayOfWeek);
				
			  	break;
			case "month":
				var firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1),
				lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

				this.set("sdate", firstDayOfMonth);
				this.set("edate", lastDayOfMonth);

			  	break;
			case "year":
			  	var firstDayOfYear = new Date(today.getFullYear(), 0, 1),
			  	lastDayOfYear = new Date(today.getFullYear(), 11, 31);

				this.set("sdate", firstDayOfYear);
				this.set("edate", lastDayOfYear);

			  	break;
			default:
				this.set("sdate", "");
				this.set("edate", "");
			}
		},		
		strDate 			: function(){
			var strDate = "",
			sdate = this.get("sdate"),
			edate = this.get("edate");

			if(sdate && edate){
				strDate = "From " + kendo.toString(new Date(sdate), "dd-MM-yyyy") + " To " + kendo.toString(new Date(edate), "dd-MM-yyyy");
			}else if(sdate){
				strDate = "On " + kendo.toString(new Date(sdate),"dd-MM-yyyy");
			}else if(edate){
				strDate = "As Of " + kendo.toString(new Date(edate),"dd-MM-yyyy");
			}else{
				strDate = "";
			}

			return strDate;
		},
		search 				: function(){
			var self = this,
			para = [], 
			start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"), 
			end = kendo.toString(this.get("edate"), "yyyy-MM-dd");

        	//Dates
        	if(start && end){        		
            	para.push({ field:"issued_date >=", value: start });
            	para.push({ field:"issued_date <=", value: end });
            }else if(start){
            	para.push({ field:"issued_date", value: start });
            }else if(end){
            	para.push({ field:"issued_date <=", value: end });
            }else{
            	
            }
            this.dataSource.filter(para);
		}
    });



    /*************************
	*	Water Section   	* 
	**************************/
    banhji.waterCenter = kendo.observable({
		lang 				: langVM,
		transactionDS  		: dataStore(apiUrl + 'transactions'),
		contactDS			: new kendo.data.DataSource({
			transport: {
				read 	: {
					url: apiUrl + "contacts",
					type: "GET",
					headers: banhji.header,
					dataType: 'json'
				},				
				parameterMap: function(options, operation) {
					if(operation === 'read') {
						return {
							page: options.page,
							limit: options.pageSize,
							filter: options.filter,
							sort: options.sort
						};
					} else {
						return {models: kendo.stringify(options.models)};
					}
				}
			},
			schema 	: {
				model: {
					id: 'id'
				},
				data: 'results',
				total: 'count'
			},
			filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:1 },
			sort:{ field:"number", dir:"asc" },
			batch: true,
			serverFiltering: true,
			serverSorting: true,
			serverPaging: true,
			page:1,
			pageSize: 100
		}),
		contactTypeDS  		: banhji.source.customerTypeDS,
		noteDS 				: dataStore(apiUrl + 'notes'),
		attachmentDS	 	: dataStore(apiUrl + "attachments"),
		currencyDS  		: banhji.source.currencyDS,
		summaryDS 			: dataStore(apiUrl + "transactions"),
		sortList			: banhji.source.sortList,
		sorter 				: "all",
		sdate 				: "",
		edate 				: "",
		obj 				: {id:0},
		note 				: "",
		searchText 			: "",
		contact_type_id 	: null,
		currency_id 		: 0,
		balance 			: 0,
		deposit 			: 0,
		outInvoice 			: 0,
		overInvoice 		: 0,
		currencyCode 		: "",
		user_id 			: banhji.source.user_id,
		pageLoad 			: function(id){
			if(id){
				this.loadObj(id);
			}

			//Refresh
			if(this.contactDS.total()>0){
				this.contactDS.fetch();
				this.searchTransaction();
				this.loadSummary();
			}
		},
		sorterChanges 		: function(){
	        var today = new Date(),
        	sdate = "",
        	edate = "",
        	sorter = this.get("sorter");
        	
			switch(sorter){
				case "today":								
					this.set("sdate", today);
					this.set("edate", "");
													  					
				  	break;
				case "week":			  	
					var first = today.getDate() - today.getDay(),
					last = first + 6;

					this.set("sdate", new Date(today.setDate(first)));
					this.set("edate", new Date(today.setDate(last)));						
					
				  	break;
				case "month":							  	
					this.set("sdate", new Date(today.getFullYear(), today.getMonth(), 1));
					this.set("edate", new Date(today.getFullYear(), today.getMonth() + 1, 0));

				  	break;
				case "year":				
				  	this.set("sdate", new Date(today.getFullYear(), 0, 1));
				  	this.set("edate", new Date(today.getFullYear(), 11, 31));

				  	break;
				default:
					this.set("sdate", "");
				  	this.set("edate", "");									  
			}
		},
		setCurrencyCode 	: function(){
			var code = "", obj = this.get("obj");

			$.each(banhji.source.currencyRateDS.data(), function(index, value){				
				if(value.locale == obj.locale){
					code = value.currency[0].code;					

					return false;					
				}
			});

			this.set("currencyCode", code);
		},
		loadObj 			: function(id){
			var self = this;

			this.contactDS.query({
				filter: { field:"id", value:id},
				page:1,
				pageSize:100
			}).then(function(){
				var view = self.contactDS.view();

				if(view.length>0){
					self.set("obj", view[0]);
					self.loadData();
				}
			});
		},
		loadData 			: function(){
			var obj = this.get("obj");

			this.searchTransaction();
			this.loadSummary(obj.id);
			this.setCurrencyCode();

			this.attachmentDS.filter({ field:"contact_id", value: obj.id });
			this.noteDS.query({
				filter: { field:"contact_id", value: obj.id },
				sort: { field:"noted_date", dir:"desc" },
				page: 1,
				pageSize: 10
			});
		},
		//Upload
		onSelect 			: function(e){			
	        // Array with information about the uploaded files
	        var self = this, 
	        files = e.files,
	        obj = this.get("obj");			
			
			if(obj.id>0){
		        // Check the extension of each file and abort the upload if it is not .jpg
		        $.each(files, function(index, value){
		            if (value.extension.toLowerCase() === ".jpg"
		            	|| value.extension.toLowerCase() === ".jpeg"
		            	|| value.extension.toLowerCase() === ".tiff"
		            	|| value.extension.toLowerCase() === ".png" 
		            	|| value.extension.toLowerCase() === ".gif"
		            	|| value.extension.toLowerCase() === ".pdf"){

		            	var key = 'ATTACH_' + banhji.institute.id + "_" + Math.floor(Math.random() * 100000000000000001) +'_'+ value.name;

		            	self.attachmentDS.add({
		            		user_id 		: self.get("user_id"),
		            		contact_id 		: obj.id,
		            		type 			: "Contact",
		            		name 			: value.name,
		            		description 	: "",
		            		key 			: key,
		            		url 			: banhji.s3 + key,
		            		size 			: value.size,
		            		created_at 		: new Date(),

		            		file 			: value.rawFile
		            	});	            			            		            
		            }else{
		            	alert("This type of file is not allowed to attach.");
		            }
		        });
	    	}else{
	    		alert("Please select a customer!");
	    	}
	    },
	    removeFile 			: function(e){
	    	var data = e.data;

	    	if (confirm(banhji.source.confirmMessage)) {
	    		this.attachmentDS.remove(data);
	    		this.attachmentDS.sync();
	    	}	    	
	    },
	    uploadFile 			: function(){
	    	$.each(this.attachmentDS.data(), function(index, value){	    		
		    	if(!value.id){
			    	var params = { 
		            	Body: value.file, 
		            	Key: value.key 
		            };
		            bucket.upload(params, function (err, data) {		                
	                	// console.log(err, data);
	                	// var url = data.Location;                
	            	});
            	}	            
            });

            this.attachmentDS.sync();
            var saved = false;
            this.attachmentDS.bind("requestEnd", function(e){
            	//Delete File
            	if(e.type=="destroy"){
	            	if(saved==false && e.response){
	            		saved = true;
	            	
	            		var response = e.response.results;
	            		$.each(response, function(index, value){            			
		            		var params = {
							  	//Bucket: 'STRING_VALUE', /* required */
							 	Delete: { /* required */
								    Objects: [ /* required */
								      	{
									        Key: value.data.key /* required */
								      	}
								      /* more items */
								    ]
							  	}
							};
							bucket.deleteObjects(params, function(err, data) {
							  	//console.log(err, data);
							});
						});
	            	}
            	}
            });
	    },
	    //Summary
		loadContact 		: function(id){
			var self = this;
			
			this.contactDS.query({
			  	filter:[
			  		{ field:"id", value:id }
			  	],
			  	page: 1,
			  	pageSize: 50
			}).then(function(e) {
			    var view = self.contactDS.data();
			    
			    if(view.length>0){
			    	self.set("obj", view[0]);
			    	self.loadData();
			    }
			});
		},
		loadSummary 		: function(id){
			var self = this, obj = this.get("obj");

			this.summaryDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", operator:"where_in", value: ["Water_Deposit", "Water_Invoice"] },
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: { field: "issued_date", dir: "desc" },
			  	page: 1,
			  	pageSize: 1000
			}).then(function(){
				var view = self.summaryDS.view(),
				deposit = 0, open = 0, over = 0, balance = 0, today = new Date();

				$.each(view, function(index, value){
					if(value.type=="Water_Deposit"){
						deposit += kendo.parseFloat(value.amount);
					}else{
						balance += kendo.parseFloat(value.amount) - kendo.parseFloat(value.deposit);
						open++;

						if(new Date(value.due_date)<today){						
							over++;
						}
					}									
				});
				
				self.set("deposit", kendo.toString(deposit, obj.locale=="km-KH"?"c0":"c", obj.locale));
				self.set("outInvoice", kendo.toString(open, "n0"));
				self.set("overInvoice", kendo.toString(over, "n0"));
				self.set("balance", kendo.toString(balance, obj.locale=="km-KH"?"c0":"c", obj.locale));
			});
		},
		loadBalance 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Water_Invoice" },
			  		{ field:"status", operator:"where_in", value: [0,2] }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadDeposit 		: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value:"Water_Deposit" }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},
		loadOverInvoice 	: function(){
			var obj = this.get("obj");

			this.transactionDS.query({
			  	filter: [
			  		{ field:"contact_id", value: obj.id },
			  		{ field:"type", value: "Water_Invoice" },
			  		{ field:"status", operator:"where_in", value: [0,2] },
			  		{ field:"due_date <", value: kendo.toString(new Date(), "yyyy-MM-dd") }
			  	],
			  	sort: [
			  		{ field: "issued_date", dir: "desc" },
			  		{ field: "id", dir: "desc" }
			  	],
			  	page: 1,
			  	pageSize: 10
			});
		},	
		selectedRow			: function(e){
			var data = e.data;
			
			this.set("obj", data);
			this.loadData();
		},
		//Search
		enterSearch 		: function(e){
			e.preventDefault();

			this.search();
		},
		search 				: function(){
			var self = this, 
			para = [],
      		searchText = this.get("searchText"),
      		contact_type_id = this.get("contact_type_id");
      		
      		if(searchText){
      			var textParts = searchText.replace(/([a-z]+)/i, "$1 ").split(/[^0-9a-z]+/ig);

      			para.push(
      				{ field: "abbr", value: textParts[0] },
      				{ field: "number", value: textParts[1] },
					{ field: "name", operator: "or_like", value: searchText }
      			);
      		}

      		if(contact_type_id){
      			para.push({ field: "contact_type_id", value: contact_type_id });
      		}else{
      			para.push({ field: "parent_id", model:"contact_type", operator:"where_related", value: 1 });
      		}

      		this.contactDS.filter(para);
			
			//Clear search filters
      		self.set("searchText", "");
      		self.set("contact_type_id", 0);
		},
		searchTransaction	: function(){
			var self = this,
				start = kendo.toString(this.get("sdate"), "yyyy-MM-dd"),
        		end = kendo.toString(this.get("edate"), "yyyy-MM-dd"),
        		para = [], obj = this.get("obj");

        	if(obj.id>0){
        		para.push({ field:"contact_id", value: obj.id });
        	
	        	//Dates
	        	if(start && end){
	            	para.push({ field:"issued_date >=", value: start });
	            	para.push({ field:"issued_date <=", value: end });
	            }else if(start){
	            	para.push({ field:"issued_date", value: start });
	            }else if(end){
	            	para.push({ field:"issued_date <=", value: end });
	            }else{
	            	
	            }

	            this.transactionDS.query({
	            	filter: para,
	            	sort: [
				  		{ field: "issued_date", dir: "desc" },
				  		{ field: "id", dir: "desc" }
				  	],
	            	page: 1,
	            	pageSize: 10
	            });
	        }            
		},
		//Note
		saveNoteEnter 		: function(e){
			e.preventDefault();
			this.saveNote();
		},		
		saveNote 			: function(){
			var obj = this.get("obj");

			if(obj.id>0 && this.get("note")!==""){
				this.noteDS.insert(0, {
					contact_id 	: obj.id,
					note 		: this.get("note"),
					noted_date	: new Date(),
					created_by 	: this.get("user_id"),

					creator 	: ""
				});

				this.noteDS.sync();
				this.set("note", "");					
			}else{
				alert("Please select a customer and Memo is required");
			}
		}
	});
	banhji.wMeter = kendo.observable({
		lang 				: langVM,
		dataSource 			: dataStore(baseUrl + "meters"),
		existingDS 			: dataStore(baseUrl + "meters"),
		deleteDS 			: dataStore(baseUrl + "meters/record"),		
		contactDS 			: dataStore(baseUrl + "contacts"),					
		locationDS 			: dataStore(baseUrl + "locations"),
		itemDS 				: dataStore(baseUrl + "items"),
		feeDS 				: dataStore(baseUrl + "fees"),
		statusList 			: [            
			{ "id": 1, "name": "Active" },
			{ "id": 0, "name": "Inactive" },
			{ "id": 2, "name": "Void" }
        ],
        tariffList 			: [],
        exemptionList 		: [],
        maintenanceList 	: [],
        deposit_link 		: null,
        invoice_link 		: null,
        deposit_amount 		: 0,
        invoice_amount 		: 0,
        obj 				: null,             
        current_company_id 	: 0,
        current_meter_id 	: 0,
        isDuplicateNumber 	: false,
        originalNo 			: null,
		pageLoad 			: function(id){
			this.loadMeter(id);									
		},		
		loadMeter 			: function(id){
			var self = this;

			if(this.get("current_meter_id")!=id){
			 	this.set("current_meter_id", id);				

				this.dataSource.query({
					filter: { field:"id", value: id },
					page: 1,
	  				take: 50
				}).then(function(e) {
				    var view = self.dataSource.view();

				    self.set("originalNo", view[0].number);				    
				    self.contactDS.filter({ field:"id", value:view[0].contact_id });		    			    	
			    	self.contactDS.filter([]);

			    	return self.feeQuery(view[0].company_id);	    		   	    			    			    				    
				}).then(function(fee){
					var view = self.dataSource.view();					
					
					self.set("obj", view[0]);
					self.set("deposit_link", "#/wDeposit/"+view[0].deposit_id);
					self.set("invoice_link", "#/wMeterInvoice/"+view[0].invoice_id);

					if(view[0].deposit[0]){
						self.set("deposit_amount", kendo.toString(kendo.parseFloat(view[0].deposit[0].amount), "c", view[0].deposit[0].locale));
					}else{
						self.set("deposit_amount", 0);
					}

					if(view[0].invoice[0]){
						self.set("invoice_amount", kendo.toString(kendo.parseFloat(view[0].invoice[0].amount), "c", view[0].invoice[0].locale));
					}else{
						self.set("invoice_amount", 0);
					}					
										
					self.loadMap();
				});
			}
		},		
		loadMap 			: function(){
			var obj = this.get("obj"), lat = kendo.parseFloat(obj.latitute),
			lng = kendo.parseFloat(obj.longtitute);

			if(lat && lng){
				var myLatLng = {lat:lat, lng:lng};
				var mapOptions = {
					zoom: 17,					
					center: myLatLng,
					mapTypeControl: false,
					zoomControl: false,
					scaleControl: false,
					streetViewControl: false
				};
				var map = new google.maps.Map(document.getElementById('map'),mapOptions);
				var marker = new google.maps.Marker({
					position: myLatLng,
					map: map,
					title: obj.number
				});
			} 
		},
		feeQuery 			: function(company_id){
			var self = this, dfd = $.Deferred();

			if(this.get("current_company_id")!=company_id){
			 	this.set("current_company_id", company_id);
				
		    	this.feeDS.query({
					filter: [
						{ field:"company_id", value: company_id },
						{ field:"utility_id", value: 2 }
					]
				}).then(function(e) {
					var view = self.feeDS.view();

					self.set("tariffList", []);
					self.set("exemptionList", []);
					self.set("maintenanceList", []);

					$.each(view, function(index, value){																						
						if(value.type=="tariff"){							
							self.tariffList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="exemption"){							
							self.exemptionList.push({
								id 	: value.id,
								name: value.name 
							});
						}
						if(value.type=="maintenance"){
							self.maintenanceList.push({
								id 	: value.id,
								name: value.name 
							});
						}								
					});

					dfd.resolve(view);				    			   		    			
				});
			}			

		    return dfd;	    		    	
	    },	    	
		contactChanges 		: function(e){
			if(e.sender.selectedIndex>0){
				var obj = this.get("obj"),
				contact = this.contactDS.get(obj.contact_id);

				obj.set("company_id", contact.wbranch_id);
				obj.set("location_id", contact.wlocation_id);
				
				this.feeQuery(contact.wbranch_id);
			}
		},
		checkExistingNumber : function(){
			var self = this;	
			
			var number = this.get("obj").number;
			var originalNo = this.get("originalNo");
			
			if(number.length>0 && number!==originalNo){
				this.existingDS.query({
					filter: { field:"number", value: number },
					page: 1,
					pageSize: 100
				}).then(function(e){
					var view = self.existingDS.view();
					
					if(view.length>0){
				 		self.set("isDuplicateNumber", true);						
					}else{
						self.set("isDuplicateNumber", false);
					}
				});							
			}else{
				this.set("isDuplicateNumber", false);
			}			
		},				
		save 				: function(){			
			var self = this, saved = false;

			this.dataSource.sync();			
			this.dataSource.bind("requestEnd", function(e){				
				if(e.type=="create" && saved==false){					
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
					self.addEmpty();										
				}

				if(e.type=="update" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();
					window.history.back();
				}

				if(e.type=="destroy" && saved==false){
					saved = true;
					banhji.wCustomerCenter.meterDS.fetch();					
					window.history.back();
				}
			});
		},
		delete 				: function(){
			var self = this,
			obj = this.get("obj");

			if (confirm("Are you sure, you want to delete it?")) {
				this.deleteDS.query({
				  	filter: { field: "meter_id", value: obj.id },
				  	page: 1,
				  	take: 1
				}).then(function() {
					var view = self.deleteDS.view();

					if(view.length>0){
						alert("Sorry, you can not delete it because it is using now.");
					}else{
						var data = self.dataSource.get(obj.id);
				        self.dataSource.remove(data);
				        self.save();
					}
				});				
	    	}
		},
		cancel 				: function(){
			this.dataSource.cancelChanges();
			window.history.back();
		}		
	});



    /*************************
	*	Reports Module Section   * 
	**************************/
    banhji.reportDashboard = kendo.observable({
    	lang 				: langVM,
    	dataSource			: dataStore(apiUrl+"accounting_reports/ratio_analysis"),
    	quickRatio			: 0,
		currentRatio 		: 0,
		cashRatio  			: 0,
		wcSale 				: 0,
		grossProfitMargin 	: 0,
		profitMargin 		: 0,
		returnOnAsset 		: 0,
		roce 				: 0,
		arCollectionPeriod 	: 0,
		apPaymentPeriod 	: 0,
		inventoryTurnOver 	: 0,
		ccc 				: 0,    	 	
    	pageLoad 			: function(){
			var self = this;

			this.dataSource.query({
				filter: [],								
				page: 1,
				pageSize: 100
			}).then(function(){
				var view = self.dataSource.view();				
				
				self.set("quickRatio", kendo.toString(view[0].quickRatio, "n"));
				self.set("currentRatio", kendo.toString(view[0].currentRatio, "n"));
				self.set("cashRatio", kendo.toString(view[0].cashRatio, "n"));
				
				self.set("wcSale", kendo.toString(view[0].wcSale, "p"));
				self.set("grossProfitMargin", kendo.toString(view[0].grossProfitMargin, "p"));
				self.set("profitMargin", kendo.toString(view[0].profitMargin, "p"));
				self.set("returnOnAsset", kendo.toString(view[0].returnOnAsset, "n"));
				
				self.set("roce", kendo.toString(view[0].roce, "p"));
				self.set("arCollectionPeriod", kendo.toString(view[0].arCollectionPeriod, "n"));
				self.set("apPaymentPeriod", kendo.toString(view[0].apPaymentPeriod, "n"));
				self.set("inventoryTurnOver", kendo.toString(view[0].inventoryTurnOver, "n"));
				self.set("ccc", kendo.toString(view[0].ccc, "n"));
			});
		}
    });

	/* views and layout */
	banhji.view = {
		layout 		: new kendo.Layout('#layout', {model: banhji.Layout}),
		blank		: new kendo.View('<div></div>'),		
		index  		: new kendo.Layout("#index", {model: banhji.index}),		
		menu 		: new kendo.Layout('#menu-tmpl', {model: banhji.userManagement}),
		searchAdvanced: new kendo.Layout("#searchAdvanced", {model: banhji.searchAdvanced}),

		//Accounting
		accountingDashboard: new kendo.Layout("#accountingDashboard", {model: banhji.accountingDashboard}),
		accountingCenter: new kendo.Layout("#accountingCenter", {model: banhji.accountingCenter}),
		account: new kendo.Layout("#account", {model: banhji.account}),
		txnItem: new kendo.Layout("#txnItem", {model: banhji.txnItem}),
		journal: new kendo.Layout("#journal", {model: banhji.journal}),
		currencyRate: new kendo.Layout("#currencyRate", {model: banhji.currencyRate}),
		recurring: new kendo.Layout("#recurring", {model: banhji.recurring}),
		journalReport: new kendo.Layout("#journalReport", {model: banhji.journalReport}),
		generalLedger: new kendo.Layout("#generalLedger", {model: banhji.generalLedger}),
		trialBalance: new kendo.Layout("#trialBalance", {model: banhji.trialBalance}),
		chartOfAccount: new kendo.Layout("#chartOfAccount", {model: banhji.chartOfAccount}),
		accountingReportCenter: new kendo.Layout("#accountingReportCenter", {model: banhji.accountingReportCenter}),
		accountingSetting: new kendo.Layout("#accountingSetting", {model: banhji.accountingSetting}),

		addAccountingprefix: new kendo.Layout("#addAccountingprefix", {model: banhji.addAccountingprefix}),

		segment: new kendo.Layout("#segment", {model: banhji.segment}),
		transactionListDate: new kendo.Layout("#transactionListDate", {model: banhji.transactionListDate}),
		recentTransactionsList: new kendo.Layout("#recentTransactionsList", {model: banhji.recentTransactionsList}),
		recurringJournalList: new kendo.Layout("#recurringJournalList", {model: banhji.recurringJournalList}),
		statementProfitLoss: new kendo.Layout("#statementProfitLoss", {model: banhji.statementProfitLoss}),
		statementFinancialPosition: new kendo.Layout("#statementFinancialPosition", {model: banhji.statementFinancialPosition}),
		statementProfitLossComparison: new kendo.Layout("#statementProfitLossComparison", {model: banhji.statementProfitLossComparison}),
		statementFinancialPositionComparison: new kendo.Layout("#statementFinancialPositionComparison", {model: banhji.statementFinancialPositionComparison}),
		statementChangesEquity: new kendo.Layout("#statementChangesEquity", {model: banhji.statementChangesEquity}),
		statementCashFlow: new kendo.Layout("#statementCashFlow", {model: banhji.statementCashFlow}),
		auditTrialReport: new kendo.Layout("#auditTrialReport", {model: banhji.auditTrialReport}),
		accountRecurring: new kendo.Layout("#accountRecurring", {model: banhji.accountRecurring}),
		
		//Sale Tax
		saleTax: new kendo.Layout("#saleTax", {model: banhji.saleTax}),
		saleTaxReportCenter: new kendo.Layout("#saleTaxReportCenter", {model: banhji.saleTaxReportCenter}),
		saleJournal: new kendo.Layout("#saleJournal", {model: banhji.saleJournal}),
		purchaseJournal: new kendo.Layout("#purchaseJournal", {model: banhji.purchaseJournal}),


		//Employee
		employeeDashboard: new kendo.Layout("#employeeDashboard", {model: banhji.employeeDashboard}),
		employeeCenter: new kendo.Layout("#employeeCenter", {model: banhji.employeeCenter}),
		employee: new kendo.Layout("#employee", {model: banhji.employee}),
		cashAdvance: new kendo.Layout("#cashAdvance", {model: banhji.cashAdvance}),
		expense: new kendo.Layout("#expense", {model: banhji.expense}),
		employeeReportCenter: new kendo.Layout("#employeeReportCenter"),

		//Vendor
		vendorDashboard: new kendo.Layout("#vendorDashboard", {model: banhji.vendorDashboard}),
		vendorCenter: new kendo.Layout("#vendorCenter", {model: banhji.vendorCenter}),
		vendor: new kendo.Layout("#vendor", {model: banhji.vendor}),
		purchaseOrder: new kendo.Layout("#purchaseOrder", {model: banhji.purchaseOrder}),
		grn: new kendo.Layout("#grn", {model: banhji.grn}),
		purchase: new kendo.Layout("#purchase", {model: banhji.purchase}),
		purchaseReturn: new kendo.Layout("#purchaseReturn", {model: banhji.purchaseReturn}),
		vendorDeposit: new kendo.Layout("#vendorDeposit", {model: banhji.vendorDeposit}),		
		vendorSetting: new kendo.Layout("#vendorSetting", {model: banhji.vendorSetting}),
		vendorReportCenter: new kendo.Layout("#vendorReportCenter", {model: banhji.vendorReportCenter}),
		expensesPurchaseSummarySupplier: new kendo.Layout("#expensesPurchaseSummarySupplier", {model: banhji.vendorSale}),
		expensesPurchaseDetailSupplier: new kendo.Layout("#expensesPurchaseDetailSupplier", {model: banhji.vendorSale}),
		purchaseSummaryProductServices: new kendo.Layout("#purchaseSummaryProductServices", {model: banhji.vendorSale}),
		openPurchaseOrder: new kendo.Layout("#openPurchaseOrder", {model: banhji.vendorSale}),
		purchaseDetailProductServices: new kendo.Layout("#purchaseDetailProductServices", {model: banhji.vendorSale}),
		suppliersTransactionList: new kendo.Layout("#suppliersTransactionList", {model: banhji.vendorSale}),
		depositDetailSupplier: new kendo.Layout("#depositDetailSupplier", {model: banhji.vendorSale}),
		suppliersBalanceSummary: new kendo.Layout("#suppliersBalanceSummary", {model: banhji.vendorSale}),
		suppliersBalanceDetail: new kendo.Layout("#suppliersBalanceDetail", {model: banhji.vendorSale}),
		payablesAgingSummary: new kendo.Layout("#payablesAgingSummary", {model: banhji.vendorSale}),
		payablesAgingDetail: new kendo.Layout("#payablesAgingDetail", {model: banhji.vendorSale}),
		listBillsPaid: new kendo.Layout("#listBillsPaid", {model: banhji.vendorSale}),
		billPaymentList: new kendo.Layout("#billPaymentList", {model: banhji.vendorSale}),
		productServiceList: new kendo.Layout("#productServiceList", {model: banhji.vendorSale}),
		supplierList: new kendo.Layout("#supplierList", {model: banhji.supplierList}),
		vendorRecurring: new kendo.Layout("#vendorRecurring", {model: banhji.vendorRecurring}),

		//Customer
		customerDashboard: new kendo.Layout("#customerDashboard", {model: banhji.customerDashboard}),
		customerCenter: new kendo.Layout("#customerCenter", {model: banhji.customerCenter}),		
		customer: new kendo.Layout("#customer", {model: banhji.customer}),		
		invoice: new kendo.Layout("#invoice", {model: banhji.invoice}),
		cashSale: new kendo.Layout("#cashSale", {model: banhji.cashSale}),
		saleOrder: new kendo.Layout("#saleOrder", {model: banhji.saleOrder}),
		quote: new kendo.Layout("#quote", {model: banhji.quote}),		
		gdn: new kendo.Layout("#gdn", {model: banhji.gdn}),
		saleReturn: new kendo.Layout("#saleReturn", {model: banhji.saleReturn}),		
		statement: new kendo.Layout("#statement", {model: banhji.statement}),
		customerDeposit: new kendo.Layout("#customerDeposit", {model: banhji.customerDeposit}),
		customerReportCenter: new kendo.Layout("#customerReportCenter", {model: banhji.customerReportCenter}),
		customerList : new kendo.Layout("#customerList", {model: banhji.customerList}),
		customerBalance : new kendo.Layout("#customerBalance", {model: banhji.customerBalance}),
		customerSetting: new kendo.Layout("#customerSetting", {model: banhji.customerSetting}),
		job: new kendo.Layout("#job", {model: banhji.job}),
		invoiceCustom: new kendo.Layout("#invoiceCustom", {model: banhji.invoiceCustom}),
		invoiceForm: new kendo.Layout("#invoiceForm", {model: banhji.invoiceForm}),
		invoiceForm1: new kendo.Layout("#invoiceForm1", {model: banhji.invoiceForm}),
		invoiceForm2: new kendo.Layout("#invoiceForm2", {model: banhji.invoiceForm}),
		//invoiceForm3: new kendo.Layout("#invoiceForm3", {model: banhji.invoiceForm}),
		//invoiceForm4: new kendo.Layout("#invoiceForm4", {model: banhji.invoiceForm}),
		//invoiceForm5: new kendo.Layout("#invoiceForm5", {model: banhji.invoiceForm}),
		invoiceForm6: new kendo.Layout("#invoiceForm6", {model: banhji.invoiceForm}),
		invoiceForm7: new kendo.Layout("#invoiceForm7", {model: banhji.invoiceForm}),
		invoiceForm8: new kendo.Layout("#invoiceForm8", {model: banhji.invoiceForm}),
		invoiceForm9: new kendo.Layout("#invoiceForm9", {model: banhji.invoiceForm}),
		invoiceForm10: new kendo.Layout("#invoiceForm10", {model: banhji.invoiceForm}),
		invoiceForm11: new kendo.Layout("#invoiceForm11", {model: banhji.invoiceForm}),
		invoiceForm12: new kendo.Layout("#invoiceForm12", {model: banhji.invoiceForm}),
		invoiceForm13: new kendo.Layout("#invoiceForm13", {model: banhji.invoiceForm}),
		invoiceForm14: new kendo.Layout("#invoiceForm14", {model: banhji.invoiceForm}),
		invoiceForm15: new kendo.Layout("#invoiceForm15", {model: banhji.invoiceForm}),
		invoiceForm16: new kendo.Layout("#invoiceForm16", {model: banhji.invoiceForm}),
		invoiceForm17: new kendo.Layout("#invoiceForm17", {model: banhji.invoiceForm}),
		invoiceForm18: new kendo.Layout("#invoiceForm18", {model: banhji.invoiceForm}),
		invoiceForm19: new kendo.Layout("#invoiceForm19", {model: banhji.invoiceForm}),
		invoiceForm20: new kendo.Layout("#invoiceForm20", {model: banhji.invoiceForm}),
		invoiceForm21: new kendo.Layout("#invoiceForm21", {model: banhji.invoiceForm}),
		invoiceForm22: new kendo.Layout("#invoiceForm22", {model: banhji.invoiceForm}),
		invoiceForm23: new kendo.Layout("#invoiceForm23", {model: banhji.invoiceForm}),
		invoiceForm24: new kendo.Layout("#invoiceForm24", {model: banhji.invoiceForm}),
		invoiceForm25: new kendo.Layout("#invoiceForm25", {model: banhji.invoiceForm}),
		invoiceForm26: new kendo.Layout("#invoiceForm26", {model: banhji.invoiceForm}),
		invoiceForm27: new kendo.Layout("#invoiceForm27", {model: banhji.invoiceForm}),
		invoiceForm28: new kendo.Layout("#invoiceForm28", {model: banhji.invoiceForm}),
		invoiceForm29: new kendo.Layout("#invoiceForm29", {model: banhji.invoiceForm}),
		invoiceForm30: new kendo.Layout("#invoiceForm30", {model: banhji.invoiceForm}),
		invoiceForm31: new kendo.Layout("#invoiceForm31", {model: banhji.invoiceForm}),
		invoiceForm32: new kendo.Layout("#invoiceForm32", {model: banhji.invoiceForm}),
		invoiceForm33: new kendo.Layout("#invoiceForm33", {model: banhji.invoiceForm}),
		invoiceForm34: new kendo.Layout("#invoiceForm34", {model: banhji.invoiceForm}),
		invoiceForm35: new kendo.Layout("#invoiceForm35", {model: banhji.invoiceForm}),
		invoiceForm36: new kendo.Layout("#invoiceForm36", {model: banhji.invoiceForm}),
		invoiceForm37: new kendo.Layout("#invoiceForm37", {model: banhji.invoiceForm}),
		invoiceForm38: new kendo.Layout("#invoiceForm38", {model: banhji.invoiceForm}),
		invoiceForm39: new kendo.Layout("#invoiceForm39", {model: banhji.invoiceForm}),
		invoiceForm40: new kendo.Layout("#invoiceForm40", {model: banhji.invoiceForm}),
		invoiceForm41: new kendo.Layout("#invoiceForm41", {model: banhji.invoiceForm}),
		invoiceForm42: new kendo.Layout("#invoiceForm42", {model: banhji.invoiceForm}),
		
		saleSummaryCustomer: new kendo.Layout("#saleSummaryCustomer", {model: banhji.customerSale}),
		saleDetailCustomer: new kendo.Layout("#saleDetailCustomer", {model: banhji.customerSale}),
		saleSummaryProduct: new kendo.Layout("#saleSummaryProduct", {model: banhji.customerSale}),
		customerTransactionList: new kendo.Layout("#customerTransactionList", {model: banhji.customerSale}),
		depositDetailCustomer: new kendo.Layout("#depositDetailCustomer", {model: banhji.customerSale}),
		saleDetailProduct : new kendo.Layout("#saleDetailProduct", {model: banhji.customerSale}),
		customerBalanceSummary : new kendo.Layout("#customerBalanceSummary", {model: banhji.customerSale}),
		customerBalanceDetail : new kendo.Layout("#customerBalanceDetail", {model: banhji.customerSale}),
		receivableAgingSummary : new kendo.Layout("#receivableAgingSummary", {model: banhji.customerSale}),
		receivableAgingDetail : new kendo.Layout("#receivableAgingDetail", {model: banhji.customerSale}),
		listInvoicesCollect : new kendo.Layout("#listInvoicesCollect", {model: banhji.customerSale}),
		collectReport : new kendo.Layout("#collectReport", {model: banhji.customerSale}),
		invoiceList : new kendo.Layout("#invoiceList", {model: banhji.customerSale}),
		saleJobEngagement: new kendo.Layout("#saleJobEngagement", {model: banhji.customerSale}),
		saleOrderList: new kendo.Layout("#saleOrderList", {model: banhji.customerSale}),

		customerRecurring : new kendo.Layout("#customerRecurring", {model: banhji.customerRecurring}),

		//Cashier
		cashier: new kendo.Layout("#cashier", {model: banhji.cashier}),
		reconcile: new kendo.Layout("#reconcile", {model: banhji.reconcile}),
		cashTransaction: new kendo.Layout("#cashTransaction", {model: banhji.cashTransaction}),
		cashReceipt: new kendo.Layout("#cashReceipt", {model: banhji.cashReceipt}),
		cashPayment: new kendo.Layout("#cashPayment", {model: banhji.cashPayment}),
		
		//Inventory		
		itemDashBoard: new kendo.Layout("#itemDashBoard", {model: banhji.itemDashBoard}),
		itemCenter: new kendo.Layout("#itemCenter", {model: banhji.itemCenter}),		
		item: new kendo.Layout("#item", {model: banhji.item}),
		itemService: new kendo.Layout("#itemService", {model: banhji.itemService}),
		nonInventoryPart: new kendo.Layout("#nonInventoryPart", {model: banhji.nonInventoryPart}),
		itemPrice: new kendo.Layout("#itemPrice", {model: banhji.itemPrice}),
		itemCatalog: new kendo.Layout("#itemCatalog", {model: banhji.itemCatalog}),
		itemAssembly: new kendo.Layout("#itemAssembly", {model: banhji.itemAssembly}),
		itemAdjustment: new kendo.Layout("#itemAdjustment", {model: banhji.itemAdjustment}),
		itemSetting: new kendo.Layout("#itemSetting", {model: banhji.itemSetting}),
		internalUsage: new kendo.Layout("#internalUsage", {model: banhji.internalUsage}),
		serviceSetting: new kendo.Layout("#serviceSetting", {model: banhji.serviceSetting}),
		itemReportCenter: new kendo.Layout("#itemReportCenter", {model: banhji.itemReportCenter}),
		inventoryPositionSummary: new kendo.Layout("#inventoryPositionSummary", {model: banhji.inventorySale}),
		inventoryPositionDetail: new kendo.Layout("#inventoryPositionDetail", {model: banhji.inventorySale}),
		inventoryTurnoverList: new kendo.Layout("#inventoryTurnoverList", {model: banhji.inventorySale}),
		inventorySaleItemAnalysis: new kendo.Layout("#inventorySaleItemAnalysis", {model: banhji.inventorySale}),
		inventoryMovementSummary: new kendo.Layout("#inventoryMovementSummary", {model: banhji.inventorySale}),
		inventoryMovementDetail: new kendo.Layout("#inventoryMovementDetail", {model: banhji.inventorySale}),
		inventorySaleByItem: new kendo.Layout("#inventorySaleByItem", {model: banhji.inventorySaleByItem}),
		inventoryList: new kendo.Layout("#inventoryList", {model: banhji.inventoryList}),		
		inventoryPurchaseByVendorSummary: new kendo.Layout("#inventoryPurchaseByVendorSummary", {model: banhji.inventoryPurchaseByVendorSummary}),
		inventoryPurchaseByVendorDetail: new kendo.Layout("#inventoryPurchaseByVendorDetail", {model: banhji.inventoryPurchaseByVendorDetail}),
		fixedAssets: new kendo.Layout("#fixedAssets", {model: banhji.fixedAssets}),
		itemRecurring: new kendo.Layout("#itemRecurring", {model: banhji.itemRecurring}),

		//Cash Managment
		cashDashboard: new kendo.Layout("#cashDashboard", {model: banhji.cashDashboard}),
		cashCenter: new kendo.Layout("#cashCenter", {model: banhji.cashCenter}),		
		cash: new kendo.Layout("#cash", {model: banhji.cash}),
		cashList : new kendo.Layout("#cashList", {model: banhji.cashList}),		
		cashDeposit: new kendo.Layout("#cashDeposit", {model: banhji.cashDeposit}),
		cashReportCenter: new kendo.Layout("#cashReportCenter"),
		cashSetting: new kendo.Layout("#cashSetting", {model: banhji.cashSetting}),
		
		//Document
		documents: new kendo.Layout("#documents", {model: banhji.fileManagement}),

		//Report
		reportDashboard: new kendo.Layout("#reportDashboard", {model: banhji.reportDashboard}),

		//Water
		waterCenter: new kendo.Layout("#waterCenter", {model: banhji.waterCenter}),
		wMeter: new kendo.Layout("#wMeter", {model: banhji.wMeter}),

		//Menu
		accountingMenu: new kendo.View("#accountingMenu", {model: langVM}),
		employeeMenu: new kendo.View("#employeeMenu", {model: langVM}),
		vendorMenu: new kendo.View("#vendorMenu", {model: langVM}),
		customerMenu: new kendo.View("#customerMenu", {model: langVM}),
		cashMenu: new kendo.View("#cashMenu", {model: langVM}),
		waterMenu: new kendo.View("#waterMenu", {model: langVM}),
		inventoryMenu: new kendo.View("#inventoryMenu", {model: langVM}),
		saleTaxMenu: new kendo.View("#saleTaxMenu", {model: langVM})	
	};
	/* views and layout */
	banhji.router = new kendo.Router({
		init: function() {	
			var language = JSON.parse(localStorage.getItem('userData/lang'));	
			switch(language) {
				case "KH": 
					langVM.set('lang', km_KH);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
					break;
				case "EN":
					langVM.set('lang', en_US);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
					break;
				default: 
					langVM.set('lang', en_US);
					localforage.setItem("lang", language);
					langVM.set('localeCode', language);
			}
			localforage.getItem('user', function(err, data){
				if (err) {
					
				} else {
					$('#current-section').html('|&nbsp;Company');
					$('#home-menu').addClass('active');
					banhji.view.layout.render("#wrapperApplication");
					banhji.index.set('companyName', data.institute.name);
					banhji.index.set('companyLogo', data.institute.logo);
					var blank = new kendo.View('#blank-tmpl');
					banhji.view.layout.showIn('#menu', banhji.view.menu);
					if(userPool.getCurrentUser() == null) {
						window.location.replace(baseUrl + "login");
					}
					banhji.aws.getImage();
				}
			});	
			
		},
		routeMissing: function(e) {
			// banhji.view.layout.showIn("#layout-view", banhji.view.missing);
			console.log("no resource found.")
		}
	});
	/* Login page */
	banhji.router.route('/', function(){
		var blank = new kendo.View('#blank-tmpl');
		banhji.view.layout.showIn('#content', banhji.view.index);
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		$('#main-top-navigation').append('<li><a href="\#">Home</a></li>');
		$('#current-section').text("");
		$("#secondary-menu").html("");
		banhji.index.getLogo();
		banhji.index.pageLoad();
	});
	banhji.router.route("/search_advanced", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{			
			var vm = banhji.searchAdvanced;
						
			banhji.view.layout.showIn("#content", banhji.view.searchAdvanced);
			
			if(banhji.pageLoaded["search_advanced"]==undefined){
				banhji.pageLoaded["search_advanced"] = true;
		         
		        vm.contactTypeDS.read();	
			}

			vm.pageLoad();			
		}
	});	
	
	
	/*************************
	* Accounting Section   *
	**************************/
	banhji.router.route("/accounting", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {	
				banhji.view.layout.showIn("#content", banhji.view.accountingDashboard);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);

				var vm = banhji.accountingDashboard;
				banhji.userManagement.addMultiTask("Accounting Dashboard","accounting",null);

				if(banhji.pageLoaded["accounting"]==undefined){
					banhji.pageLoaded["accounting"] = true;
			          	
				}

				vm.pageLoad();			
			} else {
				window.location.replace(baseUrl + "admin");
			}				
		});
	});
	banhji.router.route("/accounting_center(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {			
				var vm = banhji.accountingCenter;
				banhji.userManagement.addMultiTask("Account Center","accounting_center",null);
							
				banhji.view.layout.showIn("#content", banhji.view.accountingCenter);			
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);

				if(banhji.pageLoaded["accounting_center"]==undefined){
					banhji.pageLoaded["accounting_center"] = true;
			              	
				}

				vm.pageLoad(id);			
			} else {
				window.location.replace(baseUrl + "admin");
			}				
		});
	});
	banhji.router.route("/cash_advance(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.cashAdvance);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.cashAdvance;

				banhji.userManagement.addMultiTask("Cash Advance","cash_advance",vm);
				
				if(banhji.pageLoaded["cash_advance"]==undefined){
					banhji.pageLoaded["cash_advance"] = true;
	   
					var validator = $("#example").kendoValidator().data("kendoValidator");

			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }		            
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id,is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });			
	});
	banhji.router.route("/expense(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {							
				banhji.view.layout.showIn("#content", banhji.view.expense);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.expense;

				banhji.userManagement.addMultiTask("Expense","expense",vm);
				
				if(banhji.pageLoaded["expense"]==undefined){
					banhji.pageLoaded["expense"] = true;
	   
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id,is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });		
	});
	banhji.router.route("/account(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {				
				var vm = banhji.account;
				banhji.userManagement.addMultiTask("Account","account",vm);
							
				banhji.view.layout.showIn("#content", banhji.view.account);			
				// kendo.fx($("#slide-form")).slideIn("down").play();

				if(banhji.pageLoaded["account"]==undefined){
					banhji.pageLoaded["account"] = true;		         

			       var validator = $("#example").kendoValidator().data("kendoValidator");
													
			        $("#saveNew").click(function(e){				
						e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
			            	vm.save();		            				  
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }		            
					});

					$("#saveClose").click(function(e){				
						e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
							vm.set("saveClose", true);
			            	vm.save();		            	
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});				      	
				}

				vm.pageLoad(id);			
			} else {
				window.location.replace(baseUrl + "admin");
			}				
		});				
	});
	banhji.router.route("/journal(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {							
				banhji.view.layout.showIn("#content", banhji.view.journal);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.journal;
				banhji.userManagement.addMultiTask("Journal Entry","journal",vm);
				
				if(banhji.pageLoaded["journal"]==undefined){
					banhji.pageLoaded["journal"] = true;
	   
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isValid")){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isValid")){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate() && vm.get("isValid")){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isValid") && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id,is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });	
	});
	banhji.router.route("/accounting_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.accountingReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);

			var vm = banhji.accountingReportCenter;			
			banhji.userManagement.addMultiTask("Accounting Report Center","accounting_report_center",null);
			if(banhji.pageLoaded["accounting_report_center"]==undefined){
				banhji.pageLoaded["accounting_report_center"] = true;				
								
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/accounting_setting", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("accounting" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {	
				banhji.view.layout.showIn("#content", banhji.view.accountingSetting);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);

				var vm = banhji.vendorSetting;
				banhji.userManagement.addMultiTask("General Accounting Setting","accounting_setting",null);
				
				if(banhji.pageLoaded["accounting_setting"]==undefined){
					banhji.pageLoaded["accounting_setting"] = true;

					vm.contactTypeDS.filter({ field:"parent_id", value: 2 });
				}

				vm.pageLoad();			     		
			} else {
				window.location.replace(baseUrl + "admin");
			}				
		});
	});

	banhji.router.route("/currency_rate", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.currencyRate);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.currencyRate;
			banhji.userManagement.addMultiTask("Currency Rate","currency_rate",null);
			
			if(banhji.pageLoaded["currency_rate"]==undefined){
				banhji.pageLoaded["currency_rate"] = true;

			}

			vm.pageLoad();			
		}
	});
	banhji.router.route("/recurring", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{						
			banhji.view.layout.showIn("#content", banhji.view.recurring);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.recurring;
			banhji.userManagement.addMultiTask("Recurring Transaction Lists","recurring",null);
			
			if(banhji.pageLoaded["recurring"]==undefined){
				banhji.pageLoaded["recurring"] = true;   
				
				vm.dataSource.filter({ field:"is_recurring", value: 1 });

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");               

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":								
						sdate = today;
															  					
					  	break;
					case "week":			  	
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));						
						
					  	break;
					case "month":							  	
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":				
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
											  
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();                	
                });
                
                start.max(end.value());
                end.min(start.value());
				 		
			}

			vm.pageLoad();					
		}
	});
	banhji.router.route("/journal_report", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.journalReport);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.journalReport;
			banhji.userManagement.addMultiTask("Journal Entry Reports","journal_report",null);

			if(banhji.pageLoaded["journal_report"]==undefined){
				banhji.pageLoaded["journal_report"] = true;									
						
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/trial_balance", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.trialBalance);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.trialBalance;
			banhji.userManagement.addMultiTask("Trial Balance","trial_balance",null);

			if(banhji.pageLoaded["trial_balance"]==undefined){
				banhji.pageLoaded["trial_balance"] = true;                
                						
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/chart_of_account", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.chartOfAccount);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.chartOfAccount;
			banhji.userManagement.addMultiTask("Chart of Account","chart_of_account",null);

			if(banhji.pageLoaded["chart_of_account"]==undefined){
				banhji.pageLoaded["chart_of_account"] = true;              
                						
			}
		}
	});
	banhji.router.route("/add_accountingprefix(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.addAccountingprefix);			
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.addAccountingprefix;
			banhji.userManagement.addMultiTask("Add Accounting Prefix","add_accountingprefix",null);
			if(banhji.pageLoaded["add_accountingprefix"]==undefined){
				banhji.pageLoaded["add_accountingprefix"] = true;				        
				setTimeout(function(){
					var validator = $("#example").kendoValidator().data("kendoValidator");
					var notification = $("#notification").kendoNotification({				    
					    autoHideAfter: 5000,
					    width: 300,				    
					    height: 50
					}).data('kendoNotification');
					$("#saveNew").click(function(e){	
		        			
						e.preventDefault();
						if(validator.validate()){
			            	vm.save();		            	

			            	notification.success("Save Successful");			  
				        }else{
				        	notification.error("Warning, please review it again!");			           
				        }		            
					});
					$("#saveClose").click(function(e){				
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
			            	window.history.back();

			            	notification.success("Save Successful");			  
				        }else{
				        	notification.error("Warning, please review it again!");			           
				        }	            
					});
				},2000);
						
			};
			
			vm.pageLoad(id);		
		};
	});	
	banhji.router.route("/segment", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.segment);

			banhji.userManagement.addMultiTask("Segment","segment",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.segment;

			if(banhji.pageLoaded["segment"]==undefined){
				banhji.pageLoaded["segment"] = true;
														
			}		
		}
	});
	banhji.router.route("/general_ledger", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.generalLedger);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.generalLedger;
			banhji.userManagement.addMultiTask("General Ledger","general_ledger",null);

			if(banhji.pageLoaded["general_ledger"]==undefined){
				banhji.pageLoaded["general_ledger"] = true;
						
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/transaction_list_date", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.transactionListDate);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.journalReport;
			banhji.userManagement.addMultiTask("Transaction List by Date","transaction_list_date",null);

			if(banhji.pageLoaded["transaction_list_date"]==undefined){
				banhji.pageLoaded["transaction_list_date"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");               

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":								
						sdate = today;
															  					
					  	break;
					case "week":			  	
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));						
						
					  	break;
					case "month":							  	
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":				
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
											  
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();                	
                });
                
                start.max(end.value());
                end.min(start.value());				

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],		        	
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){        		
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });            	          	            	
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);		            
		        });								
						
			}
		}
	});
	banhji.router.route("/recent_transactions_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.recentTransactionsList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.journalReport;
			banhji.userManagement.addMultiTask("Recent Transactions List","recent_transactions_list",null);

			if(banhji.pageLoaded["recent_transactions_list"]==undefined){
				banhji.pageLoaded["recent_transactions_list"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");               

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});	
	banhji.router.route("/recurring_journal_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.recurringJournalList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);
			
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Recurring Journal List","recurring_journal_list",null);

			if(banhji.pageLoaded["recurring_journal_list"]==undefined){
				banhji.pageLoaded["recurring_journal_list"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/audit_trial_report", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.auditTrialReport);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Audit Trial Report","audit_trial_report",null);

			if(banhji.pageLoaded["audit_trial_report"]==undefined){
				banhji.pageLoaded["audit_trial_report"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/statement_profit_loss", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementProfitLoss);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.statementProfitLoss;
			banhji.userManagement.addMultiTask("Statement of Profit or Loss","statement_profit_loss",null);

			if(banhji.pageLoaded["statement_profit_loss"]==undefined){
				banhji.pageLoaded["statement_profit_loss"] = true;
						
			}

			vm.pageLoad();
		}
	});	
	banhji.router.route("/statement_financial_position", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementFinancialPosition);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.statementFinancialPosition;
			banhji.userManagement.addMultiTask("Statement of Financial Position","statement_financial_position",null);

			if(banhji.pageLoaded["statement_financial_position"]==undefined){
				banhji.pageLoaded["statement_financial_position"] = true;
						
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/statement_profit_loss_comparison", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementProfitLossComparison);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Statement of Profit or Loss Comparison","statement_profit_loss_comparison",null);

			if(banhji.pageLoaded["statement_profit_loss_comparison"]==undefined){
				banhji.pageLoaded["statement_profit_loss_comparison"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");               

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":								
						sdate = today;
															  					
					  	break;
					case "week":			  	
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));						
						
					  	break;
					case "month":							  	
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":				
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/statement_financial_position_comparison", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementFinancialPositionComparison);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);			
			
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Statement of Financial Position Comparison","statement_financial_position_comparison",null);

			if(banhji.pageLoaded["statement_financial_position_comparison"]==undefined){
				banhji.pageLoaded["statement_financial_position_comparison"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/statement_changes_equity", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementChangesEquity);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);
			
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Statement Changes Equity","statement_changes_equity",null);

			if(banhji.pageLoaded["statement_changes_equity"]==undefined){
				banhji.pageLoaded["statement_changes_equity"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/statement_cash_flow", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.statementCashFlow);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.accountingMenu);
			var vm = banhji.journalReport;

			banhji.userManagement.addMultiTask("Statement of Cash Flow","statement_cash_flow",null);

			if(banhji.pageLoaded["statement_cash_flow"]==undefined){
				banhji.pageLoaded["statement_cash_flow"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

				$("#search").click(function(e){
		        	e.preventDefault();

		        	var para = [],		        	
					sdate = kendo.toString(start.value(), "yyyy-MM-dd"), 
					edate = kendo.toString(end.value(), "yyyy-MM-dd");
					
		        	//Dates
		        	if(start.value() && end.value()){
		            	para.push({ field:"issued_date >=", value: sdate });
		            	para.push({ field:"issued_date <=", value: edate });
		            }else if(start.value()){
		            	para.push({ field:"issued_date", value: sdate });
		            }else if(end.value()){
		            	para.push({ field:"issued_date <=", value: edate });
		            }else{
		            	
		            }

		            vm.dataSource.filter(para);
		        });
			}
		}
	});
	banhji.router.route("/account_recurring", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.accountRecurring);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.accountRecurring;
			banhji.userManagement.addMultiTask("Account Recurring","account_recurring",null);
			
			if(banhji.pageLoaded["account_recurring"]==undefined){
				banhji.pageLoaded["account_recurring"] = true;   
				
				vm.dataSource.filter({ field:"is_recurring", value: 1 });

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());
				 		
			}

			vm.pageLoad();
		}
	});

	/*************************
	*   SaleTax Section   *
	**************************/
	banhji.router.route("/sale_tax", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.saleTax);

			banhji.userManagement.addMultiTask("Tax Item","sale_tax",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			//banhji.view.menu.showIn('#secondary-menu', banhji.view.saleTaxMenu);
			
			var vm = banhji.saleTax;

			if(banhji.pageLoaded["sale_tax"]==undefined){
				banhji.pageLoaded["sale_tax"] = true;
			}
			$("#ddlIncome").kendoDropDownList({
	            optionLabel: "(--- Select ---)",
	            valuePrimitive: true,
	            dataTextField: "name",
	            dataValueField: "id",
	            template: '#=code# #=name#',
	            dataSource: {
	                transport: {
						read: {
							url: apiUrl + "accounts",
							headers: {
								"Entity": getDB()
							},
							type: "GET",
							dataType: "json"
						}
					},
					schema 	: {
						model: {
							id: 'id'
						},
						data: 'results',
						total: 'count'
					},
					serverFiltering: true,
					filter: { field:"account_type_id", value: 20 }
				}
	        }).data("kendoDropDownList");
		}		
	});
	banhji.router.route("/sale_tax_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.saleTaxReportCenter);

			banhji.userManagement.addMultiTask("Sale Tax Report Center","sale_tax_report_center",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.saleTaxMenu);
			
			var vm = banhji.sale_tax_report_center;

			if(banhji.pageLoaded["sale_tax_report_center"]==undefined){
				banhji.pageLoaded["sale_tax_report_center"] = true;
			}
			$("#ddlIncome").kendoDropDownList({
	            optionLabel: "(--- Select ---)",
	            valuePrimitive: true,
	            dataTextField: "name",
	            dataValueField: "id",
	            template: '#=code# #=name#',
	            dataSource: {
	                transport: {
						read: {
							url: apiUrl + "accounts",
							headers: {
								"Entity": getDB()
							},
							type: "GET",
							dataType: "json"
						}
					},
					schema 	: {
						model: {
							id: 'id'
						},
						data: 'results',
						total: 'count'
					},
					serverFiltering: true,
					filter: { field:"account_type_id", value: 20 }
				}
	        }).data("kendoDropDownList");
		}		
	});
	banhji.router.route("/sale_journal", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.saleJournal);

			banhji.userManagement.addMultiTask("Sale Journal","sale_journal",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.saleTaxMenu);
			
			var vm = banhji.sale_tax_report_center;

			if(banhji.pageLoaded["sale_journal"]==undefined){
				banhji.pageLoaded["sale_journal"] = true;
			}
			$("#ddlIncome").kendoDropDownList({
	            optionLabel: "(--- Select ---)",
	            valuePrimitive: true,
	            dataTextField: "name",
	            dataValueField: "id",
	            template: '#=code# #=name#',
	            dataSource: {
	                transport: {
						read: {
							url: apiUrl + "accounts",
							headers: {
								"Entity": getDB()
							},
							type: "GET",
							dataType: "json"
						}
					},
					schema 	: {
						model: {
							id: 'id'
						},
						data: 'results',
						total: 'count'
					},
					serverFiltering: true,
					filter: { field:"account_type_id", value: 20 }
				}
	        }).data("kendoDropDownList");
		}		
	});	
	banhji.router.route("/purchase_journal", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.purchaseJournal);

			banhji.userManagement.addMultiTask("Purchase Journal","purchase_journal",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.saleTaxMenu);
			
			var vm = banhji.sale_tax_report_center;

			if(banhji.pageLoaded["purchase_journal"]==undefined){
				banhji.pageLoaded["purchase_journal"] = true;
			}
			$("#ddlIncome").kendoDropDownList({
	            optionLabel: "(--- Select ---)",
	            valuePrimitive: true,
	            dataTextField: "name",
	            dataValueField: "id",
	            template: '#=code# #=name#',
	            dataSource: {
	                transport: {
						read: {
							url: apiUrl + "accounts",
							headers: {
								"Entity": getDB()
							},
							type: "GET",
							dataType: "json"
						}
					},
					schema 	: {
						model: {
							id: 'id'
						},
						data: 'results',
						total: 'count'
					},
					serverFiltering: true,
					filter: { field:"account_type_id", value: 20 }
				}
	        }).data("kendoDropDownList");
		}		
	});


	/*************************
	*   Employee Section   *
	**************************/
	banhji.router.route("/employees", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.employeeDashboard);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.employeeMenu);
			
			var vm = banhji.employeeDashboard;

			banhji.userManagement.addMultiTask("Employees Dashboard","employees",null);


			if(banhji.pageLoaded["employees"]==undefined){
				banhji.pageLoaded["employees"] = true;
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/employee_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.employeeCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.employeeMenu);
			
			var vm = banhji.employeeCenter;

			banhji.userManagement.addMultiTask("Employees Center","employee_center",null);

			if(banhji.pageLoaded["employee_center"]==undefined){
				banhji.pageLoaded["employee_center"] = true;
				vm.contactTypeDS.filter({ field:"parent_id", value:2 });
				
				vm.contactDS.query({
				  	filter:{ field:"parent_id", operator:"where_related", model:"contact_type", value:2 },
				  	page: 1,
				  	pageSize: 50
				}).then(function(e) {
				    var view = vm.contactDS.data();
				    
				    if(view.length>0){
				    	vm.set("obj", view[0]);
				    	vm.loadSummary(view[0].id);
				    	vm.loadTransaction(view[0].id);
				    	vm.loadNote(view[0].id);
				    }
				});

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
						
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:

					}

					start.value(sdate);
					end.value(edate);
					start.max(end.value());
                	end.min(start.value());
                	dateChanges();
                });
                start.max(end.value());
                end.min(start.value());
			}
		}
	});
	banhji.router.route("/employee(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.employee;
			vm.pageLoad(id);

			banhji.userManagement.addMultiTask("Employees","employee",null);
			
			banhji.view.layout.showIn("#content", banhji.view.employee);
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["employee"]==undefined){
				banhji.pageLoaded["employee"] = true;

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({
				    autoHideAfter: 5000,
				    width: 300,
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){
		        	e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});
			}
		}
	});	
	banhji.router.route("/employee_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.employeeReportCenter);

			banhji.userManagement.addMultiTask("Employee Reports","employee_report_center",null);

			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.employeeMenu);

			//var vm = banhji.customerReportCenter;
			
			if(banhji.pageLoaded["employee_report_center"]==undefined){
				banhji.pageLoaded["employee_report_center"] = true;
			}
		}
	});

	/*************************
	*   Vendor Section   *
	**************************/
	banhji.router.route("/vendors", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.vendorDashboard);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);
				
				var vm = banhji.vendorDashboard;
				banhji.userManagement.addMultiTask("Supplier Dashboard","vendors",null);
				if(banhji.pageLoaded["vendors"]==undefined){
					banhji.pageLoaded["vendors"] = true;
				}

				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/vendor_center(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.vendorCenter);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);
				
				var vm = banhji.vendorCenter;
				banhji.userManagement.addMultiTask("Supplier Center","vendor_center",null);

				if(banhji.pageLoaded["vendor_center"]==undefined){
					banhji.pageLoaded["vendor_center"] = true;
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/vendor(/:id)(/:is_pattern)", function(id, is_pattern){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.vendor;
				banhji.userManagement.addMultiTask("Supplier","vendor",vm);

				banhji.view.layout.showIn("#content", banhji.view.vendor);
				kendo.fx($("#slide-form")).slideIn("down").play();

				if(banhji.pageLoaded["vendor"]==undefined){
					banhji.pageLoaded["vendor"] = true;
			        var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_pattern);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/purchase_order(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {						
				banhji.view.layout.showIn("#content", banhji.view.purchaseOrder);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.purchaseOrder;
				banhji.userManagement.addMultiTask("Purchase Order","purchase_order",vm);

				if(banhji.pageLoaded["purchase_order"]==undefined){
					banhji.pageLoaded["purchase_order"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();
						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}
		// });
	});
	banhji.router.route("/grn(/:id)(/:is_recurring)", function(id,is_recurring){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.grn);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.grn;
			banhji.userManagement.addMultiTask("Goods Receive Note","grn",vm);

			if(banhji.pageLoaded["grn"]==undefined){
				banhji.pageLoaded["grn"] = true;

				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveRecurring").click(function(e){
					e.preventDefault();

					if(validator.validate() && vm.validateRecurring()){
		            	vm.set("saveRecurring", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id, is_recurring);
		}	});	
	banhji.router.route("/vendor_deposit(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.vendorDeposit);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.vendorDeposit;
				banhji.userManagement.addMultiTask("Supplier Deposit","vendor_deposit",vm);
				
				if(banhji.pageLoaded["vendor_deposit"]==undefined){
					banhji.pageLoaded["vendor_deposit"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}
		// });
	});	
	banhji.router.route("/purchase(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.purchase);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.purchase;
				banhji.userManagement.addMultiTask("Purchase","purchase",vm);

				if(banhji.pageLoaded["purchase"]==undefined){
					banhji.pageLoaded["purchase"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}
		// });
	});
	banhji.router.route("/purchase_return(/:id)", function(id){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.purchaseReturn);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.purchaseReturn;
				banhji.userManagement.addMultiTask("Purchase Return","purchase_return",vm);
				
				if(banhji.pageLoaded["purchase_return"]==undefined){
					banhji.pageLoaded["purchase_return"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();
						
						if(validator.validate() && vm.get("obj").remaining===0){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("obj").remaining===0){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate() && vm.get("obj").remaining===0){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });		
	});	
	banhji.router.route("/vendor_setting", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("supplier" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.vendorSetting);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);

				var vm = banhji.vendorSetting;
				banhji.userManagement.addMultiTask("Supplier Setting","vendor_setting",null);
				
				if(banhji.pageLoaded["vendor_setting"]==undefined){
					banhji.pageLoaded["vendor_setting"] = true;

				}

				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/vendor_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.vendorReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);

			var vm = banhji.vendorReportCenter;
			banhji.userManagement.addMultiTask("Supplier Report Center","vendor_report_center");

			//var vm = banhji.customerReportCenter;
			banhji.userManagement.addMultiTask("Expense/Purchase Managment Reports","vendor_report_center",null);

			if(banhji.pageLoaded["vendor_report_center"]==undefined){
				banhji.pageLoaded["vendor_report_center"] = true;
			}
			banhji.vendorReportCenter.dataSource.read();
			banhji.vendorReportCenter.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorReportCenter.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorReportCenter.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorReportCenter.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));
					banhji.vendorReportCenter.set('order', kendo.toString(e.response.order, 'n0'));
					banhji.vendorReportCenter.set('items', kendo.toString(e.response.items, 'n0'));
					banhji.vendorReportCenter.set('overDate', kendo.toString(e.response.overDate, 'n0'));
					banhji.vendorReportCenter.set('totalBalance', kendo.toString(e.response.totalBalance, 'c2'));
					banhji.vendorReportCenter.set('openBalance', kendo.toString(e.response.openBalance, 'n0'));
				}
			});
			vm.pageLoad();
		}
	});
	banhji.router.route("/expenses_purchase_summary_supplier", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.expensesPurchaseSummarySupplier;
			banhji.userManagement.addMultiTask("Expense Purchase Summary Supplier","expenses_purchase_summary_supplier"); 

			banhji.view.layout.showIn("#content", banhji.view.expensesPurchaseSummarySupplier);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.purchaseSummary.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.purchaseSummary.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorSale.set('segments', kendo.toString(e.response.segments, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/suppliers_transaction_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.suppliersTransactionList;
			banhji.userManagement.addMultiTask("Supplier Transaction List","suppliers_transaction_list"); 

			banhji.view.layout.showIn("#content", banhji.view.suppliersTransactionList);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.supplierTransaction.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});		
			banhji.vendorSale.supplierTransaction.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorSale.set('totalCashPurchase', kendo.toString(e.response.totalCashPurchase, 'c2'));	
					banhji.vendorSale.set('totalCashPayment', kendo.toString(e.response.totalCashPayment, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/expenses_purchase_detail_supplier", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.expensesPurchaseDetailSupplier;
			banhji.userManagement.addMultiTask("Expense Purchase Detail Supplier","expenses_purchase_detail_supplier"); 

			banhji.view.layout.showIn("#content", banhji.view.expensesPurchaseDetailSupplier);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.purchaseDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});	
			banhji.vendorSale.purchaseDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/deposit_detail_supplier", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.depositDetailSupplier;
			banhji.userManagement.addMultiTask("Deposit Detail Supplier","deposit_detail_supplier"); 

			banhji.view.layout.showIn("#content", banhji.view.depositDetailSupplier);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.depositDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});	
			banhji.vendorSale.depositDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/purchase_summary_product_services", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.purchaseSummaryProductServices;
			banhji.userManagement.addMultiTask("Purchase Summary Product/Service","purchase_summary_product_services"); 

			banhji.view.layout.showIn("#content", banhji.view.purchaseSummaryProductServices);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.summaryProduct.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.summaryProduct.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total_sale', kendo.toString(e.response.total_sale, 'c2'));
					banhji.vendorSale.set('total_avg', kendo.toString(e.response.total_avg, 'c'));
					banhji.vendorSale.set('gpm', kendo.toString(e.response.gpm, 'p'));
				}
			});
		}
	});
	banhji.router.route("/open_purchase_order", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.openPurchaseOrder;
			banhji.userManagement.addMultiTask("Open Purchase Order","open_purchase_order");

			banhji.view.layout.showIn("#content", banhji.view.openPurchaseOrder);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.purchaseOrder.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.purchaseOrder.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));		
					banhji.vendorSale.set('order', kendo.toString(e.response.order, 'n0'));	
					banhji.vendorSale.set('customer', kendo.toString(e.response.customer, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/purchase_detail_product_services", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.purchaseDetailProductServices;
			banhji.userManagement.addMultiTask("Purchase Detail Product/Service","purchase_detail_product_services");

			banhji.view.layout.showIn("#content", banhji.view.purchaseDetailProductServices);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.detailProduct.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.detailProduct.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.vendorSale.set('totalQuantity', kendo.toString(e.response.totalQuantity, 'n0'));	
					banhji.vendorSale.set('totaProdcuts', kendo.toString(e.response.totaProdcuts, 'n0'));
				}
			});
		}
	});	
	banhji.router.route("/suppliers_balance_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.suppliersBalanceSummary;
			banhji.userManagement.addMultiTask("Supplier Balance Summary","suppliers_balance_summary");

			banhji.view.layout.showIn("#content", banhji.view.suppliersBalanceSummary);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.supplierBalance.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.supplierBalance.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.vendorSale.set('openPurchase', kendo.toString(e.response.openPurchase, 'n0'));
					banhji.vendorSale.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/suppliers_balance_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.suppliersBalanceDetail;
			banhji.userManagement.addMultiTask("Supplier Balance Detail","suppliers_balance_detail");

			banhji.view.layout.showIn("#content", banhji.view.suppliersBalanceDetail);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.balanceDetailSupplier.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.balanceDetailSupplier.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorSale.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));	
					banhji.vendorSale.set('openBill', kendo.toString(e.response.openBill, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/payables_aging_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.payablesAgingSummary;
			banhji.userManagement.addMultiTask("Payables Aging Summary ","payables_aging_summary");

			banhji.view.layout.showIn("#content", banhji.view.payablesAgingSummary);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.payablesAging.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.payablesAging.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorSale.set('aging', kendo.toString(e.response.aging, 'n0'));
					banhji.vendorSale.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/payables_aging_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.payablesAgingDetail;
			banhji.userManagement.addMultiTask("Payables Aging Detail ","payables_aging_detail");

			banhji.view.layout.showIn("#content", banhji.view.payablesAgingDetail);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.payablesAgingDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.payablesAgingDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.vendorSale.set('aging', kendo.toString(e.response.aging, 'n0'));	
					banhji.vendorSale.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/list_bills_paid", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.listBillsPaid;
			banhji.userManagement.addMultiTask("List Bills Paid ","list_bills_paid");

			banhji.view.layout.showIn("#content", banhji.view.listBillsPaid);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.listBillsPaid.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.listBillsPaid.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.vendorSale.set('aging', kendo.toString(e.response.aging, 'n0'));	
					banhji.vendorSale.set('supplierCount', kendo.toString(e.response.supplierCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/bill_payment_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.billPaymentList;
			banhji.userManagement.addMultiTask("List of Payment","bill_payment_list");

			banhji.view.layout.showIn("#content", banhji.view.billPaymentList);
			banhji.vendorSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.vendorSale.billPaymentList.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.vendorSale.billPaymentList.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.vendorSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.vendorSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.vendorSale.set('numberPayment', kendo.toString(e.response.numberPayment, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/product_service_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.productServiceList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.vendorMenu);

			//var vm = banhji.customerReportCenter;
			banhji.userManagement.addMultiTask("Product/Service List","product_service_list",null);
			if(banhji.pageLoaded["product_service_list"]==undefined){
				banhji.pageLoaded["product_service_list"] = true;

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();
					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;
						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());	
			}
		}
	});	
	banhji.router.route("/supplier_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.supplierList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.supplierMenu);

			var vm = banhji.supplierList;
			
			if(banhji.pageLoaded["supplier_list"]==undefined){
				banhji.pageLoaded["supplier_list"] = true;
				
			}
		}
	});
	banhji.router.route("/vendor_recurring", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.vendorRecurring);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.vendorRecurring;
			banhji.userManagement.addMultiTask("Supplier Recurring","vendor_recurring",null);
			
			if(banhji.pageLoaded["vendor_recurring"]==undefined){
				banhji.pageLoaded["vendor_recurring"] = true;   
				
				vm.dataSource.filter({ field:"is_recurring", value: 1 });

				function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());
				 		
			}

			vm.pageLoad();
		}
	});


	/*************************
	*   Customer Section   *
	**************************/
	banhji.router.route("/customers", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.customerDashboard);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);
				
				//eraseCookie("isshow");
				var isshow = readCookie("cusVisit");
				
			    if (isshow != 1) {
			        createCookie("cusVisit", 1);
					$("a.aCustomer").click();
				}

				var vm = banhji.customerDashboard;
				banhji.userManagement.addMultiTask("Customer Dashboard","customers",null);
				if(banhji.pageLoaded["customers"]==undefined){
					banhji.pageLoaded["customers"] = true;
				}
				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/customer_center(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.customerCenter);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);
				
				var vm = banhji.customerCenter;
				banhji.userManagement.addMultiTask("Customer Center","customer_center",null);
				if(banhji.pageLoaded["customer_center"]==undefined){
					banhji.pageLoaded["customer_center"] = true;
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/customer(/:id)(/:is_pattern)", function(id,is_pattern){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.customer);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.customer;
				banhji.userManagement.addMultiTask("Customer","customer",vm);
				if(banhji.pageLoaded["customer"]==undefined){
					banhji.pageLoaded["customer"] = true;

			        var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						//e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("isDuplicateNumber")==false){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_pattern);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/quote(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.quote);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.quote;
				banhji.userManagement.addMultiTask("Quote","quote",vm);

				if(banhji.pageLoaded["quote"]==undefined){
					banhji.pageLoaded["quote"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });		
	});
	banhji.router.route("/sale_order(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.saleOrder);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.saleOrder;
				banhji.userManagement.addMultiTask("Sale Order","sale_order",vm);
				if(banhji.pageLoaded["sale_order"]==undefined){
					banhji.pageLoaded["sale_order"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });		
	});
	banhji.router.route("/customer_deposit(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.customerDeposit);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.customerDeposit;
				banhji.userManagement.addMultiTask("Customer Deposit","customer_deposit",vm);

				if(banhji.pageLoaded["customer_deposit"]==undefined){
					banhji.pageLoaded["customer_deposit"] = true;

			        var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}
		// });
	});
	banhji.router.route("/cash_sale(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.cashSale);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.cashSale;
				banhji.userManagement.addMultiTask("Cash Sale","cash_sale",vm);
				if(banhji.pageLoaded["cash_sale"]==undefined){
					banhji.pageLoaded["cash_sale"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);

		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });			
	});
	banhji.router.route("/invoice(/:id)(/:is_recurring)", function(id,is_recurring){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.invoice);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.invoice;
				banhji.userManagement.addMultiTask("Invoice","invoice",vm);
				if(banhji.pageLoaded["invoice"]==undefined){
					banhji.pageLoaded["invoice"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveRecurring").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.validateRecurring()){
			            	vm.set("saveRecurring", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_recurring);
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}
		// });
	});
	banhji.router.route("/gdn(/:id)(/:is_recurring)", function(id,is_recurring){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.gdn);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.gdn;
			banhji.userManagement.addMultiTask("GDN","gdn",vm);
			if(banhji.pageLoaded["gdn"]==undefined){
				banhji.pageLoaded["gdn"] = true;

				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveRecurring").click(function(e){
					e.preventDefault();

					if(validator.validate() && vm.validateRecurring()){
		            	vm.set("saveRecurring", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id, is_recurring);
		}		
	});
	banhji.router.route("/sale_return(/:id)", function(id){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.saleReturn);
				kendo.fx($("#slide-form")).slideIn("down").play();

				var vm = banhji.saleReturn;
				banhji.userManagement.addMultiTask("Sale Return","sale_return",vm);
				if(banhji.pageLoaded["sale_return"]==undefined){
					banhji.pageLoaded["sale_return"] = true;
					
			        var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();
						
						if(validator.validate() && vm.get("obj").remaining===0){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate() && vm.get("obj").remaining===0){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate() && vm.get("obj").remaining===0){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
		// 		} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });		
	});
	banhji.router.route("/statement(/:id)", function(){
		// banhji.accessMod.query({
		// 	filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		// }).then(function(e){
		// 	var allowed = false;
		// 	if(banhji.accessMod.data().length > 0) {
		// 		for(var i = 0; i < banhji.accessMod.data().length; i++) {
		// 			if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
		// 				allowed = true;
		// 				break;
		// 			}
		// 		}
		// 	} 
		// 	if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.statement);

				var vm = banhji.statement;
				banhji.userManagement.addMultiTask("Statement","statement",null);

				if(banhji.pageLoaded["statement"]==undefined){
					banhji.pageLoaded["statement"] = true;
					
				}

				vm.pageLoad();
		// 	} else {
		// 		window.location.replace(baseUrl + "admin");
		// 	}				
		// });
	});
	banhji.router.route("/customer_setting", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("customer" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.customerSetting);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

				var vm = banhji.customerSetting;
				banhji.userManagement.addMultiTask("Customer Setting","customer_setting",null);
				if(banhji.pageLoaded["customer_setting"]==undefined){
					banhji.pageLoaded["customer_setting"] = true;
					
					vm.contactTypeDS.filter({ field:"parent_id", value:1 });
				}

				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/customer_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerReportCenter;
			banhji.userManagement.addMultiTask("Customer Reports Center","customer_report_center",null);
			if(banhji.pageLoaded["customer_report_center"]==undefined){
				banhji.pageLoaded["customer_report_center"] = true;
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/customer_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerList;
			banhji.userManagement.addMultiTask("Customer List","customer_list",null);
			if(banhji.pageLoaded["customer_list"]==undefined){
				banhji.pageLoaded["customer_list"] = true;
				
			}
		}
	});
	banhji.router.route("/customer_balance", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerBalance);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerBalance;
			banhji.userManagement.addMultiTask("Customer Balance","customer_balance",null);
			if(banhji.pageLoaded["customer_balance"]==undefined){
				banhji.pageLoaded["customer_balance"] = true;
				
				vm.search();
			}
		}
	});
	banhji.router.route("/job", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.job);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);
			
			var vm = banhji.job;
			banhji.userManagement.addMultiTask("Job","job",null);
			if(banhji.pageLoaded["job"]==undefined){
				banhji.pageLoaded["job"] = true;
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/invoice_custom(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.invoiceCustom);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.invoiceCustom;
			
			if(banhji.pageLoaded["invoice_custom"]==undefined){
				banhji.pageLoaded["invoice_custom"] = true;

				//Function write css to header
				function loadStyle(href){
				    // avoid duplicates
				    for(var i = 0; i < document.styleSheets.length; i++){
				        if(document.styleSheets[i].href == href){
				            return;
				        }
				    }
				    var head  = document.getElementsByTagName('head')[0];
				    var link  = document.createElement('link');
				    link.rel  = 'stylesheet';
				    link.type = 'text/css';
				    link.href = href;
				    head.appendChild(link);
				}
				var Href1 = '<?php echo base_url(); ?>assets/invoice/invoice.css';
				loadStyle(Href1);
				setTimeout(function(){
					var validator = $("#example").kendoValidator().data("kendoValidator");
					var notification = $("#notification").kendoNotification({
					    autoHideAfter: 5000,
					    width: 300,
					    height: 50
					}).data('kendoNotification');
					$("#saveNew").click(function(e){
						e.preventDefault();
						if(validator.validate()){
			            	vm.save();

			            	notification.success("Save Successful");
				        }else{
				        	notification.error("Warning, please review it again!");
				        }
					});
					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
			            	window.history.back();

			            	notification.success("Save Successful");
				        }else{
				        	notification.error("Warning, please review it again!");
				        }
					});
				},2000);
			};
			
			vm.pageLoad(id);
		};
	});
	banhji.router.route("/invoice_form(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.invoiceForm);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.invoiceForm;
			banhji.userManagement.addMultiTask("Customer Form","invoice_form",null);
			if(banhji.pageLoaded["invoice_form"]==undefined){
				banhji.pageLoaded["invoice_form"] = true;

				//Function write css to header
				function loadStyle(href){
				    // avoid duplicates
				    for(var i = 0; i < document.styleSheets.length; i++){
				        if(document.styleSheets[i].href == href){
				            return;
				        }
				    }
				    var head  = document.getElementsByTagName('head')[0];
				    var link  = document.createElement('link');
				    link.rel  = 'stylesheet';
				    link.type = 'text/css';
				    link.href = href;
				    head.appendChild(link);
				}
				var Href1 = '<?php echo base_url(); ?>assets/invoice/invoice.css';
				loadStyle(Href1);
			};
			
			vm.pageLoad(id);
		};
	});
	banhji.router.route("/sale_summary_customer", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleSummaryCustomer;
			banhji.userManagement.addMultiTask("Sale Summary Customer Report","sale_summary_customer",null);

			banhji.view.layout.showIn("#content", banhji.view.saleSummaryCustomer);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.saleSummaryCustomer.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
		
			banhji.customerSale.saleSummary.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/sale_detail_customer", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleDetailCustomer;
			banhji.userManagement.addMultiTask("Sale Detail Customer Report","sale_detail_customer",null);

			banhji.view.layout.showIn("#content", banhji.view.saleDetailCustomer);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.detailSummary.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.detailSummary.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/deposit_detail_customer", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.depositDetailCustomer;
			banhji.userManagement.addMultiTask("Deposit Detail by Customer","deposit_detail_customer",null);

			banhji.view.layout.showIn("#content", banhji.view.depositDetailCustomer);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.depositDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.depositDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/customer_transaction_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.customerTransactionList;
			banhji.userManagement.addMultiTask("Customer Transaction List","customer_transaction_list",null);

			banhji.view.layout.showIn("#content", banhji.view.customerTransactionList);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.customerTransaction.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.customerTransaction.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('cashSale', kendo.toString(e.response.cashSale, 'c2'));
					banhji.customerSale.set('totalCashSale', kendo.toString(e.response.totalCashSale, 'c2'));
					banhji.customerSale.set('totalCashReceipt', kendo.toString(e.response.totalCashReceipt, 'c2'));
					banhji.customerSale.set('customerBalance', kendo.toString(e.response.customerBalance, 'c2'));
					banhji.customerSale.set('totalSale', kendo.toString(e.response.totalSale, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/sale_summary_product", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleSummaryProduct;
			banhji.userManagement.addMultiTask("Sale Summary by Product","sale_summary_product",null);

			banhji.view.layout.showIn("#content", banhji.view.saleSummaryProduct);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.summaryProductSale.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.summaryProductSale.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.customerSale.set('total_sale', kendo.toString(e.response.total_sale, 'c2'));
					banhji.customerSale.set('total_avg', kendo.toString(e.response.total_avg, 'c2'));	
					banhji.customerSale.set('gpm', kendo.toString(e.response.gpm, 'p'));
				}
			});
		}
	});	
	banhji.router.route("/sale_detail_product", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleDetailProduct;
			banhji.userManagement.addMultiTask("Sale Detail by Product","sale_detail_product",null);

			banhji.view.layout.showIn("#content", banhji.view.saleDetailProduct);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.detailCustomerSale.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.detailCustomerSale.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('totalQty', kendo.toString(e.response.totalQty, 'n0'));	
					banhji.customerSale.set('productSale', kendo.toString(e.response.productSale, 'n0'));	
				}
			});
		}
	});
	banhji.router.route("/customer_balance_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.customerBalanceSummary;
			banhji.userManagement.addMultiTask("Customer Balance Summary","customer_balance_summary",null);

			banhji.view.layout.showIn("#content", banhji.view.customerBalanceSummary);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.summaryBalance.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.summaryBalance.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('openInvoice', kendo.toString(e.response.openInvoice, 'n0'));
					banhji.customerSale.set('customerCount', kendo.toString(e.response.customerCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/customer_balance_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.customerBalanceDetail;
			banhji.userManagement.addMultiTask("Customer Balance Detail","customer_balance_detail",null);

			banhji.view.layout.showIn("#content", banhji.view.customerBalanceDetail);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.saleDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});	
			banhji.customerSale.saleDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));	
					banhji.customerSale.set('openInvoice', kendo.toString(e.response.openInvoice, 'n0'));
					banhji.customerSale.set('customerCount', kendo.toString(e.response.customerCount, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/receivable_aging_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.receivableAgingSummary;
			banhji.userManagement.addMultiTask("Receivable Aging Summary","receivable_aging_summary",null);

			banhji.view.layout.showIn("#content", banhji.view.receivableAgingSummary);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.receivableAging.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.receivableAging.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('cashSale', kendo.toString(e.response.cashSale, 'c2'));
					banhji.customerSale.set('aging', kendo.toString(e.response.aging, '0'));
				}
			});
		}
	});
	banhji.router.route("/receivable_aging_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.receivableAgingDetail;
			banhji.userManagement.addMultiTask("Receivable Aging Detail","receivable_aging_detail",null);

			banhji.view.layout.showIn("#content", banhji.view.receivableAgingDetail)
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.receivableDetail.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.receivableDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('aging', kendo.toString(e.response.aging, '0'));
				}
			});
		}
	});
	banhji.router.route("/list_invoices_collect", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.listInvoicesCollect;
			banhji.userManagement.addMultiTask("List Invoice Collect","list_invoices_collect",null);

			banhji.view.layout.showIn("#content", banhji.view.listInvoicesCollect);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.listInvoicesCollect.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.listInvoicesCollect.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('aging', kendo.toString(e.response.aging, '0'));
				}
			});
		}
	});
	banhji.router.route("/collect_report", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.collectReport;
			banhji.userManagement.addMultiTask("Report to be Collect","collect_report",null);

			banhji.view.layout.showIn("#content", banhji.view.collectReport);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.collectReportDB.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.collectReportDB.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('totalInvoice', kendo.toString(e.response.totalInvoice, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/invoice_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.invoiceList;
			banhji.userManagement.addMultiTask("Invoice List","invoice_list",null);

			banhji.view.layout.showIn("#content", banhji.view.invoiceList);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.invoiceListDB.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.invoiceListDB.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('totalCreditSale', kendo.toString(e.response.totalCreditSale, 'c2'));
					banhji.customerSale.set('totalBalance', kendo.toString(e.response.totalBalance, 'c2'));
					banhji.customerSale.set('totalInvoice', kendo.toString(e.response.totalInvoice, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/customer_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.customerList;
			banhji.userManagement.addMultiTask("Customer List","customer_list",null);

			banhji.view.layout.showIn("#content", banhji.view.customerList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

			var vm = banhji.customerList;
			
			if(banhji.pageLoaded["customer_list"]==undefined){
				banhji.pageLoaded["customer_list"] = true;
				
			}
		}
	});
	banhji.router.route("/sale_job_engagement", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleJobEngagement;
			banhji.userManagement.addMultiTask("Sale Job Engagement","sale_job_engagement",null);

			banhji.view.layout.showIn("#content", banhji.view.saleJobEngagement);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.saleJob.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.saleJob.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('saleNumber', kendo.toString(e.response.saleNumber, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/sale_order_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.saleOrderList;
			banhji.userManagement.addMultiTask("List of Sale Order","sale_order_list",null);

			banhji.view.layout.showIn("#content", banhji.view.saleOrderList);
			banhji.customerSale.set('startDate', new Date().getFullYear() + "-01-01");
			banhji.customerSale.saleOrderDB.dataSource.filter({
				logic: banhji.saleSummaryCustomer.get('filteredBy'),
				filters: [
					{field: "issued_date >=", value: kendo.toString(new Date().getFullYear() + "-01-01", "yyyy-MM-dd")},
					{field: "issued_date <=", value: kendo.toString(new Date(), "yyyy-MM-dd")}
				]
			});
			banhji.customerSale.saleOrderDB.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.customerSale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.customerSale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.customerSale.set('order', kendo.toString(e.response.order, 'n0'));
					banhji.customerSale.set('customer', kendo.toString(e.response.customer, 'n0'));
					banhji.customerSale.set('totalQty', kendo.toString(e.response.totalQty, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/cash_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);

			var vm = banhji.cashSetting;
			banhji.userManagement.addMultiTask("Cash Setting","cash_setting",null);
			if(banhji.pageLoaded["cash_setting"]==undefined){
				banhji.pageLoaded["cash_setting"] = true;
				
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
			}

			vm.pageLoad();
		}
	});

	banhji.router.route("/customer_recurring", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.customerRecurring);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);

			var vm = banhji.customerRecurring;
			banhji.userManagement.addMultiTask("Customer Recurring","customer_recurring",null);
			if(banhji.pageLoaded["customer_recurring"]==undefined){
				banhji.pageLoaded["customer_recurring"] = true;
				
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
			}

			vm.pageLoad();
		}
	});


	/*************************
	*   Cashier Section   *
	**************************/
	banhji.router.route("/cashier(/:id)", function(id){
		banhji.view.layout.showIn("#content", banhji.view.cashier);
		kendo.fx($("#slide-form")).slideIn("down").play();

		var vm = banhji.cashier;
		banhji.userManagement.addMultiTask("Cashier Dashboard","cashier",null);
		if(banhji.pageLoaded["cashier"]==undefined){
			banhji.pageLoaded["cashier"] = true;
			
			$("#ddlContact").kendoComboBox({
				placeholder: "លេខកូដ...",
				valuePrimitive: true,
                dataTextField: "fullname",
                dataValueField: "id",
                filter: "search",
                autoBind: false,
                minLength: 3,
                height: 400,
                dataSource: vm.contactDS,
                change: function(e) {
				    var value = this.value(),
				    data = this.dataSource.get(value);

				    vm.set("customer", data);
				    vm.transactionDS.filter({ field:"contact_id", value: value });
				    vm.loadInvoice(value, data.fullname, data.account_id);
				},
				template:'#=number# #=fullname#'
            });

	        $("#ddlCashAccount").kendoDropDownList({
	            optionLabel: "(--- Select ---)",
	            valuePrimitive: true,
	            dataTextField: "name",
	            dataValueField: "id",
	            dataSource: {
	                transport: {
						read: {
							url: apiUrl + "accounts",
							headers: {
								"Entity": getDB()
							},
							type: "GET",
							dataType: "json"
						}
					},
					schema 	: {
						model: {
							id: 'id'
						},
						data: 'results',
						total: 'count'
					},
					serverFiltering: true,
					filter: { field:"account_type_id", value: 6 }
				},
				template: '#=number# #=name#'
	        }).data("kendoDropDownList");

	        var validator = $("#example").kendoValidator().data("kendoValidator");
			var notification = $("#notification").kendoNotification({
			    autoHideAfter: 5000,
			    width: 300,
			    height: 50
			}).data('kendoNotification');

	        $("#save").click(function(e){
				e.preventDefault();

				if(validator.validate()){
	            	vm.save();

	            	notification.success("Save Successful");
		        }else{
		        	notification.error("Warning, please review it again!");
		        }
			});
		}

		vm.pageLoad(id);
	});
	banhji.router.route("/reconcile(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.reconcile);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.reconcile;
			banhji.userManagement.addMultiTask("Reconcile & Transfer","reconcile",vm);

			vm.pageLoad(id);
			
			if(banhji.pageLoaded["reconcile"]==undefined){
				banhji.pageLoaded["reconcile"] = true;

				$("#ddlCashAccount").kendoDropDownList({
		            optionLabel: "(--- Select ---)",
		            valuePrimitive: true,
		            dataTextField: "name",
		            dataValueField: "id",
		            dataSource: {
		                transport: {
							read: {
								url: apiUrl + "accounts",
								headers: {
									"Entity": getDB()
								},
								type: "GET",
								dataType: "json"
							}
						},
						schema 	: {
							model: {
								id: 'id'
							},
							data: 'results',
							total: 'count'
						},
						serverFiltering: true,
						filter: { field:"account_type_id", value: 6 }
					},
					template: '#=number# #=name#'
		        }).data("kendoDropDownList");

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({
				    autoHideAfter: 5000,
				    width: 300,
				    height: 50
				}).data('kendoNotification');
				
		        $("#save").click(function(e){
					e.preventDefault();

					if(validator.validate() && vm.get("isExisting")==false && vm.get("obj").transfered_amount>0){
		            	vm.save();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});
			}
		}
	});
	banhji.router.route("/cash_transaction(/:id)(/:is_recurring)", function(id,is_recurring){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashTransaction);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.cashTransaction;
			banhji.userManagement.addMultiTask("Cash Transaction","cash_transaction",vm);
			
			if(banhji.pageLoaded["cash_transaction"]==undefined){
				banhji.pageLoaded["cash_transaction"] = true;
 
				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveRecurring").click(function(e){
					e.preventDefault();
					
					if(validator.validate() && vm.validateRecurring()){
		            	vm.set("saveRecurring", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id,is_recurring);
		}
	});
	banhji.router.route("/cash_receipt(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		} else {
			banhji.view.layout.showIn("#content", banhji.view.cashReceipt);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.cashReceipt;
			banhji.userManagement.addMultiTask("Cash Receipt","cash_receipt",vm);
			
			if(banhji.pageLoaded["cash_receipt"]==undefined){
				banhji.pageLoaded["cash_receipt"] = true;

				vm.paymentTermDS.read();

				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id);
		}		
	});
	banhji.router.route("/cash_payment(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashPayment);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.cashPayment;
			banhji.userManagement.addMultiTask("Cash Payment","cash_payment",vm);
			
			if(banhji.pageLoaded["cash_payment"]==undefined){
				banhji.pageLoaded["cash_payment"] = true;

				vm.paymentTermDS.read();

				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id);
		}		
	});


	/*************************
	*   Document Section   *
	**************************/
	banhji.router.route("/documents", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
				if(banhji.accessMod.data().length > 0) {
					for(var i = 0; i < banhji.accessMod.data().length; i++) {
						if("documents" == banhji.accessMod.data()[i].name.toLowerCase()) {
							banhji.view.layout.showIn("#content", banhji.view.documents);
							//banhji.view.layout.showIn('#menu', banhji.view.menu);
							//banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

							var vm = banhji.fileManagement;
							banhji.userManagement.addMultiTask("Attached Documents","documents",null);
							if(banhji.pageLoaded["documents"]==undefined){
								banhji.pageLoaded["documents"] = true;
							}
							vm.dataSource.read();
							vm.dataSource.bind('requestEnd', function(e){
								if(e.type == 'read') {
									vm.set('contactNu', e.response.contactNumber);
									vm.set('contactSize', kendo.toString(e.response.contactSize, "n2"));
									vm.set('transactionNu', e.response.transactionNumber);
									vm.set('transactionSize', kendo.toString(e.response.transactionSize, "n2"));
									vm.set('totalSize', kendo.toString(e.response.total, 'n2'));
								}
							});
							break;
						}
					}
				} else {
					window.location.replace(baseUrl + "admin");
				}				
			}
		);
		// if(!checkRole("documents")){
		// 	window.location.replace(baseUrl + "admin");
		// }else{
		// 	banhji.view.layout.showIn("#content", banhji.view.documents);
		// 	//banhji.view.layout.showIn('#menu', banhji.view.menu);
		// 	//banhji.view.menu.showIn('#secondary-menu', banhji.view.customerMenu);

		// 	var vm = banhji.fileManagement;			
		// 	banhji.userManagement.addMultiTask("Attached Documents","documents",null);
		// 	if(banhji.pageLoaded["documents"]==undefined){
		// 		banhji.pageLoaded["documents"] = true;					
		// 	}
		// 	vm.dataSource.read();
		// 	vm.dataSource.bind('requestEnd', function(e){
		// 		if(e.type == 'read') {
		// 			vm.set('contactNu', e.response.contactNumber);
		// 			vm.set('contactSize', e.response.contactSize);
		// 			vm.set('transactionNu', e.response.transactionNumber);
		// 			vm.set('transactionSize', e.response.transactionSize);
		// 			vm.set('totalSize', e.response.total);
		// 		}
		// 	});			
		// }		
	});


	/*************************
	*   Inventory Section   *
	**************************/
	banhji.router.route("/inventories", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.itemDashBoard);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
				
				var vm = banhji.itemDashBoard;
				banhji.userManagement.addMultiTask("Products/Services Dashboard","inventories",null);

				if(banhji.pageLoaded["inventories"]==undefined){
					banhji.pageLoaded["inventories"] = true;
				}

				banhji.itemDashBoard.positionSummary.read();
				banhji.itemDashBoard.positionSummary.bind('requestEnd', function(e){
					if(e.response) {
						banhji.itemDashBoard.set('count', e.response.count);
						kendo.culture(banhji.locale);
						banhji.itemDashBoard.set('onHand', kendo.toString(e.response.onHand, 'n0'));
					}
				});
				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});	
	banhji.router.route("/item_center(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.itemCenter);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
				
				var vm = banhji.itemCenter;

				banhji.userManagement.addMultiTask("Inventory Center","item_center",null);

				if(banhji.pageLoaded["item_center"]==undefined){
					banhji.pageLoaded["item_center"] = true;
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item(/:id)(/:is_pattern)", function(id, is_pattern){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.item;
							
				banhji.view.layout.showIn("#content", banhji.view.item);
				banhji.userManagement.addMultiTask("Inventory For Sale","item",null);

				if(banhji.pageLoaded["item"]==undefined){
					banhji.pageLoaded["item"] = true;
					
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_pattern);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item_prices/:id", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.itemPrice;

				banhji.userManagement.addMultiTask("Inventory Price","item_prices",null);
				
				banhji.view.layout.showIn("#content", banhji.view.itemPrice);
				
				if(banhji.pageLoaded["item_prices"]==undefined){
					banhji.pageLoaded["item_prices"] = true;
					
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item_catalog(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.itemCatalog;

				banhji.userManagement.addMultiTask("Inventory Catalog","item_catalog",vm);
				
				banhji.view.layout.showIn("#content", banhji.view.itemCatalog);
				
				if(banhji.pageLoaded["item_catalog"]==undefined){
					banhji.pageLoaded["item_catalog"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item_assembly(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.itemAssembly;

				banhji.userManagement.addMultiTask("Inventory Assembly","item_assembly",vm);
				
				banhji.view.layout.showIn("#content", banhji.view.itemAssembly);
				
				if(banhji.pageLoaded["item_assembly"]==undefined){
					banhji.pageLoaded["item_assembly"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item_service(/:id)(/:is_pattern)", function(id, is_pattern){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.itemService;

				banhji.userManagement.addMultiTask("Service","item_service",vm);
				
				banhji.view.layout.showIn("#content", banhji.view.itemService);
				
				if(banhji.pageLoaded["item_service"]==undefined){
					banhji.pageLoaded["item_service"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_pattern);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/non_inventory_part(/:id)(/:is_pattern)", function(id, is_pattern){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.nonInventoryPart;

				banhji.userManagement.addMultiTask("Other Inventory","non_inventory_part",vm);
				
				banhji.view.layout.showIn("#content", banhji.view.nonInventoryPart);
				
				if(banhji.pageLoaded["non_inventory_part"]==undefined){
					banhji.pageLoaded["non_inventory_part"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id, is_pattern);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/fixed_assets(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.fixedAssets);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

				var vm = banhji.fixedAssets;

				banhji.userManagement.addMultiTask("Fixed Assets","fixed_assets",vm);

				if(banhji.pageLoaded["fixed_assets"]==undefined){
					banhji.pageLoaded["fixed_assets"] = true;
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/txn_item(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				var vm = banhji.txnItem;
				banhji.userManagement.addMultiTask("Transaction Item","txn_item",vm);
				
				banhji.view.layout.showIn("#content", banhji.view.txnItem);
				
				if(banhji.pageLoaded["txn_item"]==undefined){
					banhji.pageLoaded["txn_item"] = true;

					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/item_adjustment(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.itemAdjustment);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

				var vm = banhji.itemAdjustment;

				banhji.userManagement.addMultiTask("Inventory Adjustment","item_adjustment",vm);

				if(banhji.pageLoaded["item_adjustment"]==undefined){
					banhji.pageLoaded["item_adjustment"] = true;
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});
	banhji.router.route("/internal_usage(/:id)", function(id){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.internalUsage);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

				var vm = banhji.internalUsage;

				banhji.userManagement.addMultiTask("Internal Usage","internal_usage",null);
				
				if(banhji.pageLoaded["internal_usage"]==undefined){
					banhji.pageLoaded["internal_usage"] = true;
					
					var validator = $("#example").kendoValidator().data("kendoValidator");
			        $("#saveNew").click(function(e){
						e.preventDefault();

						if(validator.validate()){
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#saveClose").click(function(e){
						e.preventDefault();

						if(validator.validate()){
							vm.set("saveClose", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});

					$("#savePrint").click(function(e){
						e.preventDefault();
						
						if(validator.validate()){
							vm.set("savePrint", true);
			            	vm.save();
				        }else{
				        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
				        }
					});
				}

				vm.pageLoad(id);
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});	
	});
	banhji.router.route("/item_setting", function(){
		banhji.accessMod.query({
			filter: {field: 'username', value: JSON.parse(localStorage.getItem('userData/user')).username}
		}).then(function(e){
			var allowed = false;
			if(banhji.accessMod.data().length > 0) {
				for(var i = 0; i < banhji.accessMod.data().length; i++) {
					if("products/services" == banhji.accessMod.data()[i].name.toLowerCase()) {
						allowed = true;
						break;
					}
				}
			} 
			if(allowed) {
				banhji.view.layout.showIn("#content", banhji.view.itemSetting);
				banhji.view.layout.showIn('#menu', banhji.view.menu);
				banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

				var vm = banhji.itemSetting;

				banhji.userManagement.addMultiTask("General Products/ Services Setting","item_setting",null);
				
				if(banhji.pageLoaded["item_setting"]==undefined){
					banhji.pageLoaded["item_setting"] = true;
					
				}

				vm.pageLoad();
			} else {
				window.location.replace(baseUrl + "admin");
			}
		});
	});	

	banhji.router.route("/service_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.serviceSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.serviceSetting;

			banhji.userManagement.addMultiTask("General Service Setting","service_setting",null);
			
			if(banhji.pageLoaded["service_setting"]==undefined){
				banhji.pageLoaded["service_setting"] = true;
				
				vm.categoryDS.filter({ field:"item_type_id", operator:"where_in", value: [4,6] });
				vm.itemTypeDS.filter({ field:"id", operator:"where_in", value: [4,6] });
				vm.itemGroupDS.filter({ field:"id", operator:"where_in", value: [3,4] });
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/item_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemReportCenter);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.itemReportCenter;
			
			if(banhji.pageLoaded["item_report_center"]==undefined){
				banhji.pageLoaded["item_report_center"] = true;
			};
			vm.pageLoad();
		};
	});
	banhji.router.route("/inventory_position_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.inventoryPositionSummary;
			banhji.userManagement.addMultiTask("Inventory Position Summary","inventory_position_summary",null);

			banhji.view.layout.showIn("#content", banhji.view.inventoryPositionSummary);
			banhji.inventorySale.inventoryPositionSummary.dataSource.read();
			banhji.inventorySale.inventoryPositionSummary.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);	
					banhji.inventorySale.set('onHand', kendo.toString(e.response.onHand, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/inventory_sale_item_analysis", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.inventorySaleItemAnalysis;
			banhji.userManagement.addMultiTask("Inventory Sale Item Analysis","inventory_sale_item_analysis",null);

			banhji.view.layout.showIn("#content", banhji.view.inventorySaleItemAnalysis);
			banhji.inventorySale.inventorySaleDB.dataSource.read();
			banhji.inventorySale.inventorySaleDB.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.inventorySale.set('onHand', kendo.toString(e.response.onHand, 'n0'));
					banhji.inventorySale.set('sale', kendo.toString(e.response.sale, 'c2'));
					banhji.inventorySale.set('grossProfitMargin', kendo.toString(e.response.grossProfitMargin, 'p'));
				}
			});
		}
	});
	banhji.router.route("/inventory_position_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPositionDetail);
			banhji.inventorySale.inventoryPositionDetail.dataSource.read();
			banhji.inventorySale.inventoryPositionDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.inventorySale.set('total', kendo.toString(e.response.total, 'c2'));
					banhji.inventorySale.set('item', kendo.toString(e.response.item, 'n0'));
					banhji.inventorySale.set('service', kendo.toString(e.response.service, 'n0'));
					banhji.inventorySale.set('totalOnhand', kendo.toString(e.response.totalOnhand, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/inventory_turnover_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryTurnoverList);
			banhji.inventorySale.inventoryTurnoverList.dataSource.read();
			banhji.inventorySale.inventoryTurnoverList.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.inventorySale.set('onHand', kendo.toString(e.response.onHand, 'n0'));
					banhji.inventorySale.set('turnover', kendo.toString(e.response.turnover, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/inventory_movement_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryMovementSummary);
			banhji.inventorySale.inventoryMovementSummary.dataSource.read();
			banhji.inventorySale.inventoryMovementSummary.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.inventorySale.set('onHand', kendo.toString(e.response.onHand, 'n0'));
					banhji.inventorySale.set('sale', kendo.toString(e.response.sale, 'n0'));
				}
			});
		}
	});
	banhji.router.route("/inventory_movement_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryMovementDetail);
			banhji.inventorySale.inventoryMovementDetail.dataSource.read();
			banhji.inventorySale.inventoryMovementDetail.dataSource.bind('requestEnd', function(e){
				if(e.response) {
					banhji.inventorySale.set('count', e.response.count);
					kendo.culture(banhji.locale);
					banhji.inventorySale.set('total', kendo.toString(e.response.total, 'c2'));
				}
			});
		}
	});
	banhji.router.route("/inventory_sale_by_item", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventorySaleByItem);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventorySaleByItem;

			banhji.userManagement.addMultiTask("Inventory Sale By Item Analysis","inventory_sale_by_item",null);
			
			if(banhji.pageLoaded["inventory_sale_by_item"]==undefined){
				banhji.pageLoaded["inventory_sale_by_item"] = true;
			}
		}
	});
	banhji.router.route("/inventory_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);
			
			var vm = banhji.inventoryList;

			banhji.userManagement.addMultiTask("Inventory List","inventory_list",null);
			
			if(banhji.pageLoaded["inventory_list"]==undefined){
				banhji.pageLoaded["inventory_list"] = true;

				vm.vendorDS.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value: 2 });

				var categories = $("#categories").kendoDropDownList({
                    optionLabel: "(--- Category ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.categoryDS,
                    change: function(e) {
					    //var value = this.value();
					    vm.set("item_group_id", 0);
					}
                }).data("kendoDropDownList");

                var itemGroups = $("#itemGroups").kendoDropDownList({
                    autoBind: false,
                    cascadeFrom: "categories",
                    cascadeFromField: "category_id",
                    optionLabel: "(--- Group ---)",
                    dataTextField: "name",
                    dataValueField: "id",
                    dataSource: vm.itemGroupDS
                }).data("kendoDropDownList");


                function startChange() {
                    var startDate = start.value(),
                    endDate = end.value();

                    if (startDate) {
                        startDate = new Date(startDate);
                        startDate.setDate(startDate.getDate());
                        end.min(startDate);
                    } else if (endDate) {
                        start.max(new Date(endDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function endChange() {
                    var endDate = end.value(),
                    startDate = start.value();

                    if (endDate) {
                        endDate = new Date(endDate);
                        endDate.setDate(endDate.getDate());
                        start.max(endDate);
                    } else if (startDate) {
                        end.min(new Date(startDate));
                    } else {
                        endDate = new Date();
                        start.max(endDate);
                        end.min(endDate);
                    }

                    dateChanges();
                }

                function dateChanges(){
                	var strDate = "";

					if(start.value() && end.value()){
						strDate = "From " + kendo.toString(new Date(start.value()), "dd-MM-yyyy") + " To " + kendo.toString(new Date(end.value()), "dd-MM-yyyy");
					}else if(start.value()){
						strDate = "On " + kendo.toString(new Date(start.value()),"dd-MM-yyyy");
					}else if(end.value()){
						strDate = "As Of " + kendo.toString(new Date(end.value()),"dd-MM-yyyy");
					}else{
						strDate = "";
					}

					$("#strDate").text(strDate);
                }

                var start = $("#sdate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: startChange
                }).data("kendoDatePicker");

                var end = $("#edate").kendoDatePicker({
                	format: "dd-MM-yyyy",
                    change: endChange
                }).data("kendoDatePicker");

                var sorter = $("#sorter").change(function(){
                	var today = new Date(),
                	sdate = "",
                	edate = "",
                	value = $("#sorter").val();

					switch(value){
					case "today":
						sdate = today;
					  	break;
					case "week":
						var first = today.getDate() - today.getDay(),
						last = first + 6;

						var sdate = new Date(today.setDate(first)),
						edate = new Date(today.setDate(last));
					  	break;
					case "month":
						var sdate = new Date(today.getFullYear(), today.getMonth(), 1),
						edate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

					  	break;
					case "year":
					  	var sdate = new Date(today.getFullYear(), 0, 1),
					  	edate = new Date(today.getFullYear(), 11, 31);

					  	break;
					default:
					}

					start.value(sdate);
					end.value(edate);
					
					start.max(end.value());
                	end.min(start.value());

                	dateChanges();
                });
                
                start.max(end.value());
                end.min(start.value());

			}

			vm.pageLoad();
		}
	});	
	banhji.router.route("/inventory_purchase_by_vendor_summary", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPurchaseByVendorSummary);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPurchaseByVendorSummary;

			banhji.userManagement.addMultiTask("Purchase By Supplier Summary","inventory_purchase_by_vendor_summary",null);		
			
			if(banhji.pageLoaded["inventory_purchase_by_vendor_summary"]==undefined){
				banhji.pageLoaded["inventory_purchase_by_vendor_summary"] = true;
				
			}
		}
	});
	banhji.router.route("/inventory_purchase_by_vendor_detail", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.inventoryPurchaseByVendorDetail);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.inventoryPurchaseByVendorDetail;

			banhji.userManagement.addMultiTask("Purchase By Supplier Detail","inventory_purchase_by_vendor_detail",null);		
			
			if(banhji.pageLoaded["inventory_purchase_by_vendor_detail"]==undefined){
				banhji.pageLoaded["inventory_purchase_by_vendor_detail"] = true;
				
			}
		}
	});
	banhji.router.route("/item_recurring", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.itemRecurring);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.inventoryMenu);

			var vm = banhji.itemRecurring;

			banhji.userManagement.addMultiTask("Products/Services Recurring","item_recurring",vm);

			if(banhji.pageLoaded["item_recurring"]==undefined){
				banhji.pageLoaded["item_recurring"] = true;
				var validator = $("#example").kendoValidator().data("kendoValidator");
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
						vm.set("saveClose", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();
					
					if(validator.validate()){
						vm.set("savePrint", true);
		            	vm.save();
			        }else{
			        	$("#ntf1").data("kendoNotification").error(banhji.source.errorMessage);
			        }
				});
			}

			vm.pageLoad(id);
		}
	});


	/*************************
	*   Cash Managment   *
	**************************/
	banhji.router.route("/cashs", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashDashboard);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);
			
			var vm = banhji.cashDashboard;
			banhji.userManagement.addMultiTask("Cash Dashboard","cashs",null);

			if(banhji.pageLoaded["cashs"]==undefined){
				banhji.pageLoaded["cashs"] = true;
				banhji.cashDashboard.graphDS.fetch();
				banhji.cashDashboard.topCashDS.read();
				banhji.cashDashboard.topCashDS.bind('requestEnd', function(e) {
					if(e.response) {
						kendo.culture(banhji.locale);
						banhji.cashDashboard.set('balance', kendo.toString(e.response.balance, 'c2'));
						banhji.cashDashboard.set('cashACNumber', e.response.cashACNumber);
					}
				});

				banhji.cashDashboard.topAdvaDS.read();
				banhji.cashDashboard.topAdvaDS.bind('requestEnd', function(e) {
					if(e.response) {
						kendo.culture(banhji.locale);
						banhji.cashDashboard.set('open', e.response.open);
						banhji.cashDashboard.set('overDue', e.response.overDue);
						banhji.cashDashboard.set('totalAdvance', kendo.toString(e.response.total_advance, 'c2'));
					}
				});
			}

			vm.pageLoad();
		}
	});
	banhji.router.route("/cash_center", function(){
		banhji.view.layout.showIn("#content", banhji.view.cashCenter);
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);
		var blank = new kendo.View('#blank-tmpl');
		var vm = banhji.cashCenter;
		banhji.cashCenter.accountTypeDS.read();
		banhji.userManagement.addMultiTask("Cash Center","cash_center",null);

		if(banhji.pageLoaded["cash_center"]==undefined){
			banhji.pageLoaded["cash_center"] = true;
   
		}
	});
	banhji.router.route("/cash(/:id)", function(id){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			var vm = banhji.cash;

			banhji.userManagement.addMultiTask("Cash","cash",vm);
						
			banhji.view.layout.showIn("#content", banhji.view.cash);
			kendo.fx($("#slide-form")).slideIn("down").play();

			if(banhji.pageLoaded["cash"]==undefined){
				banhji.pageLoaded["cash"] = true;

		        var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({
				    autoHideAfter: 5000,
				    width: 300,
				    height: 50
				}).data('kendoNotification');

		        $("#save").click(function(e){
					e.preventDefault();

					if(validator.validate() && vm.get("isDuplicateNumber")==false){
		            	vm.save();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});
			}

			vm.pageLoad(id);
		}
	});	
	banhji.router.route("/cash_deposit(/:id)(/:is_recurring)", function(id,is_recurring){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashDeposit);
			kendo.fx($("#slide-form")).slideIn("down").play();

			var vm = banhji.cashDeposit;

			banhji.userManagement.addMultiTask("Cash Deposit","cash_deposit",vm);
			
			if(banhji.pageLoaded["cash_deposit"]==undefined){
				banhji.pageLoaded["cash_deposit"] = true;

				var validator = $("#example").kendoValidator().data("kendoValidator");
				var notification = $("#notification").kendoNotification({
				    autoHideAfter: 5000,
				    width: 300,
				    height: 50
				}).data('kendoNotification');
				
		        $("#saveNew").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});

				$("#saveClose").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
		            	window.history.back();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});

				$("#savePrint").click(function(e){
					e.preventDefault();

					if(validator.validate()){
		            	vm.save();
		            	window.print();

		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});

				$("#saveRecurring").click(function(e){
					e.preventDefault();

					if(validator.validate() && vm.validateRecurring()){
		            	vm.saveRecurring();
		            	
		            	notification.success("Save Successful");
			        }else{
			        	notification.error("Warning, please review it again!");
			        }
				});
			}

			vm.pageLoad(id, is_recurring);
		}
	});
	banhji.router.route("/cash_report_center", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashReportCenter);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);

			//var vm = banhji.customerReportCenter;
			banhji.userManagement.addMultiTask("Cash Position","cash_report_center",null);
			
			if(banhji.pageLoaded["cash_report_center"]==undefined){
				banhji.pageLoaded["cash_report_center"] = true;	
			}
		}
	});
	banhji.router.route("/cash_list", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashList);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);

			var vm = banhji.cashList;
			banhji.userManagement.addMultiTask("Cash List","cash_list",null);
			
			if(banhji.pageLoaded["cash_list"]==undefined){
				banhji.pageLoaded["customer_list"] = true;
				
				vm.contactTypeDS.filter({ field:"parent_id", value:1 });
				vm.dataSource.filter({ field:"parent_id", operator:"where_related", model:"contact_type", value:1 });

				$("#grid").kendoGrid({
				    dataSource: vm.dataSource,
				    toolbar: ["excel"],
		            excel: {
		                fileName: "Cash_List.xlsx",
		                filterable: true
		            },
		            reorderable: true,
				    groupable: true,
				    sortable: true,
				    pageable: true,
				    columns:[
				    	{ field: "number", title:"Number" },
				    	{ field: "surname", title:"Surname" },
				    	{ field: "name", title:"Name" },
				    	{ field: "contact_type", title:"Type" }
				    ]
				});
			}
		}
	});
	banhji.router.route("/cash_setting", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.cashSetting);
			banhji.view.layout.showIn('#menu', banhji.view.menu);
			banhji.view.menu.showIn('#secondary-menu', banhji.view.cashMenu);

			var vm = banhji.cashSetting;
			
			banhji.userManagement.addMultiTask("General Cash Setting","cash_setting",null);
			
			if(banhji.pageLoaded["cash_setting"]==undefined){
				banhji.pageLoaded["cash_setting"] = true;

				vm.contactTypeDS.filter({ field:"parent_id", value: 1 });
			}

			vm.pageLoad();
		}
	});



	/*************************
	*   Water Section   *
	**************************/
	banhji.router.route("/water_center(/:id)", function(id){		
		banhji.view.layout.showIn("#content", banhji.view.waterCenter);
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
		
		var vm = banhji.waterCenter;

		banhji.userManagement.addMultiTask("Water Center","water_center",null);

		if(banhji.pageLoaded["water_center"]==undefined){
			banhji.pageLoaded["water_center"] = true;
		}

		vm.pageLoad(id);
	});
	banhji.router.route("/wMeter(/:id)", function(id){		
		banhji.view.layout.showIn("#content", banhji.view.wMeter);
		banhji.view.layout.showIn('#menu', banhji.view.menu);
		banhji.view.menu.showIn('#secondary-menu', banhji.view.waterMenu);
		
		var vm = banhji.wMeter;

		banhji.userManagement.addMultiTask("Water Meter","wMeter",null);

		if(banhji.pageLoaded["wMeter"]==undefined){
			banhji.pageLoaded["wMeter"] = true;
		}

		vm.pageLoad(id);
	});




	/*************************
	*   Reports Section   *
	**************************/
	banhji.router.route("/reports", function(){
		if(!banhji.userManagement.getLogin()){
			banhji.router.navigate('/manage');
		}else{
			banhji.view.layout.showIn("#content", banhji.view.reportDashboard);
			
			var vm = banhji.reportDashboard;
			banhji.userManagement.addMultiTask("Reports Dashboard","reports",null);

			if(banhji.pageLoaded["reports"]==undefined){
				banhji.pageLoaded["reports"] = true;
			}
			vm.pageLoad();
		}
	});


	$(function() {	
		banhji.router.start();
		banhji.source.loadData();
		console.log($(location).attr('hash').substr(2));

		function createCookie(name,value,days) {
		    if (days) {
		        var date = new Date();
		        date.setTime(date.getTime()+(days*24*60*60*1000));
		        var expires = "; expires="+date.toGMTString();
		    }
		    else var expires = "";
		    document.cookie = name+"="+value+expires+"; path=/";
		}
		function readCookie(name) {
		    var nameEQ = name + "=";
		    var ca = document.cookie.split(';');
		    for(var i=0;i < ca.length;i++) {
		        var c = ca[i];
		        while (c.charAt(0)==' ') c = c.substring(1,c.length);
		        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		    }
		    return null;
		}
		function eraseCookie(name) {
		    createCookie(name,"");
		}
	});
</script>